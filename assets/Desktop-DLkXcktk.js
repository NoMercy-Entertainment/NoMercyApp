import{$ as x,c as y,o as c,l,i as o,h as I,a7 as M,d as f,C as j,j as k,B as v,v as _,y as n,a0 as h,au as B,F as A,p as E,ar as T}from"./vue-ionic-BZKAFNsD.js";import{u as U}from"./useApiClient-dJX1JwVI.js";import{_ as F}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DOe_jPua.js";import{_ as $}from"./Button.vue_vue_type_script_setup_true_lang-DNNBfaYY.js";import{_ as L}from"./DashboardCard.vue_vue_type_script_setup_true_lang-Dfzst2b6.js";import{_ as N}from"./Avatar.vue_vue_type_script_setup_true_lang-TLqLSqA9.js";import{bd as z,h as S,w as D}from"./index-En-DH4bZ.js";import{u as K}from"./useServerClient-DggO6pli.js";import{_ as O}from"./Modal.vue_vue_type_script_setup_true_lang-DYkO2vPA.js";import"./vendor-B4CMB5r9.js";import"./icons-BW5E66pf.js";import"./rxjs-BCp2L9Rn.js";import"./media-C2AqgyMX.js";import"./api-BBofn2cc.js";import"./swiper-D00Cnjmx.js";import"./useInfiniteServerClient-DZr6viGI.js";import"./useMounted-Ddis8rGT.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-CTa4FlxL.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-CBcusWU1.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-BaVJO8ob.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-16zO7UkF.js";import"./music-player-4pEGVRj1.js";const Z={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},P=["src"],Q=x({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(u,d)=>(c(),y(L,{route:`/dashboard/users/${r.data.user_id}`,line1:r.data.name,line2:""},{image:l(()=>[o("div",Z,[d[0]||(d[0]=o("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(c(),I("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,P)):(c(),y(N,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"]))}}),W={class:"flex w-full flex-col justify-start text-left"},G={class:"py-4 text-sm text-auto-10"},H={class:"flex flex-col gap-2 w-full"},J={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},R=x({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const u=r,{t:d}=M();f(null);const a=f(""),p=f([]),{data:b}=K({path:"/dashboard/libraries"}),s=f();function g(){p.value=[],u.close()}function m(i){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(i).toLowerCase())}const w=j(()=>a.value?m(a.value):!1);function V(){var i,e;if(!a.value){p.value.push({type:"error",place:"email",message:d("Email is required")});return}if(!m(a.value)){p.value.push({type:"error",place:"email",message:d("Invalid email address")});return}z().post("server/server-users",{id:(i=S.value)==null?void 0:i.id,email:a.value,libraries:(e=s.value)==null?void 0:e.map(t=>t.id)}).then(()=>{D.invalidateQueries({queryKey:["server_users"]}),a.value="",u.close()}).catch(({response:t})=>{(t==null?void 0:t.status)!==200&&(t!=null&&t.data)&&p.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})}return(i,e)=>{const t=k("InputText"),q=k("MultiSelect");return c(),y(O,{open:r.open,close:g,title:"Invite user"},{actions:l(()=>[n($,{id:"yes",type:"button",color:"theme",variant:"contained","end-icon":"emailSend",disabled:!w.value,onClick:V},{default:l(()=>[v(_(i.$t("Send")),1)]),_:1},8,["disabled"]),n($,{id:"no",type:"button",variant:"text",onClick:g},{default:l(()=>[v(_(i.$t("Cancel")),1)]),_:1})]),default:l(()=>[o("div",W,[o("p",G,[v(_(i.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=o("br",null,null,-1)),v(" "+_(i.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),o("div",H,[e[3]||(e[3]=o("label",{for:"email"},"Email",-1)),n(t,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=C=>a.value=C),class:"mb-4"},null,8,["modelValue"])]),o("div",J,[e[4]||(e[4]=o("label",{for:"libraries"},"Allowed libraries",-1)),n(q,{id:"libraries",modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=C=>s.value=C),display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:h(b),"option-label":"title"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),ge=x({__name:"Desktop",setup(r){var b;const u=f(!1),{data:d}=U({path:"server/server-users",params:{id:(b=S.value)==null?void 0:b.id},queryKey:["server_users"]});function a(){u.value=!0,setTimeout(()=>{var s;(s=document.querySelector("#email"))==null||s.focus()},300)}function p(){u.value=!1}return(s,g)=>(c(),y(h(T),null,{default:l(()=>[n(h(B),{fullscreen:!0},{default:l(()=>[n(F,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[n($,{id:"invite",color:"theme","start-icon":"userAdd",onClick:a},{default:l(()=>[v(_(s.$t("Invite user")),1)]),_:1})]),default:l(()=>[(c(!0),I(A,null,E([...h(d)??[]].sort((m,w)=>m.name.localeCompare(w.name)),m=>(c(),y(Q,{key:m.user_id,data:m},null,8,["data"]))),128)),n(R,{open:u.value,close:p},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{ge as default};
