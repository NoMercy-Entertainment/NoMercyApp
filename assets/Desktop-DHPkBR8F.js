import"./useInfiniteServerClient-ChzPawtk.js";import{A as $,Cl as I,Dl as u,El as m,Hl as d,Js as A,Kl as x,O as C,Sr as E,Wl as B,bl as i,ec as D,es as S,hl as j,hu as b,kl as k,ll as w,su as p,tu as l,wa as T,xl as f,yl as L,yu as v}from"./index-Rmty3EhQ.js";import{n as K}from"./dist-DQBaa2g2.js";import"./md5-BZOwRlJL.js";import{t as N}from"./useServerClient-CbixTTZm.js";import"./ScrollContainer-D9yWZpjD.js";import"./useMounted-DUlgn5dG.js";import"./RipperOverlay-Di0OgBTb.js";import"./ripperSocket-CM7We1k2.js";import"./FloatingBackButton-EzlyyCkz.js";import{t as O}from"./DashboardLayout-DPr-WzPB.js";import{t as z}from"./DashboardCard-ANTbTLXr.js";import{t as F}from"./useApiClient-CnmBnXMe.js";import{t as W}from"./Avatar-kNDF3182.js";w();var Z={class:"backdropCard relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},H=["src"],J=k({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){const s=p(!1);function c(e){console.error(e),e.target.onerror=null,s.value=!0}return(e,o)=>(d(),f(z,{line1:r.data.name,route:`/dashboard/users/${r.data.user_id}`,line2:""},{image:l(()=>[i("div",Z,[o[0]||(o[0]=i("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar&&!s.value?(d(),I("img",{key:0,onerror:c,src:r.data.avatar,alt:"",class:"w-full h-full object-cover rounded-lg backdropCard-image"},null,8,H)):(d(),f(W,{key:1,email:r.data.email,class:"w-full backdropCard-image"},null,8,["email"]))])]),_:1},8,["line1","route"]))}}),P=J;w();var Q={class:"flex w-full flex-col justify-start text-left"},G={class:"py-4 text-sm text-surface-10"},R={class:"flex flex-col gap-2 w-full"},X={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},Y=k({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const s=r,{t:c}=K();p(null);const e=p(""),o=p([]),{data:h}=N({path:"/dashboard/libraries"}),_=p();function n(){o.value=[],s.close()}function y(a){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(a).toLowerCase())}const M=L(()=>e.value?y(e.value):!1);function V(){if(!e.value){o.value.push({type:"error",place:"email",message:c("Email is required")});return}if(!y(e.value)){o.value.push({type:"error",place:"email",message:c("Invalid email address")});return}E().post("server/server-users",{id:S.value?.id,email:e.value,libraries:_.value?.map(a=>a.id)}).then(()=>{T.invalidateQueries({queryKey:["server_users"]}),e.value="",s.close()}).catch(({response:a})=>{a?.status!==200&&a?.data&&o.value.push({message:a.data.message??"An error occurred",place:"email",type:a.data.status??a.data.exception})})}return(a,t)=>{const q=x("InputText"),U=x("MultiSelect");return d(),f($,{close:n,open:r.open,title:"Invite user"},{actions:l(()=>[u(C,{id:"yes",disabled:!M.value,color:"theme","end-icon":"emailSend",type:"button",variant:"contained",onClick:V},{default:l(()=>[m(v(a.$t("Send")),1)]),_:1},8,["disabled"]),u(C,{id:"no",type:"button",variant:"text",onClick:n},{default:l(()=>[m(v(a.$t("Cancel")),1)]),_:1})]),default:l(()=>[i("div",Q,[i("p",G,[m(v(a.$t("Enter the email of the friend you want to invite to your server.")),1),t[2]||(t[2]=i("br",null,null,-1)),m(" "+v(a.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",R,[t[3]||(t[3]=i("label",{for:"email"},"Email",-1)),u(q,{id:"email",modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=g=>e.value=g),class:"mb-4"},null,8,["modelValue"])]),i("div",X,[t[4]||(t[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),u(U,{id:"libraries",modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=g=>_.value=g),options:b(h),display:"chip",label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),ee=Y;w();var ae=k({__name:"Desktop",setup(r){const s=p(!1),{data:c}=F({path:"server/server-users",params:{id:S.value?.id},queryKey:["server_users"]});function e(){s.value=!0,setTimeout(()=>{document.querySelector("#email")?.focus()},300)}function o(){s.value=!1}return(h,_)=>(d(),f(b(D),null,{default:l(()=>[u(b(A),{fullscreen:!0},{default:l(()=>[u(O,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[u(C,{id:"invite",color:"theme","start-icon":"userAdd",onClick:e},{default:l(()=>[m(v(h.$t("Invite user")),1)]),_:1})]),default:l(()=>[(d(!0),I(j,null,B([...b(c)??[]].sort((n,y)=>n.name.localeCompare(y.name)),n=>(d(),f(P,{key:n.user_id,data:n},null,8,["data"]))),128)),u(ee,{open:s.value,close:o},null,8,["open"])]),_:1})]),_:1})]),_:1}))}}),_e=ae;export{_e as default};
