import{_ as ve,c as h,o as i,a as n,m as L,I as S,C as p,eL as Z,cC as J,t as C,A,eM as ee,eN as k,eO as me,eP as te,eQ as re,R as ae,l as b,E as z,ek as he,b0 as ge,d as v,s as d,j as f,b as j,h as se,F as _,K as y,eR as K,w as ye,bu as xe,bh as be}from"./index-H-vD2rqS.js";import{c as w,d as E,_ as we}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DuAJYD1Y.js";import{B as ke,s as Ce}from"./index-C5qO4Eqs.js";import{u as _e}from"./useMounted-Dveo4ZJ5.js";import{u as Pe}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-BgPrKIqK.js";import{u as I}from"./useServerClient-DCS4BGnu.js";import{a as M,S as T,_ as F}from"./ServerTasksCard.vue_vue_type_script_setup_true_lang-ToAu10p3.js";import{d as Se}from"./colorScheme-Ctim-6os.js";import{_ as $e}from"./ActivityCard.vue_vue_type_script_setup_true_lang-DU8cpnwc.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-Dccf_qNw.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-CX14zQZK.js";import"./Button.vue_vue_type_script_setup_true_lang-Cx9uFmF_.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-OA0oELVZ.js";import"./ripperSocket-VzNd0LM5.js";import"./useQuery-C5_JtCKV.js";import"./useBaseQuery-x8hgGQVw.js";import"./useQueryClient-B5STIjF7.js";import"./useInfiniteServerClient-B-2LPPx2.js";import"./KeepCounting.vue_vue_type_script_setup_true_lang-BloLwhcd.js";import"./index-5TqZ8QDo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DCTDKyIe.js";var Oe={root:{position:"relative"}},je={root:"p-chart"},Ae=ke.extend({name:"chart",classes:je,inlineStyles:Oe}),Ie={name:"BaseChart",extends:Ce,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:Ae,provide:function(){return{$pcChart:this,$parentInstance:this}}},oe={name:"Chart",extends:Ie,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var e=this;ve(()=>import("./auto-Cj0TocxD.js"),[]).then(function(r){e.chart&&(e.chart.destroy(),e.chart=null),r&&r.default&&(e.chart=new r.default(e.$refs.canvas,{type:e.type,data:e.data,options:e.options,plugins:e.plugins})),e.$emit("loaded",e.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(e){if(this.chart){var r=this.chart.getElementsAtEventForMode(e,"nearest",{intersect:!0},!1),s=this.chart.getElementsAtEventForMode(e,"dataset",{intersect:!0},!1);r&&r[0]&&s&&this.$emit("select",{originalEvent:e,element:r[0],dataset:s})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function P(t){"@babel/helpers - typeof";return P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(t)}function Q(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,s)}return r}function W(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Q(Object(r),!0).forEach(function(s){Me(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Me(t,e,r){return(e=Ne(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ne(t){var e=Re(t,"string");return P(e)=="symbol"?e:e+""}function Re(t,e){if(P(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(P(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var De=["width","height"];function Be(t,e,r,s,u,l){return i(),h("div",L({class:t.cx("root"),style:t.sx("root")},t.ptmi("root")),[n("canvas",L({ref:"canvas",width:t.width,height:t.height,onClick:e[0]||(e[0]=function(g){return l.onCanvasClick(g)})},W(W({},t.canvasProps),t.ptm("canvas"))),null,16,De)],16)}oe.render=Be;const Ue={class:"flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch text-slate-light-11/80 dark:text-slate-dark-11/80"},ze={class:"flex flex-grow flex-col items-start justify-start gap-1 text-left"},Ee={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start self-stretch"},Ge={class:"w-8 flex-shrink-0 flex-grow-0 text-sm"},Ve={class:"relative h-2 flex-grow rounded-lg"},qe={class:"w-10 flex-shrink-0 flex-grow-0 text-right text-sm"},He=S({__name:"ResourceBar",props:{cpu:{type:Number,required:!0,default:0},value:{type:Number,required:!0,default:0}},setup(t){const e=t,r=p(()=>Z.value?J(e.value,ee):"rgb(var(--color-focus))");return(s,u)=>(i(),h("div",Ue,[n("div",ze,[n("div",Ee,[n("p",Ge,C(t.cpu),1),n("div",Ve,[u[0]||(u[0]=n("div",{class:"absolute h-2 w-full rounded left-[-1px] top-[-1px] bg-auto-2 dark:bg-auto-1"},null,-1)),n("div",{class:"absolute h-2 rounded transition-all duration-500 left-[-1px] top-[-1px]",style:A({width:`${t.value}%`,backgroundImage:`linear-gradient(90deg, ${r.value} 0%, ${r.value} 100%)`})},null,4)]),n("p",qe,C(Math.floor(t.value))+"% ",1)])])]))}}),Le={class:"relative flex aspect-video h-auto w-full flex-1 flex-shrink-0 flex-col items-start justify-center gap-1 flex-grow-1"},Ke={class:"relative h-full flex-1 flex-shrink-0 w-available"},Te={class:"absolute top-2/3 left-1/2 -translate-x-1/2 text-center font-semibold text-[2.5vw] monospace sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.6vw]"},Fe={class:"flex-shrink-0 flex-grow-0 scale-75 self-stretch text-center text-sm font-semibold w-available text-[2.5vw] sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.7vw]"},U=S({__name:"ResourceCircle",props:{name:{type:String,required:!0},value:{type:Number,required:!0},size:{type:Number,required:!0}},setup(t){const e=t,r=p(()=>{if(Z.value)return J(e.value,ee);switch(e.name){case"CPU":return k(re,50);case"Memory":return k(te,50);case"GPU":return k(me,50)}}),s=p(()=>Math.PI*72),u=p(()=>(1-(e.value===-1?0:e.value)/100)*s.value);return(l,g)=>(i(),h("div",Le,[n("div",Ke,[(i(),h("svg",{viewBox:"0 0 152 148",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"absolute inset-2 mx-auto rounded",style:A({width:t.size*2,height:t.size*2}),preserveAspectRatio:"xMidYMid meet"},[g[0]||(g[0]=n("path",{d:"M148 76C148 66.5448 146.138 57.1822 142.519 48.4468C138.901 39.7114 133.598 31.7741 126.912 25.0883C120.226 18.4025 112.289 13.099 103.553 9.48068C94.8178 5.86234 85.4552 4 76 4C66.5448 3.99999 57.1823 5.86232 48.4468 9.48066C39.7114 13.099 31.7742 18.4025 25.0883 25.0883C18.4025 31.7741 13.099 39.7113 9.48069 48.4468C5.86234 57.1822 4 66.5448 4 76",class:"stroke-auto-2 dark:stroke-auto-1","stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),n("path",{class:"absolute -top-1 -left-1 h-2 rounded transition-all duration-500",d:"M4 76C4 56.9044 11.5857 38.5909 25.0883 25.0883C38.5909 11.5857 56.9044 4 76 4C95.0956 4 113.409 11.5857 126.912 25.0883C140.414 38.5909 148 56.9044 148 76",style:A({stroke:r.value,strokeDasharray:s.value,strokeDashoffset:u.value}),"stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,4)],4)),n("p",Te,C(t.value===-1?l.$t(""):Math.floor(t.value))+C(t.value===-1?"":"%"),1)]),n("p",Fe,C(t.name),1)]))}}),Qe={class:"flex items-start justify-between gap-2 overflow-clip w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},We={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start self-stretch"},x=40,X=S({__name:"ServerResourceCard",setup(t){const{data:e}=I({path:"dashboard/server/info",queryKey:["serverInfo",ae.value?.serverBaseUrl]}),r=b(),s=b("graph"),u=b(Array.from({length:x}).fill("")),l=b(Array.from({length:x}).fill(null)),g=b(Array.from({length:x}).fill(null)),N=b(Array.from({length:x}).fill([null]));_e(()=>w.value?.invoke("StartResources"),()=>w.value?.invoke("StopResources").catch(),10);function ne(){w.value?.invoke("StartResources")}z(()=>{he()?.onreconnected(ne)});const G=p(()=>r.value?.cpu?.core?.toSorted((a,o)=>a.index-o.index)??[]),R=p(()=>r.value?.gpu?.toSorted((a,o)=>a.index-o.index).map(a=>(a.power+a.core)/2)??[]),V=p(()=>r.value?.cpu?.core?.length?Math.floor(G.value?.reduce((a,o)=>a+o.utilization,0)/G.value.length):-1),q=p(()=>r.value?.memory?.percentage==="NaN"?-1:r.value?.memory?.percentage??-1),le=p(()=>{if(r.value?.gpu?.length===0)return-1;const a=Math.floor(R.value?.reduce((o,c)=>o+c,0)/R.value.length);return Number.isNaN(a)?-1:a}),D=p(()=>(window.innerWidth-5e3)/3);function ie(a){if(a.length===1)return[{color:K(a[0]),opacity:50}];const $=50/2,H=[];for(let O=0;O<a.length;O++){const fe=25+O%3*$;H.push({color:K(a[O]),opacity:fe})}return H}function ue(a){a&&(r.value=a,l.value=[...l.value.slice(-x),V.value],g.value=[...g.value.slice(-x),q.value],N.value=[...N.value.slice(-x),R.value])}Pe(w,"ResourceUpdate",ue);const ce=p(()=>({labels:u.value,datasets:[...e.value?.cpu?.map((a,o)=>{const c=re;return{label:`CPU ${e.value?.cpu.length>1?o:""}`,data:l.value,yAxisID:"y",borderColor:k(c,50)}})??[],{label:"Memory",data:g.value,yAxisID:"y",borderColor:k(te,50)},...e.value?.gpu?.map((a,o)=>{const c=ie(e.value?.gpu)[o],m=k(c.color,c.opacity);return{label:`GPU ${e.value?.gpu.length>1?o:""}`,data:N.value.map($=>$[o]),yAxisID:"y",borderColor:m}})??[]]})),B=ge("legendPosition","bottom"),pe=p(()=>{const a=getComputedStyle(document.documentElement),o=Se.value?`rgb(${a.getPropertyValue("--color-slate-12")})`:`rgb(${a.getPropertyValue("--color-slate-1")})`,c=a.getPropertyValue("--p-content-border-color"),m=["left","top","right","bottom"];return{indexAxis:"x",maintainAspectRatio:!1,animation:!1,plugins:{legend:{labels:{color:o},value:B.value,onClick(){B.value=m[(m.indexOf(B.value)+1)%m.length]}}},elements:{line:{tension:.2},point:{pointStyle:!1}},scales:{x:{ticks:{color:"transparent"},grid:{color:"transparent"}},y:{min:0,max:100,beginAtZero:!0,clip:!0,ticks:{color:o},grid:{color:c}}}}}),de=p(()=>`${(e.value?.gpu?.length??0)*40+120}px`);return(a,o)=>(i(),v(M,{title:"Resources monitor"},{cta:d(()=>[...o[0]||(o[0]=[])]),default:d(()=>[n("div",Qe,[f(U,{name:"CPU",value:V.value,size:D.value},null,8,["value","size"]),o[1]||(o[1]=n("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),f(U,{name:"Memory",value:q.value,size:D.value},null,8,["value","size"]),o[2]||(o[2]=n("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),f(U,{name:"GPU",value:le.value,size:D.value},null,8,["value","size"])]),n("div",We,[s.value==="bar"?(i(!0),h(_,{key:0},se(r.value?.cpu?.core??[],(c,m)=>(i(),h(_,{key:c.index},[Number.isNaN(c.utilization)?j("",!0):(i(),v(He,{key:0,cpu:m,value:c.utilization},null,8,["cpu","value"]))],64))),128)):j("",!0),s.value==="graph"?(i(),v(y(oe),{key:1,type:"line",data:ce.value,options:pe.value,style:A(`height: ${de.value}`),class:"w-available"},null,8,["data","options","style"])):j("",!0)])]),_:1}))}}),Y=S({__name:"ServerActivityCard",setup(t){const{data:e}=I({path:"dashboard/activity",refetchInterval:1e4,data:{take:999},queryKey:["server","activity"]}),{data:r}=I({path:"dashboard/devices",refetchInterval:1e4,queryKey:["devices"]});return(s,u)=>y(E)?(i(),v(M,{key:0,title:"Activity",background:!1},{cta:d(()=>[...u[0]||(u[0]=[])]),default:d(()=>[(i(!0),h(_,null,se(y(e)?.slice(0,5)??[],l=>(i(),v($e,{key:l?.id,devices:y(r)??[],activity:l},null,8,["devices","activity"]))),128))]),_:1})):j("",!0)}}),Xe={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-1 xl:row-start-1"},Ye={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-3 xl:row-start-1"},Ze={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 lg:col-start-1 lg:row-start-2 2xl:col-span-2 2xl:col-start-5 2xl:row-start-1 2xl:flex"},kt=S({__name:"Desktop",setup(t){const e=b(!0);ye(w,u=>{e.value=!!u}),z(()=>{setTimeout(()=>{e.value=!!w.value},1e3)});const{data:r}=I({path:"dashboard/server/storage",queryKey:["dashboard","storage",ae.value?.serverBaseUrl]});z(()=>{console.raw(r.value)});const s=p(()=>window.CSS.supports("grid-template-rows: masonry"));return(u,l)=>(i(),v(y(be),null,{default:d(()=>[f(y(xe),{fullscreen:!0},{default:d(()=>[f(we,{title:"Dashboard overview","grid-style":s.value?3:2,styles:"grid-template-rows: masonry; masonry-auto-flow: next;"},{cta:d(()=>[...l[0]||(l[0]=[])]),default:d(()=>[s.value?(i(),h(_,{key:0},[f(T),f(F),f(Y),y(E)?(i(),v(X,{key:0})):(i(),v(M,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:d(()=>[...l[1]||(l[1]=[])]),default:d(()=>[l[2]||(l[2]=n("div",{class:"min-h-80"},null,-1))]),_:1}))],64)):(i(),h(_,{key:1},[n("div",Xe,[f(T),y(E)?(i(),v(X,{key:0})):(i(),v(M,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:d(()=>[...l[3]||(l[3]=[])]),default:d(()=>[l[4]||(l[4]=n("div",{class:"min-h-80"},null,-1))]),_:1}))]),n("div",Ye,[f(F)]),n("div",Ze,[f(Y)])],64))]),_:1},8,["grid-style"])]),_:1})]),_:1}))}});export{kt as default};
