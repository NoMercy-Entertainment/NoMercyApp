import{e4 as B,I as L,l as I,w as A,ci as P,ai as m,ah as b,eh as $,d as v,o as w,s as x,j as z,K as T,bu as M,c6 as U,a as S,bh as D,S as y,R as _,a5 as g,bL as V,ei as j,ej as N,at as R}from"./index-4xkagrUD.js";import{g as f}from"./imageModal-C_R_PIu2.js";import{S as H,O as q}from"./octopusPlugin-B4krDOsM.js";import{A as O}from"./autoSkipPlugin-xYyJalpZ.js";import{B as X,c as F,l as K,a as W,b as G,n as J}from"./subtitles-octopus-D5kU1jMP.js";import{u as Q}from"./useServerClient-B7mr_MDk.js";import{K as Y}from"./keyHandlerPlugin-CFA8JXjs.js";import"./buttons-IwPh3z7u.js";import"./useQuery-BV5bz1Dq.js";import"./useBaseQuery-bD5-uZ52.js";import"./useQueryClient-BxrKgI38.js";import"./useInfiniteServerClient-B5bQCKha.js";class Z extends X{preScreen={};episodeScreen={};languageScreen={};selectedSeason;hasPlayed=!1;tvDialogStyles=["w-available","h-available","max-w-available","max-h-available",""];use(){this.player.container.style.display="contents",this.createTvOverlay(this.player.overlay),this.createPreScreen(this.player.overlay),this.createEpisodeScreen(this.player.overlay),this.createLanguageScreen(this.player.overlay),this.player.options.autoPlay||this.showPreScreen(),this.player.once("firstFrame",()=>{this.hasPlayed=!0}),this.player.on("play",()=>{this.player.emit("show-seek-container",!1),this.player.getVideoElement().scrollIntoView(),this.closePreScreen(),this.closeEpisodeScreen(),this.closeLanguageScreen()}),this.player.on("back-button",this.backMenu.bind(this)),this.player.on("pause",()=>{this.player.overlay.scrollIntoView()}),this.player.once("ready",()=>{this.showPreScreen(),this.player.pause()})}backMenu(){this.player.isTv()&&this.currentMenu!=="seek"&&(this.player.container.classList.contains("episode-screen")?this.closeEpisodeScreen():this.player.container.classList.contains("language-screen")?this.closeLanguageScreen():this.player.container.classList.contains("pre-screen")?this.player.emit("back"):(this.player.pause(),this.showPreScreen()))}createTvOverlay(o){const e=this.player.createElement("div","tv-overlay").addClasses(["absolute","flex","flex-col","justify-end","gap-4","w-available","h-available","z-0"]).addClasses(["group-[&.nomercyplayer.paused.pre-screen]:hidden"]).appendTo(o).get(),s=this.createTopBar(e);this.player.addClasses(s,["px-10","pt-10","z-0"]);const t=this.createRestartButton(s,!0);this.player.addClasses(t,["children:stroke-2"]);const a=this.createNextButton(s,!0);this.player.addClasses(a,["children:stroke-2"]),this.createDivider(s),this.createTvCurrentItem(s),this.createOverlayCenterMessage(e),this.createSpinnerContainer(e),this.seekContainer=this.createSeekContainer(e);const l=this.createBottomBar(e),n=this.player.createElement("div","bottom-row").addClasses(["tv-bottom-row","relative","flex","flex-row","items-center","gap-4","mt-auto","w-available","px-20","pb-10","z-0"]).appendTo(l).get();this.createPlaybackButton(n,!0),this.createTime(n,"current",[]),this.createTvProgressBar(n),this.createTime(n,"remaining",["mr-14"]),this.player.on("playing",()=>{this.currentMenu!=="seek"&&!this.controlsVisible&&this.playbackButton.focus(),this.currentScrubTime=this.getClosestSeekableInterval()});let r=t??a;[t,a].forEach(i=>{i?.addEventListener("keydown",c=>{c.key==="ArrowDown"?!this.nextUp.style||this.nextUp.style.display==="none"?this.playbackButton?.focus():this.nextUp.lastChild?.focus():c.key==="ArrowLeft"?(r=c.target.previousElementSibling,r?.focus()):c.key==="ArrowRight"&&(c.preventDefault(),r=c.target.nextElementSibling,r?.focus())})}),[this.nextUp.firstChild,this.nextUp.lastChild].forEach(i=>{i?.addEventListener("keydown",c=>{c.key==="ArrowUp"?(r||t)?.focus():c.key==="ArrowDown"?this.playbackButton.focus():c.key==="ArrowLeft"?this.nextUp.firstChild?.focus():c.key==="ArrowRight"&&this.nextUp.lastChild?.focus()})}),[this.playbackButton].forEach(i=>{i?.addEventListener("keydown",c=>{c.key==="ArrowUp"&&(c.preventDefault(),this.nextUp?.classList?.contains("visible")?this.nextUp?.focus():r?.focus())})});let p=!1;const d=i=>{const c=i.target;if(i.key==="ArrowLeft"){if([t.id,a.id,this.nextUp.firstChild?.id,this.nextUp.lastChild?.id].includes(c?.id))return;if(i.preventDefault(),this.player.emit("show-seek-container",!0),this.shouldSlide)this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()}),this.shouldSlide=!1;else{const u=this.currentScrubTime-10;p=!0,this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:u})}}else if(i.key==="ArrowRight"){if([t.id,a.id,this.nextUp.firstChild?.id,this.nextUp.lastChild?.id].includes(c?.id))return;if(i.preventDefault(),this.player.emit("show-seek-container",!0),this.shouldSlide)this.currentScrubTime=this.player.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.player.getClosestSeekableInterval()}),this.shouldSlide=!1;else{const u=this.currentScrubTime+10;p=!0,this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:u})}}else i.key==="Enter"&&(Math.abs(this.currentScrubTime-this.player.getCurrentTime())>5&&p?(this.player.seek(this.currentScrubTime),p=!1):i.target===document.body&&this.player.togglePlayback())};return[window,t,a].forEach(i=>{i?.addEventListener("keydown",d),this.player.on("dispose",()=>{i?.removeEventListener("keydown",d)})}),this.player.on("active",i=>{!this.controlsVisible&&i&&this.playbackButton.focus(),this.player.overlay.scrollIntoView(),setTimeout(()=>{this.controlsVisible=i},0)}),l}showPreScreen(){this.preScreen.showModal(),this.preScreen.querySelector(".button-container>button")?.focus(),setTimeout(()=>{this.player.container.classList.add("pre-screen")},5)}closePreScreen(){this.preScreen.close(),this.player.emit("hideControls"),this.player.container.classList.remove("pre-screen")}createPreScreen(o){this.preScreen=this.player.createElement("dialog","pre-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused:not(.open)]:backdrop:bg-black/80","group-[&.nomercyplayer.paused:not(.open)]:backdrop:pointer-events-none"]).appendTo(o).get(),this.preScreen.setAttribute("popover","manual"),this.preScreen.setAttribute("role","modal");const e=this.player.createElement("div","pre-screen").addClasses(["pre-screen","absolute","inset-0","flex","p-6","text-white","w-available","h-available","z-0"]).addClasses(["group-[&.nomercyplayer.paused.episode-screen]:hidden","group-[&.nomercyplayer.paused.language-screen]:hidden"]).appendTo(this.preScreen).get(),s=this.player.createElement("div","left-side").addClasses(["flex","flex-col","justify-between","items-center","w-1/2","h-available"]).appendTo(e).get(),t=this.createImageContainer(s),a=this.player.createElement("div","title-container").addClasses(["flex","flex-col","w-available","h-available"]).appendTo(t).get(),l=this.player.createElement("div","title").addClasses(["flex","text-white","text-lg","font-bold","mx-2"]).appendTo(a).get(),n=this.player.createElement("div","description").addClasses(["text-left","text-white","text-sm","line-clamp-4","font-bold","leading-5","overflow-hidden","mx-2"]).appendTo(a).get();this.player.on("item",()=>{l.innerHTML=this.player.playlistItem().title.replace(this.player.playlistItem().show??"","").replace("%S",this.player.localize("S")).replace("%E",this.player.localize("E")),n.innerHTML=this.player.playlistItem().description});const r=this.player.createElement("div","button-container").addClasses(["button-container","flex","flex-col","gap-3","w-available","h-1/2","mt-7","mb-3","overflow-auto","p-2","[*::-webkit-scrollbar]:hidden"]).appendTo(s).get();this.createTvButton(r,"play",null,this.player.play,this.buttons.play),this.createTvButton(r,"restart","Play from beginning",this.player.restart,this.buttons.restart);const p=this.createTvButton(r,"showEpisodeMenu","Episodes",()=>this.player.emit("showEpisodeScreen"),this.buttons.playlist);p.style.display="none",p.addEventListener("click",()=>{this.player.emit("switch-season",this.player.playlistItem().season),this.showEpisodeScreen()});const d=this.createTvButton(r,"showLanguageMenu","Audio and subtitles",()=>this.player.emit("showLanguageScreen"),this.buttons.language);d.style.display="none",d.addEventListener("click",()=>{this.showLanguageScreen()}),this.player.createElement("div","pre-screen-right-side").addClasses(["flex","flex-col","justify-center","w-1/3","h-available"]).appendTo(e).get(),this.player.on("audioTracks",()=>{this.player.hasAudioTracks()||this.player.hasCaptions()?d.style.display="flex":d.style.display="none"}),this.player.on("item",()=>{this.player.getPlaylist().length>1?p.style.display="flex":p.style.display="none"})}showEpisodeScreen(){this.episodeScreen.showModal(),this.player.container.classList.add("episode-screen"),this.player.container.classList.add("open"),this.episodeScrollContainer.querySelector(".button-container>button")?.focus()}closeEpisodeScreen(){this.episodeScreen.close(),this.player.container.classList.remove("episode-screen"),this.player.container.classList.remove("open"),this.preScreen.querySelector(".button-container>button")?.focus()}createEpisodeScreen(o){this.episodeScreen=this.player.createElement("dialog","episode-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused.episode-screen]:backdrop:bg-black/80","group-[&.nomercyplayer.paused.episode-screen]:backdrop:pointer-events-none"]).appendTo(o).get(),this.episodeScreen.setAttribute("popover","manual"),this.episodeScreen.setAttribute("role","modal");const e=this.player.createElement("div","episode-screen").addClasses(["episode-screen","absolute","inset-0","flex","gap-4","p-6","text-white","w-available","h-available","z-0"]).appendTo(this.episodeScreen).get(),s=this.player.createElement("div","episode-screen-left-side").addClasses(["flex","flex-col","justify-between","items-center","w-2/5","h-available"]).appendTo(e).get();this.createImageContainer(s);const t=this.player.createElement("div","season-button-container").addClasses(["flex","flex-col","gap-3","w-available","h-available","mt-7","mb-3","overflow-auto","px-2","py-0.5","[*::-webkit-scrollbar]:hidden"]).appendTo(s).get();this.player.once("playlist",()=>{const a=this.player.createElement("div","episode-screen-right-side").addClasses(["flex","flex-col","justify-center","w-3/5","h-available"]).appendTo(e).get();this.episodeScrollContainer=this.player.createElement("div","episode-button-container").addClasses(["button-container","flex","flex-col","overflow-auto","h-available","pt-6","gap-2","p-1","min-h-[50%]","scroll-p-4","scroll-smooth"]).appendTo(a).get();let l={};for(const n of this.player.getSeasons())l=this.createTvSeasonButton(t,`season-${n.season}`,n,()=>this.player.emit("switch-season",n.season));l.addEventListener?.("keydown",n=>{if(n.key!=="ArrowLeft"){if(n.key!=="ArrowRight"){if(!(n.key==="ArrowUp"&&!this.player.options.disableTouchControls)){if(n.key==="ArrowDown"&&!this.player.options.disableTouchControls){l.nextElementSibling?.focus();const r=l.nextElementSibling;r?.nodeName==="BUTTON"?r?.focus():l.parentElement.nextElementSibling?.focus()}}}}});for(const[n,r]of this.player.getPlaylist().entries()??[])this.createTvEpisodeMenuButton(this.episodeScrollContainer,r,n)})}showLanguageScreen(){this.languageScreen.showModal(),this.player.container.classList.add("language-screen"),this.player.container.classList.add("open"),this.languageScreen.querySelector(".button-container>button")?.focus()}closeLanguageScreen(){this.languageScreen.close(),this.player.container.classList.remove("language-screen"),this.player.container.classList.remove("open"),this.preScreen.querySelector(".button-container>button")?.focus()}createLanguageScreen(o){this.languageScreen=this.player.createElement("dialog","language-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused.language-screen]:backdrop:bg-black/80","group-[&.nomercyplayer.paused.language-screen]:backdrop:pointer-events-none"]).appendTo(o).get(),this.languageScreen.setAttribute("popover","manual"),this.languageScreen.setAttribute("role","modal");const e=this.player.createElement("div","language-screen").addClasses(["language-screen","absolute","inset-0","flex","p-6","text-white","w-available","h-available","z-0"]).appendTo(this.languageScreen).get(),s=this.player.createElement("div","language-screen-left-side").addClasses(["flex","flex-col","items-center","overflow-clip","w-2/5","h-available"]).appendTo(e).get();this.createImageContainer(s);const t=this.player.createElement("div","language-scroll-container").addClasses(["flex","flex-col","overflow-auto","w-available","h-available","gap-3","scroll-p-4","scroll-smooth","border-transparent","outline-transparent","p-1"]).appendTo(s).get();t.addEventListener("focus",()=>{t.querySelector("button")?.focus()});const a=this.player.createElement("div","language-button-container").addClasses(["flex-shrink-0","h-auto","px-2","py-0.5","w-available","text-left","mt-3"]).appendTo(t).get();a.textContent=this.player.localize("Audio");const l=this.player.createElement("div","language-button-container").addClasses(["[*::-webkit-scrollbar]:hidden","flex","flex-col","flex-shrink-0","gap-3","px-2","py-0.5","w-available"]).appendTo(t).get();l.style.paddingRight="5rem";let n={};const r=i=>{if(i.key!=="ArrowLeft"){if(i.key!=="ArrowRight"){if(i.key==="ArrowUp"&&!this.player.options.disableTouchControls)i.target.previousElementSibling?.focus();else if(i.key==="ArrowDown"&&!this.player.options.disableTouchControls){const c=i.target.nextElementSibling;c?.nodeName==="BUTTON"?c?.focus():n.parentElement.nextElementSibling?.focus()}}}};n.removeEventListener?.("keydown",r),this.player.on("audioTracks",i=>{l.innerHTML="";for(const[c,u]of i?.entries()??[])n=this.createLanguageMenuButton(l,{language:u.language??"",label:u.label??"",type:u.type??"",id:u.id??c-1,buttonType:"audio"})});const p=this.player.createElement("div","language-button-container").addClasses(["flex-shrink-0","h-auto","px-2","py-0.5","w-available","text-left","mt-3"]).appendTo(t).get();p.textContent=this.player.localize("Subtitles");const d=this.player.createElement("div","subtitle-button-container").addClasses(["[*::-webkit-scrollbar]:hidden","flex","flex-col","flex-shrink-0","gap-3","flex-shrink-0","px-2","py-0.5","w-available"]).appendTo(t).get();d.style.paddingRight="5rem",d.style.marginTop="0",this.player.on("captionsList",i=>{d.innerHTML="";for(const[c,u]of i.entries()??[])this.createLanguageMenuButton(d,{language:u.language??"",label:u.label??"",type:u.type??"",id:u.id??c-1,buttonType:"subtitle"})})}createTvProgressBar(o){this.sliderBar=this.player.createElement("div","slider-bar").addClasses(["slider-bar","group/slider","overflow-clip","flex","rounded-full","bg-white/20","h-2","mx-4","relative","w-available"]).appendTo(o).get();const e=this.player.createElement("div","slider-progress").addClasses(["slider-progress","absolute","flex","h-full","pointer-events-none","rounded-full","bg-white","z-10","-left-full","w-full"]).appendTo(this.sliderBar).get();return this.chapterBar=this.player.createElement("div","chapter-progress").addClasses(["chapter-bar","bg-transparent","flex","h-2","relative","rounded-full","overflow-clip","w-available"]).appendTo(this.sliderBar).get(),this.player.on("item",async()=>{this.sliderBar.classList.add("bg-white/20"),this.previewTime=[],this.chapters=[],e.style.transform="translateX(0%)",await this.fetchPreviewTime()}),this.player.on("chapters",()=>{this.player.getChapters()?.length>0&&!this.player.isTv()?this.sliderBar.classList.remove("bg-white/20"):this.sliderBar.classList.add("bg-white/20")}),this.player.on("time",s=>{e.style.transform=`translateX(${s.percentage}%)`}),this.player.on("currentScrubTime",s=>{e.style.transform=`translateX(${s.currentTime/s.duration*100}%)`}),this.sliderBar}createTvEpisodeMenuButton(o,e,s){const t=this.player.createElement("button",`playlist-${e.id}`).addClasses(["playlist-menu-button","relative","flex","w-available","p-2","gap-2","rounded-lg","snap-center","outline-transparent","outline","outline-1","outline-solid","text-white","focus-visible:outline-2","focus-visible:outline-white","transition-all","duration-200"]).appendTo(o).get();this.player.playlistItem().season!==1&&(t.style.display="none");const a=this.player.createElement("div",`playlist-${e.id}-left`).addClasses(["episode-menu-button-left","relative","rounded-md","w-[50%]","overflow-clip","self-center"]).appendTo(t).get();this.player.createElement("div",`episode-${e.id}-shadow`).addClasses(["episode-menu-button-shadow","bg-[linear-gradient(0deg,rgba(0,0,0,0.87)_0%,rgba(0,0,0,0.7)_25%,rgba(0,0,0,0)_50%,rgba(0,0,0,0)_100%)]","shadow-[inset_0px_1px_0px_rgba(255,255,255,0.24),inset_0px_-1px_0px_rgba(0,0,0,0.24),inset_0px_-2px_0px_rgba(0,0,0,0.24)]","bottom-0","left-0","absolute","!h-available","w-available"]).appendTo(a).get();const l=this.player.createElement("img",`episode-${e.id}-image`).addClasses(["episode-menu-button-image","w-available","h-auto","aspect-video","object-cover",""]).appendTo(a).get();l.setAttribute("loading","lazy"),e.image?.startsWith("http")?l.src=e.image??"":l.src=e.image&&e.image!==""?`${this.imageBaseUrl}${e.image}`:"";const n=this.player.createElement("div",`episode-${e.id}-progress-container`).addClasses(["episode-menu-progress-container","absolute","bottom-1","w-available","flex","flex-col","px-3"]).appendTo(a).get(),r=this.player.createElement("div",`episode-${e.id}-progress-box`).addClasses(["episode-menu-progress-box","flex","justify-between","h-available","sm:mx-2","mb-1","px-1"]).appendTo(n).get(),p=this.player.createElement("div",`episode-${e.id}-progress-item`).addClasses(["progress-item-text","text-[0.7rem]",""]).appendTo(r).get();e.episode&&e.show&&(p.textContent=`${this.player.localize("E")}${e.episode}`);const d=this.player.createElement("div",`episode-${e.id}-progress-duration`).addClasses(["progress-duration","text-[0.7rem]"]).appendTo(r).get();d.textContent=e.duration?.replace(/^00:/u,"");const i=this.player.createElement("div",`episode-${e.id}-slider-container`).addClasses(["slider-container","group/slider","overflow-clip","hidden","rounded-full","bg-white/20","h-1","mx-4","relative","w-available"]).appendTo(n).get();i.style.display=e.progress?"flex":"none";const c=this.player.createElement("div",`episode-${e.id}-progress-bar`).addClasses(["progress-bar","absolute","flex","h-full","pointer-events-none","rounded-full","bg-white","z-10","-left-full","w-full"]).appendTo(i).get();e.progress?.time&&(c.style.transform=`translateX(${e.progress.time/F(e.duration)*100}%`);const u=this.player.createElement("div",`episode-${e.id}-right-side`).addClasses(["playlist-card-right","w-3/4","flex","flex-col","text-left","gap-1","px-1","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white"]).appendTo(t).get(),k=this.player.createElement("span",`episode-${e.id}-title`).addClasses(["playlist-menu-button-title","font-bold","text-lg","line-clamp-1","text-white",""]).appendTo(u).get();k.textContent=K((e.title??"").replace(e.show??"","").replace("%S",this.player.localize("S")).replace("%E",this.player.localize("E")));const E=this.player.createElement("span",`episode-${e.id}-overview`).addClasses(["playlist-menu-button-overview","font-bold","text-[0.7rem]","leading-4","line-clamp-4","overflow-hidden","text-white"]).appendTo(u).get();return E.textContent=W(e.description,600),this.player.on("item",()=>{this.player.playlistItem().season===e.season?t.style.display="flex":t.style.display="none",this.player.playlistItem().season===e.season&&this.player.playlistItem().episode===e.episode?t.style.background="rgba(255,255,255,.1)":t.style.background="transparent"}),this.player.on("switch-season",h=>{this.selectedSeason=h,this.player.playlistItem().id===e.id?setTimeout(()=>{this.player.scrollCenter(t,o,{margin:1,duration:100})},50):this.player.playlistItem().season!==h&&this.episodeScrollContainer.scrollTo(0,0),h===e.season?t.style.display="flex":t.style.display="none"}),this.player.on("active",()=>{c.style.transform=`translateX(${this.player.getTimeData().percentage}%)`}),this.player.on("time",h=>{this.player.playlistItem()?.uuid===e.uuid&&this.player.container.classList.contains("active")&&(i.style.display="flex",c.style.transform=`translateX(${h.percentage}%)`)}),e.episode&&e.show&&(p.innerText=e.season===void 0?`${e.episode}`:`${this.player.localize("S")}${e.season}: ${this.player.localize("E")}${e.episode}`),t.addEventListener("keydown",h=>{h.key==="ArrowLeft"?document.querySelector(`#season-${this.player.playlistItem().season}`)?.focus():h.key==="ArrowRight"||(h.key==="ArrowUp"&&!this.player.options.disableTouchControls?t.previousElementSibling?.focus():h.key==="ArrowDown"&&!this.player.options.disableTouchControls&&t.nextElementSibling?.focus())}),t.addEventListener("focus",()=>{this.player.scrollCenter(t,o,{margin:2,duration:50})}),t.addEventListener("click",()=>{e.episode&&e.season?this.player.setEpisode(e.season,e.episode):this.player.playlistItem(s),this.closeEpisodeScreen(),this.closePreScreen(),this.player.play().then()}),t}createTvSeasonButton(o,e,s,t,a){const l=this.player.createElement("button",e).addClasses(["w-available","mr-auto","h-8","px-1","py-2","flex","flex-nowrap","items-center","snap-center","rounded","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white",`${e}-button`]).appendTo(o).get();if(l.type="button",l.addEventListener("focus",()=>{this.player.scrollIntoView(l)}),l.addEventListener("keyup",d=>{d.key==="ArrowLeft"||d.key==="ArrowRight"&&(s.season===this.player.playlistItem()?.season?Array.from(document.querySelectorAll("[id^=playlist-]")).filter(i=>getComputedStyle(i).display==="flex").at((this.player.playlistItem()?.episode??0)-1)?.focus():Array.from(document.querySelectorAll("[id^=playlist-]")).filter(i=>getComputedStyle(i).display==="flex").at(0)?.focus())}),l.addEventListener("keydown",d=>{d.key==="ArrowUp"&&!this.player.options.disableTouchControls?l.previousElementSibling?.focus():d.key==="ArrowDown"&&!this.player.options.disableTouchControls&&l.nextElementSibling?.focus()}),l.addEventListener("click",()=>{t?.bind(this)()}),a){const d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("viewBox","0 0 24 24"),d.id=e,this.player.addClasses(d,[`${e}-icon`,...a.classes,"svg-size","h-5","w-5","fill-current","pointer-events-none","group-hover/button:scale-110","duration-700"]);const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",a.hover),d.appendChild(i),l.appendChild(d)}const n=this.player.createElement("div",`${e}-button-text`).addClasses(this.menuButtonTextStyles).addClasses(["flex","justify-between","items-center","w-available","gap-1","flex-nowrap"]).appendTo(l).get(),r=this.player.createElement("span",`${e}-button-text-span-1`).addClasses(["line-clamp-1","text-nowrap","text-sm","w-auto"]).appendTo(n).get(),p=this.player.createElement("span",`${e}-button-text-span-2`).addClasses(["line-clamp-1","text-nowrap","text-xs","w-min"]).appendTo(n).get();return s.seasonName?(r.textContent=s.seasonName,p.textContent=`${s.episodes} ${this.player.localize("ep")}`):s.season?(r.textContent=`${this.player.localize("Season")} ${s.season}`,p.textContent=`${s.episodes} ${this.player.localize("ep")}`):p.textContent=`${s.episodes} ${this.player.localize("ep")}`,l}getVisibleButtons(o){const s=o.parentElement?.querySelectorAll("button");if(!s||s?.length===0)return;const t=Array.from(s).filter(l=>l.style.display!=="none"),a=t.findIndex(l=>l===o);return{visibleButtons:t,currentButtonIndex:a}}findPreviousVisibleButton(o){const e=this.getVisibleButtons(o);if(!e)return;const{visibleButtons:s,currentButtonIndex:t}=e;return s.at(t-1)}findNextVisibleButton(o){const e=this.getVisibleButtons(o);if(!e)return;const{visibleButtons:s,currentButtonIndex:t}=e;return s.at(s.length)}createImageContainer(o){const e=this.player.createElement("div","left-side-top").addClasses(["flex","flex-col","justify-center","items-center","w-available","gap-2","h-auto"]).appendTo(o).get(),s=this.player.createElement("div","logo-container").addClasses(["flex","flex-col","justify-center","items-center","w-available","h-[85px]","min-h-[85px]"]).appendTo(e).get(),t=this.player.createElement("span","fallbackText").addClasses(["w-auto","h-available","items-center","py-0","max-w-[38vw]","mr-auto","leading-[1.2]","font-bold","object-fit"]).appendTo(s).get(),a=this.player.createElement("img","logo").addClasses(["w-auto","px-2","py-2","mr-auto","object-fit","h-auto","max-w-[23rem]","max-h-available",""]).appendTo(s).get(),l=this.player.createElement("div","left-side-top-overview").addClasses(["flex","flex-col","w-available","h-[40px]"]).appendTo(e).get(),n=this.player.createElement("div","rating-container").addClasses(["flex","gap-2","items-center","w-available","text-white"]).appendTo(l).get(),r=this.player.createElement("span","year-text").addClasses(["flex","text-white","text-sm","font-bold","mx-2"]).appendTo(n).get(),p=this.player.createElement("img","rating-image").addClasses(["w-8","h-available","object-fit","invert"]).appendTo(n).get(),d=this.player.createElement("span","episodes-count-text").addClasses(["flex","text-white","text-sm","font-bold","mx-2"]).appendTo(n).get();return this.player.on("item",()=>{const i=this.player.playlistItem()?.logo;!i||i===""||i.includes("null")||i.includes("undefined")?(t.textContent=G(this.player.playlistItem()?.show??""),t.style.fontSize=`calc(110px / ${t.innerText.length} + 3ch)`,t.style.display="flex",a.style.display="none"):(a.style.display="block",t.style.display="none",i?.startsWith("http")?a.src=i:a.src=i&&i!==""?`${this.imageBaseUrl}${i}`:""),r.innerHTML=this.player.playlistItem()?.year?.toString()??"",this.player.playlistItem()?.year?r.style.display="flex":r.style.display="none",p.removeAttribute("src"),p.removeAttribute("alt"),p.style.opacity="0",this.player.getPlaylist().length>1&&(d.innerHTML=`${this.player.getPlaylist().length} ${this.player.localize("episodes")}`);const c=this.player.playlistItem()?.rating;c&&(p.src=`https://storage.nomercy.tv/laravel/kijkwijzer/${c.image}`,p.alt=c.rating.toString(),p.style.opacity="1")}),e}createTvButton(o,e,s,t,a){const l=this.player.createElement("button",e).addClasses(["w-9/12","mr-auto","h-8","px-1","py-2","flex","items-center","rounded","snap-center","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white",`${e}-button`]).appendTo(o).get();if(l.type="button",l.addEventListener("focus",()=>{setTimeout(()=>{this.player.scrollCenter(l,o,{margin:1,duration:100})},50)}),l.addEventListener("keydown",r=>{if(r.key==="ArrowUp"&&!this.player.options.disableTouchControls)this.findPreviousVisibleButton(l)?.focus();else if(r.key==="ArrowDown"&&!this.player.options.disableTouchControls){const p=this.findNextVisibleButton(l);p?p?.focus():l.parentElement?.nextElementSibling?.focus()}}),l.addEventListener("click",t?.bind(this.player)),a){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox","0 0 24 24"),r.id=e,this.player.addClasses(r,[`${e}-icon`,...a.classes,"svg-size","h-5","w-5","fill-current","pointer-events-none","group-hover/button:scale-110","duration-700"]);const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",a.hover),r.appendChild(p),l.appendChild(r)}const n=this.player.createElement("span",`${e}-buttonText`).addClasses(this.menuButtonTextStyles).appendTo(l).get();return s||(s="Play",setTimeout(()=>{this.player.once("firstFrame",()=>{s="Resume",n.innerHTML=this.player.localize("Resume")})},500)),n.innerHTML=this.player.localize(s),l}createSeekContainer(o){const e=this.player.createElement("div","seek-container").addClasses(["relative","h-auto","mb-28","w-available","translate-y-[80vh]","z-40","w-available"]).appendTo(o).get(),s=this.player.createElement("div","seek-scroll-clone-container").addClasses(["[--gap:1.5rem]","absolute","flex","h-available","w-available","gap-[var(--gap)]","z-10","pointer-events-none"]).appendTo(e).get();this.thumbnailClone=this.player.createElement("div","thumbnail-clone-1").addClasses(["h-auto","object-cover","border-4","mx-auto"]).appendTo(s).get();const t=this.player.createElement("div","seek-scroll-container").addClasses(["relative","flex","h-available","w-available","overflow-auto","px-[calc(100%/2.14)]","gap-1.5","scrollbar-none"]).appendTo(e).get();return this.player.once("item",()=>{this.player.on("preview-time",()=>{this.thumbs=[];for(const a of this.previewTime)this.thumbs.push({time:a,el:this.createThumbnail(a)});t.innerHTML="",B(this.thumbs.map(a=>a.el),"id").forEach(a=>{t.appendChild(a)}),this.player.once("time",()=>{this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()})})})}),this.player.on("lastTimeTrigger",()=>{this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()})}),this.player.on("currentScrubTime",a=>{if(a.currentTime<=0)a.currentTime=0;else if(a.currentTime>=this.player.getDuration())return;const l=this.thumbs.find(n=>a.currentTime>=n.time.start&&a.currentTime<=n.time.end);this.currentScrubTime=a.currentTime,l&&this.player.scrollIntoView(l.el)}),this.player.on("show-seek-container",a=>{a?(e.style.transform="none",this.player.pause()):this.seekContainer.style.transform=""}),e}}const ue=L({__name:"Tv",setup(C){const{data:o}=Q({}),e=I();function s(t){const a={muted:!1,controls:!1,preload:"auto",debug:!1,autoPlay:!0,playlist:t?.filter(i=>!!i.id)??[],controlsTimeout:3e3,doubleClickDelay:300,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2],accessToken:b.value?.accessToken||localStorage.getItem("access_token")||"",basePath:_.value?.serverBaseUrl,forceTvMode:(y("android")||y("ios"))&&!y("mobile"),disableTouchControls:!1,disableMediaControls:"mediaSession"in navigator||y("capacitor"),renderAhead:10};e.value?.dispose(),e.value=J("player1").setup(a);const l=new Z;e.value?.registerPlugin("tvUI",l),e.value?.usePlugin("tvUI");const n=new O;e.value?.registerPlugin("autoSkip",n),e.value?.usePlugin("autoSkip");const r=new Y;e.value?.registerPlugin("keyHandler",r),e.value?.usePlugin("keyHandler");const p=new H;e.value?.registerPlugin("sync",p),e.value?.usePlugin("sync");const d=new q;e.value?.registerPlugin("octopus",d),e.value?.usePlugin("octopus"),e.value?.once("play",()=>{e.value?.enterFullscreen()}),e.value?.on("playlistComplete",()=>{history.state.back?g.back():g.replace("/")}),e.value?.on("dispose",()=>{V(),j(),history.state.back?g.back():g.replace("/")}),e.value?.on("back",()=>{e.value?.dispose()}),e.value?.on("play",()=>{f(!0)}),e.value?.on("pause",()=>{f(!1)}),e.value?.on("ready",()=>{N(),m.stop()}),e.value?.on("item",()=>{e.value?.play()}),R.addListener("backButton",()=>{e.value?.emit("back-button"),e.value?.emit("back-button-hyjack")})}return A(o,t=>{t?.length&&s(t)}),P(()=>{m.stop(),b.value.features?.nomercyConnect?s():o.value?.length&&s(o.value)}),$(()=>{e.value?.dispose(),f(!1)}),(t,a)=>(w(),v(T(D),null,{default:x(()=>[z(T(M),{fullscreen:!0},{default:x(()=>[(w(),v(U,{to:"body"},[a[0]||(a[0]=S("div",{class:"absolute inset-0 flex h-full w-full overflow-clip bg-black z-1199"},[S("div",{id:"player1",class:"group nomercyplayer"})],-1))]))]),_:1})]),_:1}))}});export{ue as default};
