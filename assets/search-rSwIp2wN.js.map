{"version":3,"file":"search-rSwIp2wN.js","sources":["../../src/store/search.ts"],"sourcesContent":["import {computed, onMounted, ref, watch} from 'vue';\nimport {useDebounce, useIntersectionObserver} from '@vueuse/core';\n\nimport type {HomeDataItem} from '@/types/api/music';\nimport type {Component} from '@/lib/routerHelper';\nimport type {Movie, Person, Tv} from '@/types/api/base/info';\n\nimport {currentServer} from '@/store/currentServer';\nimport {user} from '@/store/user';\nimport {tmdbApiKey} from '@/config/config';\n\nexport const musicSearchValue = ref('');\nexport const musicSearchResult = computed(() => musicResult.value);\n\nconst debouncedSearchValue = useDebounce(musicSearchValue, 500);\nconst musicResult = ref<Component<HomeDataItem>[]>([]);\n\nwatch(debouncedSearchValue, (value) => {\n\tconst url = `${currentServer.value?.serverBaseUrl}/api/v1/music/search?query=${value}`;\n\n\tfetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Authorization': `Bearer ${user.value?.accessToken}`\n\t\t}\n\t})\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tmusicResult.value = data.data;\n\t\t});\n});\n\n\nexport const videoSearchValue = ref('');\nexport const videoSearchResult = ref<Array<Movie|Tv|Person& any>>([]);\nexport const hasMoreResults = ref(false);\n\nconst debouncedVideoSearchValue = useDebounce(videoSearchValue, 500);\nconst page = ref(1);\n\nwatch(debouncedVideoSearchValue, (value) => {\n\tpage.value = 1; // Reset page number on new search\n\tconst url = `https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=en-US&query=${value}&page=${page.value}&include_adult=false`;\n\n\tfetch(url)\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tvideoSearchResult.value = data.results;\n\t\t\thasMoreResults.value = data.total_pages > 1;\n\t\t});\n});\n\nexport const fetchNextPage = () => {\n\tpage.value += 1;\n\tconst url = `https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=en-US&query=${debouncedVideoSearchValue.value}&page=${page.value}&include_adult=false`;\n\n\tfetch(url)\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tvideoSearchResult.value = [...videoSearchResult.value, ...data.results];\n\t\t\tif (data.results.length === 0) {\n\t\t\t\thasMoreResults.value = false;\n\t\t\t} else {\n\t\t\t\thasMoreResults.value = data.total_pages > page.value;\n\t\t\t}\n\t\t});\n}\n\nconst loadMore = ref(null);\nconst { stop } = useIntersectionObserver(\n\tloadMore,\n\t([{ isIntersecting }], observerElement) => {\n\t\tif (isIntersecting) {\n\t\t\tfetchNextPage()\n\t\t}\n\t},\n);\n\nonMounted(() => {\n\tstop();\n});\n"],"names":["ref","computed","refDebounced","watch","useIntersectionObserver","onMounted","currentServer","user","tmdbApiKey","musicSearchValue","musicSearchResult","musicResult","debouncedSearchValue","useDebounce","value","_a","_b","url","response","data","videoSearchValue","videoSearchResult","hasMoreResults","debouncedVideoSearchValue","page","fetchNextPage","loadMore","stop","isIntersecting","observerElement"],"mappings":"AAWa,OAAA,KAAAA,EAAA,MAAAC,EAAA,MAAAC,EAAA,KAAAC,EAAA,MAAAC,EAAA,MAAAC,EAAA,MAAAC,EAAA,MAAAC,EAAA,MAAAC,MAAA,sBAAA,MAAAC,EAAmBT,EAAI,EAAE,EACzBU,EAAoBT,EAAS,IAAMU,EAAY,KAAK,EAE3DC,EAAuBC,EAAYJ,EAAkB,GAAG,EACxDE,EAAcX,EAA+B,EAAE,EAErDG,EAAMS,EAAuBE,GAAU,CAN1B,IAAAC,EAAAC,EAOZ,MAAMC,EAAM,IAAGF,EAAAT,EAAc,QAAd,YAAAS,EAAqB,aAAa,8BAA8BD,CAAK,GAEpF,MAAMG,EAAK,CACV,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAiB,WAAUD,EAAAT,EAAK,QAAL,YAAAS,EAAY,WAAW,EAAA,CACnD,CACA,EACC,KAAKE,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbR,EAAY,MAAQQ,EAAK,IAAA,CACzB,CACH,CAAC,EAGY,MAAAC,EAAmBpB,EAAI,EAAE,EACzBqB,EAAoBrB,EAAiC,CAAE,CAAA,EACvDsB,EAAiBtB,EAAI,EAAK,EAEjCuB,EAA4BV,EAAYO,EAAkB,GAAG,EAC7DI,EAAOxB,EAAI,CAAC,EAElBG,EAAMoB,EAA4BT,GAAU,CAC3CU,EAAK,MAAQ,EACb,MAAMP,EAAM,qDAAqDT,CAAU,yBAAyBM,CAAK,SAASU,EAAK,KAAK,uBAEtH,MAAAP,CAAG,EACP,KAAKC,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbE,EAAkB,MAAQF,EAAK,QAChBG,EAAA,MAAQH,EAAK,YAAc,CAAA,CAC1C,CACH,CAAC,EAEM,MAAMM,EAAgB,IAAM,CAClCD,EAAK,OAAS,EACR,MAAAP,EAAM,qDAAqDT,CAAU,yBAAyBe,EAA0B,KAAK,SAASC,EAAK,KAAK,uBAEhJ,MAAAP,CAAG,EACP,KAAKC,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbE,EAAkB,MAAQ,CAAC,GAAGA,EAAkB,MAAO,GAAGF,EAAK,OAAO,EAClEA,EAAK,QAAQ,SAAW,EAC3BG,EAAe,MAAQ,GAERA,EAAA,MAAQH,EAAK,YAAcK,EAAK,KAChD,CACA,CACH,EAEME,EAAW1B,EAAI,IAAI,EACnB,CAAE,KAAA2B,CAAS,EAAAvB,EAChBsB,EACA,CAAC,CAAC,CAAE,eAAAE,EAAgB,EAAGC,IAAoB,CACtCD,GACWH,EAAA,CACf,CAEF,EAEApB,EAAU,IAAM,CACVsB,EAAA,CACN,CAAC"}