import{Dt as A,It as p,Lt as P,Mt as C,Ot as b,Pt as O,_t as k,gt as N,ht as F,vt as H,yt as $}from"./index-04Sh3wNb.js";var D=new WeakMap,T=(e,r,t,o=0,s=!1)=>{D.has(e)!==t&&(t?Y(e,r,o,s):q(e,r))},U=e=>e===e.getRootNode().activeElement,Y=(e,r,t,o=!1)=>{const s=r.parentNode,a=r.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,o&&(a.disabled=!0),s.appendChild(a),D.set(e,a);const n=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${n}px,${t}px,0) scale(0)`},q=(e,r)=>{const t=D.get(e);t&&(D.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""};var G=(e,r,t)=>{if(!t||!r)return()=>{};const o=u=>{U(r)&&T(e,r,u)},s=()=>T(e,r,!1),a=()=>o(!0),n=()=>o(!1);return C(t,"ionScrollStart",a),C(t,"ionScrollEnd",n),r.addEventListener("blur",s),()=>{P(t,"ionScrollStart",a),P(t,"ionScrollEnd",n),r.removeEventListener("blur",s)}};var W=()=>{let e=!0,r=!1;const t=document,o=()=>{r=!0},s=()=>{e=!0},a=n=>{if(r){r=!1;return}const u=t.activeElement;if(!u||u.matches("input, textarea, [no-blur], [contenteditable]"))return;const f=n.target;f!==u&&(f.matches("input, textarea, [no-blur], [contenteditable]")||f.closest("input, textarea, [no-blur], [contenteditable]")||(e=!1,setTimeout(()=>{e||u.blur()},50)))};return C(t,"ionScrollStart",o),t.addEventListener("focusin",s,!0),t.addEventListener("touchend",a,!1),()=>{P(t,"ionScrollStart",o,!0),t.removeEventListener("focusin",s,!0),t.removeEventListener("touchend",a,!1)}},z=.3,j=(e,r,t,o)=>{var s;const a=(s=e.closest("ion-item,[ion-item]"))!==null&&s!==void 0?s:e;return J(a.getBoundingClientRect(),r.getBoundingClientRect(),t,o)},J=(e,r,t,o)=>{const s=e.top,a=e.bottom,n=r.top,u=Math.min(r.bottom,o-t),f=n+15,d=u-50-a,c=f-s,l=Math.round(d<0?-d:c>0?-c:0),v=Math.min(l,s-n),S=Math.abs(v)/z;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(s-f)+4}},K="$ionPaddingTimer",M=(e,r,t)=>{const o=e[K];o&&clearTimeout(o),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[K]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},x=(e,r,t)=>{const o=()=>{r&&M(r,0,t)};e.addEventListener("focusout",o,{once:!0})},g=0,R="data-ionic-skip-scroll-assist",Q=(e,r,t,o,s,a,n,u=!1)=>{const f=a&&(n===void 0||n.mode===N.None);let d=!1;const c=b!==void 0?b.innerHeight:0,l=h=>{if(d===!1){d=!0;return}_(e,r,t,o,h.detail.keyboardHeight,f,u,c,!1)},v=()=>{d=!1,b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute("data-ionic-skip-scroll-assist")){r.removeAttribute(R);return}_(e,r,t,o,s,f,u,c),b===null||b===void 0||b.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},I=e=>{var r;if(document.activeElement===e)return;const t=e.getAttribute("id"),o=e.closest(`label[for="${t}"]`),s=(r=document.activeElement)===null||r===void 0?void 0:r.closest(`label[for="${t}"]`);o!==null&&o===s||(e.setAttribute(R,"true"),e.focus())},_=async(e,r,t,o,s,a,n=!1,u=0,f=!0)=>{if(!t&&!o)return;const d=j(e,t||o,s,u);if(t&&Math.abs(d.scrollAmount)<4){I(r),a&&t!==null&&(M(t,g),x(r,t,()=>g=0));return}if(T(e,r,!0,d.inputSafeY,n),I(r),p(()=>e.click()),a&&t&&(g=d.scrollPadding,M(t,g)),typeof window<"u"){let c;const l=async()=>{c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await $(t,0,d.scrollAmount,d.scrollDuration),T(e,r,!1,d.inputSafeY),I(r),a&&x(r,t,()=>g=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await H(t),h=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>h-S.scrollTop){r.type==="password"?(d.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),c=setTimeout(l,1e3);return}}l()}};var X=async(e,r)=>{if(A===void 0)return;const t=r==="ios",o=r==="android",s=e.getNumber("keyboardHeight",290),a=e.getBoolean("scrollAssist",!0),n=e.getBoolean("hideCaretOnScroll",t),u=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(A.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,l=new WeakMap,v=await F.getResizeMode(),S=async i=>{await new Promise(m=>O(i,m));const y=i.shadowRoot||i,L=y.querySelector("input")||y.querySelector("textarea"),w=k(i),B=w?null:i.closest("ion-footer");if(L){if(w&&n&&!c.has(i)){const m=G(i,L,w);c.set(i,m)}if(!(L.type==="date"||L.type==="datetime-local")&&(w||B)&&a&&!l.has(i)){const m=Q(i,L,w,B,s,f,v,o);l.set(i,m)}}},h=i=>{if(n){const y=c.get(i);y&&y(),c.delete(i)}if(a){const y=l.get(i);y&&y(),l.delete(i)}};u&&W();for(const i of d)S(i);A.addEventListener("ionInputDidLoad",i=>{S(i.detail)}),A.addEventListener("ionInputDidUnload",i=>{h(i.detail)})};export{X as startInputShims};
