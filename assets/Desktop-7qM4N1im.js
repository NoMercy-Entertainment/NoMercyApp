import{Y as A,C as p,h as b,o as n,i as l,v as S,H as z,d as k,f as B,P as ve,c as h,l as m,y as x,b as N,p as X,F as P,Z as w,w as me,ar as fe,an as xe}from"./vue-ionic-Cv2or74p.js";import{c as C,d as H,_ as ge}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-B9MWxtiG.js";import{r as he}from"./primevue-JgeSHwCi.js";import{u as ye}from"./useMounted-CS-UU_bv.js";import{u as we}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-C5JckHow.js";import{c6 as Q,b2 as ee,c7 as te,c8 as $,c9 as be,ca as re,cb as ae,c as se,bJ as ke,cc as E}from"./index-CuFkuKu6.js";import{u as I}from"./useServerClient-qGMhEAzq.js";import{a as O,S as Y,_ as Z}from"./ServerTasksCard.vue_vue_type_script_setup_true_lang-DLhtn05X.js";import{d as _e}from"./colorScheme-CxexT0BO.js";import{_ as Ce}from"./ActivityCard.vue_vue_type_script_setup_true_lang-DVPvA5FW.js";import"./vendor-F08gofix.js";import"./icons-BW5E66pf.js";import"./rxjs-BCp2L9Rn.js";import"./media-C2AqgyMX.js";import"./api-BBofn2cc.js";import"./swiper-DhG1br88.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-DBaWFqyn.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-Bi-0Ik3i.js";import"./Button.vue_vue_type_script_setup_true_lang-R7-60zhu.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-Bm4VhcNJ.js";import"./Button.vue_vue_type_script_setup_true_lang-BDrzJc8T.js";import"./music-player-Dgg5bFLw.js";import"./useInfiniteServerClient-B2pSj0Pt.js";import"./KeepCounting.vue_vue_type_script_setup_true_lang-CYijFFKD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch text-slate-light-11/80 dark:text-slate-dark-11/80"},Se={class:"flex flex-grow flex-col items-start justify-start gap-1 text-left"},Pe={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start self-stretch"},Ae={class:"w-8 flex-shrink-0 flex-grow-0 text-sm"},Me={class:"relative h-2 flex-grow rounded-lg"},Ne={class:"w-10 flex-shrink-0 flex-grow-0 text-right text-sm"},ze=A({__name:"ResourceBar",props:{cpu:{type:Number,required:!0,default:0},value:{type:Number,required:!0,default:0}},setup(d){const o=d,i=p(()=>Q.value?ee(o.value,te):"rgb(var(--color-focus))");return(g,v)=>(n(),b("div",$e,[l("div",Se,[l("div",Pe,[l("p",Ae,S(d.cpu),1),l("div",Me,[v[0]||(v[0]=l("div",{class:"absolute h-2 w-full rounded left-[-1px] top-[-1px] bg-auto-2 dark:bg-auto-1"},null,-1)),l("div",{class:"absolute h-2 rounded transition-all duration-500 left-[-1px] top-[-1px]",style:z({width:`${d.value}%`,backgroundImage:`linear-gradient(90deg, ${i.value} 0%, ${i.value} 100%)`})},null,4)]),l("p",Ne,S(Math.floor(d.value))+"% ",1)])])]))}}),Ie={class:"relative flex aspect-video h-auto w-full flex-1 flex-shrink-0 flex-col items-start justify-center gap-1 flex-grow-1"},Oe={class:"relative h-full flex-1 flex-shrink-0 w-available"},Re={class:"absolute top-2/3 left-1/2 -translate-x-1/2 text-center font-semibold text-[2.5vw] monospace sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.6vw]"},Ue={class:"flex-shrink-0 flex-grow-0 scale-75 self-stretch text-center text-sm font-semibold w-available text-[2.5vw] sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.7vw]"},q=A({__name:"ResourceCircle",props:{name:{type:String,required:!0},value:{type:Number,required:!0},size:{type:Number,required:!0}},setup(d){const o=d,i=p(()=>{if(Q.value)return ee(o.value,te);switch(o.name){case"CPU":return $(ae,50);case"Memory":return $(re,50);case"GPU":return $(be,50)}}),g=p(()=>Math.PI*72),v=p(()=>(1-(o.value==-1?0:o.value)/100)*g.value);return(f,s)=>(n(),b("div",Ie,[l("div",Oe,[(n(),b("svg",{viewBox:"0 0 152 148",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"absolute inset-2 mx-auto rounded",style:z({width:d.size*2,height:d.size*2}),preserveAspectRatio:"xMidYMid meet"},[s[0]||(s[0]=l("path",{d:"M148 76C148 66.5448 146.138 57.1822 142.519 48.4468C138.901 39.7114 133.598 31.7741 126.912 25.0883C120.226 18.4025 112.289 13.099 103.553 9.48068C94.8178 5.86234 85.4552 4 76 4C66.5448 3.99999 57.1823 5.86232 48.4468 9.48066C39.7114 13.099 31.7742 18.4025 25.0883 25.0883C18.4025 31.7741 13.099 39.7113 9.48069 48.4468C5.86234 57.1822 4 66.5448 4 76",class:"stroke-auto-2 dark:stroke-auto-1","stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),l("path",{class:"absolute -top-1 -left-1 h-2 rounded transition-all duration-500",d:"M4 76C4 56.9044 11.5857 38.5909 25.0883 25.0883C38.5909 11.5857 56.9044 4 76 4C95.0956 4 113.409 11.5857 126.912 25.0883C140.414 38.5909 148 56.9044 148 76",style:z({stroke:i.value,strokeDasharray:g.value,strokeDashoffset:v.value}),"stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,4)],4)),l("p",Re,S(d.value==-1?f.$t(""):Math.floor(d.value))+S(d.value==-1?"":"%"),1)]),l("p",Ue,S(d.name),1)]))}}),De={class:"flex items-start justify-between gap-2 overflow-clip w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},Ge={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start self-stretch"},M=40,J=A({__name:"ServerResourceCard",setup(d){var T;const{data:o}=I({path:"dashboard/server/info",queryKey:["serverInfo",(T=se.value)==null?void 0:T.serverBaseUrl]}),i=k(),g=k("graph"),v=k(Array(M).fill("")),f=k(Array(M).fill(null)),s=k(Array(M).fill(null)),R=k(Array(M).fill([null])),le=e=>{e&&(i.value=e,f.value=[...f.value.slice(-40),V.value],s.value=[...s.value.slice(-40),K.value],R.value=[...R.value.slice(-40),U.value])};ye(()=>{var e;return(e=C.value)==null?void 0:e.invoke("StartResources")},()=>{var e;return(e=C.value)==null?void 0:e.invoke("StopResources").catch()},10),we(C,"ResourceUpdate",le);const oe=()=>{var e;(e=C.value)==null||e.invoke("StartResources")};B(()=>{const e=ke();e==null||e.onreconnected(oe)});const j=p(()=>{var e,t,r;return((r=(t=(e=i.value)==null?void 0:e.cpu)==null?void 0:t.core)==null?void 0:r.toSorted((a,u)=>a.index-u.index))??[]}),U=p(()=>{var e,t;return((t=(e=i.value)==null?void 0:e.gpu)==null?void 0:t.toSorted((r,a)=>r.index-a.index).map(r=>r.encode))??[]}),V=p(()=>{var e,t,r,a;return(r=(t=(e=i.value)==null?void 0:e.cpu)==null?void 0:t.core)!=null&&r.length?Math.floor(((a=j.value)==null?void 0:a.reduce((u,c)=>u+c.utilization,0))/j.value.length):-1}),K=p(()=>{var e,t,r,a;return((t=(e=i.value)==null?void 0:e.memory)==null?void 0:t.percentage)=="NaN"?-1:((a=(r=i.value)==null?void 0:r.memory)==null?void 0:a.percentage)??-1}),ne=p(()=>{var t,r,a;if(((r=(t=i.value)==null?void 0:t.gpu)==null?void 0:r.length)==0)return-1;const e=Math.floor(((a=U.value)==null?void 0:a.reduce((u,c)=>u+c,0))/U.value.length);return Number.isNaN(e)?-1:e}),D=p(()=>(window.innerWidth-5e3)/3),ie=e=>{if(e.length===1)return[{color:E(e[0]),opacity:50}];const u=50/2,c=[];for(let y=0;y<e.length;y++){const _=25+y%3*u;c.push({color:E(e[y]),opacity:_})}return c},ue=p(()=>{var e,t,r,a;return{labels:v.value,datasets:[...((t=(e=o.value)==null?void 0:e.cpu)==null?void 0:t.map((u,c)=>{var _;const y=ae;return{label:`CPU ${((_=o.value)==null?void 0:_.cpu.length)>1?c:""}`,data:f.value,yAxisID:"y",borderColor:$(y,50)}}))??[],{label:"Memory",data:s.value,yAxisID:"y",borderColor:$(re,50)},...((a=(r=o.value)==null?void 0:r.gpu)==null?void 0:a.map((u,c)=>{var F,L;const y=ie((F=o.value)==null?void 0:F.gpu)[c],_=$(y.color,y.opacity);return{label:`GPU ${((L=o.value)==null?void 0:L.gpu.length)>1?c:""}`,data:R.value.map(pe=>pe[c]),yAxisID:"y",borderColor:_}}))??[]]}}),G=ve("legendPosition","bottom"),ce=p(()=>{const e=getComputedStyle(document.documentElement),t=_e.value?`rgb(${e.getPropertyValue("--color-slate-12")})`:`rgb(${e.getPropertyValue("--color-slate-1")})`,r=e.getPropertyValue("--p-content-border-color"),a=["left","top","right","bottom"];return{indexAxis:"x",maintainAspectRatio:!1,animation:!1,plugins:{legend:{labels:{color:t},value:G.value,onClick(){G.value=a[(a.indexOf(G.value)+1)%a.length]}}},elements:{line:{tension:.2},point:{pointStyle:!1}},scales:{x:{ticks:{color:"transparent"},grid:{color:"transparent"}},y:{min:0,max:100,beginAtZero:!0,clip:!0,ticks:{color:t},grid:{color:r}}}}}),de=p(()=>{var u,c;return`${(((c=(u=o.value)==null?void 0:u.gpu)==null?void 0:c.length)??0)*40+120}px`});return(e,t)=>(n(),h(O,{title:"Resources monitor"},{cta:m(()=>t[0]||(t[0]=[])),default:m(()=>{var r,a;return[l("div",De,[x(q,{name:"CPU",value:V.value,size:D.value},null,8,["value","size"]),t[1]||(t[1]=l("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),x(q,{name:"Memory",value:K.value,size:D.value},null,8,["value","size"]),t[2]||(t[2]=l("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),x(q,{name:"GPU",value:ne.value,size:D.value},null,8,["value","size"])]),l("div",Ge,[g.value=="bar"?(n(!0),b(P,{key:0},X(((a=(r=i.value)==null?void 0:r.cpu)==null?void 0:a.core)??[],(u,c)=>(n(),b(P,{key:u.index},[Number.isNaN(u.utilization)?N("",!0):(n(),h(ze,{key:0,cpu:c,value:u.utilization},null,8,["cpu","value"]))],64))),128)):N("",!0),g.value=="graph"?(n(),h(w(he),{key:1,type:"line",data:ue.value,options:ce.value,style:z(`height: ${de.value}`),class:"w-available"},null,8,["data","options","style"])):N("",!0)])]}),_:1}))}}),W=A({__name:"ServerActivityCard",setup(d){const{data:o}=I({path:"dashboard/activity",refetchInterval:1e4,data:{take:999},queryKey:["server","activity"]}),{data:i}=I({path:"dashboard/devices",refetchInterval:1e4,queryKey:["devices"]});return(g,v)=>w(H)?(n(),h(O,{key:0,title:"Activity",background:!1},{cta:m(()=>v[0]||(v[0]=[])),default:m(()=>{var f;return[(n(!0),b(P,null,X(((f=w(o))==null?void 0:f.slice(0,5))??[],s=>(n(),h(Ce,{devices:w(i)??[],key:s==null?void 0:s.id,activity:s},null,8,["devices","activity"]))),128))]}),_:1})):N("",!0)}}),qe={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-1 xl:row-start-1"},Be={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-3 xl:row-start-1"},He={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 lg:col-start-1 lg:row-start-2 2xl:col-span-2 2xl:col-start-5 2xl:row-start-1 2xl:flex"},pt=A({__name:"Desktop",setup(d){var v;const o=k(!0);me(C,f=>{o.value=!!f}),B(()=>{setTimeout(()=>{o.value=!!C.value},1e3)});const{data:i}=I({path:"dashboard/server/storage",queryKey:["dashboard","storage",(v=se.value)==null?void 0:v.serverBaseUrl]});B(()=>{console.raw(i.value)});const g=p(()=>window.CSS.supports("grid-template-rows: masonry"));return(f,s)=>(n(),h(w(xe),null,{default:m(()=>[x(w(fe),{fullscreen:!0},{default:m(()=>[x(ge,{title:"Dashboard overview",gridStyle:g.value?3:2,styles:"grid-template-rows: masonry; masonry-auto-flow: next;"},{cta:m(()=>s[0]||(s[0]=[])),default:m(()=>[g.value?(n(),b(P,{key:0},[x(Y),x(Z),x(W),w(H)?(n(),h(J,{key:0})):(n(),h(O,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:m(()=>s[1]||(s[1]=[])),default:m(()=>[s[2]||(s[2]=l("div",{class:"min-h-80"},null,-1))]),_:1}))],64)):(n(),b(P,{key:1},[l("div",qe,[x(Y),w(H)?(n(),h(J,{key:0})):(n(),h(O,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:m(()=>s[3]||(s[3]=[])),default:m(()=>[s[4]||(s[4]=l("div",{class:"min-h-80"},null,-1))]),_:1}))]),l("div",Be,[x(Z)]),l("div",He,[x(W)])],64))]),_:1},8,["gridStyle"])]),_:1})]),_:1}))}});export{pt as default};
