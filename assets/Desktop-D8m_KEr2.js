import{C as y,Ct as m,Dt as u,J as R,K as o,O as v,S as k,T as w,X as q,c as S,g as A,j as x,k as i,mt as b,ot as t,wt as g}from"./i18n-Rm1NkeNf.js";import"./ionic-vX7GXDhi.js";import{C as K,_ as M}from"./vue-core-D-3YrIBp.js";import{C as N}from"./primevue-DkuV93HA.js";import"./query-BPfDyGC_.js";import{Gi as T,Ki as h,_i as r,n as j,qi as C}from"./index-CqFEqgEJ.js";import"./useInfiniteServerClient-BxfXw7oy.js";import{t as I}from"./useServerClient-FaU9Jlhr.js";import"./ScrollContainer-BZ0RW1Ps.js";import"./useMounted-A4MEnwHg.js";import"./RipperOverlay-Wc0s5pLz.js";import"./ripperSocket-CzZLnkTd.js";import"./FloatingBackButton-D0_nsljf.js";import{t as V}from"./DashboardLayout-Cn65wMyW.js";import{t as z}from"./DashboardCard-AEwgH1HZ.js";S();var F={class:"relative flex aspect-video flex-shrink-0 flex-grow-0 flex-col items-center justify-center self-stretch overflow-clip rounded-lg bg-theme-8"},O={key:1,class:"text-xl font-bold text-center"},U=x({__name:"LibraryCard",props:{data:{type:Object,required:!0}},setup(a){return(s,c)=>(o(),y(z,{line1:a.data.title,line2:a.data.folder_library&&a.data.folder_library?.length!==1?`${a.data.folder_library?.length} folders`:`${a.data.folder_library?.length}  folder`,route:`/dashboard/libraries/${a.data.id}`},{image:t(()=>[k("div",F,[c[0]||(c[0]=k("div",{class:"backdropCard-overlay"},null,-1)),a.data.image?(o(),y(j,{key:0,path:a.data.image,aspect:"backdrop",class:"z-0"},null,8,["path"])):(o(),w("span",O,u(a.data.title),1))])]),_:1},8,["line1","line2","route"]))}}),G=U;S();var J=x({__name:"Desktop",setup(a){const s=N(),{data:c,error:B}=I({path:"dashboard/libraries",queryKey:["dashboard","libraries",C.value?.serverBaseUrl]}),n=b(!1);async function E(){if(!n.value){n.value=!0;try{const{data:e}=await h().post("dashboard/libraries");s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3}),T.invalidateQueries({queryKey:["dashboard","libraries",C.value?.serverBaseUrl]})}catch{s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while creating the library"),life:5e3})}finally{n.value=!1}}}const l=b(!1);function D(){l.value=!0,h().post("dashboard/libraries/refresh").then(({data:e})=>{l.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{l.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}const d=b(!1);function L(){d.value=!0,h().post("dashboard/libraries/scan-new").then(({data:e})=>{d.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{d.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the library folders"),life:5e3})})}const p=b(!1);function $(){p.value=!0,h().post("dashboard/libraries/rescan").then(({data:e})=>{p.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{p.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}return(e,P)=>{const f=q("Button");return o(),y(m(K),null,{default:t(()=>[i(m(M),{fullscreen:!0},{default:t(()=>[i(V,{error:m(B),"grid-style":1,description:"Manage your media libraries and their content here.",title:"Libraries"},{cta:t(()=>[i(f,{id:"newLibrary",disabled:n.value,color:"theme","start-icon":"folderAdd",onClick:E},{default:t(()=>[v(u(n.value?e.$t("Creating..."):e.$t("New library")),1)]),_:1},8,["disabled"])]),actions:t(()=>[i(f,{id:"refresh",class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:D},{default:t(()=>[v(u(e.$t("Refresh all libraries")),1)]),_:1},8,["class","disabled"]),i(f,{id:"missing",class:g(d.value?"first:children:animate-spin !cursor-not-allowed":""),disabled:d.value,color:"auto","start-icon":"folderSwap",type:"button",variant:"text",onClick:L},{default:t(()=>[v(u(e.$t("Find missing")),1)]),_:1},8,["class","disabled"]),i(f,{id:"rescan",class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:$},{default:t(()=>[v(u(e.$t("Rescan all libraries")),1)]),_:1},8,["class","disabled"])]),default:t(()=>[(o(!0),w(A,null,R(m(c)??[],_=>(o(),y(G,{key:_.id,data:_},null,8,["data"]))),128))]),_:1},8,["error"])]),_:1})]),_:1})}}}),de=J;export{de as default};
