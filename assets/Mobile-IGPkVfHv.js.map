{"version":3,"file":"Mobile-IGPkVfHv.js","sources":["../../src/views/Base/Watch/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {onBeforeUnmount, onMounted, onUnmounted, ref} from 'vue';\nimport {useRoute} from 'vue-router';\nimport {useTranslation} from 'i18next-vue';\nimport {IonContent, IonPage, isPlatform} from '@ionic/vue';\nimport {App} from '@capacitor/app';\n\nimport {disableImmersiveMode, enableImmersiveMode, lockLandscape, lockPortrait} from '@/lib/utils';\nimport {isNative} from '@/config/global';\nimport {currentServer} from '@/store/currentServer';\nimport {user} from '@/store/user';\nimport {setDisableScreensaver} from '@/store/imageModal';\n\nimport type {NMPlayer, PlaylistItem, SetupConfig} from '@/lib/VideoPlayer';\nimport {\n  AutoSkipPlugin,\n  DesktopUIPlugin,\n  nmplayer,\n  OctopusPlugin,\n  SyncPlugin\n} from '@/lib/VideoPlayer';\n\nimport audioPlayer from '@/store/audioPlayer';\nimport router from \"@/router\";\n\nconst {t} = useTranslation();\nconst route = useRoute();\n\nconst config: SetupConfig = {\n  muted: false,\n  controls: false,\n  preload: 'auto',\n  debug: false,\n  autoPlay: true,\n  playlist: `${currentServer.value?.serverApiUrl}${route.fullPath}`,\n\n  controlsTimeout: 3000,\n  doubleClickDelay: 500,\n  playbackRates: [\n    0.25,\n    0.5,\n    0.75,\n    1,\n    1.25,\n    1.5,\n    1.75,\n    2,\n  ],\n  accessToken: user.value?.accessToken || localStorage.getItem('access_token') || '',\n  basePath: currentServer.value?.serverBaseUrl,\n  forceTvMode: (isPlatform('android') || isPlatform('ios')) && !isPlatform('mobile'),\n  disableTouchControls: false,\n  disableMediaControls: 'mediaSession' in navigator || isPlatform('capacitor'),\n  renderAhead: 100,\n};\n\ninterface MyNmPlayer extends NMPlayer {\n  showInProduction: () => boolean;\n  getPlaylistItem: () => PlaylistItem & {\n    tmdb_id: number,\n    special_id: number,\n    video_type: string,\n    video_id: number;\n  };\n}\n\nconst player = ref<MyNmPlayer>();\n\nonMounted(() => {\n  // @ts-ignore\n  player.value ??= nmplayer('player1')\n      .setup(config);\n\n  player.value?.once('back', () => {\n    //\n  });\n\n  const desktopUIPlugin = new DesktopUIPlugin();\n  player.value?.registerPlugin('desktopUI', desktopUIPlugin);\n  player.value?.usePlugin('desktopUI');\n\n  const octopusPlugin = new OctopusPlugin();\n  player.value?.registerPlugin('octopus', octopusPlugin);\n  player.value?.usePlugin('octopus');\n\n  const autoSkipPlugin = new AutoSkipPlugin();\n  player.value?.registerPlugin('autoSkip', autoSkipPlugin);\n  player.value?.usePlugin('autoSkip');\n\n  // const sabrePlugin = new SabrePlugin();\n  // player.value?.registerPlugin('sabre', sabrePlugin);\n  // player.value?.usePlugin('sabre');\n\n  const syncPlugin = new SyncPlugin();\n  player.value?.registerPlugin('sync', syncPlugin);\n  player.value?.usePlugin('sync');\n\n  player.value?.once('play', () => {\n    player.value?.enterFullscreen();\n  });\n\n  player.value?.on('playlistComplete', () => {\n    player.value?.dispose();\n    router.back();\n  });\n\n  player.value?.on('back', () => {\n    router.back();\n  });\n\n  player.value?.on('play', () => {\n    setDisableScreensaver(true);\n  });\n\n  player.value?.on('pause', () => {\n    setDisableScreensaver(false);\n  });\n\n  player.value?.on('ready', () => {\n    lockLandscape();\n    enableImmersiveMode();\n    audioPlayer.stop();\n  });\n\n  player.value?.on('item', (playlistItem: PlaylistItem) => {\n    player.value?.play();\n  });\n\n  player.value?.on('active', (value) => {\n    if (value) {\n      //\n    } else {\n      //\n    }\n  });\n\n  App.addListener('backButton', () => {\n    player.value?.emit('back-button-hyjack');\n    router.back();\n  });\n\n  document.dispatchEvent(new Event('sidebar'));\n});\n\nonBeforeUnmount(() => {\n  lockPortrait();\n  disableImmersiveMode();\n});\n\nonUnmounted(() => {\n  player.value?.dispose();\n  setDisableScreensaver(false);\n});\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n      <Teleport to=\"body\">\n        <div class=\"absolute inset-0 flex h-full w-full overflow-clip bg-black z-1199\"\n             :class=\"{\n             'mb-28': isNative,\n             'mb-0': !isNative,\n           }\">\n          <div id=\"player1\" class=\"group nomercyplayer\"></div>\n        </div>\n      </Teleport>\n    </ion-content>\n  </ion-page>\n</template>\n\n<style>\n.nomercyplayer .top-bar {\n  @apply pt-safe-offset-4;\n}\n</style>\n"],"names":["useTranslation","route","useRoute","config","_a","currentServer","_b","user","_c","isPlatform","player","ref","onMounted","nmplayer","desktopUIPlugin","DesktopUIPlugin","octopusPlugin","OctopusPlugin","_d","_e","autoSkipPlugin","AutoSkipPlugin","_f","_g","syncPlugin","SyncPlugin","_h","_i","_j","_k","router","_l","_m","setDisableScreensaver","_n","_o","lockLandscape","enableImmersiveMode","audioPlayer","_p","playlistItem","_q","value","App","onBeforeUnmount","lockPortrait","disableImmersiveMode","onUnmounted"],"mappings":"geAyBYA,EAAe,EAC3B,MAAMC,EAAQC,EAAS,EAEjBC,EAAsB,CAC1B,MAAO,GACP,SAAU,GACV,QAAS,OACT,MAAO,GACP,SAAU,GACV,SAAU,IAAGC,EAAAC,EAAc,QAAd,YAAAD,EAAqB,YAAY,GAAGH,EAAM,QAAQ,GAE/D,gBAAiB,IACjB,iBAAkB,IAClB,cAAe,CACb,IACA,GACA,IACA,EACA,KACA,IACA,KACA,CACF,EACA,cAAaK,EAAAC,EAAK,QAAL,YAAAD,EAAY,cAAe,aAAa,QAAQ,cAAc,GAAK,GAChF,UAAUE,EAAAH,EAAc,QAAd,YAAAG,EAAqB,cAC/B,aAAcC,EAAW,SAAS,GAAKA,EAAW,KAAK,IAAM,CAACA,EAAW,QAAQ,EACjF,qBAAsB,GACtB,qBAAsB,iBAAkB,WAAaA,EAAW,WAAW,EAC3E,YAAa,GACf,EAYMC,EAASC,EAAgB,EAE/B,OAAAC,EAAU,IAAM,uCAEdF,EAAO,QAAPA,EAAO,MAAUG,GAAS,SAAS,EAC9B,MAAMV,CAAM,IAEVC,EAAAM,EAAA,QAAA,MAAAN,EAAO,KAAK,OAAQ,IAAM,CAAA,GAI3B,MAAAU,EAAkB,IAAIC,IACrBT,EAAAI,EAAA,QAAA,MAAAJ,EAAO,eAAe,YAAaQ,IACnCN,EAAAE,EAAA,QAAA,MAAAF,EAAO,UAAU,aAElB,MAAAQ,EAAgB,IAAIC,IACnBC,EAAAR,EAAA,QAAA,MAAAQ,EAAO,eAAe,UAAWF,IACjCG,EAAAT,EAAA,QAAA,MAAAS,EAAO,UAAU,WAElB,MAAAC,EAAiB,IAAIC,IACpBC,EAAAZ,EAAA,QAAA,MAAAY,EAAO,eAAe,WAAYF,IAClCG,EAAAb,EAAA,QAAA,MAAAa,EAAO,UAAU,YAMlB,MAAAC,EAAa,IAAIC,IAChBC,EAAAhB,EAAA,QAAA,MAAAgB,EAAO,eAAe,OAAQF,IAC9BG,EAAAjB,EAAA,QAAA,MAAAiB,EAAO,UAAU,SAEjBC,EAAAlB,EAAA,QAAA,MAAAkB,EAAO,KAAK,OAAQ,IAAM,QAC/BxB,EAAAM,EAAO,QAAP,MAAAN,EAAc,iBAAgB,IAGzByB,EAAAnB,EAAA,QAAA,MAAAmB,EAAO,GAAG,mBAAoB,IAAM,QACzCzB,EAAAM,EAAO,QAAP,MAAAN,EAAc,UACd0B,EAAO,KAAK,CAAA,IAGPC,EAAArB,EAAA,QAAA,MAAAqB,EAAO,GAAG,OAAQ,IAAM,CAC7BD,EAAO,KAAK,CAAA,IAGPE,EAAAtB,EAAA,QAAA,MAAAsB,EAAO,GAAG,OAAQ,IAAM,CAC7BC,EAAsB,EAAI,CAAA,IAGrBC,EAAAxB,EAAA,QAAA,MAAAwB,EAAO,GAAG,QAAS,IAAM,CAC9BD,EAAsB,EAAK,CAAA,IAGtBE,EAAAzB,EAAA,QAAA,MAAAyB,EAAO,GAAG,QAAS,IAAM,CAChBC,EAAA,EACMC,EAAA,EACpBC,EAAY,KAAK,CAAA,IAGnBC,EAAA7B,EAAO,QAAP,MAAA6B,EAAc,GAAG,OAASC,GAA+B,QACvDpC,EAAAM,EAAO,QAAP,MAAAN,EAAc,MAAK,IAGrBqC,EAAA/B,EAAO,QAAP,MAAA+B,EAAc,GAAG,SAAWC,GAAU,CAKpC,GAGEC,EAAA,YAAY,aAAc,IAAM,QAC3BvC,EAAAM,EAAA,QAAA,MAAAN,EAAO,KAAK,sBACnB0B,EAAO,KAAK,CAAA,CACb,EAED,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,CAAA,CAC5C,EAEDc,EAAgB,IAAM,CACPC,EAAA,EACQC,EAAA,CAAA,CACtB,EAEDC,EAAY,IAAM,QAChB3C,EAAAM,EAAO,QAAP,MAAAN,EAAc,UACd6B,EAAsB,EAAK,CAAA,CAC5B"}