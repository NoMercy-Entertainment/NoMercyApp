import{c as d,it as f,mt as s,x as m}from"./i18n-fABvX7Av.js";import{t as i}from"./signalr-CquQMbEc.js";import{F as u,I as S,qi as o,va as l}from"./index-C2s_qrrf.js";d();var e=s();const k=m(()=>e.value?.connection),a=s(!1);function t(){a.value=!0,document.dispatchEvent(new Event("ripperHub-connected")),e.value?.connection&&S(e.value?.connection)}function c(n){a.value=!1,console.log("Disconnected from Ripper SignalR",n),document.dispatchEvent(new Event("ripperHub-disconnected"))}function p(n){a.value=!1,console.error("Ripper SignalR Error:",n),document.dispatchEvent(new Event("ripperHub-error"))}f(o,async n=>{const r=l.value?.accessToken;n&&a.value&&(e.value?.connection?.stop().then(),e.value?.dispose(),e.value=new u(o.value.serverBaseUrl,r,"ripperHub"),e.value?.connection?.on("connected",t),e.value?.connection?.on("disconnected",c),await v().catch(p))});async function v(){if(e.value?.connection?.state!==i.Connected)return e.value?.connection?.start().then(t)}async function b(){try{return e.value?.connection?.state===i.Disconnected?void 0:e.value?.connection?.stop().then(c).catch(c)}catch(n){console.error("Error stopping Ripper SignalR:",n),c()}}async function w(){const n=l.value?.accessToken;o.value&&(!e.value?.connection?.state||e.value?.connection?.state===i.Disconnected)&&(e.value=new u(o.value.serverBaseUrl,n,"ripperHub"),e.value?.connection?.on("connected",t),e.value?.connection?.on("disconnected",c),await v().catch(p),e.value?.connection?.onreconnecting(r=>{console.log("SignalR Disconnected.",r?.message),c()}),e.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),t()}))}export{b as i,a as n,w as r,k as t};
