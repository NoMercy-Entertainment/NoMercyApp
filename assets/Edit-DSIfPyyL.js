import{aw as Y,a_ as X,br as j,I as c,o as i,e as m,a7 as d,v as A,a6 as b,t as l,a,bs as Z,b1 as z,b3 as ee,bt as O,aC as te,J as D,aB as _,c as ae,bu as q,h as p,bv as se}from"./index-BTvrz2ko.js";import{_ as le}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CFrsWScg.js";import{_ as oe}from"./Modal.vue_vue_type_script_setup_true_lang-CsVJX_EW.js";import{_ as T}from"./Button.vue_vue_type_script_setup_true_lang-DPLtpr2K.js";import{u as ne}from"./useApiClient-BBqFoW53.js";import{_ as re}from"./Select.vue_vue_type_script_setup_true_lang-ITD3Z42M.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-0vHQnG4C.js";import"./listbox-UrJBn439.js";const ie={class:"my-6 text-sm text-auto-10"},de=Y({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const w=v,{t:f}=X(),r=j(),S=c([]),o=()=>{var u;if(!w.id){S.value.push({type:"error",place:"email",message:f("Email is required")});return}Z().post("server/users",{_method:"delete",server_id:(u=z.value)==null?void 0:u.id,user_id:w.id}).then(()=>{r.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),w.close()};return(u,B)=>(i(),m(oe,{open:v.open,close:v.close,params:{name:v.name},title:"Delete server member {{name}}"},{actions:d(()=>[A(T,{type:"button",id:"yes",color:"red",variant:"contained",endIcon:"userRemove",onClick:o},{default:d(()=>[b(l(u.$t("Yes")),1)]),_:1}),A(T,{type:"button",id:"no",variant:"text",color:"white",onClick:v.close},{default:d(()=>[b(l(u.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:d(()=>[a("p",ie,[b(l(u.$t("Are you sure you want to delete this server member?")),1),B[0]||(B[0]=a("br",null,null,-1)),b(" "+l(u.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),ue={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},ce={class:"mt-4 mb-2"},me={class:"flex flex-col gap-2"},pe={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},fe={class:"whitespace-pre-wrap text-sm font-semibold text-contrast"},be={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ve={class:"whitespace-pre-wrap text-sm font-semibold text-contrast"},he={class:"mt-4 mb-2"},ge={class:"flex w-full flex-col gap-2"},ye={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},_e={class:"whitespace-pre-wrap text-sm font-semibold text-contrast"},we={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ke={class:"whitespace-pre-wrap text-sm font-semibold text-contrast"},Ve={class:"mt-4 mb-2"},$e={class:"flex w-1/2 flex-col gap-2"},Ce={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},xe={class:"whitespace-pre-wrap text-sm font-semibold text-contrast"},Ee=Y({__name:"Edit",setup(v){var K,M,N,R,I,Q,P,F,J;const w=j(),f=ee(),{data:r}=O({path:"/dashboard/libraries"}),{data:S}=ne({path:"server_users",params:{server_id:(K=z.value)==null?void 0:K.id},queryKey:["server_users"]}),{data:o,error:u}=O({path:`dashboard/users/${f.params.id}/permissions`,queryKey:["userPermissions",f.params.id]}),B=te(()=>{var e,t;return(t=(e=S.value)==null?void 0:e.find(n=>n.id==f.params.id))==null?void 0:t.name}),k=c((M=o.value)==null?void 0:M.allowed),V=c((N=o.value)==null?void 0:N.manage),$=c((R=o.value)==null?void 0:R.audio_transcoding),C=c((I=o.value)==null?void 0:I.video_transcoding),L=c((Q=o.value)==null?void 0:Q.no_transcoding),h=c(((P=r.value)==null?void 0:P.filter(e=>{var t,n;return(n=(t=o.value)==null?void 0:t.libraries)==null?void 0:n.includes(e.id)}).length)==((F=r.value)==null?void 0:F.length)),g=c((J=r.value)==null?void 0:J.filter(e=>{var t,n;return(n=(t=o.value)==null?void 0:t.libraries)==null?void 0:n.includes(e.id)}));D(o,e=>{var t,n,x;k.value=e==null?void 0:e.allowed,V.value=e==null?void 0:e.manage,$.value=e==null?void 0:e.audio_transcoding,C.value=e==null?void 0:e.video_transcoding,L.value=e==null?void 0:e.no_transcoding,g.value=(t=r.value)==null?void 0:t.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}),h.value=((n=r.value)==null?void 0:n.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}).length)==((x=r.value)==null?void 0:x.length)});const U=c(!1),G=()=>{U.value=!0},H=()=>{U.value=!1},E=()=>{window.history.back()},W=()=>{var e;se().patch(`dashboard/users/${f.params.id}/permissions`,{allowed:k.value,manage:V.value,audio_transcoding:$.value,video_transcoding:C.value,no_transcoding:L.value,libraries:(e=g.value)==null?void 0:e.map(t=>t.id)}).then(({data:t})=>{w.invalidateQueries({queryKey:["userPermissions",f.params.id]}),E()})};return D(h,e=>{e&&(g.value=r.value)}),D(g,e=>{r.value}),(e,t)=>(i(),m(le,{error:_(u),title:"Server member: {{name}}",params:{name:B.value},back:!0},{cta:d(()=>t[6]||(t[6]=[])),actions:d(()=>[A(T,{type:"button",id:"yes",variant:"text",class:"mr-auto",color:"text-auto-alpha-11",startIcon:"userDelete",onClick:G},{default:d(()=>[b(l(e.$t("Remove user")),1)]),_:1}),A(T,{type:"button",id:"cancel",variant:"text",color:"white",onClick:E},{default:d(()=>[b(l(e.$t("Cancel")),1)]),_:1}),A(T,{type:"button",id:"save",color:"theme",onClick:W},{default:d(()=>[b(l(e.$t("Save")),1)]),_:1})]),default:d(()=>{var n,x,y;return[_(o)?(i(),ae("div",ue,[a("h3",ce,l(e.$t("Base permissions"))+":",1),a("div",me,[a("label",pe,[k.value!=null?(i(),m(q,{key:0,id:"allowed",label:"Manage",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",fe,l(e.$t("Allow this user to access content")),1)]),a("label",be,[V.value!=null?(i(),m(q,{key:0,id:"manage",label:"Manage",modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=s=>V.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",ve,l(e.$t("Allow this user to manage the server")),1)])]),a("h3",he,l(e.$t("Media playback"))+":",1),a("div",ge,[a("label",ye,[$.value!=null?(i(),m(q,{key:0,id:"audioTranscoding",label:"AudioTranscoding",modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=s=>$.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",_e,l(e.$t("Allow audio playback that requires transcoding")),1)]),a("label",we,[C.value!=null?(i(),m(q,{key:0,id:"videoTranscoding",label:"VideoTranscoding",modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",ke,l(e.$t("Allow video playback that requires transcoding")),1)])]),a("h3",Ve,l(e.$t("Library Access"))+":",1),a("div",$e,[a("label",Ce,[h.value!=null?(i(),m(q,{key:0,id:"allowedAllLibraries",label:"AllowedAllLibraries",modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=s=>h.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",xe,l(e.$t("Enable access to all libraries")),1)]),h.value?p("",!0):(i(),m(re,{key:0,id:"libraries",label:"libraries",placeholder:"Select libraries",multiple:"",items:_(r),optionLabel:"title",modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=s=>g.value=s)},null,8,["items","modelValue"]))])])):p("",!0),(n=_(o))!=null&&n.id?(i(),m(de,{key:1,id:(x=_(o))==null?void 0:x.id,name:(y=_(o))==null?void 0:y.name,close:H,open:U.value},null,8,["id","name","open"])):p("",!0)]}),_:1},8,["error","params"]))}});export{Ee as default};
//# sourceMappingURL=Edit-DSIfPyyL.js.map
