import{$ as Y,At as l,C as D,Dt as j,Et as g,H as _e,K as he,O as T,S as a,T as v,Y as o,Z as L,_t as d,c as J,g as G,j as X,k as i,lt as x,st as M,w as B,x as ae}from"./i18n-DBb78QAI.js";import"./ionic-DNKsarlx.js";import{I as xe,P as be,w as ge}from"./vue-core-C9HAaO_1.js";import{c as W,h as q,w as ye}from"./primevue-CDzFprnl.js";import{c as re}from"./query-Dwz_k4KB.js";import{Oa as we,Qi as Z,Ra as $e,Zi as N,b as le,dr as te,k as oe,x as ke,xi as se,y as z}from"./index-A9ZXfM_l.js";import"./useInfiniteServerClient-CfrVy_UX.js";import{t as ie}from"./useServerClient-D7utCp4C.js";import{t as H}from"./ScrollContainer-COxBM-C8.js";import"./useMounted-BpvfXUCe.js";import"./RipperOverlay-Co5yS9RL.js";import"./ripperSocket-BF5Gj0oB.js";import"./FloatingBackButton-CFBsz6Nk.js";import{t as O}from"./Checkbox-98T3OB16.js";import{t as Ce}from"./DashboardLayout-_Yj4z20y.js";import{t as Se}from"./useSortable-DpX3grHB.js";be();J();var Ve={class:"my-6 text-sm text-surface-10"},De=X({__name:"DeleteSpecialModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(I){const k=I,y=re(),m=ye(),c=d(!1);async function n(){if(!c.value){c.value=!0;try{const{data:_}=await N().delete(`dashboard/specials/${k.id}`);m.add({severity:_.status==="ok"?"success":"error",summary:se(_.status==="ok"?"Success":"Error"),detail:se(_.message,..._.args??[]),life:5e3}),y.invalidateQueries({queryKey:["dashboard","specials"]}),k.close(),k.noRedirect||oe.back()}catch{c.value=!1}}}return(_,w)=>{const C=Y("Button");return o(),D(ke,{close:I.close,open:I.open,params:{special:k.name},"max-width":"max-w-xl",title:"Delete special {{special}}"},{actions:x(()=>[i(C,{id:"yes",disabled:c.value,onclick:n,color:"red","end-icon":"trash",type:"button"},{default:x(()=>[T(l(c.value?_.$t("Deleting..."):_.$t("Delete")),1)]),_:1},8,["disabled"]),i(C,{id:"no",disabled:c.value,onclick:I.close,color:"auto",type:"button",variant:"text"},{default:x(()=>[T(l(_.$t("Cancel")),1)]),_:1},8,["disabled","onclick"])]),default:x(()=>[a("div",Ve,l(_.$t("Are you sure you want to delete this special?")),1)]),_:1},8,["close","open","params"])}}}),Ee=De;J();var Ie={class:"flex flex-col gap-4 w-full h-full min-h-0"},Ae={class:"relative flex items-center flex-1 rounded-lg border border-surface-8/8 bg-surface-2 shadow-lg"},Pe={key:0,class:"absolute top-full left-0 right-0 mt-1 z-50 rounded-lg border border-surface-5/8 bg-surface-6 shadow-lg overflow-hidden"},Be={key:0,class:"flex items-center justify-center h-16 text-sm text-surface-9"},Ue={class:"flex flex-col"},Te=["onClick"],ze={key:1,class:"w-[18px] flex-shrink-0"},Oe={class:"flex flex-col flex-1 min-w-0"},Re={class:"text-sm font-medium text-surface-12 truncate"},qe={key:0,class:"text-xs text-surface-9 truncate"},je={class:"text-xs text-surface-9 w-16 text-right capitalize flex-shrink-0"},Me={class:"flex gap-4 w-full h-full min-h-0"},Ne={class:"flex flex-col flex-1 min-w-0 rounded-lg border border-surface-5 bg-surface-2 overflow-hidden"},Fe={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},Qe={class:"text-xs font-medium text-surface-12 flex-1"},Ke={class:"flex flex-col flex-1 overflow-hidden relative"},Le={class:"flex flex-col"},Ge={key:0,class:"flex items-center justify-center h-24 text-sm text-surface-9"},We=["onClick"],Ze={class:"flex flex-col flex-1 min-w-0"},He={class:"text-sm font-medium text-surface-12 truncate"},Ye={key:0,class:"text-xs text-surface-9 truncate"},Je={class:"text-xs text-surface-9 w-16 text-right capitalize flex-shrink-0"},Xe={class:"flex flex-col items-center justify-start gap-2 flex-shrink-0 py-10"},ea={class:"flex flex-col flex-1 min-w-0 rounded-lg border border-surface-5 bg-surface-2 overflow-hidden"},aa={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},la={class:"text-xs font-medium text-surface-12 w-12"},ta={class:"text-xs font-medium text-surface-12 flex-1"},sa={class:"flex flex-col flex-1 overflow-hidden relative"},ra={key:0,class:"flex items-center justify-center h-24 text-sm text-surface-9"},oa={class:"flex flex-col flex-1 min-w-0"},ia={class:"text-sm font-medium text-surface-12 truncate"},da={key:0,class:"text-xs text-surface-9 truncate"},ua={class:"text-sm text-surface-9 w-12 text-right flex-shrink-0"},na={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},ca={class:"text-xs font-medium text-surface-12 flex flex-1 justify-start gap-2"},va={class:"w-12 text-right"},fa=X({__name:"PlaylistEditor",props:{specialId:{}},setup(I,{expose:k}){const y=I,m=d([]),c=d([]),n=d(""),_=$e(n,350),w=d([]),C=d(!1),S=d([]),A=d(null),$=d(!1),V=d(null),u=d([]),f=d([]),{data:E,refetch:R}=ie({path:`dashboard/specials/${y.specialId}/items`,queryKey:["dashboard","specials",y.specialId,"items"]});M(_,async e=>{if(e.trim().length<2){w.value=[],$.value=!1;return}C.value=!0;try{const{data:r}=await N().get(`dashboard/specials/search?q=${encodeURIComponent(e)}`);w.value=Array.isArray(r)?r:r.data??[],$.value=!0}catch{w.value=[]}finally{C.value=!1}}),we(A,()=>{$.value=!1});function P(){w.value.length&&($.value=!0)}function U(e){return m.value.some(r=>r.media_id===e.id&&r.media_type===e.media_type)||u.value.some(r=>r.media_id===e.id&&r.media_type===e.media_type)}function s(e){return{id:`avail-${e.media_type}-${e.id}`,order:m.value.length,media_type:e.media_type,media_id:e.id,title:e.title,overview:e.overview,still:e.still,poster:e.poster,year:e.year,show_title:e.show_title,season_number:e.season_number,episode_number:e.episode_number,available:e.available}}function p(e){const r=S.value.indexOf(e);r>=0?S.value.splice(r,1):S.value.push(e)}function F(){w.value.filter(e=>S.value.includes(e.id)&&!U(e)).forEach(e=>{m.value.push(s(e))}),S.value=[]}const h=ae(()=>te(c.value,m.value));function de(e){const r=c.value.indexOf(e);r>=0?c.value.splice(r,1):c.value.push(e)}function ue(){h.value?c.value=[]:c.value=m.value.map(e=>e.id)}M(E,e=>{e&&(u.value=[...e].sort((r,b)=>r.order-b.order))},{immediate:!0}),Se(V,u,{animation:150,handle:".drag-handle"});const ee=ae(()=>te(f.value,u.value));function ne(e){const r=f.value.indexOf(e);r>=0?f.value.splice(r,1):f.value.push(e)}function ce(){ee.value?f.value=[]:f.value=u.value.map(e=>e.id)}function ve(){const e=m.value.filter(b=>c.value.includes(b.id)&&!u.value.some(t=>t.media_id===b.media_id&&t.media_type===b.media_type)),r=u.value.length;e.forEach((b,t)=>{u.value.push({...b,id:`pending-${b.media_type}-${b.media_id}`,order:r+t})}),m.value=m.value.filter(b=>!c.value.includes(b.id)),c.value=[]}function fe(){u.value.filter(e=>f.value.includes(e.id)).forEach(e=>{m.value.some(r=>r.media_id===e.media_id&&r.media_type===e.media_type)||m.value.push({...e,id:`avail-${e.media_type}-${e.media_id}`})}),u.value=u.value.filter(e=>!f.value.includes(e.id)),f.value=[]}const pe=re(),Q=d(!1);async function me(){Q.value=!0;try{await N().patch(`dashboard/specials/${y.specialId}/items`,{items:u.value.map((e,r)=>({media_type:e.media_type,media_id:e.media_id,order:r}))}),await pe.invalidateQueries({queryKey:["dashboard","specials",y.specialId,"items"]}),await R()}finally{Q.value=!1}}return k({save:me,isSaving:Q}),(e,r)=>{const b=Y("InputText");return o(),v("div",Ie,[a("div",{ref_key:"searchWrapperEl",ref:A,class:"relative flex gap-4 pt-4"},[a("div",Ae,[i(le,{"class-name":"absolute left-3 w-4 text-surface-9 pointer-events-none z-10",icon:"searchMagnifyingGlass"}),i(b,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=t=>n.value=t),placeholder:e.$t("Search movies and episodes..."),class:"w-full !pl-9",size:"small",variant:"filled",onFocus:P},null,8,["modelValue","placeholder"])]),i(z,{id:"add-from-search",disabled:S.value.length===0,color:"theme","end-icon":"addCircle",type:"button",variant:"contained",onClick:F},{default:x(()=>[T(l(e.$t("Add selected")),1)]),_:1},8,["disabled"]),$.value&&(C.value||w.value.length>0)?(o(),v("div",Pe,[C.value?(o(),v("div",Be,[i(g(ge),{class:"ion-padding",name:"crescent"})])):(o(),D(H,{key:1,static:!1,class:"max-h-80"},{default:x(()=>[a("div",Ue,[(o(!0),v(G,null,L(w.value,t=>(o(),v("div",{key:`${t.media_type}-${t.id}`,class:j([[U(t)?"opacity-40 cursor-default":"cursor-pointer"],"flex items-center gap-3 px-4 h-11 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"]),onClick:K=>!U(t)&&p(t.id)},[U(t)?(o(),v("span",ze)):(o(),D(O,{key:0,"model-value":S.value.includes(t.id)},null,8,["model-value"])),a("div",Oe,[a("span",Re,l(t.title),1),t.show_title?(o(),v("span",qe,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):B("",!0)]),a("span",je,l(t.media_type),1)],10,Te))),128))])]),_:1}))])):B("",!0)],512),a("div",Me,[a("div",Ne,[a("div",Fe,[i(O,{"model-value":h.value,"onUpdate:modelValue":ue},null,8,["model-value"]),a("span",Qe,l(e.$t("Title")),1)]),a("div",Ke,[i(H,{static:!1,class:"flex-1 min-h-0"},{default:x(()=>[a("div",Le,[m.value.length===0?(o(),v("div",Ge,l(e.$t("Search and add items above")),1)):(o(!0),v(G,{key:1},L(m.value,t=>(o(),v("div",{key:t.id,class:j([[!t.available&&"opacity-40"],"flex items-center gap-4 px-4 h-12 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"]),onClick:K=>de(t.id)},[i(O,{"model-value":c.value.includes(t.id)},null,8,["model-value"]),a("div",Ze,[a("span",He,l(t.title),1),t.show_title?(o(),v("span",Ye,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):B("",!0)]),a("span",Je,l(t.media_type),1)],10,We))),128))])]),_:1})])]),a("div",Xe,[i(z,{id:"add-to-playlist",disabled:c.value.length===0,class:"!w-8",color:"theme","end-icon":"arrowRight",size:"sm",onClick:ve},null,8,["disabled"]),i(z,{id:"remove-from-playlist",disabled:f.value.length===0,class:"!w-8",color:"theme",size:"sm","start-icon":"arrowLeft",variant:"outlined",onClick:fe},null,8,["disabled"])]),a("div",ea,[a("div",aa,[a("span",la,l(e.$t("Order")),1),i(O,{"model-value":ee.value,"onUpdate:modelValue":ce},null,8,["model-value"]),a("span",ta,l(e.$t("Title")),1)]),a("div",sa,[i(H,{static:!1,class:"flex-1 min-h-0"},{default:x(()=>[a("div",{ref_key:"playlistEl",ref:V,class:"flex flex-col"},[u.value.length===0?(o(),v("div",ra,l(e.$t("Add items from the left panel")),1)):(o(!0),v(G,{key:1},L(u.value,(t,K)=>(o(),v("div",{key:t.id,class:"flex items-center gap-4 px-4 h-12 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"},[i(le,{"class-name":"drag-handle w-4 text-surface-9 cursor-grab active:cursor-grabbing flex-shrink-0 !pointer-events-auto",icon:"menuDotsVertical"}),i(O,{"model-value":f.value.includes(t.id),"onUpdate:modelValue":Na=>ne(t.id)},null,8,["model-value","onUpdate:modelValue"]),a("div",oa,[a("span",ia,l(t.title),1),t.show_title?(o(),v("span",da,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):B("",!0)]),a("span",ua,l(K+1),1)]))),128))],512)]),_:1})]),a("div",na,[a("span",ca,[a("span",null,l(e.$t("Total"))+":",1),a("span",va,l(u.value.length),1),a("span",null,l(e.$t("items")),1)])])])])])}}}),pa=fa;J();var ma={class:"flex items-center gap-2"},_a={key:0,class:"flex gap-6 w-full p-4"},ha={class:"flex flex-col gap-4 rounded-xl bg-surface-12/3 p-5 w-full"},xa={class:"text-base font-semibold text-surface-12"},ba={class:"flex flex-col gap-2"},ga={class:"text-sm font-medium text-surface-12/60",for:"name"},ya={class:"flex flex-col gap-2"},wa={class:"text-sm font-medium text-surface-12/60",for:"overview"},$a={class:"flex flex-col gap-4 rounded-xl bg-surface-12/3 p-5 w-full"},ka={class:"text-base font-semibold text-surface-12"},Ca={class:"flex flex-col gap-4"},Sa={class:"flex items-start gap-4"},Va={key:1,class:"w-28 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-backdrop flex items-center justify-center"},Da={class:"text-xs text-surface-9"},Ea={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Ia={class:"text-sm font-medium text-surface-12/60",for:"backdrop"},Aa={class:"flex items-start gap-4"},Pa={key:1,class:"w-28 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-backdrop flex items-center justify-center"},Ba={class:"text-xs text-surface-9"},Ua={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Ta={class:"text-sm font-medium text-surface-12/60",for:"logo"},za={class:"flex items-start gap-4"},Oa={key:1,class:"w-20 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-poster flex items-center justify-center"},Ra={class:"text-xs text-surface-9"},qa={class:"flex flex-col gap-1.5 flex-1 min-w-0"},ja={class:"text-sm font-medium text-surface-12/60",for:"poster"},Ma=X({__name:"Edit",setup(I){const k=xe(),{data:y,error:m,refetch:c}=ie({path:"dashboard/specials",queryKey:["dashboard","specials"]}),n=d();_e(()=>{c()}),he(()=>{y.value&&(n.value=y.value.find(s=>s.id===k.params.id))}),M(y,s=>{s&&(n.value=s.find(p=>p.id===k.params.id))});const _=d(!1);function w(){_.value=!0}function C(){_.value=!1}function S(){oe.back()}const A=d(n.value?.title||""),$=d(n.value?.overview||""),V=d(n.value?.backdrop||""),u=d(n.value?.poster||""),f=d(n.value?.logo||"");M(n,s=>{s&&(A.value=s?.title,$.value=s?.overview,V.value=s?.backdrop,u.value=s?.poster,f.value=s?.logo)});const E=d("Details"),R=d(),P=d(!1);async function U(){if(!P.value){P.value=!0;try{await Promise.all([N().patch(`/dashboard/specials/${n.value?.id}`,{title:A.value,overview:$.value,backdrop:V.value,poster:u.value,logo:f.value}),R.value?.save()])}finally{P.value=!1}}}return(s,p)=>{const F=Y("Textarea");return o(),D(Ce,{error:g(m),"grid-style":4,params:{title:n.value?.title},"class-name":"!m-0",title:"Special: {{title}}"},{"pre-cta":x(()=>[a("nav",ma,[a("button",{class:j([E.value==="Details"?"bg-focus/11 border-focus/4":"border-transparent hover:bg-focus/10 hover:border-focus/4","flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-semibold transition-colors duration-200"]),onClick:p[0]||(p[0]=h=>E.value="Details")},l(s.$t("Details")),3),a("button",{class:j([E.value==="Playlist"?"bg-focus/11 border-focus/4":"border-transparent hover:bg-focus/10 hover:border-focus/4","flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-semibold transition-colors duration-200"]),onClick:p[1]||(p[1]=h=>E.value="Playlist")},l(s.$t("Playlist")),3)])]),actions:x(()=>[i(z,{id:"remove",class:"children:text-gray-400 children:transition-colors children:duration-100 children:hover:text-red-dark-8",color:"auto","start-icon":"folderRemove",type:"button",variant:"text",onClick:w},{default:x(()=>[T(l(s.$t("Remove")),1)]),_:1}),i(z,{id:"cancel",color:"white",type:"button",variant:"text",onClick:S},{default:x(()=>[T(l(s.$t("Cancel")),1)]),_:1}),i(z,{id:"save",disabled:P.value,class:"ml-auto",color:"theme",type:"button",onClick:U},{default:x(()=>[T(l(P.value?s.$t("Saving..."):s.$t("Save")),1)]),_:1},8,["disabled"])]),default:x(()=>[E.value==="Details"?(o(),v("div",_a,[a("section",ha,[a("h3",xa,l(s.$t("General")),1),a("div",ba,[a("label",ga,l(s.$t("Name")),1),i(g(q),{id:"name",modelValue:A.value,"onUpdate:modelValue":p[2]||(p[2]=h=>A.value=h),class:"w-full",variant:"filled"},null,8,["modelValue"])]),a("div",ya,[a("label",wa,l(s.$t("Overview")),1),i(F,{id:"overview",modelValue:$.value,"onUpdate:modelValue":p[3]||(p[3]=h=>$.value=h),rows:6,class:"w-full",variant:"filled"},null,8,["modelValue"])])]),a("section",$a,[a("h3",ka,l(s.$t("Artwork")),1),a("div",Ca,[a("div",Sa,[V.value?(o(),D(g(W),{key:0,src:`${g(Z)?.serverBaseUrl}/images/original${V.value}`,alt:"Backdrop",class:"w-28 flex-shrink-0 rounded-lg overflow-hidden aspect-backdrop",preview:""},null,8,["src"])):(o(),v("div",Va,[a("span",Da,l(s.$t("No image")),1)])),a("div",Ea,[a("label",Ia,l(s.$t("Backdrop")),1),i(g(q),{id:"backdrop",modelValue:V.value,"onUpdate:modelValue":p[4]||(p[4]=h=>V.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])]),a("div",Aa,[f.value?(o(),D(g(W),{key:0,src:`${g(Z)?.serverBaseUrl}/images/original${f.value}`,alt:"Logo",class:"w-28 flex-shrink-0 rounded-lg overflow-hidden aspect-backdrop bg-surface-12/6",preview:""},null,8,["src"])):(o(),v("div",Pa,[a("span",Ba,l(s.$t("No image")),1)])),a("div",Ua,[a("label",Ta,l(s.$t("Logo")),1),i(g(q),{id:"logo",modelValue:f.value,"onUpdate:modelValue":p[5]||(p[5]=h=>f.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])]),a("div",za,[u.value?(o(),D(g(W),{key:0,src:`${g(Z)?.serverBaseUrl}/images/original${u.value}`,alt:"Poster",class:"w-20 flex-shrink-0 rounded-lg overflow-hidden aspect-poster",preview:""},null,8,["src"])):(o(),v("div",Oa,[a("span",Ra,l(s.$t("No image")),1)])),a("div",qa,[a("label",ja,l(s.$t("Poster")),1),i(g(q),{id:"poster",modelValue:u.value,"onUpdate:modelValue":p[6]||(p[6]=h=>u.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])])])])])):B("",!0),E.value==="Playlist"&&n.value?.id?(o(),D(pa,{key:1,ref_key:"playlistEditorRef",ref:R,"special-id":n.value.id,class:"w-full flex-1 min-full"},null,8,["special-id"])):B("",!0),n.value?.id?(o(),D(Ee,{key:2,id:n.value?.id,close:C,name:n.value?.title,open:_.value},null,8,["id","name","open"])):B("",!0)]),_:1},8,["error","params"])}}}),rl=Ma;export{rl as default};
