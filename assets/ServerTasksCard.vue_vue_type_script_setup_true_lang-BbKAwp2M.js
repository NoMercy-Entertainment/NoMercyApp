import{aw as A,aB as h,aL as Ve,o as l,e as x,a7 as y,a as e,t as s,r as V,z as Ie,dV as Ee,c as d,h as g,I as B,dI as Me,b1 as K,bw as O,bu as Ae,az as Te,eb as Oe,v as m,aM as f,eK as Fe,u as F,F as Q,c7 as Pe,J as Ue,aC as L,dz as Qe,au as qe,q as De,a6 as D,eL as ze}from"./index-Cee2BA8G.js";import{u as E}from"./useHubListener-DrIa7T8r.js";import{d as Be,c as M}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-etFpQ88S.js";const Ke={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch w-full"},Le={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch text-slate-light-12 dark:text-slate-dark-12"},Je={class:"flex-grow text-xl font-medium"},Re={class:"ml-auto flex gap-2"},Ge={key:1,class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch"},He={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch text-slate-light-12 dark:text-slate-dark-12"},Xe={class:"flex-grow text-xl font-medium"},We={class:"ml-auto flex gap-2"},J=A({__name:"ServerSystemCard",props:{title:{type:String,required:!0},background:{type:Boolean,required:!1,default:!0}},setup(t){return(r,n)=>h(Ve)&&h(Be)?(l(),x(h(Ee),{key:0},{default:y(()=>[e("div",Ke,[e("div",Le,[e("p",Je,s(r.$t(t.title)),1),e("div",Re,[V(r.$slots,"cta")])]),e("div",{class:Ie(["flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl",{"bg-slate-lightA-3 dark:bg-slate-darkA-3 p-4":t.background}])},[V(r.$slots,"default")],2)])]),_:3})):h(Be)?(l(),d("div",Ge,[e("div",He,[e("p",Xe,s(r.$t(t.title)),1),e("div",We,[V(r.$slots,"cta")])]),e("div",{class:Ie(["flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl",{"bg-slate-lightA-3 dark:bg-slate-darkA-3 p-4":t.background}])},[V(r.$slots,"default")],2)])):g("",!0)}}),Ye={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border-1 border-slate-light-10 dark:border-slate-dark-10 text-slate-light-12/80 dark:text-slate-dark-12/80 rounded-lg pl-1 pr-2 py-1"},Ze={class:"flex-shrink-0 flex-grow-0 text-sm"},et={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border-1 border-slate-light-10 dark:border-slate-dark-10 text-slate-light-12/80 dark:text-slate-dark-12/80 rounded-lg pl-1 pr-2 py-1"},tt={class:"flex-shrink-0 flex-grow-0 text-sm"},st={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},at={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},lt={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},rt={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},it={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},ot={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},nt={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},dt={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},ct={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},ut={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},ft={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},ht={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},xt={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},gt={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},mt={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},vt={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},pt={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},kt={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},wt={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch overflow-clip w-available"},bt={class:"w-auto flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},_t={class:"flex-shrink-0 flex-grow-0 text-sm line-clamp-1 text-slate-light-10 dark:text-slate-dark-10"},yt=A({__name:"ServerSystemInfoCard",setup(t){var o,i;const r=B(!1),n=B(!0),{data:k,refetch:c}=Me({queryKey:["runners",(o=K.value)==null?void 0:o.serverBaseUrl],retryOnMount:!0,queryFn:()=>O().get("dashboard/tasks/runners").then(({data:a})=>(r.value=!(a.workers>0),a.workers??[]))}),{data:u}=Ae({path:"dashboard/server/info",queryKey:["serverInfo",(i=K.value)==null?void 0:i.serverBaseUrl]}),w=()=>{n.value=!0,c()},p=()=>{n.value=!1};return Te(()=>{const a=Oe();a==null||a.onreconnected(w),a==null||a.onclose(p)}),(a,v)=>(l(),x(J,{title:"System"},{cta:y(()=>[e("div",Ye,[m(f,{icon:"pause",class:"w-4"}),e("p",Ze,s(a.$t("Pause")),1)]),e("div",et,[m(f,{icon:"shutdown",class:"w-4"}),e("p",tt,s(a.$t("Shutdown")),1)])]),default:y(()=>{var $,j,S,C,N,I,q,z;return[e("div",st,[e("p",at,s(a.$t("Server")),1),e("p",lt,s(($=h(u))==null?void 0:$.server),1)]),e("div",rt,[e("p",it,s(a.$t("Server version")),1),e("p",ot,s((j=h(u))==null?void 0:j.version),1)]),e("div",nt,[e("p",dt,s(a.$t("Uptime")),1),e("p",ct,[(l(),x(Fe,{startTime:(S=h(u))==null?void 0:S.bootTime,key:(C=h(u))==null?void 0:C.bootTime},null,8,["startTime"]))])]),e("div",ut,[e("p",ft,s(a.$t("OS")),1),e("p",ht,s((N=h(u))==null?void 0:N.os.toTitleCase()),1)]),e("div",xt,[e("p",gt,s(a.$t("Architecture")),1),e("p",mt,s((I=h(u))==null?void 0:I.arch),1)]),(l(!0),d(Q,null,F((q=h(u))==null?void 0:q.cpu,(b,_)=>(l(),d("div",vt,[e("p",pt,s(a.$t("CPU"))+" #"+s(_+1),1),e("p",kt,s(b),1)]))),256)),(l(!0),d(Q,null,F((z=h(u))==null?void 0:z.gpu,(b,_)=>(l(),d("div",wt,[e("p",bt,s(a.$t("GPU"))+" #"+s(_+1),1),e("p",_t,s(b),1)]))),256))]}),_:1}))}}),ps=Pe(yt,[["__scopeId","data-v-090e8938"]]),$t={key:0,class:"relative flex w-full flex-col items-start justify-start overflow-clip rounded-lg pt-2 group/encoderCard gap-1.5 px-2.5 pb-3.5 bg-slate-lightA-3 dark:bg-slate-darkA-3"},jt={class:"relative flex w-full items-center justify-center gap-0.5"},St={class:"w-full flex-grow text-sm font-semibold text-auto-12 line-clamp-1"},Ct={class:"flex-shrink-0 flex-grow-0 text-right text-xs font-light text-auto-alpha-10"},Nt={class:"relative flex items-start justify-start gap-2"},It={key:0,class:"relative aspect-video h-auto w-1/3 flex-shrink-0 flex-grow-0 overflow-hidden rounded-sm min-w-36",style:{background:`linear-gradient(
                      to bottom,
                      rgba(0, 0, 0, 0) 0%,
                      rgba(0, 0, 0, 0) 25%,
                      rgba(0, 0, 0, 0) 50%,
                      #000 100%
                    )`}},qt={class:"absolute inset-0 z-0 h-full w-full bg-white/[0.01]"},zt=["src"],Bt={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px]"},At={class:"absolute z-10 flex items-end justify-start left-[3%] bottom-[3%] gap-[2%]"},Tt={class:"absolute z-10 flex items-end justify-end right-[3%] bottom-[3%] gap-[2%] text-[10px]"},Pt={class:"group-hover/progress:hidden text-right font-bold text-auto-12 monospace"},Ut={class:"flex h-full flex-grow flex-col items-start justify-evenly"},Vt={class:"relative flex h-4 items-center justify-center overflow-clip"},Et={class:"ml-2 w-full font-medium text-2xs text-auto-12"},Mt={key:0,class:"relative flex h-4 w-full items-start justify-start gap-2"},Ot={key:0,class:"relative flex h-4 items-center justify-center overflow-clip"},Ft={class:"ml-2 w-full font-medium text-2xs text-auto-12"},Qt={key:1,class:"relative flex h-4 w-full items-start justify-start gap-2"},Dt={key:0,class:"relative flex h-4 items-center justify-center overflow-clip"},Kt={class:"ml-1 font-medium text-2xs text-auto-12"},Lt={key:2,class:"relative flex h-4 items-center justify-center gap-2 overflow-clip"},Jt=["title"],Rt={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},Gt=["title"],Ht={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},Xt=["title"],Wt={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},Yt={key:0,class:"absolute -bottom-0.5 left-0 h-1 w-full blur-[1px]"},Zt=A({__name:"ServerEncoderTaskCard",props:{data:{type:Object,required:!0}},setup(t){var o;const r=t,n=B((o=r.data)==null?void 0:o.status);Ue(r,i=>{n.value=i.data.status});const k=L(()=>n.value==="running"?"running":"paused"),c=L(()=>{var a;return r.data.thumbnails?(((a=K.value)==null?void 0:a.serverBaseUrl)+"\\"+r.data.thumbnails).replace(/\\+/gu,"/").replace(/\/\/images/u,"/images")+"?token="+Qe.value.accessToken:null}),u=()=>{O().post(`/dashboard/tasks/pause/${r.data.process_id}`).then(({data:i})=>{n.value=i?"paused":n.value}).catch(()=>{})},w=()=>{O().post(`/dashboard/tasks/resume/${r.data.process_id}`).then(({data:i})=>{n.value=i?"running":n.value}).catch(()=>{})},p=()=>{n.value==="running"?u():w()};return(i,a)=>{var v,$,j,S,C,N,I,q,z,b,_,R,G,H,X,W,Y,Z,ee,te,se,ae,le,re,ie,oe,ne,de,ce,ue,fe,he,xe,ge,me,ve,T,pe,ke,we,be,P,_e,ye,$e,je,U,Se,Ce,Ne;return t.data?(l(),d("div",$t,[e("div",jt,[e("p",St,s(t.data.title.replace(/NoMercy/giu,"")),1),e("p",Ct,s(i.$t("Id"))+": "+s((v=t.data)==null?void 0:v.process_id),1)]),e("div",Nt,[(($=t.data)==null?void 0:$.message)=="Encoding video"?(l(),d("div",It,[e("div",qt,[a[0]||(a[0]=e("div",{class:"pointer-events-none absolute inset-0 z-10 mt-auto h-4/5 bg-gradient-to-t from-black via-black/60"},null,-1)),c.value?(l(),d("img",{key:0,src:c.value,class:"absolute z-0 h-full w-full",alt:""},null,8,zt)):g("",!0)]),e("div",{onClick:p,class:"absolute top-1/2 left-1/2 z-10 group-hover/encoderCard:flex hidden h-11 w-11 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/60 p-0.5 group/progress text-focus"},[e("div",Bt,[k.value=="running"?(l(),x(f,{key:0,icon:"pause",class:"w-10 text-white"})):(l(),x(f,{key:1,icon:"play",class:"w-10 text-white"}))])]),e("div",At,[(j=t.data)!=null&&j.has_gpu?(l(),x(f,{key:0,icon:"gpu",className:"w-[15%]"})):(l(),x(f,{key:1,icon:"cpu",className:"w-[15%]"})),(S=t.data)!=null&&S.is_hdr?(l(),x(f,{key:2,icon:"hdr",className:"w-[15%]"})):(l(),x(f,{key:3,icon:"hdrOff",className:"w-[15%]"}))]),e("div",Tt,[e("span",Pt,s(Math.floor(((C=t.data)==null?void 0:C.progress)??0))+"% ",1)])])):g("",!0),e("div",Ut,[e("div",Vt,[m(f,{icon:"stickyNote",className:"relative w-4 text-auto-12"}),e("p",Et,s((N=t.data)==null?void 0:N.message),1)]),((I=t.data)==null?void 0:I.message)=="Encoding video"?(l(),d("div",Mt,[(q=t.data)!=null&&q.speed?(l(),d("div",Ot,[m(f,{icon:"dashboard",className:"relative w-4 text-auto-12"}),e("p",Ft,s((z=t.data)==null?void 0:z.speed)+"X ",1)])):g("",!0)])):g("",!0),((b=t.data)==null?void 0:b.message)=="Encoding video"?(l(),d("div",Qt,[(_=t.data)!=null&&_.remaining_split?(l(),d("div",Dt,[m(f,{icon:"hourglass",className:"relative w-4 text-auto-12"}),e("p",Kt,s((G=(R=t.data)==null?void 0:R.remaining_split)!=null&&G[0]&&((H=t.data)==null?void 0:H.remaining_split[0])>0?` ${((W=(X=t.data)==null?void 0:X.remaining_split)==null?void 0:W[0])+i.$t("d")} `:"")+" "+s((Z=(Y=t.data)==null?void 0:Y.remaining_split)!=null&&Z[1]&&(((ee=t.data)==null?void 0:ee.remaining_split[1])>0||((te=t.data)==null?void 0:te.remaining_split[0])>0)?` ${((ae=(se=t.data)==null?void 0:se.remaining_split)==null?void 0:ae[1])+i.$t("h")} `:"")+" "+s((re=(le=t.data)==null?void 0:le.remaining_split)!=null&&re[2]&&(((ie=t.data)==null?void 0:ie.remaining_split[2])>0||((oe=t.data)==null?void 0:oe.remaining_split[1])>0||((ne=t.data)==null?void 0:ne.remaining_split[0])>0)?` ${((ce=(de=t.data)==null?void 0:de.remaining_split)==null?void 0:ce[2])+i.$t("m")} `:"")+" "+s((fe=(ue=t.data)==null?void 0:ue.remaining_split)!=null&&fe[3]?` ${((xe=(he=t.data)==null?void 0:he.remaining_split)==null?void 0:xe[3])+i.$t("s")} `:""),1)])):g("",!0)])):g("",!0),(ge=t.data)!=null&&ge.video_streams&&((me=t.data)==null?void 0:me.message)=="Encoding video"?(l(),d("div",Lt,[e("div",{class:"relative flex h-4 w-full cursor-pointer items-center justify-start gap-2",title:((pe=(T=(ve=t.data)==null?void 0:ve.video_streams)==null?void 0:T.join)==null?void 0:pe.call(T,", "))??""},[m(f,{icon:"film",className:"w-4"}),e("p",Rt,s((ke=t.data)==null?void 0:ke.video_streams.length),1)],8,Jt),(we=t.data)!=null&&we.audio_streams?(l(),d("div",{key:0,class:"relative flex h-4 cursor-pointer items-center justify-center gap-2 overflow-clip",title:((_e=(P=(be=t.data)==null?void 0:be.audio_streams)==null?void 0:P.join)==null?void 0:_e.call(P,", "))??""},[m(f,{icon:"audioFile",className:"w-4"}),e("p",Ht,s((ye=t.data)==null?void 0:ye.audio_streams.length),1)],8,Gt)):g("",!0),($e=t.data)!=null&&$e.subtitle_streams?(l(),d("div",{key:1,class:"relative flex h-4 cursor-pointer items-center justify-center gap-2 overflow-clip",title:((Se=(U=(je=t.data)==null?void 0:je.subtitle_streams)==null?void 0:U.join)==null?void 0:Se.call(U,", "))??""},[m(f,{icon:"chatBubble",className:"w-4"}),e("p",Wt,s((Ce=t.data)==null?void 0:Ce.subtitle_streams.length),1)],8,Xt)):g("",!0)])):g("",!0)])]),((Ne=t.data)==null?void 0:Ne.message)=="Encoding video"?(l(),d("div",Yt,[a[1]||(a[1]=e("div",{class:"absolute w-full h-1 left-[-1px] top-[-1px] bg-black/[0.22]"},null,-1)),e("div",{class:"w-0 h-1 absolute left-[-1px] top-[-1px] rounded-sm bg-gradient-to-r from-black/5 to-[rgb(var(--color-focus))] z-10",style:qe(`width: ${t.data.progress}%;`)},null,4),e("div",{class:"w-1 h-0.5 absolute top-[-1px] rounded-sm bg-[#f1eefe] -translate-x-[2px] z-0",style:qe(`left: ${t.data.progress}%;`)},null,4)])):g("",!0)])):g("",!0)}}}),es={class:"flex flex-shrink-0 flex-grow-0 items-start gap-4 self-stretch overflow-hidden rounded-lg py-4 pr-1 pl-4 bg-slate-lightA-3 dark:bg-slate-darkA-3 text-slate-light-12/80 dark:text-slate-dark-12/80"},ts={class:"relative flex flex-1 flex-grow flex-col items-start space-y-[-2px] w-full"},ss={class:"w-full flex-grow text-sm font-semibold text-auto-12 line-clamp-1"},as={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available !mt-1 text-slate-light-12/80 dark:text-slate-dark-12/80"},ls={class:"text-slate-light-11 dark:text-slate-dark-11"},rs={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80 w-full flex justify-between"},is={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},os={class:"text-slate-light-11 dark:text-slate-dark-11"},ns={class:"flex-shrink-0 flex-grow-0 self-stretch break-all text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},ds={class:"text-slate-light-11 dark:text-slate-dark-11"},cs={class:"relative flex flex-shrink-0 flex-grow-0 items-start justify-start gap-2 overflow-hidden rounded-lg bg-transparent p-1.5 -mt-1.5 -mr-0.5"},us=A({__name:"ServerQueueTaskCard",props:{data:{type:Object,required:!0}},setup(t){const r=t,n=B(r.data.priority??0),k=async c=>{O().patch(`/dashboard/tasks/queue/${r.data.id}`,{id:r.data.id,priority:c}).then(()=>{console.log("Priority updated")})};return Ue(n,c=>{console.log(c),k(c)}),(c,u)=>{const w=De("InputNumber");return l(),d("div",es,[e("div",ts,[e("p",ss,s(t.data.title.replace(/NoMercy/giu,"")),1),e("p",as,[D(s(c.$t("Id"))+": ",1),e("span",ls,s(t.data.id),1)]),e("p",rs,[e("span",null,s(c.$t("Priority"))+":",1),m(w,{size:"small",variant:"filled",showButtons:"",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=p=>n.value=p),class:"ml-auto h-8 first:children:!w-12 last:children:!w-4 children:last:children:!w-4 translate-x-12 overflow-clip -mb-2",min:0,max:100,step:1},null,8,["modelValue"])]),e("p",is,[D(s(c.$t("Profile"))+": ",1),e("span",os,s(t.data.profile),1)]),e("p",ns,[D(s(c.$t("File"))+": ",1),e("span",ds,s(t.data.input_file),1)])]),e("button",cs,[m(f,{icon:"cross",class:"relative h-5 w-5 flex-shrink-0 flex-grow-0"})])])}}}),fs=Pe(us,[["__scopeId","data-v-450498bd"]]),hs={class:"relative flex items-start justify-start gap-2 self-stretch rounded-lg p-4 bg-slate-lightA-3 dark:bg-slate-darkA-3 text-slate-light-12/80 dark:text-slate-dark-12/80"},xs={class:"flex-shrink-0 flex-grow-0 self-stretch text-sm font-semibold"},ks=A({__name:"ServerTasksCard",setup(t){Te(()=>{r.value=[]});const r=B([]),{data:n,refetch:k}=Ae({path:"dashboard/tasks/queue",queryKey:["queue"],refetchInterval:3e4}),c=o=>{o.status=="running"||o.status=="paused"?r.value=ze([...r.value.filter(i=>(i==null?void 0:i.id)!==(o==null?void 0:o.id)),o],"id"):(r.value=ze([...r.value.filter(i=>(i==null?void 0:i.id)!==(o==null?void 0:o.id))],"id"),k())},u=L(()=>{var o;return(o=n.value)==null?void 0:o.filter(i=>!r.value.find(a=>a.id==i.payload_id))}),w=o=>{n.value=o},p=()=>{r.value=[],k()};return E(M,"encoder-progress",c),E(M,"encoder-queue",w),E(M,"encoder-clear",p),E(M,"disconnected",p),(o,i)=>{var a;return r.value.length||(a=h(n))!=null&&a.length?(l(),x(J,{key:0,title:"Running tasks",background:!1},{cta:y(()=>i[0]||(i[0]=[])),default:y(()=>[(l(!0),d(Q,null,F(r.value??[],v=>(l(),x(Zt,{key:v.id,data:v},null,8,["data"]))),128)),(l(!0),d(Q,null,F(u.value,v=>(l(),x(fs,{key:v.id,data:v},null,8,["data"]))),128))]),_:1})):(l(),x(J,{key:1,title:"Running tasks",background:!1},{default:y(()=>[e("div",hs,[e("span",xs,s(o.$t("No tasks are currently running")),1)])]),_:1}))}}});export{ps as S,ks as _,J as a};
//# sourceMappingURL=ServerTasksCard.vue_vue_type_script_setup_true_lang-BbKAwp2M.js.map
