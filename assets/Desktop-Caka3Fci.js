import{I as w,d as v,o as d,s as l,a as s,c as $,l as c,C as M,f as x,q as p,t as f,j as i,K as b,dt as j,R as k,aq as A,bu as B,F as E,h as T,bh as U}from"./index-4xkagrUD.js";import{u as F}from"./useApiClient-DE88hXBo.js";import{_ as K}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DGO9C1aT.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-BtdLYnKX.js";import{_ as L}from"./DashboardCard.vue_vue_type_script_setup_true_lang-D8PoIF1Q.js";import{_ as N}from"./Avatar.vue_vue_type_script_setup_true_lang-CMnnGn-d.js";import{u as z}from"./index-CcqrGmOp.js";import{u as D}from"./useServerClient-B7mr_MDk.js";import{_ as O}from"./Modal.vue_vue_type_script_setup_true_lang-Dp5Zd_ee.js";import"./useQuery-BV5bz1Dq.js";import"./useBaseQuery-bD5-uZ52.js";import"./useQueryClient-BxrKgI38.js";import"./useInfiniteServerClient-B5bQCKha.js";import"./useMounted-DwAICKQh.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-BakoKms1.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-BEbBJsKC.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-QF_JR66q.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-CJGz-6CV.js";import"./ripperSocket-QjP5362k.js";import"./md5-BG15t2ye.js";import"./Shadow-C2_odF_R.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},P=["src"],Q=w({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(o,n)=>(d(),v(L,{route:`/dashboard/users/${r.data.user_id}`,line1:r.data.name,line2:""},{image:l(()=>[s("div",Z,[n[0]||(n[0]=s("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(d(),$("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,P)):(d(),v(N,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"]))}}),R={class:"flex w-full flex-col justify-start text-left"},W={class:"py-4 text-sm text-auto-10"},G={class:"flex flex-col gap-2 w-full"},H={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},J=w({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const o=r,{t:n}=z();c(null);const a=c(""),m=c([]),{data:h}=D({path:"/dashboard/libraries"}),_=c();function u(){m.value=[],o.close()}function y(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(e).toLowerCase())}const I=M(()=>a.value?y(a.value):!1);function q(){if(!a.value){m.value.push({type:"error",place:"email",message:n("Email is required")});return}if(!y(a.value)){m.value.push({type:"error",place:"email",message:n("Invalid email address")});return}j().post("server/server-users",{id:k.value?.id,email:a.value,libraries:_.value?.map(e=>e.id)}).then(()=>{A.invalidateQueries({queryKey:["server_users"]}),a.value="",o.close()}).catch(({response:e})=>{e?.status!==200&&e?.data&&m.value.push({message:e.data.message??"An error occurred",place:"email",type:e.data.status??e.data.exception})})}return(e,t)=>{const S=x("InputText"),V=x("MultiSelect");return d(),v(O,{open:r.open,close:u,title:"Invite user"},{actions:l(()=>[i(C,{id:"yes",type:"button",color:"theme",variant:"contained","end-icon":"emailSend",disabled:!I.value,onClick:q},{default:l(()=>[p(f(e.$t("Send")),1)]),_:1},8,["disabled"]),i(C,{id:"no",type:"button",variant:"text",onClick:u},{default:l(()=>[p(f(e.$t("Cancel")),1)]),_:1})]),default:l(()=>[s("div",R,[s("p",W,[p(f(e.$t("Enter the email of the friend you want to invite to your server.")),1),t[2]||(t[2]=s("br",null,null,-1)),p(" "+f(e.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),s("div",G,[t[3]||(t[3]=s("label",{for:"email"},"Email",-1)),i(S,{id:"email",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=g=>a.value=g),class:"mb-4"},null,8,["modelValue"])]),s("div",H,[t[4]||(t[4]=s("label",{for:"libraries"},"Allowed libraries",-1)),i(V,{id:"libraries",modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=g=>_.value=g),display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:b(h),"option-label":"title"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),Ce=w({__name:"Desktop",setup(r){const o=c(!1),{data:n}=F({path:"server/server-users",params:{id:k.value?.id},queryKey:["server_users"]});function a(){o.value=!0,setTimeout(()=>{document.querySelector("#email")?.focus()},300)}function m(){o.value=!1}return(h,_)=>(d(),v(b(U),null,{default:l(()=>[i(b(B),{fullscreen:!0},{default:l(()=>[i(K,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[i(C,{id:"invite",color:"theme","start-icon":"userAdd",onClick:a},{default:l(()=>[p(f(h.$t("Invite user")),1)]),_:1})]),default:l(()=>[(d(!0),$(E,null,T([...b(n)??[]].sort((u,y)=>u.name.localeCompare(y.name)),u=>(d(),v(Q,{key:u.user_id,data:u},null,8,["data"]))),128)),i(J,{open:o.value,close:m},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{Ce as default};
