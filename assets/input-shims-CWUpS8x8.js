import{$ as k,Q as F,_t as H,bt as P,dt as y,et as $,ht as M,nt as p,tt as U,ut as A,yt as Y}from"./index-CymNhKD_.js";var D=new WeakMap,T=(e,r,t,s=0,o=!1)=>{D.has(e)!==t&&(t?G(e,r,s,o):W(e,r))},q=e=>e===e.getRootNode().activeElement,G=(e,r,t,s=!1)=>{const o=r.parentNode,a=r.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,s&&(a.disabled=!0),o.appendChild(a),D.set(e,a);const n=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${n}px,${t}px,0) scale(0)`},W=(e,r)=>{const t=D.get(e);t&&(D.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""},O=50,z=(e,r,t)=>{if(!t||!r)return()=>{};const s=u=>{q(r)&&T(e,r,u)},o=()=>T(e,r,!1),a=()=>s(!0),n=()=>s(!1);return M(t,"ionScrollStart",a),M(t,"ionScrollEnd",n),r.addEventListener("blur",o),()=>{P(t,"ionScrollStart",a),P(t,"ionScrollEnd",n),r.removeEventListener("blur",o)}},I="input, textarea, [no-blur], [contenteditable]",j=()=>{let e=!0,r=!1;const t=document,s=()=>{r=!0},o=()=>{e=!0},a=n=>{if(r){r=!1;return}const u=t.activeElement;if(!u||u.matches(I))return;const f=n.target;f!==u&&(f.matches(I)||f.closest(I)||(e=!1,setTimeout(()=>{e||u.blur()},50)))};return M(t,"ionScrollStart",s),t.addEventListener("focusin",o,!0),t.addEventListener("touchend",a,!1),()=>{P(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",o,!0),t.removeEventListener("touchend",a,!1)}},Q=.3,J=(e,r,t,s)=>{var o;return V(((o=e.closest("ion-item,[ion-item]"))!==null&&o!==void 0?o:e).getBoundingClientRect(),r.getBoundingClientRect(),t,s)},V=(e,r,t,s)=>{const o=e.top,a=e.bottom,n=r.top,u=Math.min(r.bottom,s-t),f=n+15,d=u-O-a,c=f-o,l=Math.round(d<0?-d:c>0?-c:0),v=Math.min(l,o-n),S=Math.abs(v)/Q;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(o-f)+4}},x="$ionPaddingTimer",B=(e,r,t)=>{const s=e[x];s&&clearTimeout(s),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[x]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},R=(e,r,t)=>{const s=()=>{r&&B(r,0,t)};e.addEventListener("focusout",s,{once:!0})},g=0,K="data-ionic-skip-scroll-assist",X=(e,r,t,s,o,a,n,u=!1)=>{const f=a&&(n===void 0||n.mode===k.None);let d=!1;const c=y!==void 0?y.innerHeight:0,l=h=>{if(d===!1){d=!0;return}N(e,r,t,s,h.detail.keyboardHeight,f,u,c,!1)},v=()=>{d=!1,y===null||y===void 0||y.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute(K)){r.removeAttribute(K);return}N(e,r,t,s,o,f,u,c),y===null||y===void 0||y.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),y===null||y===void 0||y.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},C=e=>{var r;if(document.activeElement===e)return;const t=e.getAttribute("id"),s=e.closest(`label[for="${t}"]`),o=(r=document.activeElement)===null||r===void 0?void 0:r.closest(`label[for="${t}"]`);s!==null&&s===o||(e.setAttribute(K,"true"),e.focus())},N=async(e,r,t,s,o,a,n=!1,u=0,f=!0)=>{if(!t&&!s)return;const d=J(e,t||s,o,u);if(t&&Math.abs(d.scrollAmount)<4){C(r),a&&t!==null&&(B(t,g),R(r,t,()=>g=0));return}if(T(e,r,!0,d.inputSafeY,n),C(r),Y(()=>e.click()),a&&t&&(g=d.scrollPadding,B(t,g)),typeof window<"u"){let c;const l=async()=>{c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await p(t,0,d.scrollAmount,d.scrollDuration),T(e,r,!1,d.inputSafeY),C(r),a&&R(r,t,()=>g=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await U(t),h=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>h-S.scrollTop){r.type==="password"?(d.scrollAmount+=O,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),c=setTimeout(l,1e3);return}}l()}},Z=!0,ee=async(e,r)=>{if(A===void 0)return;const t=r==="ios",s=r==="android",o=e.getNumber("keyboardHeight",290),a=e.getBoolean("scrollAssist",!0),n=e.getBoolean("hideCaretOnScroll",t),u=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(A.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,l=new WeakMap,v=await F.getResizeMode(),S=async i=>{await new Promise(m=>H(i,m));const b=i.shadowRoot||i,L=b.querySelector("input")||b.querySelector("textarea"),w=$(i),_=w?null:i.closest("ion-footer");if(L){if(w&&n&&!c.has(i)){const m=z(i,L,w);c.set(i,m)}if(!(L.type==="date"||L.type==="datetime-local")&&(w||_)&&a&&!l.has(i)){const m=X(i,L,w,_,o,f,v,s);l.set(i,m)}}},h=i=>{if(n){const b=c.get(i);b&&b(),c.delete(i)}if(a){const b=l.get(i);b&&b(),l.delete(i)}};u&&Z&&j();for(const i of d)S(i);A.addEventListener("ionInputDidLoad",i=>{S(i.detail)}),A.addEventListener("ionInputDidUnload",i=>{h(i.detail)})};export{ee as startInputShims};
