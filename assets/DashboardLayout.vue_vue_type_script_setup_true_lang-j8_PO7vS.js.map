{"version":3,"file":"DashboardLayout.vue_vue_type_script_setup_true_lang-j8_PO7vS.js","sources":["../../src/lib/clients/dashboardSocket.ts","../../src/components/Buttons/HelpButton.vue","../../src/Layout/Desktop/DashboardLayout.vue"],"sourcesContent":["import {computed, type Ref, ref, watch} from 'vue';\nimport {HubConnectionState} from '@microsoft/signalr/src/HubConnection';\n\nimport SocketClient from '@/lib/clients/socketClient/SocketClient';\nimport {connect, onConnect, onDisconnect} from '@/lib/clients/socketClient/events';\nimport {currentServer} from '@/store/currentServer';\nimport {user} from '@/store/user';\n\nconst dashboardSocket: Ref<SocketClient| undefined> = ref();\nexport const connection = computed(() => dashboardSocket.value?.connection);\nexport const dashboardSocketIsConnected = ref(false);\n\nconst connected = () => {\n\tdashboardSocketIsConnected.value = true;\n\tconsole.log('Connected to Dashboard SignalR');\n\tdocument.dispatchEvent(new Event('dashboardHub-connected'));\n\n\tif (dashboardSocket.value?.connection) {\n\t\tonConnect(dashboardSocket.value?.connection);\n\t\tconnect(dashboardSocket.value?.connection);\n\t}\n};\n\nconst disconnected = (err?: Event|void) => {\n\tdashboardSocketIsConnected.value = false;\n\tconsole.log('Disconnected from Dashboard SignalR', err);\n\tdocument.dispatchEvent(new Event('dashboardHub-disconnected'));\n};\n\nconst error = (err: Error) => {\n\tdashboardSocketIsConnected.value = false;\n\tconsole.error('Dashboard SignalR Error:', err);\n\tdocument.dispatchEvent(new Event('dashboardHub-error'));\n}\n\nwatch(currentServer, async (newServer) => {\n\tconst accessToken = user.value?.accessToken;\n\n\tif (newServer && dashboardSocketIsConnected.value) {\n\t\tdashboardSocket.value?.connection?.stop().then();\n\t\tdashboardSocket.value = new SocketClient(currentServer.value!.serverBaseUrl!, accessToken, 'dashboardHub');\n\n\t\tdashboardSocket.value?.connection?.on('connected', connected);\n\t\tdashboardSocket.value?.connection?.on('disconnected', disconnected);\n\n\t\tawait connectToHub()\n\t\t\t.catch(error);\n\t}\n});\n\nconst connectToHub = async () => {\n\tif (dashboardSocket.value?.connection?.state === HubConnectionState.Connected) return;\n\n\treturn dashboardSocket.value?.connection?.start()\n\t\t.then(connected);\n};\n\nexport const stopDashboardSocket = async () => {\n\ttry {\n\t\tif (dashboardSocket.value?.connection?.state === HubConnectionState.Disconnected) return;\n\n\t\treturn dashboardSocket.value?.connection?.stop()\n\t\t\t.then(disconnected)\n\t\t\t.catch(disconnected);\n\n\t} catch (err) {\n\t\tconsole.error('Error stopping Dashboard SignalR:', err);\n\t\tdisconnected();\n\t}\n}\n\nexport const startDashboardSocket = async () => {\n\tconst accessToken = user.value?.accessToken;\n\n\tif (currentServer.value && (!dashboardSocket.value?.connection?.state || dashboardSocket.value?.connection?.state === HubConnectionState.Disconnected)) {\n\t\tdashboardSocket.value = new SocketClient(currentServer.value.serverBaseUrl, accessToken, 'dashboardHub');\n\n\t\tdashboardSocket.value?.connection?.on('connected', connected);\n\t\tdashboardSocket.value?.connection?.on('disconnected', disconnected);\n\n\t\tawait connectToHub()\n\t\t\t.catch(error);\n\n\t\tdashboardSocket.value?.connection?.onreconnecting((error: Error | undefined) => {\n\t\t\tconsole.log('SignalR Disconnected.', error?.message);\n\t\t\tonDisconnect(dashboardSocket.value?.connection);\n\t\t\tdisconnected();\n\t\t});\n\t\tdashboardSocket.value?.connection?.onreconnected(() => {\n\t\t\tconsole.log('SignalR Reconnected.');\n\t\t\tonConnect(dashboardSocket.value?.connection);\n\t\t\tconnected();\n\t\t});\n\t}\n}\n","<script setup lang=\"ts\">\n\nimport {suffix} from '@/config/config';\n\nimport Button from '@/components/Buttons/Button.vue';\n\nimport {useRoute} from 'vue-router';\nimport {computed} from 'vue';\n\nconst route = useRoute();\n\nconst url = computed(() => `https://docs${suffix}.nomercy.tv${\n  route.path.replace(/\\/\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}/gu, '')\n}`);\n\n</script>\n\n<template>\n\t<Button\n\t\tid=\"help\"\n\t\t:href=\"url\"\n\t\tvariant=\"text\"\n\t\tcomponent=\"link\"\n    target=\"_blank\"\n\t\tcolor=\"auto\"\n\t\tstartIcon=\"messageBubbleQuestion\"\n\t\tclass=\"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5\"\n\t>\n\t\t{{ $t('Help') }}\n\t</Button>\n</template>\n","<script setup lang=\"ts\">\nimport {computed, onMounted, type PropType, watch} from 'vue';\nimport {type AxiosError} from 'axios';\n\nimport {ErrorResponse} from '@/types/server';\n\nimport {dashboardBigCardGrid, dashboardCardGrid, dashboardColumnGrid} from '@/config/global';\nimport useMounted from '@/hooks/useMounted';\nimport useServerClient from '@/lib/clients/useServerClient';\nimport {dashboardSocketIsConnected, startDashboardSocket, stopDashboardSocket} from '@/lib/clients/dashboardSocket';\nimport {setColorPalette} from '@/store/ui';\n\nimport FloatingBackButton from '@/components/Buttons/FloatingBackButton.vue';\nimport HelpButton from '@/components/Buttons/HelpButton.vue';\nimport ScrollContainer from '@/Layout/Desktop/components/ScrollContainer.vue';\n\nconst addModalOpen = defineModel({\n  required: false,\n  type: Boolean,\n});\n\nconst props = defineProps({\n  title: {\n    type: String,\n    required: true,\n  },\n  params: {\n    type: Object,\n    required: false,\n  },\n  description: {\n    type: String,\n    required: false,\n  },\n  gridStyle: {\n    type: Number,\n    required: false,\n    default: 0,\n  },\n  back: {\n    type: Boolean,\n    required: false,\n    default: false,\n  },\n  error: {\n    type: Object as PropType<AxiosError<unknown, any> | null>,\n    required: false,\n  },\n  allowAnyone: {\n    type: Boolean,\n    required: false,\n    default: false,\n  },\n});\n\nconst {dataUpdatedAt, error: permissionsError, isPending} = useServerClient({\n  path: 'dashboard/server',\n  enabled: !props.allowAnyone,\n  refetchInterval: 10000,\n  queryKey: ['dashboard', 'server', dashboardSocketIsConnected.value],\n});\n\nconst grid = computed(() => {\n  if (props.gridStyle == 1) {\n    return dashboardCardGrid.value;\n  } else if (props.gridStyle == 2) {\n    return dashboardColumnGrid.value;\n  } else if (props.gridStyle == 3) {\n    return dashboardBigCardGrid.value;\n  } else {\n    return 'flex flex-wrap';\n  }\n});\n\nconst accessError = computed(() => {\n  if (props.allowAnyone) return null;\n  const err = permissionsError.value as AxiosError<ErrorResponse, any> | null;\n\n  if (err?.response?.status == 200) return;\n\n  return {\n    code: err?.response?.data?.status ?? null,\n    message: err?.response?.data?.detail ?? ''\n  };\n});\n\nconst error = computed(() => {\n  const err = props.error as AxiosError<ErrorResponse, any> | null;\n  console.log(err);\n\n  if (!err?.response || err?.response?.status == 200) return;\n\n  return {\n    code: err?.response?.status,\n    message: err?.response?.data?.detail ?? ''\n  };\n});\n\nonMounted(() => {\n  setColorPalette(null);\n});\n\nuseMounted(startDashboardSocket, stopDashboardSocket, 1);\n\nconst showError = computed(() => {\n  return (accessError.value?.code || isPending.value || !dashboardSocketIsConnected.value) && !props.allowAnyone;\n});\n\nwatch(showError, (value) => {\n  if (value && addModalOpen.value != undefined) {\n    addModalOpen.value = false;\n  }\n});\n\nwatch(dataUpdatedAt, (value) => {\n  if (value && !dashboardSocketIsConnected.value) {\n    startDashboardSocket();\n  }\n});\n\n</script>\n\n<template>\n  <KeepAlive>\n    <div v-if=\"showError\" class=\"grid h-full w-full place-items-center\">\n      <div class=\"relative flex items-center justify-start gap-8 overflow-hidden\">\n        <div class=\"relative flex w-full flex-col gap-4\">\n          <p class=\"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80\">\n            {{ accessError?.code ? accessError?.code : 'Offline' }}\n          </p>\n          <p class=\"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line\">\n            {{ (accessError as any)?.message }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div v-else\n         class=\"relative z-0 h-available flex flex-shrink-0 flex-grow flex-col overflow-clip items-start justify-start self-stretch w-available min-h-available bg-slate-light-3 dark:bg-slate-dark-2\">\n      <div\n          class=\"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch\"\n      >\n        <div class=\"absolute inset-0 z-0 h-full w-full\"></div>\n        <!--\t\t\t<Shadow type=\"linear\"/>-->\n        <div\n            class=\"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-auto-7/6 xl:px-6 bg-slate-light-3 dark:bg-slate-dark-2\"\n        >\n          <div class=\"relative flex h-full flex-col items-start justify-center gap-1 text-slate-light-12/80 dark:text-slate-dark-12/80\">\n            <p\n                class=\"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold\"\n            >\n              {{ $t(title, params) }}\n            </p>\n            <FloatingBackButton v-if=\"back\" position=\"relative\" class=\"left-4\"/>\n            <p v-else\n               class=\"hidden h-8 w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex\"\n            >\n              {{ $t(description) }}\n            </p>\n          </div>\n\n          <slot name=\"title\"/>\n          <div class=\"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row\">\n            <HelpButton/>\n            <slot name=\"cta\"/>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"error\" class=\"grid h-full w-full place-items-center\">\n        <div class=\"relative flex flex-col items-center justify-start gap-8 overflow-hidden\">\n          <div class=\"relative flex w-full flex-col gap-4\">\n            <p class=\"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80\">\n              {{ error.code }}\n            </p>\n            <p class=\"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line\">\n              {{ error.message }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <ScrollContainer v-else :static=\"true\" class=\"z-0 flex !h-sidebar+ !min-h-[calc(100vh-16rem)] w-full flex-1 overflow-y-auto overflow-x-hidden sm:p-4\">\n        <div class=\"h-auto w-full flex-wrap content-start gap-4\" :class=\"grid\">\n          <slot/>\n        </div>\n      </ScrollContainer>\n\n      <div v-if=\"!error && $slots.actions\"\n           class=\"sticky bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-auto-7/6 empty:hidden sm:h-16 xl:px-6\"\n      >\n        <div class=\"absolute inset-0 -z-10 h-full w-full\"></div>\n        <slot name=\"actions\"/>\n      </div>\n\n    </div>\n  </KeepAlive>\n</template>\n"],"names":["dashboardSocket","ref","connection","computed","_a","dashboardSocketIsConnected","connected","onConnect","_b","connect","_c","disconnected","err","error","watch","currentServer","newServer","accessToken","user","SocketClient","_e","_d","_g","_f","connectToHub","HubConnectionState","stopDashboardSocket","startDashboardSocket","_i","_h","_k","_j","onDisconnect","_m","_l","route","useRoute","url","suffix","addModalOpen","_useModel","__props","props","dataUpdatedAt","permissionsError","isPending","useServerClient","grid","dashboardCardGrid","dashboardColumnGrid","dashboardBigCardGrid","accessError","onMounted","setColorPalette","useMounted","showError","value"],"mappings":"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"}