import{jt as s}from"./index-04Sh3wNb.js";import{t as i}from"./client-DMa-uSBE.js";import{a as c,t as l}from"./config-BOA2pGQM.js";import{c as n,n as a,t as f}from"./user-C1ciKa7-.js";import{a as k}from"./helpers-fSCF1qXj.js";var m=e=>i({baseUrl:`https://cdn${c}.nomercy.tv`,timeout:e}),h=window.location.href.startsWith("file://")?"http://localhost:5173":window.location.origin,p="nomercy-ui";function I(){return new Promise((e,o)=>{const r=location.search.split("refreshToken=")?.[1]?.split("&")?.[0]??localStorage.getItem("refresh_token")??void 0;if(!r)throw new Error("No refresh token available");m().post(`${l}token`,{grant_type:"refresh_token",client_id:p,client_secret:"",refresh_token:r},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(t=>(_(t.data),e(t))).catch(t=>(console.error(t),d(),sessionStorage.clear(),localStorage.clear(),location.reload(),o(t)))})}function _(e){a({...n.value,refreshIn:new Date(Date.now()+e.expires_in*1e3).getTime(),accessToken:e.access_token,refreshToken:e.refresh_token,idToken:e.id_token,expiresIn:e.expires_in}),s("capacitor")&&(localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("id_token",e.id_token));try{const o=k(e.id_token);console.log("decodedToken",o),a({...n.value,name:o.display_name,email:o.email,id:o.sub,locale:o.locale})}catch(o){console.error(o)}}function d(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("id_token")}function S(){`${h}`,s("capacitor")&&`${c}`,f.value.logout()}export{S as n,I as r,d as t};
