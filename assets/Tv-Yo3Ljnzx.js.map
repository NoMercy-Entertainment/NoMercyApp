{"version":3,"file":"Tv-Yo3Ljnzx.js","sources":["../../src/views/Music/Start/components/MusicHeader.vue","../../src/views/Music/Start/Tv.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, type PropType, watch } from \"vue\";\n\nimport type { HomeDataItem } from \"@/types/api/music\";\n\nimport { breakTitle2 } from \"@/lib/stringArray\";\nimport { focusColor, setColorPalette } from \"@/store/ui\";\nimport { currentServer } from \"@/store/currentServer\";\n\nconst props = defineProps({\n  selected: {\n    type: Object as PropType<HomeDataItem | null>,\n    required: false,\n  },\n});\n\nonMounted(() => {\n  setColorPalette(props.selected?.color_palette?.cover);\n});\n\nwatch(props, (value) => {\n  setColorPalette(value.selected?.color_palette?.cover);\n});\n\n</script>\n\n<template>\n  <div class=\"w-full h-full absolute left-0 top-0 bg-[#131314]\" :key=\"selected?.id\"\n    :style=\"focusColor ? `--color-focus: ${focusColor}` : ''\">\n    <div class=\"w-available h-available absolute left-[202px] top-0 overflow-hidden bg-focus\">\n      <img class=\"w-available h-available absolute left-[-0.39px] top-[-0.39px] opacity-40 object-cover object-center\"\n        :src=\"`${currentServer?.serverBaseUrl}${selected?.cover}`\" alt=\"\" />\n      <div class=\"w-available h-available absolute left-[-0.39px] top-[-0.39px]\"></div>\n      <div class=\"w-[150vw] h-[150vw] absolute left-[-30%] bottom-[-50%]\" style=\"\n              background: radial-gradient(\n                closest-side,\n                rgba(19, 19, 20, 0.1) 0%,\n                rgba(19, 19, 20, 1) 70.73974609375%\n              );\n          \"></div>\n    </div>\n    <div class=\"flex flex-col justify-start items-start w-[484px] relative left-[58px] top-20 gap-7\">\n      <div class=\"flex flex-col justify-start items-start self-stretch relative gap-5\">\n        <div class=\"flex flex-col justify-start items-start w-full relative gap-0 mt-8\">\n          <p v-if=\"selected?.name\"\n            class=\"self-stretch flex-grow-0 flex-shrink-0 w-full text-3xl font-bold text-left z-10\"\n            v-html=\"breakTitle2(selected?.name ?? ' ', 'text-lg line-clamp-2')\">\n          </p>\n\n          <div\n            class=\"flex items-center h-8 gap-2 self-stretch w-full opacity-60 text-xs font-medium text-left text-[#c4c7c5]\">\n            <span class=\"flex gap-2\" v-if=\"selected?.type\">\n              <span>{{ selected?.type.replace(/s$/u, '').toTitleCase() }}</span>\n            </span>\n\n            <span class=\"flex gap-2\" v-if=\"selected?.tracks\">\n              <span>â€¢</span>\n              <span>{{ selected?.tracks }} {{ $t('tracks') }}</span>\n            </span>\n          </div>\n\n        </div>\n        <div class=\"line-clamp-4 text-sm -mt-4\">\n          {{ selected?.description }}\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped></style>","<script setup lang=\"ts\">\nimport { ref, watch } from 'vue';\nimport { IonPage, IonContent, onIonViewDidEnter } from '@ionic/vue';\n\nimport type { HomeDataItem } from '@/types/api/music';\nimport type { Component } from \"@/lib/routerHelper\";\n\nimport useServerClient from '@/lib/clients/useServerClient';\n\nimport MusicHeader from \"./components/MusicHeader.vue\";\nimport TvCarousel2 from \"./components/TvCarousel2.vue\";\n\nconst { data } = useServerClient<Component<Component<HomeDataItem>>[]>({\n  queryKey: ['music', 'home']\n});\n\nconst selected = ref<HomeDataItem | null | undefined>();\n\nconst scrollContainer = ref<HTMLDivElement>();\nconst locked = ref(false);\nconst timeout = ref<NodeJS.Timeout>();\nconst lastFocused = ref<HTMLAnchorElement>();\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  const carousels = value.filter((item) => item.component == 'NMCarousel');\n  if (!carousels) return;\n  selected.value = carousels.find((item) => item.props.items.length > 0)?.props?.items?.[0]?.props?.data;\n});\n\nonIonViewDidEnter(() => {\n  const carousels = data.value?.filter((item) => item.component == 'NMCarousel');\n  if (!carousels) return;\n  selected.value = carousels.find((item) => item.props.items.length > 0)?.props?.items?.[0]?.props?.data;\n\n  setTimeout(() => {\n    const target = document.querySelector(`[data-card=\"${selected.value?.id}\"]`) as HTMLAnchorElement;\n    if (target) {\n      target.focus();\n    }\n  }, 100);\n});\n\nwatch(selected, (value) => {\n  setTimeout(() => {\n    const target = document.querySelector(`[data-card=\"${value?.id}\"]`) as HTMLAnchorElement;\n    if (target) {\n      target.focus();\n    }\n  }, 100);\n});\n\nconst handleFocus = (event: FocusEvent, item?: HomeDataItem) => {\n  const target = event.target as HTMLAnchorElement;\n\n  if (target?.nodeName == 'DIV') {\n    (lastFocused.value ?? target.querySelector('a'))?.focus();\n    return;\n  }\n\n  if (item) {\n    selected.value = item;\n    lastFocused.value = target;\n  }\n};\n\nconst handleDown = (event: KeyboardEvent) => {\n  if (locked.value) {\n    event.preventDefault();\n    return;\n  }\n\n  clearTimeout(timeout.value);\n  locked.value = true;\n\n  const target = event.target as HTMLDivElement;\n  const targetIndex = target.getAttribute('data-index');\n  const closest = target.closest('[data-row]');\n\n  const up = closest?.previousElementSibling as HTMLDivElement;\n  const upButton = up?.querySelector(`a[data-index=\"${targetIndex}\"]`) as HTMLAnchorElement;\n\n  const down = closest?.nextElementSibling as HTMLDivElement;\n  const downButton = down?.querySelector(`a[data-index=\"${targetIndex}\"]`) as HTMLAnchorElement;\n\n  const leftButton = target.previousElementSibling as HTMLDivElement;\n  const rightButton = target.nextElementSibling as HTMLDivElement;\n\n  if (upButton && event.key == 'ArrowUp') {\n    event.preventDefault();\n    upButton.focus();\n  } else if (downButton && event.key == 'ArrowDown') {\n    event.preventDefault();\n    downButton.focus();\n  } else if (leftButton && event.key == 'ArrowLeft') {\n    event.preventDefault();\n    leftButton.focus();\n  } else if (rightButton && event.key == 'ArrowRight') {\n    event.preventDefault();\n    rightButton.focus();\n  } else if (up && event.key == 'ArrowUp') {\n    const upButton = Array.from(up?.querySelectorAll<HTMLAnchorElement>('a'))?.at(-1);\n    if (upButton) {\n      upButton.focus();\n    }\n  } else if (down && event.key == 'ArrowDown') {\n    const downButton = Array.from(down?.querySelectorAll<HTMLAnchorElement>('a'))?.at(-1);\n    if (downButton) {\n      downButton.focus();\n    }\n  }\n};\n\nconst handleUp = (event: KeyboardEvent) => {\n  timeout.value = setTimeout(() => {\n    locked.value = false;\n  }, 150);\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n      <div class=\" w-screen h-screen relative overflow-hidden bg-[#131314]\">\n\n        <MusicHeader v-if=\"selected\" :selected=\"selected\" />\n\n        <div ref=\"scrollContainer\" tabindex=\"0\" @focus=\"handleFocus($event)\"\n          class=\"flex flex-col justify-start items-start w-available -mx-3 px-3 absolute left-14 right-14 top-[320px] h-available overflow-auto scroll-smooth gap-4 flex-1 pb-8\">\n\n          <template v-if=\"data\">\n\n            <TvCarousel2 v-for=\"(render, index) in data?.filter?.((item) => item.component == 'NMCarousel') ?? []\"\n              :key=\"render.id\" :title=\"render.props.title\" :data=\"render.props.items ?? []\" :handleFocus=\"handleFocus\"\n              :handleDown=\"handleDown\" :handleUp=\"handleUp\" />\n\n            <!--            <component-->\n            <!--                v-for=\"(render, index) in data?.filter((item) => item.component == 'NMCarousel') ?? []\"-->\n            <!--                :index=\"index\"-->\n            <!--                :key=\"render.id\"-->\n            <!--                :is=\"render.component\"-->\n            <!--                v-bind=\"render.props\"-->\n            <!--                :handleFocus=\"handleFocus\"-->\n            <!--                :handleDown=\"handleDown\"-->\n            <!--                :handleUp=\"handleUp\"-->\n            <!--            />-->\n          </template>\n        </div>\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["props","__props","onMounted","setColorPalette","_b","_a","watch","value","data","useServerClient","selected","ref","scrollContainer","locked","timeout","lastFocused","carousels","item","_e","_d","_c","onIonViewDidEnter","_f","target","handleFocus","event","handleDown","targetIndex","closest","up","upButton","down","downButton","leftButton","rightButton","handleUp"],"mappings":"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"}