var h=Object.defineProperty;var u=(a,s,t)=>s in a?h(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var r=(a,s,t)=>u(a,typeof s!="symbol"?s+"":s,t);import{P as y}from"./video-player-B2yH_Yz-.js";import{bB as c}from"./index-CTarIx2-.js";import{b as m}from"./buttons-DnucOQvv.js";import{P as p,R as l}from"./vue-ionic-9j_oSDCB.js";class P extends y{constructor(){super(...arguments);r(this,"player",{});r(this,"introPatterns",p("introPatterns",["^OP$","^NCOP$","^Opening$","^Opening","^Opening Credits$","^Opening Theme$","^Opening Song$","^Epilogue$","^Prologue$"]).value.map(t=>new RegExp(t,"iu")));r(this,"outroPatterns",p("outroPatterns",["^ED$","^PV$","^NCED$","^CM$","^Preview$","^Next Episode Preview$","^Next Time Preview$","^Outro$","^Ending","^ED+Cast$","^Credits$","^End Credits$","^Closing$"]).value.map(t=>new RegExp(t,"iu")));r(this,"buttons",{});r(this,"autoSkip",!1);r(this,"lastChapter","");r(this,"skipButtonElement",null)}initialize(t){this.player=t,!this.player.options.disableAutoPlayback&&(this.player.options.introPatterns&&(this.introPatterns=this.player.options.introPatterns),this.player.options.outroPatterns&&(this.outroPatterns=this.player.options.outroPatterns),this.player.options.autoSkip!==void 0?this.autoSkip=this.player.options.autoSkip:this.autoSkip=localStorage.getItem("nmplayer-auto-skip")==="true"||this.player.isTv(),this.buttons=m())}use(){this.player.options.disableAutoPlayback||this.player.on("time",this.checkChapters.bind(this))}dispose(){this.player.options.disableAutoPlayback||this.player.off("time",this.checkChapters.bind(this))}getChapterType(t){return this.introPatterns.some(e=>e.test(t))?"intro":this.outroPatterns.some(e=>e.test(t))?"next":null}checkChapters(){if(!this.player.chapters||!this.player.chapters.cues||this.player.chapters.cues.length===0){this.hideSkipButton();return}if(this.player.chapters.errors.length>0){console.error("Error parsing chapters:",this.player.chapters.errors),this.hideSkipButton();return}const t=this.player.getVideoElement().currentTime;let e=this.getCurrentChapter(t);if(!e){this.hideSkipButton();return}if(this.shouldSkipChapter(e.text)){if(this.lastChapter!==e.text){this.lastChapter=e.text;let i=this.getNextChapter(t);if(this.autoSkip&&(!i||this.shouldSkipChapter(i.text))){this.player.next(),this.lastChapter="";return}else this.autoSkip&&i?this.player.seek(i.startTime):this.showSkipButton()}}else this.hideSkipButton()}isFirstOrLastEpisodeOfSeason(){const t=this.player.playlistItem();if(t.episode===1)return!0;const e=this.player.getPlaylist().map(o=>l(o)),n=c(e,"season")[t.season];return n?n.at(-1)===t:!1}shouldSkipChapter(t){return this.player.getCurrentTime()<this.player.getDuration()/2&&this.player.getPlaylistIndex()===0||this.player.getCurrentTime()>this.player.getDuration()/2&&this.player.isLastPlaylistItem()||this.isFirstOrLastEpisodeOfSeason()?!1:this.introPatterns.some(e=>e.test(t))||this.outroPatterns.some(e=>e.test(t))}getCurrentChapter(t){return this.player.chapters.cues.find(e=>t>=e.startTime&&t<=e.endTime)}getNextChapter(t){return l(this.player.chapters.cues.find(e=>e.startTime>=t))}showSkipButton(){if(this.skipButtonElement){this.skipButtonElement.classList.add("visible");return}const t=this.player.createElement("button","skip-chapter-button").addClasses(["skip-chapter-button","flex","items-center","justify-center","gap-2","text-sm","text-white","bg-neutral-800","rounded","hover:bg-neutral-700","px-2","py-1","absolute","bottom-20","right-6","z-10","transition-opacity","duration-300","opacity-0","invisible"]).appendTo(this.player.overlay).get();let i=this.getChapterType(this.lastChapter)==="intro"?this.player.localize("Skip intro"):this.player.localize("Skip outro");t.title=i;const n=this.player.createElement("span","skip-chapter-text").addClasses(["hidden","md:inline"]).appendTo(t).get();n.textContent=i,this.player.createSVGElement(t,"chevronR",this.buttons.chevronR,!1,!1).classList.add("w-4","h-4"),t.addEventListener("click",()=>{this.skipToNextPlayableChapter(this.player.getCurrentTime()),this.hideSkipButton()}),this.skipButtonElement=t,requestAnimationFrame(()=>{t.classList.remove("opacity-0","invisible"),t.classList.add("opacity-100","visible")}),t.focus()}skipToNextPlayableChapter(t){let e=this.getNextChapter(t);for(;e&&this.shouldSkipChapter(e.text);)t=e.endTime,e=this.getNextChapter(t);e?this.player.seek(e.startTime):this.player.next()}hideSkipButton(){this.skipButtonElement&&(this.skipButtonElement.classList.remove("opacity-100","visible"),this.skipButtonElement.classList.add("opacity-0","invisible"),setTimeout(()=>{this.skipButtonElement&&(this.skipButtonElement.remove(),this.skipButtonElement=null)},300))}}export{P as A};
