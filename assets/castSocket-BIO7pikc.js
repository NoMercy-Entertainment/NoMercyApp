import{H as S}from"./HubConnection-CMQnVIkW.js";import{B as T,l as b,ae as E,R as f,cN as H,du as B,dv as R,cO as U,w as x}from"./index-DkQngsHe.js";const n=b(),O=T(()=>{var e;return(e=n.value)==null?void 0:e.connection}),p=b(!1);function g(){var e,o,c;p.value=!0,console.log("Connected to Cast SignalR"),document.dispatchEvent(new Event("castHub-connected")),(e=n.value)!=null&&e.connection&&(R((o=n.value)==null?void 0:o.connection),U((c=n.value)==null?void 0:c.connection))}function i(e){p.value=!1,console.log("Disconnected from Cast SignalR",e),document.dispatchEvent(new Event("castHub-disconnected"))}function y(e){p.value=!1,console.error("Cast SignalR Error:",e),document.dispatchEvent(new Event("castHub-error"))}x(f,async e=>{var c,t,a,u,l,v,r,d;const o=(c=E.value)==null?void 0:c.accessToken;e&&p.value&&((a=(t=n.value)==null?void 0:t.connection)==null||a.stop().then(),(u=n.value)==null||u.dispose(),n.value=new H(f.value.serverBaseUrl,o,"castHub"),(v=(l=n.value)==null?void 0:l.connection)==null||v.on("connected",g),(d=(r=n.value)==null?void 0:r.connection)==null||d.on("disconnected",i),await D().catch(y))});async function D(){var e,o,c,t;if(((o=(e=n.value)==null?void 0:e.connection)==null?void 0:o.state)!==S.Connected)return(t=(c=n.value)==null?void 0:c.connection)==null?void 0:t.start().then(g)}async function j(){var e,o,c,t;try{return((o=(e=n.value)==null?void 0:e.connection)==null?void 0:o.state)===S.Disconnected||(t=(c=n.value)==null?void 0:c.connection)==null?void 0:t.stop().then(i).catch(i)}catch(a){console.error("Error stopping Cast SignalR:",a),i()}}async function q(){var o,c,t,a,u,l,v,r,d,C,h,m,k;const e=(o=E.value)==null?void 0:o.accessToken;f.value&&(!((t=(c=n.value)==null?void 0:c.connection)!=null&&t.state)||((u=(a=n.value)==null?void 0:a.connection)==null?void 0:u.state)===S.Disconnected)&&(n.value=new H(f.value.serverBaseUrl,e,"castHub"),(v=(l=n.value)==null?void 0:l.connection)==null||v.on("connected",g),(d=(r=n.value)==null?void 0:r.connection)==null||d.on("disconnected",i),await D().catch(y),(h=(C=n.value)==null?void 0:C.connection)==null||h.onreconnecting(s=>{var w;console.log("SignalR Disconnected.",s==null?void 0:s.message),B((w=n.value)==null?void 0:w.connection),i()}),(k=(m=n.value)==null?void 0:m.connection)==null||k.onreconnected(()=>{var s;console.log("SignalR Reconnected."),R((s=n.value)==null?void 0:s.connection),g()}))}export{q as a,p as b,O as c,j as s};
