import{Ft as M,Gt as v,Ln as u,Rt as g,Tt as w,an as N,cn as y,i as P,kn as b,mt as l,on as F,qt as _,u as T,xn as p,yn as x,zt as f}from"./index-cywnPOBC.js";import"./dist-yzM0QGvF.js";import"./esm-CsGjMs42.js";import"./esm-D4f7ygqA.js";import"./dist-CG1k-g7C.js";import"./focus-visible-dQviwWa0.js";import"./index5-DWzlHdCO.js";import"./client-D7oxUmH6.js";import"./ionic-global-DCe2g38l.js";import"./hardware-back-button-Bqrrbg0Z.js";import"./index3-bIbYCfqw.js";import"./helpers-BGGXVDsd.js";import"./index6-vUi4VFUZ.js";import"./index8-5IzBz0Dr.js";import"./keyboard-CAPY05Np.js";import"./index2-DsYXeg3E.js";import"./ios.transition-DeZfFnMt.js";import"./keyboard2-CYwkuq6R.js";import"./md.transition-CoCDKCK7.js";import"./dir-VVnELOav.js";import"./ui-C0FA7XgL.js";import"./client-TRoQZYEY.js";import{t as A}from"./currentServer-ns-65dJg.js";import"./config-BZ-AEJ_J.js";import"./core-Byg9KrIc.js";import"./esm-D9ex0nT9.js";import"./global-oyc8MvKQ.js";import"./esm-B2mzPl6v.js";import"./bundle-mjs-BuAB9hD1.js";import{s as r}from"./user-DdN2xDWa.js";import"./serverClient-h83xvsoB.js";import{t as c}from"./router-b6Y7vD7A.js";import"./utils-CfbU6uFB.js";import"./useBaseQuery--g5SyDb6.js";import"./useInfiniteServerClient-DYu8wLRM.js";import{l as S}from"./SocketClient-BXQHVNG_.js";import"./useQueryClient-CeysrMlA.js";import"./useQuery-BSaIeQ43.js";import"./apiClient-cmnl9Hzw.js";import"./notifications-Cig9DoL1.js";import"./utils-D5nhA-44.js";import"./deviceInfo-D74C9RbC.js";import"./auth-Bz7Q9vHJ.js";import{s as d}from"./imageModal-BIphXLR8.js";import{t as V}from"./useServerClient-BCJ_nw8c.js";import{a as B,i as H,n as R,o as U,r as D,s as I}from"./VideoPlayer-zDHN3OcG.js";import"./buttons-BrAf7pXX.js";import{t as K}from"./videoNoMercyConnectPlugin-Hx_j5vTI.js";w();var E=class extends I{player={};boundKeyHandler=()=>{};initialize(o){this.player=o,this.boundKeyHandler=this.keyHandler.bind(this)}use(){this.player.options.disableControls||document.addEventListener("keyup",this.boundKeyHandler,!1)}dispose(){document.removeEventListener("keyup",this.boundKeyHandler)}keyHandler(o){if(document.activeElement?.nodeName=="INPUT")return;const n=this.keyBindings();let e=!1;this.player.getVideoElement().getBoundingClientRect().width!=0&&(!e&&this.player&&(e=!0,n.some(t=>t.key===o.key&&t.control===o.ctrlKey)&&(o.preventDefault(),n.find(t=>t.key===o.key&&t.control===o.ctrlKey)?.function())),setTimeout(()=>{e=!1},300))}hasNoMercyConnect(){return this.player.plugins.has("videoNoMercyConnect")}getNoMercyConnectSocket(){return this.hasNoMercyConnect()?this.player.plugins.get("videoNoMercyConnect")?.socket:null}sendNoMercyConnectCommand(o,n){if(this.hasNoMercyConnect())try{const e=this.getNoMercyConnectSocket();e?e.invoke("PlaybackCommand",o,n!==null?n:null):console.error("No NoMercyConnect socket available")}catch(e){console.error("Error invoking PlaybackCommand:",e)}else console.warn("No NoMercyConnect plugin available")}handleForward(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward"):this.player.forwardVideo()}handleBackward(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("backward"):this.player.rewindVideo()}handlePlayback(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand(this.player.isPlaying?"pause":"play"):this.player.togglePlayback()}handlePrevious(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("previous"):this.player.previous()}handleNext(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("next"):this.player.next()}handleCycleCaption(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("cycleCaption"):this.player.cycleSubtitles()}handleCycleAudio(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("cycleAudio"):this.player.cycleAudioTracks()}keyBindings(){return[{name:"Play",key:"MediaPlay",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("play"):this.player.play().then())}},{name:"Pause",key:"MediaPause",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("pause"):this.player.pause())}},{name:"Toggle playback",key:" ",control:!1,function:()=>{this.handlePlayback()}},{name:"Toggle playback",key:"MediaPlayPause",control:!1,function:()=>{this.player.options.disableMediaControls||this.handlePlayback()}},{name:"Stop",key:"MediaStop",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("stop"):this.player.stop())}},{name:"Rewind",key:"ArrowLeft",control:!1,function:()=>!this.player.isTv()&&this.handleBackward()},{name:"Rewind",key:"MediaRewind",control:!1,function:()=>{!this.player.isTv()&&this.player.options.disableMediaControls||this.handleBackward()}},{name:"Fast forward",key:"ArrowRight",control:!1,function:()=>!this.player.isTv()&&this.handleForward()},{name:"Fast forward",key:"MediaFastForward",control:!1,function:()=>{this.player.options.disableMediaControls||this.handleForward()}},{name:"Previous item",key:"MediaTrackPrevious",control:!1,function:()=>{this.player.options.disableMediaControls||this.handlePrevious()}},{name:"Previous item",key:"p",control:!1,function:()=>this.handlePrevious()},{name:"Next item",key:"MediaTrackNext",control:!1,function:()=>{this.player.options.disableMediaControls||this.handleNext()}},{name:"Next item",key:"n",control:!1,function:()=>this.handleNext()},{name:"Cycle subtitle tracks",key:"Subtitle",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle subtitle tracks",key:"5",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle subtitle tracks",key:"v",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle audio tracks",key:"Audio",control:!1,function:()=>this.handleCycleAudio()},{name:"Cycle audio tracks",key:"2",control:!1,function:()=>this.handleCycleAudio()},{name:"Cycle audio",key:"b",control:!1,function:()=>this.handleCycleAudio()},{name:"Forward 30 seconds",key:"ColorF0Red",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",30):this.player.forwardVideo(30)}},{name:"Forward 60 seconds",key:"ColorF1Green",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",60):this.player.forwardVideo(60)}},{name:"Forward 90 seconds",key:"ColorF2Yellow",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",90):this.player.forwardVideo(90)}},{name:"Forward 120 seconds",key:"ColorF3Blue",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",120):this.player.forwardVideo(120)}},{name:"Forward 30 seconds",key:"3",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",30):this.player.forwardVideo(30)}},{name:"Forward 60 seconds",key:"6",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",60):this.player.forwardVideo(60)}},{name:"Forward 90 seconds",key:"9",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",90):this.player.forwardVideo(90)}},{name:"Forward 120 seconds",key:"1",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",120):this.player.forwardVideo(120)}},{name:"Fullscreen",key:"f",control:!1,function:()=>{this.player.toggleFullscreen()}},{name:"Volume up",key:"ArrowUp",control:!1,function:()=>{!this.player.isTv()&&!this.player.isMobile()&&this.player.volumeUp()}},{name:"Volume down",key:"ArrowDown",control:!1,function:()=>{!this.player.isTv()&&!this.player.isMobile()&&this.player.volumeDown()}},{name:"Mute",key:"m",control:!1,function:()=>{this.player.toggleMute()}},{name:"Cycle aspect ratio",key:"BrowserFavorites",control:!1,function:()=>{this.player.cycleAspectRatio()}},{name:"Cycle aspect ratio",key:"a",control:!1,function:()=>{this.player.cycleAspectRatio()}},{name:"Show info",key:"Info",control:!1,function:()=>{}}].map((o,n)=>({...o,id:n}))}},L=E,z=_({__name:"Desktop",setup(o){const{data:n}=V({enabled:!r.value.features?.nomercyConnect}),e=b();function t(s){const i={controls:!1,debug:!1,playlist:s?.filter(a=>!!a.id)??[],accessToken:r.value?.accessToken,basePath:A.value?.serverBaseUrl?.replace(/\/$/,""),imageBasePath:"https://app.nomercy.tv/tmdb-images",forceTvMode:(l("android")||l("ios"))&&!l("mobile"),disableTouchControls:!1,disableMediaControls:"mediaSession"in navigator||l("capacitor"),renderAhead:100,disableAutoPlayback:r.value.features?.nomercyConnect};if(e.value=D("player1").setup(i),e.value.once("back",()=>{history.state.back?c.back():c.replace("/")}),r.value.features?.nomercyConnect){const a=new K;e.value.registerPlugin("videoNoMercyConnect",a),e.value.usePlugin("videoNoMercyConnect")}const m=new H;e.value.registerPlugin("desktopUI",m),e.value.usePlugin("desktopUI");const h=new B;e.value.registerPlugin("autoSkip",h),e.value.usePlugin("autoSkip");const C=new L;if(e.value.registerPlugin("keyHandler",C),e.value.usePlugin("keyHandler"),!r.value.features?.nomercyConnect){const a=new U;e.value.registerPlugin("sync",a),e.value.usePlugin("sync")}const k=new R;e.value.registerPlugin("octopus",k),e.value.usePlugin("octopus"),e.value.once("play",()=>{e.value.enterFullscreen()}),e.value.on("playlistComplete",()=>{console.log("Playlist complete"),history.state.back?c.back():c.replace("/")}),e.value.on("play",()=>{d(!0)}),e.value.on("pause",()=>{d(!1)}),e.value.on("fullscreen",a=>{window.external?.sendMessage?.(a?"enterFullscreen":"exitFullscreen")})}return x(n,s=>{s?.length&&t(s)}),N(()=>{S.stop(),r.value.features?.nomercyConnect?t():n.value?.length&&t(n.value)}),F(()=>{e.value?.dispose(),d(!1)}),(s,i)=>(y(),f(u(T),null,{default:p(()=>[v(u(P),{fullscreen:!0},{default:p(()=>[(y(),f(M,{to:"body"},[i[0]||(i[0]=g("div",{id:"player1",class:"group nomercyplayer text-white"},null,-1))]))]),_:1})]),_:1}))}}),De=z;export{De as default};
