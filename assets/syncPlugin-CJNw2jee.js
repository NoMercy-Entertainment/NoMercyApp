var r=Object.defineProperty;var y=(l,a,i)=>a in l?r(l,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[a]=i;var d=(l,a,i)=>y(l,typeof a!="symbol"?a+"":a,i);import{ae as m}from"./vue-ionic-CBB0-pQG.js";import{P as f}from"./video-player-B2yH_Yz-.js";import{bI as o}from"./index-BNKy1t0Z.js";class v extends f{constructor(){super(...arguments);d(this,"player",{});d(this,"route",{})}async initialize(i){this.player=i}use(){this.player.on("lastTimeTrigger",this.lastTimeTrigger.bind(this)),this.player.on("back",this.ended.bind(this)),this.player.on("ended",this.ended.bind(this)),this.player.on("finished",this.ended.bind(this)),this.route=m()}dispose(){this.player.off("lastTimeTrigger",this.lastTimeTrigger.bind(this)),this.player.off("back",this.ended.bind(this)),this.player.off("ended",this.ended.bind(this)),this.player.off("finished",this.ended.bind(this))}lastTimeTrigger(){const i=this.episodeData(),e=o();e==null||e.invoke("SetTime",i)}ended(){var e,s;const i=this.player.getCurrentTime()/this.player.getDuration()*100;if(this.player.isLastPlaylistItem()&&((e=this.player.playlistItem())==null?void 0:e.playlist_type)==="tv"&&i>=90){const t=o();t==null||t.invoke("RemoveWatched",this.episodeData()).then()}else if(this.player.isLastPlaylistItem()&&((s=this.player.playlistItem())==null?void 0:s.playlist_type)==="movie"&&i>=80){const t=o();t==null||t.invoke("RemoveWatched",this.episodeData()).then()}}episodeData(){var p;const i=this.player.playlistItem();let e=(p=this.route)==null?void 0:p.path;e||(e=window.location.hash.replace("#","")),e||(e=location.pathname);const s=e==null?void 0:e.split("/");let t,h,n=(i==null?void 0:i.tmdb_id)??s.at(-2);return s.at(-3)==="specials"?t=s.at(-2):s.at(-3)==="collection"&&(h=s.at(-2),n=i.id),{video_id:i==null?void 0:i.video_id,tmdb_id:n,playlist_type:s.at(-3),special_id:t,collection_id:h,video_type:i==null?void 0:i.video_type,time:Math.floor(this.player.getCurrentTime()||0)}}}export{v as S};
