var K=Object.defineProperty;var W=(T,b,t)=>b in T?K(T,b,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[b]=t;var S=(T,b,t)=>W(T,typeof b!="symbol"?b+"":b,t);import{$ as Q,d as J,w as Y,f as Z,aG as ee,c as te,o as se,l as q,y as ae,a0 as B,au as ie,i as O,t as le,ar as re,Q as L}from"./vue-ionic-DNlOg-eX.js";import{b1 as ne}from"./vendor-C28OoIfY.js";import{bs as oe,u as C,l as X,bE as pe,bF as ce,i as F,k as de,r as G,bG as ue}from"./index-BmWDEClZ.js";import{g as P}from"./imageModal-C87_bPhe.js";import{V as he,S as ye}from"./videoNoMercyConnectPlugin-D5KsMNSU.js";import{A as ge}from"./autoSkipPlugin-BIKdym6G.js";import{B as fe}from"./baseUIPlugin-2qw8wsfO.js";import{c as me,l as be,a as ve,b as we,n as xe,O as Te}from"./video-player-nmsKO7Go.js";import{u as Se}from"./useServerClient-MEtEk74o.js";import{K as Ce}from"./keyHandlerPlugin-Bs8kCSRd.js";import"./media-C2AqgyMX.js";import"./icons-BW5E66pf.js";import"./api-BBofn2cc.js";import"./swiper-D00Cnjmx.js";import"./rxjs-BCp2L9Rn.js";import"./music-player-JWnzXDV1.js";import"./buttons-DnucOQvv.js";import"./subtitles-octopus-By2PrHjB.js";import"./useInfiniteServerClient-DaaqPidf.js";class ke extends fe{constructor(){super(...arguments);S(this,"preScreen",{});S(this,"episodeScreen",{});S(this,"languageScreen",{});S(this,"selectedSeason");S(this,"hasPlayed",!1);S(this,"tvDialogStyles",["w-available","h-available","max-w-available","max-h-available",""])}use(){this.player.container.style.display="contents",this.createTvOverlay(this.player.overlay),this.createPreScreen(this.player.overlay),this.createEpisodeScreen(this.player.overlay),this.createLanguageScreen(this.player.overlay),this.player.options.autoPlay||this.showPreScreen(),this.player.once("firstFrame",()=>{this.hasPlayed=!0}),this.player.on("play",()=>{this.player.emit("show-seek-container",!1),this.player.getVideoElement().scrollIntoView(),this.closePreScreen(),this.closeEpisodeScreen(),this.closeLanguageScreen()}),this.player.on("back-button",this.backMenu.bind(this)),this.player.on("pause",()=>{this.player.overlay.scrollIntoView()}),this.player.once("ready",()=>{this.showPreScreen(),this.player.pause()})}backMenu(){this.player.isTv()&&this.currentMenu!=="seek"&&(this.player.container.classList.contains("episode-screen")?this.closeEpisodeScreen():this.player.container.classList.contains("language-screen")?this.closeLanguageScreen():this.player.container.classList.contains("pre-screen")?this.player.emit("back"):(this.player.pause(),this.showPreScreen()))}createTvOverlay(t){const e=this.player.createElement("div","tv-overlay").addClasses(["absolute","flex","flex-col","justify-end","gap-4","w-available","h-available","z-0"]).addClasses(["group-[&.nomercyplayer.paused.pre-screen]:hidden"]).appendTo(t).get(),n=this.createTopBar(e);this.player.addClasses(n,["px-10","pt-10","z-0"]);const i=this.createRestartButton(n,!0);this.player.addClasses(i,["children:stroke-2"]);const a=this.createNextButton(n,!0);this.player.addClasses(a,["children:stroke-2"]),this.createDivider(n),this.createTvCurrentItem(n),this.createOverlayCenterMessage(e),this.createSpinnerContainer(e),this.seekContainer=this.createSeekContainer(e);const l=this.createBottomBar(e),u=this.player.createElement("div","bottom-row").addClasses(["tv-bottom-row","relative","flex","flex-row","items-center","gap-4","mt-auto","w-available","px-20","pb-10","z-0"]).appendTo(l).get();this.createPlaybackButton(u,!0),this.createTime(u,"current",[]),this.createTvProgressBar(u),this.createTime(u,"remaining",["mr-14"]),this.player.on("playing",()=>{this.currentMenu!=="seek"&&!this.controlsVisible&&this.playbackButton.focus(),this.currentScrubTime=this.getClosestSeekableInterval()});let o=i??a;[i,a].forEach(s=>{s==null||s.addEventListener("keydown",r=>{var h,d;r.key==="ArrowDown"?!this.nextUp.style||this.nextUp.style.display==="none"?(h=this.playbackButton)==null||h.focus():(d=this.nextUp.lastChild)==null||d.focus():r.key==="ArrowLeft"?(o=r.target.previousElementSibling,o==null||o.focus()):r.key==="ArrowRight"&&(r.preventDefault(),o=r.target.nextElementSibling,o==null||o.focus())})}),[this.nextUp.firstChild,this.nextUp.lastChild].forEach(s=>{s==null||s.addEventListener("keydown",r=>{var h,d,y;r.key==="ArrowUp"?(h=o||i)==null||h.focus():r.key==="ArrowDown"?this.playbackButton.focus():r.key==="ArrowLeft"?(d=this.nextUp.firstChild)==null||d.focus():r.key==="ArrowRight"&&((y=this.nextUp.lastChild)==null||y.focus())})}),[this.playbackButton].forEach(s=>{s==null||s.addEventListener("keydown",r=>{var h,d,y;r.key==="ArrowUp"&&(r.preventDefault(),(d=(h=this.nextUp)==null?void 0:h.classList)!=null&&d.contains("visible")?(y=this.nextUp)==null||y.focus():o==null||o.focus())})});let p=!1;const c=s=>{var h,d,y,v;const r=s.target;if(s.key==="ArrowLeft"){if([i.id,a.id,(h=this.nextUp.firstChild)==null?void 0:h.id,(d=this.nextUp.lastChild)==null?void 0:d.id].includes(r==null?void 0:r.id))return;if(s.preventDefault(),this.player.emit("show-seek-container",!0),this.shouldSlide)this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()}),this.shouldSlide=!1;else{const m=this.currentScrubTime-10;p=!0,this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:m})}}else if(s.key==="ArrowRight"){if([i.id,a.id,(y=this.nextUp.firstChild)==null?void 0:y.id,(v=this.nextUp.lastChild)==null?void 0:v.id].includes(r==null?void 0:r.id))return;if(s.preventDefault(),this.player.emit("show-seek-container",!0),this.shouldSlide)this.currentScrubTime=this.player.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.player.getClosestSeekableInterval()}),this.shouldSlide=!1;else{const m=this.currentScrubTime+10;p=!0,this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:m})}}else s.key==="Enter"&&(Math.abs(this.currentScrubTime-this.player.getCurrentTime())>5&&p?(this.player.seek(this.currentScrubTime),p=!1):s.target===document.body&&this.player.togglePlayback())};return[window,i,a].forEach(s=>{s==null||s.addEventListener("keydown",c),this.player.on("dispose",()=>{s==null||s.removeEventListener("keydown",c)})}),this.player.on("active",s=>{!this.controlsVisible&&s&&this.playbackButton.focus(),this.player.overlay.scrollIntoView(),setTimeout(()=>{this.controlsVisible=s},0)}),l}showPreScreen(){var t;this.preScreen.showModal(),(t=this.preScreen.querySelector(".button-container>button"))==null||t.focus(),setTimeout(()=>{this.player.container.classList.add("pre-screen")},5)}closePreScreen(){this.preScreen.close(),this.player.emit("hideControls"),this.player.container.classList.remove("pre-screen")}createPreScreen(t){this.preScreen=this.player.createElement("dialog","pre-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused:not(.open)]:backdrop:bg-black/80","group-[&.nomercyplayer.paused:not(.open)]:backdrop:pointer-events-none"]).appendTo(t).get(),this.preScreen.setAttribute("popover","manual"),this.preScreen.setAttribute("role","modal");const e=this.player.createElement("div","pre-screen").addClasses(["pre-screen","absolute","inset-0","flex","p-6","text-white","w-available","h-available","z-0"]).addClasses(["group-[&.nomercyplayer.paused.episode-screen]:hidden","group-[&.nomercyplayer.paused.language-screen]:hidden"]).appendTo(this.preScreen).get(),n=this.player.createElement("div","left-side").addClasses(["flex","flex-col","justify-between","items-center","w-1/2","h-available"]).appendTo(e).get(),i=this.createImageContainer(n),a=this.player.createElement("div","title-container").addClasses(["flex","flex-col","w-available","h-available"]).appendTo(i).get(),l=this.player.createElement("div","title").addClasses(["flex","text-white","text-lg","font-bold","mx-2"]).appendTo(a).get(),u=this.player.createElement("div","description").addClasses(["text-left","text-white","text-sm","line-clamp-4","font-bold","leading-5","overflow-hidden","mx-2"]).appendTo(a).get();this.player.on("item",()=>{l.innerHTML=this.player.playlistItem().title.replace(this.player.playlistItem().show??"","").replace("%S",this.player.localize("S")).replace("%E",this.player.localize("E")),u.innerHTML=this.player.playlistItem().description});const o=this.player.createElement("div","button-container").addClasses(["button-container","flex","flex-col","gap-3","w-available","h-1/2","mt-7","mb-3","overflow-auto","p-2","[*::-webkit-scrollbar]:hidden"]).appendTo(n).get();this.createTvButton(o,"play",null,this.player.play,this.buttons.play),this.createTvButton(o,"restart","Play from beginning",this.player.restart,this.buttons.restart);const p=this.createTvButton(o,"showEpisodeMenu","Episodes",()=>this.player.emit("showEpisodeScreen"),this.buttons.playlist);p.style.display="none",p.addEventListener("click",()=>{this.player.emit("switch-season",this.player.playlistItem().season),this.showEpisodeScreen()});const c=this.createTvButton(o,"showLanguageMenu","Audio and subtitles",()=>this.player.emit("showLanguageScreen"),this.buttons.language);c.style.display="none",c.addEventListener("click",()=>{this.showLanguageScreen()}),this.player.createElement("div","pre-screen-right-side").addClasses(["flex","flex-col","justify-center","w-1/3","h-available"]).appendTo(e).get(),this.player.on("audioTracks",()=>{this.player.hasAudioTracks()||this.player.hasCaptions()?c.style.display="flex":c.style.display="none"}),this.player.on("item",()=>{this.player.getPlaylist().length>1?p.style.display="flex":p.style.display="none"})}showEpisodeScreen(){var t;this.episodeScreen.showModal(),this.player.container.classList.add("episode-screen"),this.player.container.classList.add("open"),(t=this.episodeScrollContainer.querySelector(".button-container>button"))==null||t.focus()}closeEpisodeScreen(){var t;this.episodeScreen.close(),this.player.container.classList.remove("episode-screen"),this.player.container.classList.remove("open"),(t=this.preScreen.querySelector(".button-container>button"))==null||t.focus()}createEpisodeScreen(t){this.episodeScreen=this.player.createElement("dialog","episode-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused.episode-screen]:backdrop:bg-black/80","group-[&.nomercyplayer.paused.episode-screen]:backdrop:pointer-events-none"]).appendTo(t).get(),this.episodeScreen.setAttribute("popover","manual"),this.episodeScreen.setAttribute("role","modal");const e=this.player.createElement("div","episode-screen").addClasses(["episode-screen","absolute","inset-0","flex","gap-4","p-6","text-white","w-available","h-available","z-0"]).appendTo(this.episodeScreen).get(),n=this.player.createElement("div","episode-screen-left-side").addClasses(["flex","flex-col","justify-between","items-center","w-2/5","h-available"]).appendTo(e).get();this.createImageContainer(n);const i=this.player.createElement("div","season-button-container").addClasses(["flex","flex-col","gap-3","w-available","h-available","mt-7","mb-3","overflow-auto","px-2","py-0.5","[*::-webkit-scrollbar]:hidden"]).appendTo(n).get();this.player.once("playlist",()=>{var u;const a=this.player.createElement("div","episode-screen-right-side").addClasses(["flex","flex-col","justify-center","w-3/5","h-available"]).appendTo(e).get();this.episodeScrollContainer=this.player.createElement("div","episode-button-container").addClasses(["button-container","flex","flex-col","overflow-auto","h-available","pt-6","gap-2","p-1","min-h-[50%]","scroll-p-4","scroll-smooth"]).appendTo(a).get();let l={};for(const o of this.player.getSeasons())l=this.createTvSeasonButton(i,`season-${o.season}`,o,()=>this.player.emit("switch-season",o.season));(u=l.addEventListener)==null||u.call(l,"keydown",o=>{var p,c;if(o.key!=="ArrowLeft"){if(o.key!=="ArrowRight"){if(!(o.key==="ArrowUp"&&!this.player.options.disableTouchControls)){if(o.key==="ArrowDown"&&!this.player.options.disableTouchControls){(p=l.nextElementSibling)==null||p.focus();const s=l.nextElementSibling;(s==null?void 0:s.nodeName)==="BUTTON"?s==null||s.focus():(c=l.parentElement.nextElementSibling)==null||c.focus()}}}}});for(const[o,p]of this.player.getPlaylist().entries()??[])this.createTvEpisodeMenuButton(this.episodeScrollContainer,p,o)})}showLanguageScreen(){var t;this.languageScreen.showModal(),this.player.container.classList.add("language-screen"),this.player.container.classList.add("open"),(t=this.languageScreen.querySelector(".button-container>button"))==null||t.focus()}closeLanguageScreen(){var t;this.languageScreen.close(),this.player.container.classList.remove("language-screen"),this.player.container.classList.remove("open"),(t=this.preScreen.querySelector(".button-container>button"))==null||t.focus()}createLanguageScreen(t){var s;this.languageScreen=this.player.createElement("dialog","language-screen-dialog").addClasses(this.tvDialogStyles).addClasses(["group-[&.nomercyplayer.paused.language-screen]:backdrop:bg-black/80","group-[&.nomercyplayer.paused.language-screen]:backdrop:pointer-events-none"]).appendTo(t).get(),this.languageScreen.setAttribute("popover","manual"),this.languageScreen.setAttribute("role","modal");const e=this.player.createElement("div","language-screen").addClasses(["language-screen","absolute","inset-0","flex","p-6","text-white","w-available","h-available","z-0"]).appendTo(this.languageScreen).get(),n=this.player.createElement("div","language-screen-left-side").addClasses(["flex","flex-col","items-center","overflow-clip","w-2/5","h-available"]).appendTo(e).get();this.createImageContainer(n);const i=this.player.createElement("div","language-scroll-container").addClasses(["flex","flex-col","overflow-auto","w-available","h-available","gap-3","scroll-p-4","scroll-smooth","border-transparent","outline-transparent","p-1"]).appendTo(n).get();i.addEventListener("focus",()=>{var r;(r=i.querySelector("button"))==null||r.focus()});const a=this.player.createElement("div","language-button-container").addClasses(["flex-shrink-0","h-auto","px-2","py-0.5","w-available","text-left","mt-3"]).appendTo(i).get();a.innerText=this.player.localize("Audio");const l=this.player.createElement("div","language-button-container").addClasses(["[*::-webkit-scrollbar]:hidden","flex","flex-col","flex-shrink-0","gap-3","px-2","py-0.5","w-available"]).appendTo(i).get();l.style.paddingRight="5rem";let u={};const o=r=>{var h,d;if(r.key!=="ArrowLeft"){if(r.key!=="ArrowRight"){if(r.key==="ArrowUp"&&!this.player.options.disableTouchControls)(h=r.target.previousElementSibling)==null||h.focus();else if(r.key==="ArrowDown"&&!this.player.options.disableTouchControls){const y=r.target.nextElementSibling;(y==null?void 0:y.nodeName)==="BUTTON"?y==null||y.focus():(d=u.parentElement.nextElementSibling)==null||d.focus()}}}};(s=u.removeEventListener)==null||s.call(u,"keydown",o),this.player.on("audioTracks",r=>{l.innerHTML="";for(const[h,d]of(r==null?void 0:r.entries())??[])u=this.createLanguageMenuButton(l,{language:d.language??"",label:d.label??"",type:d.type??"",id:d.id??h-1,buttonType:"audio"})});const p=this.player.createElement("div","language-button-container").addClasses(["flex-shrink-0","h-auto","px-2","py-0.5","w-available","text-left","mt-3"]).appendTo(i).get();p.innerText=this.player.localize("Subtitles");const c=this.player.createElement("div","subtitle-button-container").addClasses(["[*::-webkit-scrollbar]:hidden","flex","flex-col","flex-shrink-0","gap-3","flex-shrink-0","px-2","py-0.5","w-available"]).appendTo(i).get();c.style.paddingRight="5rem",c.style.marginTop="0",this.player.on("captionsList",r=>{c.innerHTML="";for(const[h,d]of r.entries()??[])this.createLanguageMenuButton(c,{language:d.language??"",label:d.label??"",type:d.type??"",id:d.id??h-1,buttonType:"subtitle"})})}createTvProgressBar(t){this.sliderBar=this.player.createElement("div","slider-bar").addClasses(["slider-bar","group/slider","overflow-clip","flex","rounded-full","bg-white/20","h-2","mx-4","relative","w-available"]).appendTo(t).get();const e=this.player.createElement("div","slider-progress").addClasses(["slider-progress","absolute","flex","h-full","pointer-events-none","rounded-full","bg-white","z-10","-left-full","w-full"]).appendTo(this.sliderBar).get();return this.chapterBar=this.player.createElement("div","chapter-progress").addClasses(["chapter-bar","bg-transparent","flex","h-2","relative","rounded-full","overflow-clip","w-available"]).appendTo(this.sliderBar).get(),this.player.on("item",async()=>{this.sliderBar.classList.add("bg-white/20"),this.previewTime=[],this.chapters=[],e.style.transform="translateX(0%)",await this.fetchPreviewTime()}),this.player.on("chapters",()=>{var n;((n=this.player.getChapters())==null?void 0:n.length)>0&&!this.player.isTv()?this.sliderBar.classList.remove("bg-white/20"):this.sliderBar.classList.add("bg-white/20")}),this.player.on("time",n=>{e.style.transform=`translateX(${n.percentage}%)`}),this.player.on("currentScrubTime",n=>{e.style.transform=`translateX(${n.currentTime/n.duration*100}%)`}),this.sliderBar}createTvEpisodeMenuButton(t,e,n){var v,m,w;const i=this.player.createElement("button",`playlist-${e.id}`).addClasses(["playlist-menu-button","relative","flex","w-available","p-2","gap-2","rounded-lg","snap-center","outline-transparent","outline","outline-1","outline-solid","text-white","focus-visible:outline-2","focus-visible:outline-white","transition-all","duration-200"]).appendTo(t).get();this.player.playlistItem().season!==1&&(i.style.display="none");const a=this.player.createElement("div",`playlist-${e.id}-left`).addClasses(["episode-menu-button-left","relative","rounded-md","w-[50%]","overflow-clip","self-center"]).appendTo(i).get();this.player.createElement("div",`episode-${e.id}-shadow`).addClasses(["episode-menu-button-shadow","bg-[linear-gradient(0deg,rgba(0,0,0,0.87)_0%,rgba(0,0,0,0.7)_25%,rgba(0,0,0,0)_50%,rgba(0,0,0,0)_100%)]","shadow-[inset_0px_1px_0px_rgba(255,255,255,0.24),inset_0px_-1px_0px_rgba(0,0,0,0.24),inset_0px_-2px_0px_rgba(0,0,0,0.24)]","bottom-0","left-0","absolute","!h-available","w-available"]).appendTo(a).get();const l=this.player.createElement("img",`episode-${e.id}-image`).addClasses(["episode-menu-button-image","w-available","h-auto","aspect-video","object-cover",""]).appendTo(a).get();l.setAttribute("loading","lazy"),(v=e.image)!=null&&v.startsWith("http")?l.src=e.image??"":l.src=e.image&&e.image!==""?`${this.imageBaseUrl}${e.image}`:"";const u=this.player.createElement("div",`episode-${e.id}-progress-container`).addClasses(["episode-menu-progress-container","absolute","bottom-1","w-available","flex","flex-col","px-3"]).appendTo(a).get(),o=this.player.createElement("div",`episode-${e.id}-progress-box`).addClasses(["episode-menu-progress-box","flex","justify-between","h-available","sm:mx-2","mb-1","px-1"]).appendTo(u).get(),p=this.player.createElement("div",`episode-${e.id}-progress-item`).addClasses(["progress-item-text","text-[0.7rem]",""]).appendTo(o).get();e.episode&&e.show&&(p.innerText=`${this.player.localize("E")}${e.episode}`);const c=this.player.createElement("div",`episode-${e.id}-progress-duration`).addClasses(["progress-duration","text-[0.7rem]"]).appendTo(o).get();c.innerText=(m=e.duration)==null?void 0:m.replace(/^00:/u,"");const s=this.player.createElement("div",`episode-${e.id}-slider-container`).addClasses(["slider-container","group/slider","overflow-clip","hidden","rounded-full","bg-white/20","h-1","mx-4","relative","w-available"]).appendTo(u).get();s.style.display=e.progress?"flex":"none";const r=this.player.createElement("div",`episode-${e.id}-progress-bar`).addClasses(["progress-bar","absolute","flex","h-full","pointer-events-none","rounded-full","bg-white","z-10","-left-full","w-full"]).appendTo(s).get();(w=e.progress)!=null&&w.time&&(r.style.transform=`translateX(${e.progress.time/me(e.duration)*100}%`);const h=this.player.createElement("div",`episode-${e.id}-right-side`).addClasses(["playlist-card-right","w-3/4","flex","flex-col","text-left","gap-1","px-1","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white"]).appendTo(i).get(),d=this.player.createElement("span",`episode-${e.id}-title`).addClasses(["playlist-menu-button-title","font-bold","text-lg","line-clamp-1","text-white",""]).appendTo(h).get();d.innerText=be((e.title??"").replace(e.show??"","").replace("%S",this.player.localize("S")).replace("%E",this.player.localize("E")));const y=this.player.createElement("span",`episode-${e.id}-overview`).addClasses(["playlist-menu-button-overview","font-bold","text-[0.7rem]","leading-4","line-clamp-4","overflow-hidden","text-white"]).appendTo(h).get();return y.innerText=ve(e.description,600),this.player.on("item",()=>{this.player.playlistItem().season===e.season?i.style.display="flex":i.style.display="none",this.player.playlistItem().season===e.season&&this.player.playlistItem().episode===e.episode?i.style.background="rgba(255,255,255,.1)":i.style.background="transparent"}),this.player.on("switch-season",f=>{this.selectedSeason=f,this.player.playlistItem().id===e.id?setTimeout(()=>{this.player.scrollCenter(i,t,{margin:1,duration:100})},50):this.player.playlistItem().season!==f&&this.episodeScrollContainer.scrollTo(0,0),f===e.season?i.style.display="flex":i.style.display="none"}),this.player.on("active",()=>{r.style.transform=`translateX(${this.player.getTimeData().percentage}%)`}),this.player.on("time",f=>{var x;((x=this.player.playlistItem())==null?void 0:x.uuid)===e.uuid&&this.player.container.classList.contains("active")&&(s.style.display="flex",r.style.transform=`translateX(${f.percentage}%)`)}),e.episode&&e.show&&(p.innerText=e.season===void 0?`${e.episode}`:`${this.player.localize("S")}${e.season}: ${this.player.localize("E")}${e.episode}`),i.addEventListener("keydown",f=>{var x,k,E;f.key==="ArrowLeft"?(x=document.querySelector(`#season-${this.player.playlistItem().season}`))==null||x.focus():f.key==="ArrowRight"||(f.key==="ArrowUp"&&!this.player.options.disableTouchControls?(k=i.previousElementSibling)==null||k.focus():f.key==="ArrowDown"&&!this.player.options.disableTouchControls&&((E=i.nextElementSibling)==null||E.focus()))}),i.addEventListener("focus",()=>{this.player.scrollCenter(i,t,{margin:2,duration:50})}),i.addEventListener("click",()=>{e.episode&&e.season?this.player.setEpisode(e.season,e.episode):this.player.playlistItem(n),this.closeEpisodeScreen(),this.closePreScreen(),this.player.play().then()}),i}createTvSeasonButton(t,e,n,i,a){const l=this.player.createElement("button",e).addClasses(["w-available","mr-auto","h-8","px-1","py-2","flex","flex-nowrap","items-center","snap-center","rounded","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white",`${e}-button`]).appendTo(t).get();if(l.type="button",l.addEventListener("focus",()=>{this.player.scrollIntoView(l)}),l.addEventListener("keyup",c=>{var s,r,h,d;c.key==="ArrowLeft"||c.key==="ArrowRight"&&(n.season===((s=this.player.playlistItem())==null?void 0:s.season)?(h=Array.from(document.querySelectorAll("[id^=playlist-]")).filter(y=>getComputedStyle(y).display==="flex").at((((r=this.player.playlistItem())==null?void 0:r.episode)??0)-1))==null||h.focus():(d=Array.from(document.querySelectorAll("[id^=playlist-]")).filter(y=>getComputedStyle(y).display==="flex").at(0))==null||d.focus())}),l.addEventListener("keydown",c=>{var s,r;c.key==="ArrowUp"&&!this.player.options.disableTouchControls?(s=l.previousElementSibling)==null||s.focus():c.key==="ArrowDown"&&!this.player.options.disableTouchControls&&((r=l.nextElementSibling)==null||r.focus())}),l.addEventListener("click",()=>{i==null||i.bind(this)()}),a){const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("viewBox","0 0 24 24"),c.id=e,this.player.addClasses(c,[`${e}-icon`,...a.classes,"svg-size","h-5","w-5","fill-current","pointer-events-none","group-hover/button:scale-110","duration-700"]);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",a.hover),c.appendChild(s),l.appendChild(c)}const u=this.player.createElement("div",`${e}-button-text`).addClasses(this.menuButtonTextStyles).addClasses(["flex","justify-between","items-center","w-available","gap-1","flex-nowrap"]).appendTo(l).get(),o=this.player.createElement("span",`${e}-button-text-span-1`).addClasses(["line-clamp-1","text-nowrap","text-sm","w-auto"]).appendTo(u).get(),p=this.player.createElement("span",`${e}-button-text-span-2`).addClasses(["line-clamp-1","text-nowrap","text-xs","w-min"]).appendTo(u).get();return n.seasonName?(o.innerText=n.seasonName,p.innerText=`${n.episodes} ${this.player.localize("ep")}`):n.season?(o.innerText=`${this.player.localize("Season")} ${n.season}`,p.innerText=`${n.episodes} ${this.player.localize("ep")}`):p.innerText=`${n.episodes} ${this.player.localize("ep")}`,l}getVisibleButtons(t){const e=t.parentElement,n=e==null?void 0:e.querySelectorAll("button");if(!n||(n==null?void 0:n.length)===0)return;const i=Array.from(n).filter(l=>l.style.display!=="none"),a=i.findIndex(l=>l===t);return{visibleButtons:i,currentButtonIndex:a}}findPreviousVisibleButton(t){const e=this.getVisibleButtons(t);if(!e)return;const{visibleButtons:n,currentButtonIndex:i}=e;return n.at(i-1)}findNextVisibleButton(t){const e=this.getVisibleButtons(t);if(!e)return;const{visibleButtons:n,currentButtonIndex:i}=e;return n.at(n.length)}createImageContainer(t){const e=this.player.createElement("div","left-side-top").addClasses(["flex","flex-col","justify-center","items-center","w-available","gap-2","h-auto"]).appendTo(t).get(),n=this.player.createElement("div","logo-container").addClasses(["flex","flex-col","justify-center","items-center","w-available","h-[85px]","min-h-[85px]"]).appendTo(e).get(),i=this.player.createElement("span","fallbackText").addClasses(["w-auto","h-available","items-center","py-0","max-w-[38vw]","mr-auto","leading-[1.2]","font-bold","object-fit"]).appendTo(n).get(),a=this.player.createElement("img","logo").addClasses(["w-auto","px-2","py-2","mr-auto","object-fit","h-auto","max-w-[23rem]","max-h-available",""]).appendTo(n).get(),l=this.player.createElement("div","left-side-top-overview").addClasses(["flex","flex-col","w-available","h-[40px]"]).appendTo(e).get(),u=this.player.createElement("div","rating-container").addClasses(["flex","gap-2","items-center","w-available","text-white"]).appendTo(l).get(),o=this.player.createElement("span","year-text").addClasses(["flex","text-white","text-sm","font-bold","mx-2"]).appendTo(u).get(),p=this.player.createElement("img","rating-image").addClasses(["w-8","h-available","object-fit","invert"]).appendTo(u).get(),c=this.player.createElement("span","episodes-count-text").addClasses(["flex","text-white","text-sm","font-bold","mx-2"]).appendTo(u).get();return this.player.on("item",()=>{var h,d,y,v,m,w;const s=(h=this.player.playlistItem())==null?void 0:h.logo;!s||s===""||s.includes("null")||s.includes("undefined")?(i.innerText=we(((d=this.player.playlistItem())==null?void 0:d.show)??""),i.style.fontSize=`calc(110px / ${i.innerText.length} + 3ch)`,i.style.display="flex",a.style.display="none"):(a.style.display="block",i.style.display="none",s!=null&&s.startsWith("http")?a.src=s:a.src=s&&s!==""?`${this.imageBaseUrl}${s}`:""),o.innerHTML=((v=(y=this.player.playlistItem())==null?void 0:y.year)==null?void 0:v.toString())??"",(m=this.player.playlistItem())!=null&&m.year?o.style.display="flex":o.style.display="none",p.removeAttribute("src"),p.removeAttribute("alt"),p.style.opacity="0",this.player.getPlaylist().length>1&&(c.innerHTML=`${this.player.getPlaylist().length} ${this.player.localize("episodes")}`);const r=(w=this.player.playlistItem())==null?void 0:w.rating;r&&(p.src=`https://storage.nomercy.tv/laravel/kijkwijzer/${r.image}`,p.alt=r.rating.toString(),p.style.opacity="1")}),e}createTvButton(t,e,n,i,a){const l=this.player.createElement("button",e).addClasses(["w-9/12","mr-auto","h-8","px-1","py-2","flex","items-center","rounded","snap-center","outline-transparent","outline","outline-1","outline-solid","focus-visible:outline-2","focus-visible:outline-white","active:outline-white",`${e}-button`]).appendTo(t).get();if(l.type="button",l.addEventListener("focus",()=>{setTimeout(()=>{this.player.scrollCenter(l,t,{margin:1,duration:100})},50)}),l.addEventListener("keydown",o=>{var p,c,s;if(o.key==="ArrowUp"&&!this.player.options.disableTouchControls)(p=this.findPreviousVisibleButton(l))==null||p.focus();else if(o.key==="ArrowDown"&&!this.player.options.disableTouchControls){const r=this.findNextVisibleButton(l);r?r==null||r.focus():(s=(c=l.parentElement)==null?void 0:c.nextElementSibling)==null||s.focus()}}),l.addEventListener("click",i==null?void 0:i.bind(this.player)),a){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("viewBox","0 0 24 24"),o.id=e,this.player.addClasses(o,[`${e}-icon`,...a.classes,"svg-size","h-5","w-5","fill-current","pointer-events-none","group-hover/button:scale-110","duration-700"]);const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",a.hover),o.appendChild(p),l.appendChild(o)}const u=this.player.createElement("span",`${e}-buttonText`).addClasses(this.menuButtonTextStyles).appendTo(l).get();return n||(n="Play",setTimeout(()=>{this.player.once("firstFrame",()=>{n="Resume",u.innerHTML=this.player.localize("Resume")})},500)),u.innerHTML=this.player.localize(n),l}createSeekContainer(t){const e=this.player.createElement("div","seek-container").addClasses(["relative","h-auto","mb-28","w-available","translate-y-[80vh]","z-40","w-available"]).appendTo(t).get(),n=this.player.createElement("div","seek-scroll-clone-container").addClasses(["[--gap:1.5rem]","absolute","flex","h-available","w-available","gap-[var(--gap)]","z-10","pointer-events-none"]).appendTo(e).get();this.thumbnailClone=this.player.createElement("div","thumbnail-clone-1").addClasses(["h-auto","object-cover","border-4","mx-auto"]).appendTo(n).get();const i=this.player.createElement("div","seek-scroll-container").addClasses(["relative","flex","h-available","w-available","overflow-auto","px-[calc(100%/2.14)]","gap-1.5","scrollbar-none"]).appendTo(e).get();return this.player.once("item",()=>{this.player.on("preview-time",()=>{this.thumbs=[];for(const a of this.previewTime)this.thumbs.push({time:a,el:this.createThumbnail(a)});i.innerHTML="",oe(this.thumbs.map(a=>a.el),"id").forEach(a=>{i.appendChild(a)}),this.player.once("time",()=>{this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()})})})}),this.player.on("lastTimeTrigger",()=>{this.currentScrubTime=this.getClosestSeekableInterval(),this.player.emit("currentScrubTime",{...this.player.getTimeData(),currentTime:this.getClosestSeekableInterval()})}),this.player.on("currentScrubTime",a=>{if(a.currentTime<=0)a.currentTime=0;else if(a.currentTime>=this.player.getDuration())return;const l=this.thumbs.find(u=>a.currentTime>=u.time.start&&a.currentTime<=u.time.end);this.currentScrubTime=a.currentTime,l&&this.player.scrollIntoView(l.el)}),this.player.on("show-seek-container",a=>{a?(e.style.transform="none",this.player.pause()):this.seekContainer.style.transform=""}),e}}const Fe=Q({__name:"Tv",setup(T){var i;const{data:b}=Se({enabled:!((i=C.value.features)!=null&&i.nomercyConnect)}),t=J();function e(){var a,l;(a=t.value)==null||a.emit("back-button"),(l=t.value)==null||l.emit("back-button-hyjack")}function n(a){var s,r,h,d,y,v,m,w,f,x,k,E,A,I,$,M,z,U,D,_,N,V,j,R,H;const l={muted:!1,controls:!1,preload:"auto",debug:!1,autoPlay:!0,playlist:(a==null?void 0:a.filter(g=>!!g.id))??[],controlsTimeout:3e3,doubleClickDelay:300,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2],accessToken:((s=C.value)==null?void 0:s.accessToken)||localStorage.getItem("access_token")||"",basePath:(r=de.value)==null?void 0:r.serverBaseUrl,forceTvMode:(L("android")||L("ios"))&&!L("mobile"),disableTouchControls:!1,disableMediaControls:"mediaSession"in navigator||L("capacitor"),renderAhead:10,disableAutoPlayback:(h=C.value.features)==null?void 0:h.nomercyConnect};if(t.value=xe("player1").setup(l),(d=C.value.features)!=null&&d.nomercyConnect){const g=new he;(y=t.value)==null||y.registerPlugin("videoNoMercyConnect",g),(v=t.value)==null||v.usePlugin("videoNoMercyConnect")}const u=new ke;(m=t.value)==null||m.registerPlugin("tvUI",u),(w=t.value)==null||w.usePlugin("tvUI");const o=new ge;(f=t.value)==null||f.registerPlugin("autoSkip",o),(x=t.value)==null||x.usePlugin("autoSkip");const p=new Ce;if((k=t.value)==null||k.registerPlugin("keyHandler",p),(E=t.value)==null||E.usePlugin("keyHandler"),!((A=C.value.features)!=null&&A.nomercyConnect)){const g=new ye;(I=t.value)==null||I.registerPlugin("sync",g),($=t.value)==null||$.usePlugin("sync")}const c=new Te;(M=t.value)==null||M.registerPlugin("octopus",c),(z=t.value)==null||z.usePlugin("octopus"),(U=t.value)==null||U.once("play",()=>{var g;(g=t.value)==null||g.enterFullscreen()}),(D=t.value)==null||D.on("playlistComplete",()=>{var g;(g=t.value)==null||g.dispose(),G.back()}),(_=t.value)==null||_.on("error",g=>{console.error(g)}),(N=t.value)==null||N.on("back",()=>{G.back()}),(V=t.value)==null||V.on("play",()=>{P(!0)}),(j=t.value)==null||j.on("pause",()=>{P(!1)}),(R=t.value)==null||R.on("ready",()=>{ue(),X.stop()}),(H=t.value)==null||H.on("item",()=>{var g;(g=t.value)==null||g.play()}),ne.addListener("backButton",e)}return Y(b,a=>{n(a)}),Z(()=>{var a;X.stop(),pe(!1),(a=C.value.features)!=null&&a.nomercyConnect?n():n(b.value)}),ee(()=>{var a;P(!1),ce(),(a=t.value)==null||a.dispose()}),(a,l)=>(se(),te(B(re),null,{default:q(()=>[ae(B(ie),{fullscreen:!0},{default:q(()=>[O("div",{class:le(["absolute inset-0 flex h-full w-full overflow-clip bg-black z-1199",{"mb-28":B(F),"mb-0":!B(F)}])},l[0]||(l[0]=[O("div",{id:"player1",class:"group nomercyplayer"},null,-1)]),2)]),_:1})]),_:1}))}});export{Fe as default};
