import{Ct as b,St as S,_t as I,c as _,dt as R,it as x,x as F}from"./i18n-Rm1NkeNf.js";function p(o,s,e){let t=e.initialDeps??[],n;function r(){var i,l,h,a;let u;e.key&&((i=e.debug)!=null&&i.call(e))&&(u=Date.now());const c=o();if(!(c.length!==t.length||c.some((f,m)=>t[m]!==f)))return n;t=c;let d;if(e.key&&((l=e.debug)!=null&&l.call(e))&&(d=Date.now()),n=s(...c),e.key&&((h=e.debug)!=null&&h.call(e))){const f=Math.round((Date.now()-u)*100)/100,m=Math.round((Date.now()-d)*100)/100,w=m/16,v=(g,C)=>{for(g=String(g);g.length<C;)g=" "+g;return g};console.info(`%câ± ${v(m,5)} /${v(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*w,120))}deg 100% 31%);`,e?.key)}return(a=e?.onChange)==null||a.call(e,n),n}return r.updateDeps=i=>{t=i},r}function M(o,s){if(o===void 0)throw new Error(`Unexpected undefined${s?`: ${s}`:""}`);return o}var A=(o,s)=>Math.abs(o-s)<1.01,T=(o,s,e)=>{let t;return function(...n){o.clearTimeout(t),t=o.setTimeout(()=>s.apply(this,n),e)}},y=o=>{const{offsetWidth:s,offsetHeight:e}=o;return{width:s,height:e}},k=o=>o,D=o=>{const s=Math.max(o.startIndex-o.overscan,0),e=Math.min(o.endIndex+o.overscan,o.count-1),t=[];for(let n=s;n<=e;n++)t.push(n);return t},W=(o,s)=>{const e=o.scrollElement;if(!e)return;const t=o.targetWindow;if(!t)return;const n=i=>{const{width:l,height:h}=i;s({width:Math.round(l),height:Math.round(h)})};if(n(y(e)),!t.ResizeObserver)return()=>{};const r=new t.ResizeObserver(i=>{const l=()=>{const h=i[0];if(h?.borderBoxSize){const a=h.borderBoxSize[0];if(a){n({width:a.inlineSize,height:a.blockSize});return}}n(y(e))};o.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return r.observe(e,{box:"border-box"}),()=>{r.unobserve(e)}},z={passive:!0},E=typeof window>"u"?!0:"onscrollend"in window,j=(o,s)=>{const e=o.scrollElement;if(!e)return;const t=o.targetWindow;if(!t)return;let n=0;const r=o.options.useScrollendEvent&&E?()=>{}:T(t,()=>{s(n,!1)},o.options.isScrollingResetDelay),i=u=>()=>{const{horizontal:c,isRtl:d}=o.options;n=c?e.scrollLeft*(d&&-1||1):e.scrollTop,r(),s(n,u)},l=i(!0),h=i(!1);h(),e.addEventListener("scroll",l,z);const a=o.options.useScrollendEvent&&E;return a&&e.addEventListener("scrollend",h,z),()=>{e.removeEventListener("scroll",l),a&&e.removeEventListener("scrollend",h)}},P=(o,s,e)=>{if(s?.borderBoxSize){const t=s.borderBoxSize[0];if(t)return Math.round(t[e.options.horizontal?"inlineSize":"blockSize"])}return o[e.options.horizontal?"offsetWidth":"offsetHeight"]},B=(o,{adjustments:s=0,behavior:e},t)=>{var n,r;const i=o+s;(r=(n=t.scrollElement)==null?void 0:n.scrollTo)==null||r.call(n,{[t.options.horizontal?"left":"top"]:i,behavior:e})},L=class{constructor(o){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const e=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(t=>{t.forEach(n=>{const r=()=>{this._measureElement(n.target,n)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()})}));return{disconnect:()=>{var t;(t=e())==null||t.disconnect(),s=null},observe:t=>{var n;return(n=e())==null?void 0:n.observe(t,{box:"border-box"})},unobserve:t=>{var n;return(n=e())==null?void 0:n.unobserve(t)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([e,t])=>{typeof t>"u"&&delete s[e]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:k,rangeExtractor:D,onChange:()=>{},measureElement:P,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var e,t;(t=(e=this.options).onChange)==null||t.call(e,this,s)},this.maybeNotify=p(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const e=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==e){if(this.cleanup(),!e){this.maybeNotify();return}this.scrollElement=e,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(t=>{this.observer.observe(t)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(t,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<t?"forward":"backward":null,this.scrollOffset=t,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,e)=>{const t=new Map,n=new Map;for(let r=e-1;r>=0;r--){const i=s[r];if(t.has(i.lane))continue;const l=n.get(i.lane);if(l==null||i.end>l.end?n.set(i.lane,i):i.end<l.end&&t.set(i.lane,!0),t.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((r,i)=>r.end===i.end?r.index-i.index:r.end-i.end)[0]:void 0},this.getMeasurementOptions=p(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(s,e,t,n,r)=>(this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:e,scrollMargin:t,getItemKey:n,enabled:r}),{key:!1}),this.getMeasurements=p(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:e,scrollMargin:t,getItemKey:n,enabled:r},i)=>{if(!r)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(a=>{this.itemSizeCache.set(a.key,a.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,l);for(let a=l;a<s;a++){const u=n(a),c=this.options.lanes===1?h[a-1]:this.getFurthestMeasurement(h,a),d=c?c.end+this.options.gap:e+t,f=i.get(u),m=typeof f=="number"?f:this.options.estimateSize(a),w=d+m,v=c?c.lane:a%this.options.lanes;h[a]={index:a,start:d,size:m,end:w,key:u,lane:v}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=p(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,e,t,n)=>this.range=s.length>0&&e>0?V({measurements:s,outerSize:e,scrollOffset:t,lanes:n}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=p(()=>{let s=null,e=null;const t=this.calculateRange();return t&&(s=t.startIndex,e=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,e]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,e]},(s,e,t,n,r)=>n===null||r===null?[]:s({startIndex:n,endIndex:r,overscan:e,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const e=this.options.indexAttribute,t=s.getAttribute(e);return t?parseInt(t,10):(console.warn(`Missing attribute name '${e}={index}' on measured element.`),-1)},this._measureElement=(s,e)=>{const t=this.indexFromElement(s),n=this.measurementsCache[t];if(!n)return;const r=n.key,i=this.elementsCache.get(r);i!==s&&(i&&this.observer.unobserve(i),this.observer.observe(s),this.elementsCache.set(r,s)),s.isConnected&&this.resizeItem(t,this.options.measureElement(s,e,this))},this.resizeItem=(s,e)=>{const t=this.measurementsCache[s];if(!t)return;const n=e-(this.itemSizeCache.get(t.key)??t.size);n!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,n,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=n,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,e)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))});return}this._measureElement(s,void 0)},this.getVirtualItems=p(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,e)=>{const t=[];for(let n=0,r=s.length;n<r;n++){const i=e[s[n]];t.push(i)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const e=this.getMeasurements();if(e.length!==0)return M(e[O(0,e.length-1,t=>M(e[t]).start,s)])},this.getOffsetForAlignment=(s,e,t=0)=>{const n=this.getSize(),r=this.getScrollOffset();e==="auto"&&(e=s>=r+n?"end":"start"),e==="center"?s+=(t-n)/2:e==="end"&&(s-=n);const i=this.getTotalSize()+this.options.scrollMargin-n;return Math.max(Math.min(i,s),0)},this.getOffsetForIndex=(s,e="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const t=this.measurementsCache[s];if(!t)return;const n=this.getSize(),r=this.getScrollOffset();if(e==="auto")if(t.end>=r+n-this.options.scrollPaddingEnd)e="end";else if(t.start<=r+this.options.scrollPaddingStart)e="start";else return[r,e];const i=e==="end"?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,e,t.size),e]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:e="start",behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,e),{adjustments:void 0,behavior:t})},this.scrollToIndex=(s,{align:e="auto",behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let n=0;const r=10,i=h=>{if(!this.targetWindow)return;const a=this.getOffsetForIndex(s,h);if(!a){console.warn("Failed to get offset for index:",s);return}const[u,c]=a;this._scrollToOffset(u,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const d=this.getScrollOffset(),f=this.getOffsetForIndex(s,c);if(!f){console.warn("Failed to get offset for index:",s);return}A(f[0],d)||l(c)})},l=h=>{this.targetWindow&&(n++,n<r?this.targetWindow.requestAnimationFrame(()=>i(h)):console.warn(`Failed to scroll to index ${s} after ${r} attempts.`))};i(e)},this.scrollBy=(s,{behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:e})},this.getTotalSize=()=>{var s;const e=this.getMeasurements();let t;if(e.length===0)t=this.options.paddingStart;else if(this.options.lanes===1)t=((s=e[e.length-1])==null?void 0:s.end)??0;else{const n=Array(this.options.lanes).fill(null);let r=e.length-1;for(;r>=0&&n.some(i=>i===null);){const i=e[r];n[i.lane]===null&&(n[i.lane]=i.end),r--}t=Math.max(...n.filter(i=>i!==null))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:e,behavior:t})=>{this.options.scrollToFn(s,{behavior:t,adjustments:e},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(o)}},O=(o,s,e,t)=>{for(;o<=s;){const n=(o+s)/2|0,r=e(n);if(r<t)o=n+1;else if(r>t)s=n-1;else return n}return o>0?o-1:0};function V({measurements:o,outerSize:s,scrollOffset:e,lanes:t}){const n=o.length-1,r=h=>o[h].start;if(o.length<=t)return{startIndex:0,endIndex:n};let i=O(0,n,r,e),l=i;if(t===1)for(;l<n&&o[l].end<e+s;)l++;else if(t>1){const h=Array(t).fill(0);for(;l<n&&h.some(u=>u<e+s);){const u=o[l];h[u.lane]=u.end,l++}const a=Array(t).fill(e+s);for(;i>=0&&a.some(u=>u>=e);){const u=o[i];a[u.lane]=u.start,i--}i=Math.max(0,i-i%t),l=Math.min(n,l+(t-1-l%t))}return{startIndex:i,endIndex:l}}_();function N(o){const s=new L(b(o)),e=I(s),t=s._didMount();return x(()=>b(o).getScrollElement(),n=>{n&&s._willUpdate()},{immediate:!0}),x(()=>b(o),n=>{s.setOptions({...n,onChange:(r,i)=>{var l;S(e),(l=n.onChange)==null||l.call(n,r,i)}}),s._willUpdate(),S(e)},{immediate:!0}),R(t),e}function q(o){return N(F(()=>({observeElementRect:W,observeElementOffset:j,scrollToFn:B,...b(o)})))}export{q as t};
