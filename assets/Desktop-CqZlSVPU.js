import"./useBaseQuery-CAtiNY9l.js";import"./useInfiniteServerClient-Cxmf-v6-.js";import"./useQueryClient-zQQjgupV.js";import"./useQuery-D7RSAJZ-.js";import{Bs as $,Ci as I,Co as B,Gc as b,Gs as i,Js as M,Ks as f,Nc as c,Ns as k,Oc as r,Qs as u,Rc as p,Ws as A,Zs as v,_c as E,ec as w,g as j,hc as d,ho as D,yc as x,zn as N}from"./index-DwyZWiM0.js";import"./_plugin-vue_export-helper-CEc1WwrB.js";import"./AppLogoSquare-63m8EQGn.js";import"./MoooomIcon-DX_Lfmi_.js";import{n as T}from"./dist-D-IxX4-O.js";import"./md5-DzsH4br7.js";import{t as L}from"./useServerClient-BUljf2SX.js";import"./ScrollContainer-Bi5zZJif.js";import"./useMounted-Zwuor5Dr.js";import"./RipperOverlay-BOb09qdu.js";import"./HubConnection-BgYujhqd.js";import"./ripperSocket-CF81dCQg.js";import{t as C}from"./Button-hIv__JZB.js";import{t as z}from"./Modal-C7gMaiut.js";import"./FloatingBackButton-DIrT3-xG.js";import{t as K}from"./DashboardLayout-CzEQiXeM.js";import{t as O}from"./DashboardCard-D_H1TtvM.js";import{t as Z}from"./useApiClient-Dbe2NoHx.js";import{t as F}from"./Avatar-CVQEQ8F_.js";k();var G={class:"backdropCard relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},Q=["src"],W=w({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(l){const o=p(!1);function m(e){console.error(e),e.target.onerror=null,o.value=!0}return(e,s)=>(d(),f(O,{line1:l.data.name,route:`/dashboard/users/${l.data.user_id}`,line2:""},{image:r(()=>[i("div",G,[s[0]||(s[0]=i("div",{class:"backdropCard-overlay"},null,-1)),l.data.avatar&&!o.value?(d(),M("img",{key:0,onerror:m,src:l.data.avatar,alt:"",class:"w-full h-full object-cover rounded-lg backdropCard-image"},null,8,Q)):(d(),f(F,{key:1,email:l.data.email,class:"w-full backdropCard-image"},null,8,["email"]))])]),_:1},8,["line1","route"]))}}),J=W;k();var P={class:"flex w-full flex-col justify-start text-left"},R={class:"py-4 text-sm text-surface-10"},H={class:"flex flex-col gap-2 w-full"},X={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},Y=w({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(l){const o=l,{t:m}=T();p(null);const e=p(""),s=p([]),{data:h}=L({path:"/dashboard/libraries"}),_=p();function n(){s.value=[],o.close()}function y(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(t).toLowerCase())}const S=A(()=>e.value?y(e.value):!1);function V(){if(!e.value){s.value.push({type:"error",place:"email",message:m("Email is required")});return}if(!y(e.value)){s.value.push({type:"error",place:"email",message:m("Invalid email address")});return}N().post("server/server-users",{id:I.value?.id,email:e.value,libraries:_.value?.map(t=>t.id)}).then(()=>{j.invalidateQueries({queryKey:["server_users"]}),e.value="",o.close()}).catch(({response:t})=>{t?.status!==200&&t?.data&&s.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})}return(t,a)=>{const q=x("InputText"),U=x("MultiSelect");return d(),f(z,{close:n,open:l.open,title:"Invite user"},{actions:r(()=>[u(C,{id:"yes",disabled:!S.value,color:"theme","end-icon":"emailSend",type:"button",variant:"contained",onClick:V},{default:r(()=>[v(c(t.$t("Send")),1)]),_:1},8,["disabled"]),u(C,{id:"no",type:"button",variant:"text",onClick:n},{default:r(()=>[v(c(t.$t("Cancel")),1)]),_:1})]),default:r(()=>[i("div",P,[i("p",R,[v(c(t.$t("Enter the email of the friend you want to invite to your server.")),1),a[2]||(a[2]=i("br",null,null,-1)),v(" "+c(t.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",H,[a[3]||(a[3]=i("label",{for:"email"},"Email",-1)),u(q,{id:"email",modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=g=>e.value=g),class:"mb-4"},null,8,["modelValue"])]),i("div",X,[a[4]||(a[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),u(U,{id:"libraries",modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=g=>_.value=g),options:b(h),display:"chip",label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),ee=Y;k();var te=w({__name:"Desktop",setup(l){const o=p(!1),{data:m}=Z({path:"server/server-users",params:{id:I.value?.id},queryKey:["server_users"]});function e(){o.value=!0,setTimeout(()=>{document.querySelector("#email")?.focus()},300)}function s(){o.value=!1}return(h,_)=>(d(),f(b(B),null,{default:r(()=>[u(b(D),{fullscreen:!0},{default:r(()=>[u(K,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:r(()=>[u(C,{id:"invite",color:"theme","start-icon":"userAdd",onClick:e},{default:r(()=>[v(c(h.$t("Invite user")),1)]),_:1})]),default:r(()=>[(d(!0),M($,null,E([...b(m)??[]].sort((n,y)=>n.name.localeCompare(y.name)),n=>(d(),f(J,{key:n.user_id,data:n},null,8,["data"]))),128)),u(ee,{open:o.value,close:s},null,8,["open"])]),_:1})]),_:1})]),_:1}))}}),Ie=te;export{Ie as default};
