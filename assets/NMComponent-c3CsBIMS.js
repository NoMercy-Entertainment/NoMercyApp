import{t as k}from"./useQueryClient-ku998Trb.js";import{t as x}from"./useQuery-B-9-3q3r.js";import{t as D}from"./useMutationState-J1TRNroW.js";import{$l as l,$o as q,Aa as I,Bl as U,Cl as K,Dl as B,Ea as F,Fa as N,Ga as Q,Hl as g,Jl as P,Ka as $,Oa as A,Pl as T,R as j,Ra as O,Sl as z,Wl as H,Ya as G,au as J,bc as w,cu as V,du as W,es as Y,fu as X,hl as Z,hu as m,iu as tt,kl as et,ll as C,lu as st,ou as at,sc as it,ua as nt,wa as y,xl as rt,yc as E,yl as ut,zl as ot,zs as S}from"./index-DhiB0zJh.js";var lt=class extends G{#s;#a=void 0;#t;#e;constructor(t,e){super(),this.#s=t,this.setOptions(e),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#s.defaultMutationOptions(t),Q(this.options,e)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),e?.mutationKey&&this.options.mutationKey&&O(e.mutationKey)!==O(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#a}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(t,e){return this.#e=e,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#i(){const t=this.#t?.state??I();this.#a={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){N.batch(()=>{if(this.#e&&this.hasListeners()){const e=this.#a.variables,a=this.#a.context;t?.type==="success"?(this.#e.onSuccess?.(t.data,e,a),this.#e.onSettled?.(t.data,null,e,a)):t?.type==="error"&&(this.#e.onError?.(t.error,e,a),this.#e.onSettled?.(void 0,t.error,e,a))}this.listeners.forEach(e=>{e(this.#a)})})}};function ct(t,e){const a=e||k(),i=ut(()=>a.defaultMutationOptions(F(t))),u=new lt(a,i.value),s=i.value.shallow?V(u.getCurrentResult()):J(u.getCurrentResult()),d=u.subscribe(n=>{A(s,n)}),o=(n,v)=>{u.mutate(n,v).catch(()=>{})};l(i,()=>{u.setOptions(i.value)}),tt(()=>{d()});const p=X(i.value.shallow?st(s):at(s));return l(()=>s.error,n=>{if(n&&$(i.value.throwOnError,[n]))throw n}),{...p,mutate:o,mutateAsync:s.mutate,reset:s.reset}}E();C();function f(t){const e=w(),a=[];return(t??e?.path)?.split("/").slice(1).forEach(i=>{i.includes("?")?(a.push(i.split("?")[0]),a.push(i.split("?")[1].split("=")[1])):a.push(i)}),a}function ht({queryKey:t,path:e}={queryKey:void 0,path:void 0}){return D({mutationKey:t??f(e)})}l(S(),async t=>{t&&(await y.invalidateQueries(),y.getMutationCache().clear())});l(Y,async(t,e)=>{if(!t){nt();return}e?.id&&t.id!==e.id&&(await y.invalidateQueries(),y.getMutationCache().clear())});function dt({queryKey:t,path:e}={queryKey:void 0,path:void 0}){return x({queryKey:t??f(e),queryFn:async()=>q().get(e??j.currentRoute.value.path,{params:{}}).then(({data:a})=>a.data)})}function pt({queryKey:t,path:e,homeData:a}){return ct({mutationKey:t??f(e),mutationFn:async i=>{const u=[...a.value?.map(s=>structuredClone(W(s)))??[]];for(const s of i)await q().post(e??s.update.link,{replace_id:s.update.body.replace_id}).then(d=>{for(let o=0;o<u.length;o++)u[o].id===s.update?.body?.replace_id&&(u[o]=d.data?.data[0])});return u}})}C();E();var mt={key:0,class:"grid w-available h-available place-items-center"},ft=et({__name:"NMComponent",props:{path:{type:String,required:!1,default:void 0},options:{type:Object,required:!1,default:()=>({keepForever:!0,queryKey:f()})}},setup(t){const e=t,a=new Set(["Home","Libraries","Music Start"]),i=e.options.queryKey??f(),u=ht({queryKey:i,path:e.path}),{data:s,isLoading:d}=dt({queryKey:i,path:e.path}),{data:o,mutate:p}=pt({queryKey:i,homeData:s}),n=S(),v=w();function _(){if(!s.value||!n.value)return;const r=s.value.filter(c=>c?.update?.when==="pageLoad")??[];r.length>0&&p(r)}function R(){if(!s.value||!n.value)return;const r=s.value.filter(c=>c?.update?.when==="online")??[];r.length>0&&p(r)}function M(r){const c=r;if(!s.value||!n.value)return;const h=s.value.filter(b=>b?.id===c.detail.id)??[];h.length>0&&p(h)}function L(){return a.has(v.name)}return ot(()=>{document.addEventListener("mutateId",M),s.value&&n.value&&L()&&_()}),U(()=>{document.removeEventListener("mutateId",M)}),l(n,r=>{r&&R()}),l(s,r=>{r&&requestIdleCallback(()=>{document.dispatchEvent(new Event("indexer"))})}),l(()=>v.name,r=>{s.value&&n.value&&a.has(r)&&_()}),(r,c)=>m(d)?(g(),K("div",mt,[B(m(it),{class:"ion-padding",name:"crescent"})])):m(u)?z("",!0):(g(!0),K(Z,{key:1},H(m(o)??m(s)??[],(h,b)=>(g(),rt(P(h?.component),T({key:h.id,index:b},{ref_for:!0},h.props),null,16,["index"]))),128))}}),_t=ft;export{_t as t};
