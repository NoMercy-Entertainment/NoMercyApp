import{bn as m}from"./vendor-Dgtccx1h.js";import{q as k,c as v,b6 as w,b7 as C}from"./index-DjUBSuR8.js";import{B as T,d as E,w as D}from"./vue-ionic-DRNtAYzz.js";const n=E(),x=T(()=>{var e;return(e=n.value)==null?void 0:e.connection}),f=E(!1);function d(){var e,c;f.value=!0,document.dispatchEvent(new Event("ripperHub-connected")),(e=n.value)!=null&&e.connection&&C((c=n.value)==null?void 0:c.connection)}function s(e){f.value=!1,console.log("Disconnected from Ripper SignalR",e),document.dispatchEvent(new Event("ripperHub-disconnected"))}function H(e){f.value=!1,console.error("Ripper SignalR Error:",e),document.dispatchEvent(new Event("ripperHub-error"))}D(v,async e=>{var o,t,a,i,r,u,l,p;const c=(o=k.value)==null?void 0:o.accessToken;e&&f.value&&((a=(t=n.value)==null?void 0:t.connection)==null||a.stop().then(),(i=n.value)==null||i.dispose(),n.value=new w(v.value.serverBaseUrl,c,"ripperHub"),(u=(r=n.value)==null?void 0:r.connection)==null||u.on("connected",d),(p=(l=n.value)==null?void 0:l.connection)==null||p.on("disconnected",s),await y().catch(H))});async function y(){var e,c,o,t;if(((c=(e=n.value)==null?void 0:e.connection)==null?void 0:c.state)!==m.Connected)return(t=(o=n.value)==null?void 0:o.connection)==null?void 0:t.start().then(d)}async function I(){var e,c,o,t;try{return((c=(e=n.value)==null?void 0:e.connection)==null?void 0:c.state)===m.Disconnected||(t=(o=n.value)==null?void 0:o.connection)==null?void 0:t.stop().then(s).catch(s)}catch(a){console.error("Error stopping Ripper SignalR:",a),s()}}async function j(){var c,o,t,a,i,r,u,l,p,b,g,h,R;const e=(c=k.value)==null?void 0:c.accessToken;v.value&&(!((t=(o=n.value)==null?void 0:o.connection)!=null&&t.state)||((i=(a=n.value)==null?void 0:a.connection)==null?void 0:i.state)===m.Disconnected)&&(n.value=new w(v.value.serverBaseUrl,e,"ripperHub"),(u=(r=n.value)==null?void 0:r.connection)==null||u.on("connected",d),(p=(l=n.value)==null?void 0:l.connection)==null||p.on("disconnected",s),await y().catch(H),(g=(b=n.value)==null?void 0:b.connection)==null||g.onreconnecting(S=>{console.log("SignalR Disconnected.",S==null?void 0:S.message),s()}),(R=(h=n.value)==null?void 0:h.connection)==null||R.onreconnected(()=>{console.log("SignalR Reconnected."),d()}))}export{j as a,f as b,x as r,I as s};
