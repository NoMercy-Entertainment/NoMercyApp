{"version":3,"file":"Mobile-0CbYxNSY.js","sources":["../../src/views/Base/Info/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {computed, ref, watch} from 'vue';\nimport {useRoute} from 'vue-router';\nimport {IonContent, IonPage, IonSkeletonText, onIonViewWillEnter, onIonViewWillLeave} from '@ionic/vue';\nimport axios from \"axios\";\n\nimport type {InfoResponse} from '@/types/api/base/info';\n\nimport {tmdbImageBaseUrl} from '@/config/config';\nimport useServerClient from '@/lib/clients/useServerClient';\nimport {breakTitle2, setTitle, sortByPosterAlphabetized} from '@/lib/stringArray';\nimport {background, setBackground, setColorPalette, setLogo, setPoster, title} from '@/store/ui';\nimport router from '@/router';\nimport i18next from \"@/config/i18next\";\n\nimport ImageCarousel from '@/components/Carousel/ImageCarousel.vue';\nimport PersonCarousel from '@/components/Carousel/PersonCarousel.vue';\nimport MediaCarousel from '@/components/Carousel/MediaCarousel.vue';\nimport ContentRating from '@/components/Images/ContentRating.vue';\nimport InfoItem from '@/views/Base/Info/components/InfoItem.vue';\nimport Trailer from \"@/views/Base/Info/components/Trailer.vue\";\nimport HeaderItem from \"@/views/Base/Person/components/HeaderItem.vue\";\nimport Collapsible from \"@/views/Base/Person/components/Collapsible.vue\";\nimport MobileInfoCard from \"@/views/Base/Info/components/MobileInfoCard.vue\";\nimport {t} from \"i18next\";\nimport {convertToHumanReact} from \"@/lib/dateTime\";\nimport TMDBImage from \"@/components/Images/TMDBImage.vue\";\nimport {currentServer} from \"@/store/currentServer\";\n\nconst route = useRoute();\nconst enabled = ref(false);\nconst showMore = ref(false);\nconst trailerOpen = ref(false);\nconst trailerState = ref<true | false | 'loading'>('loading');\nconst trailerIndex = ref(-1);\nconst endTime = ref<string | 0 | null | undefined>(null);\nconst interval = ref<NodeJS.Timeout | null>(null);\n\nconst content = ref<VueDivElement>();\nconst backgroundUrl = computed(() => {\n  // return `${tmdbImageBaseUrl}/original${background.value}`;\n  return `${currentServer.value?.serverBaseUrl}/images/original${background.value}`;\n});\n\nconst {data} = useServerClient<InfoResponse>({\n  keepForever: true,\n  path: route?.fullPath,\n});\n\nwatch(data, (value) => {\n  content.value?.$el?.scrollToTop(window.innerHeight);\n  enabled.value = true;\n  trailerIndex.value = 0;\n\n  setTitle(value?.title ?? value?.name);\n\n  if (value?.backdrop) {\n    setBackground(value?.backdrop);\n  }\n  if (value?.poster) {\n    setPoster(value?.poster);\n  }\n  if (value?.logo) {\n    setLogo(value?.logo);\n  }\n  if (value?.color_palette?.poster) {\n    setColorPalette(value?.color_palette?.poster);\n  }\n\n  processTrailer(value);\n});\n\nonIonViewWillEnter(() => {\n  content.value?.$el?.scrollToTop(window.innerHeight);\n  // trailerIndex.value = 0;\n  setTitle(data?.value?.name);\n\n  if (data?.value?.backdrop) {\n    setBackground(data?.value?.backdrop);\n  }\n  if (data?.value?.poster) {\n    setPoster(data?.value?.poster);\n  }\n  if (data?.value?.logo) {\n    setLogo(data?.value?.logo);\n  }\n  if (data?.value?.color_palette?.poster) {\n    setColorPalette(data?.value?.color_palette?.poster);\n  }\n});\n\nonIonViewWillLeave(() => {\n  content.value?.$el?.scrollToTop(window.innerHeight);\n});\n\nrouter.afterEach(() => {\n  setTimeout(() => {\n    content.value?.$el?.scrollToTop(window.innerHeight);\n  }, 100);\n});\n\nconst overview = ref<VueDivElement>();\n\nwatch(showMore, (value) => {\n  if (value) {\n    overview.value?.$el?.classList.remove('line-clamp-3');\n  } else {\n    setTimeout(() => {\n      overview.value?.$el?.classList.add('line-clamp-3');\n    }, 300);\n  }\n});\n\nconst toggleTrailer = () => {\n  if (!data?.value?.videos) return;\n  trailerOpen.value = !trailerOpen.value;\n\n  const main = document.querySelector<HTMLDivElement>('#main');\n  if (!main) return;\n\n  main.style.overflow = trailerOpen.value\n      ? 'hidden'\n      : 'auto';\n};\n\nconst incrementTrailerIndex = () => {\n  if (!data?.value || data?.value?.videos?.length == 0) return;\n\n  if (trailerIndex.value == data?.value?.videos.length - 1) {\n    trailerIndex.value = 0;\n  } else {\n    trailerIndex.value++;\n  }\n  trailerIndex.value++;\n};\n\nconst processTrailer = (value: InfoResponse | undefined) => {\n\n  trailerState.value = 'loading';\n\n  if (!value || value.videos?.length == 0 || !value.videos?.[trailerIndex.value]) {\n    trailerState.value = false;\n    return;\n  }\n\n  endTime.value = value.duration && new Date(new Date().getTime() + (value.duration * 60 * 1000)).toLocaleTimeString(i18next.language ?? 'en-US', {\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n  interval.value = setInterval(() => {\n    endTime.value = value.duration && new Date(new Date().getTime() + (value.duration * 60 * 1000)).toLocaleTimeString(i18next.language ?? 'en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  }, 1000);\n\n  axios.head(`https://trailer.nomercy.tv/${value.videos[trailerIndex.value]?.src}/${value.videos[trailerIndex.value]?.src}.webm`, {\n    withCredentials: false,\n  })\n      .then(() => {\n        trailerState.value = true;\n      })\n      .catch(() => {\n        incrementTrailerIndex();\n        trailerState.value = false;\n      });\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content\n        ref=\"content\"\n        :fullscreen=\"true\"\n        :style=\"`--background-image: ${backgroundUrl && !backgroundUrl.includes('null') ? `url(${backgroundUrl})` : ''};`\"\n    >\n\n      <div\n          class=\"flex z-0 flex-col justify-start items-center self-stretch flex-grow overflow-hidden gap-4 will-change-auto text-slate-lightA-12/70 dark:text-slate-darkA-12/80 z-0\"\n          style=\"box-shadow: 0 2px 2px 0 rgba(0,0,0,0.16);\"\n      >\n        <div\n            class=\"flex justify-start items-end flex-grow-0 flex-shrink-0 -mx-4 w-available h-[410px] relative gap-2\">\n\n          <div\n              class=\"absolute flex flex-col justify-start items-end flex-grow w-available -mx-20 h-[410px] z-10\"\n              style=\"background: linear-gradient(0deg, rgba(0, 0, 0, 0.50) 0%, rgba(0, 0, 0, 0.50) 100%)\"></div>\n\n          <TMDBImage\n              :key=\"background ?? 'background'\"\n              :autoShadow=\"true\"\n              :path=\"background\"\n              :colorPalette=\"data?.color_palette?.poster\"\n              :size=\"500\"\n              priority=\"low\"\n              :title=\"data?.title ?? data?.name\"\n              aspect=\"poster\"\n              loading=\"eager\"\n              class=\"absolute flex flex-col justify-start items-end flex-grow w-available -mx-20 h-[410px] bg-cover bg-top z-0 children:h-available\"\n              className=\"bg-top max-h-available w-available !object-fill\"\n              type=\"image\"/>\n\n        </div>\n\n        <div\n            class=\"flex bg-slate-light-3 dark:bg-slate-dark-1 flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 gap-3 pt-16 pb-5 will-change-auto w-inherit px-6\"\n        >\n          <p\n             class=\"self-stretch flex-grow-0 flex-shrink-0 w-[351px] text-3xl font-bold text-left z-10\"\n             v-html=\"breakTitle2(data?.title || title || '', 'text-lg line-clamp-2')\">\n          </p>\n\n          <Collapsible v-if=\"data?.overview\" :text=\"data?.overview\" :maxLines=\"3\"/>\n\n          <div v-if=\"data\"\n               class=\"flex justify-start items-center self-stretch flex-grow-0 flex-shrink-0 relative gap-2\">\n\n            <HeaderItem v-if=\"data?.year\" title=\"\" :data=\"data?.year.toString()\"/>\n\n            <HeaderItem v-if=\"data?.content_ratings.length\" title=\"\" >\n              <ContentRating :size=\"6\" v-if=\"data?.content_ratings\"\n                             class=\"h-full min-!h-[1rem] object-scale-down rounded-lg overflow-clip children:-m-0.5\"\n                             :ratings=\"data?.content_ratings\"/>\n            </HeaderItem>\n\n            <HeaderItem v-if=\"data?.have_items\" title=\"\"\n                        :data=\"`${ data?.have_items }/${ data?.number_of_items }`\"/>\n\n            <HeaderItem v-if=\"data?.duration\" title=\"\">\n                <span class=\"whitespace-nowrap\">\n                  {{ convertToHumanReact(t, data?.duration, true) }}\n                </span>\n            </HeaderItem>\n\n            <HeaderItem v-if=\"data?.voteAverage\" title=\"\">\n              <span class=\"whitespace-nowrap\">⭐ ️{{ data?.voteAverage?.toFixed(0) }}/10</span>\n            </HeaderItem>\n\n\n          </div>\n\n          <ion-skeleton-text v-else :animated=\"true\" class=\"h-6 will-change-auto\"></ion-skeleton-text>\n          <div\n              class=\"self-stretch flex-grow-0 flex-shrink-0 h-px bg-slate-dark-7/[0.1] dark:bg-slate-dark-11/[0.1]\"></div>\n\n          <InfoItem v-if=\"data?.genres\" :data=\"data\" title=\"Genres\" keyName=\"genres\" prefix=\"genres\"/>\n          <ion-skeleton-text v-else :animated=\"true\" class=\"h-12 will-change-auto\"></ion-skeleton-text>\n\n          <div\n              class=\"self-stretch flex-grow-0 flex-shrink-0 h-px bg-slate-dark-7/[0.1] dark:bg-slate-dark-11/[0.1]\"></div>\n\n          <InfoItem v-if=\"data?.writer\" :data=\"{writer: [data?.writer]}\" title=\"Writer\" keyName=\"writer\"\n                    prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.creator\" :data=\"{creator: [data?.creator]}\" title=\"Creator\"\n                    keyName=\"creator\"\n                    prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.director\" :data=\"{director: [data?.director]}\" title=\"Director\"\n                    keyName=\"director\"\n                    prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.creators\" :data=\"data\" title=\"Creators\" keyName=\"creators\" prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.directors\" :data=\"data\" title=\"Directors\" keyName=\"directors\"\n                    prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.writers\" :data=\"data\" title=\"Writers\" keyName=\"writers\" prefix=\"person\"/>\n\n          <InfoItem v-if=\"data?.keywords\" :data=\"data\" title=\"Keywords\" keyName=\"keywords\"/>\n\n          <div\n              class=\"self-stretch flex-grow-0 flex-shrink-0 h-px bg-slate-dark-7/[0.1] dark:bg-slate-dark-11/[0.1]\"></div>\n\n          <PersonCarousel v-if=\"data?.cast && data?.cast?.length > 0\"\n                          class=\"-mx-6\"\n                          :data=\"data?.cast\"\n                          title=\"Cast\"/>\n\n          <PersonCarousel v-if=\"data?.crew && data?.crew?.length > 0\"\n                          class=\"-mx-6\"\n                          :data=\"sortByPosterAlphabetized(data?.crew, 'profile', 'id')\"\n                          title=\"Crew\"/>\n\n          <ImageCarousel v-if=\"data?.posters && data?.posters?.length > 0\"\n                         class=\"-mx-6\"\n                         :data=\"data?.posters\"\n                         title=\"Poster\"\n                         type=\"poster\"/>\n\n          <ImageCarousel v-if=\"data?.backdrops && data?.backdrops?.length > 0\"\n                         class=\"-mx-6\"\n                         :colorPalette=\"data?.color_palette?.poster\"\n                         :data=\"data?.backdrops\"\n                         title=\"Backdrop\"\n                         type=\"backdrop\"/>\n\n          <MediaCarousel v-if=\"data?.recommendations && data?.recommendations?.length > 0\"\n                         class=\"-mx-6\"\n                         :colorPalette=\"data?.color_palette\"\n                         :data=\"data?.recommendations\"\n                         title=\"Recommendations\"\n                         type=\"poster\"/>\n\n          <MediaCarousel v-if=\"data?.similar && data?.similar?.length > 0\"\n                         class=\"-mx-6\"\n                         :colorPalette=\"data?.color_palette\"\n                         :data=\"data?.similar\"\n                         title=\"Similar\"\n                         type=\"poster\"/>\n\n        </div>\n      </div>\n\n      <MobileInfoCard :data=\"data\" :toggleTrailer=\"toggleTrailer\" />\n\n      <Trailer v-if=\"data?.videos && data?.videos?.length > 0 && trailerOpen\"\n               :key=\"trailerIndex\"\n               :incrementTrailerIndex=\"incrementTrailerIndex\"\n               :index=\"trailerIndex\"\n               :open=\"trailerOpen\"\n               :title=\"data?.title ?? data?.name\"\n               :toggle=\"toggleTrailer\"\n               :videos=\"data?.videos\"\n               class=\"absolute inset-0 h-full w-full z-999\"/>\n\n    </ion-content>\n  </ion-page>\n</template>\n\n<style scoped>\n:root {\n  --background-image: none;\n}\n\n</style>\n"],"names":["route","useRoute","enabled","ref","showMore","trailerOpen","trailerState","trailerIndex","endTime","interval","content","backgroundUrl","computed","_a","currentServer","background","data","useServerClient","watch","value","_b","setTitle","setBackground","setPoster","setLogo","_c","setColorPalette","_d","processTrailer","onIonViewWillEnter","_e","_f","_g","_h","_i","_k","_j","_m","_l","onIonViewWillLeave","router","overview","toggleTrailer","main","incrementTrailerIndex","i18next","axios"],"mappings":"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"}