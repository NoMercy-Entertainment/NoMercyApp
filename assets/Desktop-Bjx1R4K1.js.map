{"version":3,"file":"Desktop-Bjx1R4K1.js","sources":["../../src/views/Music/List/Desktop.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {ref, watch} from 'vue';\nimport {useRoute} from 'vue-router';\nimport {IonContent, IonPage, onIonViewWillEnter, onIonViewWillLeave} from '@ionic/vue';\n\nimport type {DisplayList} from '@/types/api/music/musicPlayer';\nimport type {PlaylistItem, SortOrder, SortType} from '@/types/musicPlayer';\n\nimport {isNative} from '@/config/global';\nimport useServerClient from '@/lib/clients/useServerClient';\nimport {setTitle, sortByType} from '@/lib/stringArray';\nimport {setColorPalette, setSortOrder, sortOrder, sortType} from '@/store/ui';\nimport {currentSong} from '@/store/audioPlayer';\n\nimport ControlHeader from '@/views/Music/List/components/ControlHeader.vue';\nimport ArtistHeader from '@/views/Music/List/components/ArtistHeader.vue';\nimport SortHeader from '@/views/Music/List/components/SortHeader.vue';\nimport TrackRow from '@/views/Music/List/components/TrackRow.vue';\nimport ScrollContainer from '@/Layout/Desktop/components/ScrollContainer.vue';\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\n\nconst route = useRoute();\n\nconst {data, isError} = useServerClient<DisplayList>({\n  path: route.fullPath,\n  keepForever: true,\n});\n\nconst main = ref<HTMLDivElement | null>(null);\n\nconst displayList = ref<PlaylistItem[]>();\nconst filter = ref('');\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  setTitle(value?.name ?? null);\n\n  sort(value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n\n  if(value?.color_palette?.cover) {\n    setColorPalette(value?.color_palette?.cover);\n  }\n});\n\nwatch(sortOrder, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, value, filter.value);\n});\nwatch(sortType, (value) => {\n  sort(data.value?.tracks ?? [], value, sortOrder.value, filter.value);\n});\nwatch(filter, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, sortOrder.value, value);\n});\n\nconst sort = (songs: PlaylistItem[], sortType: SortType, sortOrder: SortOrder, value: string) => {\n\n  const newList = sortByType<PlaylistItem>(songs ?? [], sortType, sortOrder, setSortOrder);\n\n  if (value == '') {\n    displayList.value = newList;\n  } else {\n    // @ts-ignore\n    displayList.value = newList?.filter(t =>\n        t.name?.toLowerCase().includes(value?.toLowerCase?.())\n        || t.artist_track?.some(a => a.name.toLowerCase().includes(value?.toLowerCase?.()))\n        || t.album_track?.[0]?.name.toLowerCase().includes(value?.toLowerCase?.())) ?? [];\n  }\n};\n\nonIonViewWillEnter(() => {\n  if (data?.value?.tracks) {\n    sort(data?.value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n  }\n\n  if(data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n});\n\nonIonViewWillLeave(() => {\n  if (document.getElementById('navbar')) {\n    document.getElementById('navbar')!.style.display = 'flex';\n  }\n  setColorPalette(null);\n});\n\nconst sortHeader = ref<VueDivElement>();\n\nconst onScroll = () => {\n  const sortHeaderTop = 67;\n\n  if (Math.ceil(sortHeader.value?.$el?.getBoundingClientRect()?.top ?? 500) <= sortHeaderTop) {\n    sortHeader.value?.$el?.classList.add('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.add('!bg-black/50');\n  } else {\n    sortHeader.value?.$el?.classList.remove('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.remove('!bg-black/50');\n  }\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\" class=\"flex\">\n      <NotFound v-if=\"isError\" />\n      <ScrollContainer v-else :autoHide=\"true\" :static=\"true\" @scroll=\"onScroll\">\n        <div\n            v-if=\"!route.params.id || (route.params.id && data?.id == route.params.id)\"\n            ref=\"main\"\n            class=\"flex flex-col overflow-x-clip w-available h-available sm:rounded-2xl\"\n        >\n          <ArtistHeader\n              :data=\"data\"\n          />\n          <div\n              class=\"relative z-0 flex h-auto flex-shrink-0 flex-grow flex-col items-start justify-start self-stretch\">\n            <div class=\"pointer-events-none absolute z-0 h-96 w-full bg-spotifyBottom bg-focus\"></div>\n\n            <ControlHeader\n                :key=\"data?.id\"\n                :data=\"data\"\n                :filter=\"filter\"\n                @filter-change=\"(e: string) => filter = e\"/>\n\n            <div\n                class=\"flex flex-1 flex-shrink-0 flex-col items-start justify-start self-stretch bg-slate-light-1 dark:bg-slate-dark-2 flex-grow-1 gap-0.5 sm:p-4\"\n                :class=\"{\n                   'pb-24' : isNative &&  !currentSong,\n                   'pb-40' : isNative &&  currentSong,\n                   'pb-4 sm:pb-4' : !isNative &&  currentSong\n                }\"\n            >\n              <SortHeader\n                  ref=\"sortHeader\"\n                  :key=\"data?.id\"/>\n\n              <TrackRow\n                  v-for=\"(item, index) in displayList\"\n                  :key=\"item.id\"\n                  :data=\"item\"\n                  :displayList=\"displayList\"\n                  :index=\"index\"/>\n            </div>\n          </div>\n        </div>\n      </ScrollContainer>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["route","useRoute","data","isError","useServerClient","main","ref","displayList","filter","watch","value","setTitle","sort","sortType","sortOrder","_a","setColorPalette","_b","songs","newList","sortByType","setSortOrder","t","_c","a","_f","_d","_e","onIonViewWillEnter","onIonViewWillLeave","sortHeader","onScroll","_h","_g","_j","_i","_m","_l","_k"],"mappings":"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"}