{"version":3,"file":"Tv-Cf7zUAvB.js","sources":["../../src/views/Music/List/Tv.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref, watch } from \"vue\";\nimport { ScrollPanel } from \"primevue\";\nimport { useRoute } from \"vue-router\";\nimport {\n  IonPage, IonContent, IonGrid,\n  IonRow, IonCol, IonItem,\n  IonLabel, IonList, IonButton, onIonViewDidEnter,\n} from '@ionic/vue';\nimport useServerClient from \"@/lib/clients/useServerClient\";\n\nimport type { DisplayList } from \"@/types/api/music/musicPlayer\";\n\nimport CoverImage from \"@/components/MusicPlayer/components/CoverImage.vue\";\nimport MoooomIcon from \"@/components/Images/icons/MoooomIcon.vue\";\nimport { breakTitle2 } from \"@/lib/stringArray\";\nimport BigPlayButton from \"@/components/Buttons/BigPlayButton.vue\";\nimport MusicButton from \"@/components/MusicPlayer/components/MusicButton.vue\";\nimport TrackLinks from \"@/components/MusicPlayer/components/TrackLinks.vue\";\nimport { audioPlayer, currentSong, isPlaying, openFullPlayer, setCurrentPlaylist } from \"@/store/audioPlayer\";\nimport { PlaylistItem } from \"@/types/musicPlayer\";\nimport { focusColor, setColorPalette } from \"@/store/ui\";\nimport { currentServer } from \"@/store/currentServer\";\nimport EqSpinner from \"@/components/Images/EqSpinner.vue\";\nimport MediaLikeButton from \"@/components/Buttons/MediaLikeButton.vue\";\nimport Marquee from \"@/components/Marquee.vue\";\n\nconst route = useRoute();\n\nconst { data } = useServerClient<DisplayList>({\n  path: route.fullPath,\n  keepForever: true,\n});\n\nonMounted(() => {\n  if (data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n  setTimeout(() => {\n    const firstTrack = document.querySelector<HTMLAnchorElement>('.focusable');\n    if (firstTrack) {\n      firstTrack.focus();\n    }\n  }, 100);\n});\n\nwatch(data, (value) => {\n  if (value?.color_palette?.cover) {\n    setColorPalette(value?.color_palette?.cover);\n  }\n  setTimeout(() => {\n    const firstTrack = document.querySelector<HTMLAnchorElement>('.focusable');\n    if (firstTrack) {\n      firstTrack.focus();\n    }\n  }, 100);\n});\n\nconst lastFocused = ref<HTMLAnchorElement>();\n\nonIonViewDidEnter(() => {\n  setTimeout(() => {\n    const firstTrack = document.querySelector<HTMLAnchorElement>('.focusable');\n    if (firstTrack) {\n      firstTrack.focus();\n    }\n  }, 100);\n});\n\nconst handleListFocus = (event: FocusEvent) => {\n  const target = event.target as HTMLAnchorElement;\n  const focusIndex = lastFocused.value?.getAttribute('data-index') ?? 0;\n  const firstTrack = target.querySelector<HTMLAnchorElement>(`[data-index=\"${focusIndex}\"] .focusable`);\n  if (firstTrack) {\n    firstTrack.focus();\n  }\n};\n\nconst handleListItemFocus = (event: FocusEvent) => {\n  const target = event.target as HTMLAnchorElement;\n  lastFocused.value = target;\n\n  if (target) {\n    target.scrollIntoView({\n      behavior: 'smooth',\n      block: 'center',\n    });\n  }\n\n  const dataId = target.closest('[data-id]')?.getAttribute('data-id');\n  const firstTrack = target.querySelector<HTMLAnchorElement>(`[data-index=\"${dataId}\"] .focusable`);\n  if (firstTrack) {\n    firstTrack.focus();\n  }\n};\n\nconst handleUp = (event: KeyboardEvent) => {\n  const target = event.target as HTMLAnchorElement;\n\n  if (event.key == 'ArrowUp') {\n    const previousSibling = target.closest('ion-item')?.previousSibling as HTMLElement;\n    const nextFocus = previousSibling.querySelector<HTMLAnchorElement>('.focusable');\n\n    if (nextFocus) {\n      nextFocus.focus();\n    }\n  } else if (event.key == 'ArrowDown') {\n    const nextSibling = target.closest('ion-item')?.nextSibling as HTMLElement;\n    const nextFocus = nextSibling.querySelector<HTMLAnchorElement>('.focusable');\n    if (nextFocus) {\n      nextFocus.focus();\n    }\n  }\n};\n\nconst setCurrentList = () => {\n  setCurrentPlaylist(route.fullPath);\n};\n\nconst handleClick = (song: PlaylistItem) => {\n  if (!currentSong.value) {\n    setCurrentList();\n  }\n\n  audioPlayer.playTrack(song, data.value?.tracks ?? []);\n  openFullPlayer()\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n\n      <div class=\"w-full h-full absolute left-0 top-0 bg-[#131314] pointer-events-none -z-10\" :key=\"data?.id\"\n        :style=\"focusColor ? `--color-focus: ${focusColor}` : ''\">\n        <div class=\"w-available h-available absolute left-[202px] top-0 overflow-hidden bg-focus\">\n          <img\n            class=\"w-available h-available absolute left-[-0.39px] top-[-0.39px] opacity-40 object-cover object-center\"\n            :src=\"`${currentServer?.serverBaseUrl}${data?.cover}`\" alt=\"\" />\n          <div class=\"w-[150vw] h-[150vw] absolute left-[-30%] bottom-[-50%]\" style=\"\n                  background: radial-gradient(\n                    closest-side,\n                    rgba(19, 19, 20, 0.1) 0%,\n                    rgba(19, 19, 20, 1) 70.73974609375%\n                  );\n              \"></div>\n        </div>\n      </div>\n\n      <ion-grid>\n        <ion-row class=\"ion-align-items-end\">\n          <ion-col size=\"3\">\n\n            <div class=\"flex justify-center w-available aspect-square my-8 ml-8 mr-16\">\n              <CoverImage :data=\"data\" :alt=\"data?.name\" class=\"w-auto h-full aspect-square\" />\n            </div>\n\n            <div v-if=\"data?.name\"\n              class=\"relative mb-8 flex w-full flex-1 flex-shrink-0 flex-col items-start justify-start gap-4 flex-grow-1 text-left\">\n\n              <div v-if=\"data.name.length > 50\"\n                class=\"w-full text-xl font-semibold line-clamp-2 leading-[130%] whitespace-pre-wrap\"\n                v-html=\"breakTitle2(data?.name ?? 'Songs you like', 'text-xs line-clamp-1')\">\n              </div>\n\n              <p v-else class=\"w-full text-xl font-semibold line-clamp-2 leading-[130%] whitespace-pre-wrap\">\n                {{ data?.name }}\n              </p>\n\n              <div class=\"flex items-center h-8 gap-2 self-stretch w-full text-xs font-medium text-left \">\n                <span class=\"flex gap-2\" v-if=\"data?.type\">\n                  <span>{{ data?.type.replace(/s$/u, '').toTitleCase() }}</span>\n                </span>\n\n                <span class=\"flex gap-2\" v-if=\"data?.tracks\">\n                  <span>â€¢</span>\n                  <span>{{ data?.tracks.length }} {{ $t('tracks') }}</span>\n                </span>\n              </div>\n\n              <div class=\"flex gap-2 items-center justify-between w-full\">\n\n                <MediaLikeButton :data=\"data\" />\n\n                <BigPlayButton :data=\"data\" class=\"w-12 h-12\" />\n              </div>\n\n            </div>\n\n          </ion-col>\n\n          <ion-col size=\"6\" @focus=\"handleListFocus($event)\" tabindex=\"0\">\n            <ScrollPanel class=\"w-available h-available scroll-smooth\" :pt=\"{\n              barY: {\n                tabindex: -1,\n              },\n              contentContainer: {\n                tabindex: -1,\n              },\n              content: {\n                tabindex: -1,\n              },\n              root: {\n                tabindex: -1,\n              }\n            }\" :dt=\"{\n                bar: {\n                  background: 'transparent'\n                }\n              }\">\n              <ion-list mode=\"md\" lines=\"none\">\n                <template v-for=\"(song, index) in data?.tracks\" :key=\"song.id\">\n\n                  <ion-item tabindex=\"-1\" mode=\"md\"\n                    class=\"group/track focus-within:bg-white/4 rounded-md overflow-clip\">\n                    <ion-grid>\n\n                      <ion-row :data-index=\"index\" :data-id=\"song.id\" tabindex=\"-1\"\n                        class=\"items-center !rounded-md !overflow-clip\">\n\n                        <ion-col size=\"2\" tabindex=\"-1\">\n                          <div tabindex=\"0\" :data-index=\"index\" :data-id=\"song.id\"\n                            class=\"focusable flex justify-center w-full aspect-video focus:outline outline-focus outline-2 outline-offset-2 mr-2 overflow-clip\"\n                            @focus=\"handleListItemFocus($event)\" @click=\"handleClick(song)\">\n                            <CoverImage :data=\"song\" :alt=\"song.name\" class=\"w-auto h-full aspect-square\" />\n                          </div>\n                        </ion-col>\n\n                        <ion-col size=\"8\" tabindex=\"-1\" class=\"my-auto mt-2\">\n                          <ion-label tabindex=\"-1\">\n                            <div class=\"flex w-available overflow-clip items-end\">\n                              <div\n                                class=\"flex items-center justify-center h-full aspect-square overflow-clip transition-width duration-300\"\n                                :class=\"{\n                                  'w-0': currentSong?.id != song.id,\n                                  'w-6 mr-1': currentSong?.id == song.id,\n                                }\">\n                                <EqSpinner :playing=\"isPlaying\" />\n                              </div>\n                              <Marquee :playing=\"!!currentSong?.id\" :text=\"song.name\"\n                                class=\"!w-[calc(100%-30px)] text-auto-12 children:leading-none w-available overflow-clip\" />\n                            </div>\n\n                            <TrackLinks :data=\"song.artist_track\" type=\"artists\" :id=\"song.id\" @keydown.up.prevent\n                              @keydown.down.prevent @keyup=\"handleUp($event)\" suffix=\"track\" />\n                          </ion-label>\n                        </ion-col>\n\n                        <ion-col size=\"2\" tabindex=\"-1\" class=\"opacity-0 group-focus-within/track:opacity-100\">\n                          <ion-row tabindex=\"-1\">\n\n                            <MediaLikeButton :data=\"song\" />\n\n                            <MusicButton label=\"\" tabindex=\"1\" :onclick=\"() => { }\" class=\"!bg-transparent\">\n                              <MoooomIcon icon=\"menuDotsHorizontal\" class=\"text-white\" />\n                            </MusicButton>\n                          </ion-row>\n                        </ion-col>\n\n                      </ion-row>\n\n                    </ion-grid>\n\n\n                  </ion-item>\n\n                </template>\n              </ion-list>\n            </ScrollPanel>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n\n    </ion-content>\n  </ion-page>\n</template>\n\n<style scoped>\nion-content>ion-grid {\n  --ion-grid-padding: 4rem;\n  --ion-grid-columns: 9;\n  height: 100%;\n  padding: 6rem 2rem 0 4rem !important;\n}\n\nion-content>ion-grid>ion-row {\n  height: 100%;\n}\n\nion-content>ion-grid>ion-row>ion-col {\n  height: 100%;\n}\n\n.p-scrollpanel {\n  --p-scrollpanel-bar-size: 6px;\n}\n\nion-item {\n  --padding-start: 0;\n}\n\nion-item::part(native) {\n  --inner-padding-end: 0;\n}\n\nion-item::part(native):after {\n  @apply rounded-md;\n  --background-focused: currentColor;\n  --background-focused-opacity: .12;\n}\n\nion-item>ion-grid {\n  --ion-grid-columns: 12;\n  --ion-grid-padding: 0;\n}\n\nion-item>ion-grid>ion-row {}\n\nion-list {\n  @apply bg-transparent w-full;\n}\n\nion-item {\n  --background: transparent;\n  --color: rgb(var(--color-text));\n}\n\nion-item::part(detail-icon) {\n  color: white;\n  opacity: 1;\n  font-size: 20px;\n}\n</style>"],"names":["route","useRoute","data","useServerClient","onMounted","_b","_a","setColorPalette","_d","_c","firstTrack","watch","value","lastFocused","ref","onIonViewDidEnter","handleListFocus","event","target","focusIndex","handleListItemFocus","dataId","handleUp","nextFocus","setCurrentList","setCurrentPlaylist","handleClick","song","currentSong","audioPlayer","openFullPlayer"],"mappings":"uuCA2BA,MAAMA,EAAQC,EAAS,EAEjB,CAAE,KAAAC,CAAK,EAAIC,EAA6B,CAC5C,KAAMH,EAAM,SACZ,YAAa,EAAA,CACd,EAEDI,EAAU,IAAM,cACVC,GAAAC,EAAAJ,EAAK,QAAL,YAAAI,EAAY,gBAAZ,MAAAD,EAA2B,OACbE,GAAAC,GAAAC,EAAAP,EAAK,QAAL,YAAAO,EAAY,gBAAZ,YAAAD,EAA2B,KAAK,EAElD,WAAW,IAAM,CACT,MAAAE,EAAa,SAAS,cAAiC,YAAY,EACrEA,GACFA,EAAW,MAAM,GAElB,GAAG,CAAA,CACP,EAEKC,EAAAT,EAAOU,GAAU,UACjBN,EAAAM,GAAA,YAAAA,EAAO,gBAAP,MAAAN,EAAsB,OACRC,GAAAF,EAAAO,GAAA,YAAAA,EAAO,gBAAP,YAAAP,EAAsB,KAAK,EAE7C,WAAW,IAAM,CACT,MAAAK,EAAa,SAAS,cAAiC,YAAY,EACrEA,GACFA,EAAW,MAAM,GAElB,GAAG,CAAA,CACP,EAED,MAAMG,EAAcC,EAAuB,EAE3CC,EAAkB,IAAM,CACtB,WAAW,IAAM,CACT,MAAAL,EAAa,SAAS,cAAiC,YAAY,EACrEA,GACFA,EAAW,MAAM,GAElB,GAAG,CAAA,CACP,EAEK,MAAAM,EAAmBC,GAAsB,OAC7C,MAAMC,EAASD,EAAM,OACfE,IAAab,EAAAO,EAAY,QAAZ,YAAAP,EAAmB,aAAa,gBAAiB,EAC9DI,EAAaQ,EAAO,cAAiC,gBAAgBC,CAAU,eAAe,EAChGT,GACFA,EAAW,MAAM,CAErB,EAEMU,EAAuBH,GAAsB,OACjD,MAAMC,EAASD,EAAM,OACrBJ,EAAY,MAAQK,EAEhBA,GACFA,EAAO,eAAe,CACpB,SAAU,SACV,MAAO,QAAA,CACR,EAGH,MAAMG,GAASf,EAAAY,EAAO,QAAQ,WAAW,IAA1B,YAAAZ,EAA6B,aAAa,WACnDI,EAAaQ,EAAO,cAAiC,gBAAgBG,CAAM,eAAe,EAC5FX,GACFA,EAAW,MAAM,CAErB,EAEMY,EAAYL,GAAyB,SACzC,MAAMC,EAASD,EAAM,OAEjB,GAAAA,EAAM,KAAO,UAAW,CAEpB,MAAAM,IADkBjB,EAAAY,EAAO,QAAQ,UAAU,IAAzB,YAAAZ,EAA4B,iBAClB,cAAiC,YAAY,EAE3EiB,GACFA,EAAU,MAAM,CAClB,SACSN,EAAM,KAAO,YAAa,CAE7B,MAAAM,IADclB,EAAAa,EAAO,QAAQ,UAAU,IAAzB,YAAAb,EAA4B,aAClB,cAAiC,YAAY,EACvEkB,GACFA,EAAU,MAAM,CAClB,CAEJ,EAEMC,EAAiB,IAAM,CAC3BC,GAAmBzB,EAAM,QAAQ,CACnC,EAEM0B,EAAeC,GAAuB,OACrCC,EAAY,OACAJ,EAAA,EAGjBK,GAAY,UAAUF,IAAMrB,EAAAJ,EAAK,QAAL,YAAAI,EAAY,SAAU,EAAE,EACrCwB,GAAA,CACjB;;;;"}