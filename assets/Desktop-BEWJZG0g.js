import{aG as $,j as _,o as m,a7 as l,a as i,c as k,b7 as M,K as f,bE as j,ax as E,v as I,a6 as p,t as b,x as n,aI as h,bD as A,ba as S,bq as B,bQ as T,F as U,w as L,bO as D}from"./index-h9IS6Irn.js";import{u as F}from"./useApiClient-bwgtLxOq.js";import{_ as K}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CKD7X-oQ.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-C5LS1M-F.js";import{_ as N}from"./DashboardCard.vue_vue_type_script_setup_true_lang-pQbYH7iZ.js";import{_ as O}from"./Avatar.vue_vue_type_script_setup_true_lang-BnZEzDVd.js";import{_ as z}from"./Modal.vue_vue_type_script_setup_true_lang-2hbkXpCx.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-CPT9wlwX.js";const Q={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},Z=["src"],G=$({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(u,d)=>(m(),_(N,{route:`/dashboard/users/${r.data.user_id}`,line1:r.data.name,line2:""},{image:l(()=>[i("div",Q,[d[0]||(d[0]=i("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(m(),k("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,Z)):(m(),_(O,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"]))}}),P={class:"flex w-full flex-col justify-start text-left"},W={class:"py-4 text-sm text-auto-10"},H={class:"flex flex-col gap-2 w-full"},J={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},R=$({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const{t:u}=M(),d=r;f(null);const t=f(""),v=f([]),{data:y}=j({path:"/dashboard/libraries"}),o=f(),x=()=>{v.value=[],d.close()},c=s=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(s).toLowerCase()),g=E(()=>t.value?c(t.value):!1),q=()=>{var s,e;if(!t.value){v.value.push({type:"error",place:"email",message:u("Email is required")});return}if(!c(t.value)){v.value.push({type:"error",place:"email",message:u("Invalid email address")});return}A().post("server/server-users",{id:(s=S.value)==null?void 0:s.id,email:t.value,libraries:(e=o.value)==null?void 0:e.map(a=>a.id)}).then(()=>{B.invalidateQueries({queryKey:["server_users"]}),t.value="",d.close()}).catch(({response:a})=>{(a==null?void 0:a.status)!=200&&(a!=null&&a.data)&&v.value.push({message:a.data.message??"An error occurred",place:"email",type:a.data.status??a.data.exception})})};return(s,e)=>{const a=I("InputText"),V=I("MultiSelect");return m(),_(z,{open:r.open,close:x,title:"Invite user"},{actions:l(()=>[n(C,{type:"button",id:"yes",color:"theme",variant:"contained",endIcon:"emailSend",disabled:!g.value,onClick:q},{default:l(()=>[p(b(s.$t("Send")),1)]),_:1},8,["disabled"]),n(C,{type:"button",id:"no",variant:"text",onClick:x},{default:l(()=>[p(b(s.$t("Cancel")),1)]),_:1})]),default:l(()=>[i("div",P,[i("p",W,[p(b(s.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=i("br",null,null,-1)),p(" "+b(s.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",H,[e[3]||(e[3]=i("label",{for:"email"},"Email",-1)),n(a,{id:"email",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=w=>t.value=w),class:"mb-4"},null,8,["modelValue"])]),i("div",J,[e[4]||(e[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),n(V,{id:"libraries",display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:h(y),optionLabel:"title",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=w=>o.value=w)},null,8,["options","modelValue"])])])]),_:1},8,["open"])}}}),ie=$({__name:"Desktop",setup(r){var y;const u=f(!1),{data:d}=F({path:"server/server-users",params:{id:(y=S.value)==null?void 0:y.id},queryKey:["server_users"]}),t=()=>{u.value=!0,setTimeout(()=>{var o;(o=document.querySelector("#email"))==null||o.focus()},300)},v=()=>{u.value=!1};return(o,x)=>(m(),_(h(D),null,{default:l(()=>[n(h(T),{fullscreen:!0},{default:l(()=>[n(K,{gridStyle:1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[n(C,{id:"invite",color:"theme",startIcon:"userAdd",onClick:t},{default:l(()=>[p(b(o.$t("Invite user")),1)]),_:1})]),default:l(()=>[(m(!0),k(U,null,L([...h(d)??[]].sort((c,g)=>c.name.localeCompare(g.name)),c=>(m(),_(G,{key:c.user_id,data:c},null,8,["data"]))),128)),n(R,{open:u.value,close:v},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{ie as default};
