import{C as f,Ct as u,Dt as a,Et as P,J as T,K as r,O as E,S as e,T as c,U as D,X as R,Y as j,c as S,g as z,it as K,j as C,k as x,mt as y,ot as h,w as p,wt as U,x as B}from"./i18n-Rm1NkeNf.js";import{y as L}from"./vue-core-D-3YrIBp.js";import{p as Q}from"./primevue-DkuV93HA.js";import{a as X}from"./query-BPfDyGC_.js";import{Bi as G,Ki as $,Mr as V,b as d,qi as N,v as F,xa as H,z as Y}from"./index-DvNhFfKH.js";import{t as W}from"./KeepCounting-CE57olmc.js";import{t as A}from"./useServerClient-BIuEWXCM.js";import{s as I}from"./RipperOverlay-Dwyszfk8.js";import{n as q,r as O}from"./DashboardLayout-9lzttuhy.js";S();var Z={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch w-full pt-1 text-surface-12"},ee={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},te={class:"flex-grow text-xl font-medium"},ae={class:"ml-auto flex gap-2 text-surface-12 bg-surface-12/2"},se={key:1,class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch text-surface-12"},le={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},re={class:"flex-grow text-xl font-medium"},ie={class:"ml-auto flex gap-2 bg-surface-12/2"},ne=C({__name:"ServerSystemCard",props:{title:{type:String,required:!0},background:{type:Boolean,required:!1,default:!0}},setup(t){return(l,o)=>u(G)&&u(O)?(r(),f(u(L),{key:0},{default:h(()=>[e("div",Z,[e("div",ee,[e("p",te,a(l.$t(t.title)),1),e("div",ae,[j(l.$slots,"cta")])]),e("div",{class:U([{" bg-surface-5/6 text-surface-11 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[j(l.$slots,"default")],2)])]),_:3})):u(O)?(r(),c("div",se,[e("div",le,[e("p",re,a(l.$t(t.title)),1),e("div",ie,[j(l.$slots,"cta")])]),e("div",{class:U([{"bg-surface-12/3 text-surface-12/12 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[j(l.$slots,"default")],2)])):p("",!0)}}),M=ne;S();var oe={class:"relative flex w-full items-center justify-center gap-0.5 text-surface-12"},de=["title"],ue={class:"flex-shrink-0 flex-grow-0 text-right text-xs font-light text-surface-10"},ce={class:"relative flex items-start justify-start gap-2 group/encoderCard"},fe={key:0,class:"relative aspect-video h-auto w-1/3 flex-shrink-0 flex-grow-0 overflow-hidden rounded-sm min-w-36",style:{background:`linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 0) 25%,
            rgba(0, 0, 0, 0) 50%,
            #000 100%
          )`}},ve={class:"absolute inset-0 z-0 h-full w-full bg-white/[0.01] flex flex-col justify-center"},xe=["src"],he={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px]"},me={class:"absolute z-10 flex items-end justify-start left-[3%] bottom-[3%] gap-[2%]"},ge={class:"absolute z-10 flex items-end justify-end right-[3%] bottom-[3%] gap-[2%] text-[10px]"},pe={class:"group-hover/progress:hidden text-right font-bold monospace"},we={class:"grid grid-cols-4 gap-2 flex-1"},_e={class:"flex flex-col text-surface-12 col-span-4"},be={class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},ke={class:"text-surface-12/11"},ye={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},$e={class:"text-surface-12/11 text-2xs"},Se={key:1,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Ce={class:"font-medium text-2xs text-surface-12/11"},je={class:"flex flex-nowrap gap-4 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Ie={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},qe={class:"w-full text-xs text-surface-10 line-clamp-1"},Te=["title"],ze={class:"w-full text-xs text-surface-10 line-clamp-1"},Ee=["title"],Be={class:"w-full text-xs text-surface-10 line-clamp-1"},Ne={key:0,class:"absolute -bottom-0.5 left-0 h-1 w-full blur-[1px]"},Me=C({__name:"ServerEncoderTaskCard",props:{data:{type:Object,required:!0}},setup(t){const l=t,o=y(l.data?.status);K(l,s=>{o.value=s.data.status});const w=B(()=>o.value==="running"?"running":"paused"),m=B(()=>l.data.thumbnails?`${`${N.value?.serverBaseUrl}\\${l.data.thumbnails}`.replace(/\\+/gu,"/").replace(/\/\/images/u,"/images")}?token=${H.value.accessToken}`:null);function i(){$().post(`/dashboard/tasks/pause/${l.data.process_id}`).then(({data:s})=>{o.value=s?"paused":o.value}).catch(()=>{})}function _(){$().post(`/dashboard/tasks/resume/${l.data.process_id}`).then(({data:s})=>{o.value=s?"running":o.value}).catch(()=>{})}function b(){o.value==="running"?i():_()}return(s,k)=>(r(),f(u(Q),{class:"relative overflow-clip"},{title:h(()=>[e("div",oe,[e("p",{title:t.data.title.replace(/NoMercy/giu,""),class:"w-full flex-grow text-sm font-semibold line-clamp-1 h-6"},a(t.data.title.replace(/NoMercy/giu,"")),9,de),e("p",ue,a(s.$t("Id"))+": "+a(t.data?.process_id),1)])]),content:h(()=>[e("div",ce,[t.data?.message==="Encoding video"?(r(),c("div",fe,[e("div",ve,[k[0]||(k[0]=e("div",{class:"pointer-events-none absolute inset-0 z-10 mt-auto h-4/5 bg-gradient-to-t from-black via-black/60"},null,-1)),m.value?(r(),c("img",{key:0,src:m.value,alt:"",class:"absolute z-0 h-full w-full"},null,8,xe)):p("",!0)]),e("button",{class:"absolute top-1/2 left-1/2 z-10 group-hover/encoderCard:flex hidden h-11 w-11 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/60 p-0.5 group/progress text-white flex flex-col",onClick:b},[e("div",he,[w.value==="running"?(r(),f(d,{key:0,class:"w-10",icon:"pause"})):(r(),f(d,{key:1,class:"w-10",icon:"play"}))])]),e("div",me,[t.data?.has_gpu?(r(),f(d,{key:0,"class-name":"w-[15%]",icon:"gpu"})):(r(),f(d,{key:1,"class-name":"w-[15%]",icon:"cpu"})),t.data?.is_hdr?(r(),f(d,{key:2,"class-name":"w-[15%]",icon:"hdr"})):(r(),f(d,{key:3,"class-name":"w-[15%]",icon:"hdrOff"}))]),e("div",ge,[e("span",pe,a(Math.floor(t.data?.progress??0))+"% ",1)])])):p("",!0),e("div",we,[e("div",_e,[e("span",be,[x(d,{"class-name":"relative w-4",icon:"stickyNote"}),e("span",ke,a(t.data?.message),1)]),t.data?.message==="Encoding video"?(r(),c("span",ye,[x(d,{"class-name":"relative w-4",icon:"dashboard"}),e("span",$e,a(t.data?.speed)+"X ",1)])):p("",!0),t.data?.message==="Encoding video"?(r(),c("span",Se,[x(d,{"class-name":"relative w-4",icon:"hourglass"}),e("span",Ce,a(t.data?.remaining_split?.[0]&&t.data?.remaining_split[0]>0?` ${t.data?.remaining_split?.[0]+s.$t("d")} `:"")+" "+a(t.data?.remaining_split?.[1]&&(t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[1]+s.$t("h")} `:"")+" "+a(t.data?.remaining_split?.[2]&&(t.data?.remaining_split[2]>0||t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[2]+s.$t("m")} `:"")+" "+a(t.data?.remaining_split?.[3]?` ${t.data?.remaining_split?.[3]+s.$t("s")} `:""),1)])):p("",!0),e("div",je,[t.data?.video_streams&&t.data?.message==="Encoding video"?(r(),c("span",Ie,[x(d,{"class-name":"w-4",icon:"film"}),e("span",qe,a(t.data?.video_streams.length),1)])):p("",!0),t.data?.audio_streams&&t.data?.message==="Encoding video"?(r(),c("div",{key:1,title:t.data?.audio_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[x(d,{"class-name":"w-4",icon:"audioFile"}),e("span",ze,a(t.data?.audio_streams.length),1)],8,Te)):p("",!0),t.data?.subtitle_streams&&t.data?.message==="Encoding video"?(r(),c("div",{key:2,title:t.data?.subtitle_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[x(d,{"class-name":"w-4",icon:"chatBubble"}),e("span",Be,a(t.data?.subtitle_streams.length),1)],8,Ee)):p("",!0)])])])]),t.data?.message==="Encoding video"?(r(),c("div",Ne,[k[1]||(k[1]=e("div",{class:"absolute w-full h-1 left-[-1px] top-[-1px] bg-black/[0.22]"},null,-1)),e("div",{style:P(`width: ${t.data.progress}%;`),class:"w-0 h-1 absolute left-[-1px] top-[-1px] rounded-sm bg-gradient-to-r from-black/5 to-[var(--color-theme-8)] z-10"},null,4),e("div",{style:P(`left: ${t.data.progress}%;`),class:"w-1 h-0.5 absolute top-[-1px] rounded-sm bg-[#f1eefe] -translate-x-[2px] z-0"},null,4)])):p("",!0)]),_:1}))}}),Pe=Me;S();var Ue={class:"flex flex-nowrap w-full justify-between"},Ve={class:"text-surface-12"},Oe={class:"flex flex-col text-surface-12"},De={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Ke={class:"text-surface-12/11"},Qe={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm flex justify-between"},Fe={class:"mr-auto"},Ae={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Je={class:"text-surface-12/11"},Re={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Le={class:"text-surface-12/11"},Xe=C({__name:"ServerQueueTaskCard",props:{data:{type:Object,required:!0}},setup(t){const l=t,o=y(l.data.priority??0);function w(i){$().patch(`/dashboard/tasks/queue/${l.data.id}`,{id:l.data.id,priority:i}).then(()=>{console.log("Priority updated")})}function m(){$().delete(`/dashboard/tasks/queue/${l.data.id}`).then(()=>{console.log("Item deleted")})}return K(o,i=>{console.log(i),w(i)}),(i,_)=>{const b=R("InputNumber");return r(),f(u(Q),null,{title:h(()=>[e("span",Ue,[e("span",Ve,a(t.data.title.replace(/NoMercy/giu,"")),1),e("button",{class:"float-right flex items-center justify-center gap-2 overflow-hidden rounded-lg bg-transparent w-10 -mt-1.5 -mr-1.5 aspect-square",onClick:m},[x(d,{class:"relative h-5 w-5 flex-shrink-0 flex-grow-1",icon:"cross"})])])]),content:h(()=>[e("div",Oe,[e("p",De,[E(a(i.$t("Id"))+": ",1),e("span",Ke,a(t.data.id),1)]),e("span",Qe,[e("span",Fe,a(i.$t("Priority"))+": ",1),x(b,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=s=>o.value=s),max:100,min:0,step:1,class:"ml-auto h-8 first:children:!w-12 last:children:!w-4 children:last:children:!w-4 overflow-clip -mb-2","show-buttons":"",size:"small",variant:"filled"},null,8,["modelValue"])]),e("span",Ae,[E(a(i.$t("Profile"))+": ",1),e("span",Je,a(t.data.profile),1)]),e("span",Re,[E(a(i.$t("File"))+": ",1),e("span",Le,a(t.data.input_file),1)])])]),_:1})}}}),Ge=F(Xe,[["__scopeId","data-v-8e217994"]]);S();var He={class:"flex-shrink-0 flex-grow-0 text-sm"},Ye={class:"relative flex items-start justify-start gap-2 self-stretch rounded-lg p-4 text-surface-11 bg-surface-12/2"},We={class:"flex-shrink-0 flex-grow-0 self-stretch text-sm font-semibold"},Ze=C({__name:"ServerTasksCard",setup(t){const l=y([]),o=y(!1),{data:w,refetch:m}=A({path:"dashboard/tasks/queue",queryKey:["queue"],refetchInterval:3e4});D(()=>{l.value=[]});function i(n){n.status==="running"||n.status==="paused"?l.value=V([...l.value.filter(v=>v.id!==n.id),n],"id"):(l.value=V([...l.value.filter(v=>v.id!==n.id)],"id"),m())}const _=B(()=>{const n=w.value?.filter(v=>!l.value.find(g=>g.title===v.title))??[];return o.value||n.length<=20?n:[...n.slice(0,5),...n.slice(-5)]});function b(n){w.value=n}function s(){l.value=[],m()}function k(){o.value=!o.value}return I(q,"encoder-progress",i),I(q,"encoder-queue",b),I(q,"encoder-clear",s),I(q,"disconnected",s),(n,v)=>l.value.length||u(w)?.length?(r(),f(M,{key:0,background:!1,title:"Running tasks"},{cta:h(()=>[e("button",{class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11",onClick:k},[e("p",He,a(o.value?n.$t("Show less"):n.$t("Show all")),1)])]),default:h(()=>[(r(!0),c(z,null,T(l.value.toSorted((g,J)=>g.title.localeCompare(J.title))??[],g=>(r(),f(Pe,{key:g.id,data:g},null,8,["data"]))),128)),(r(!0),c(z,null,T(_.value,g=>(r(),f(Ge,{key:g.id,data:g},null,8,["data"]))),128))]),_:1})):(r(),f(M,{key:1,background:!1,title:"Running tasks"},{default:h(()=>[e("div",Ye,[e("span",We,a(n.$t("No tasks are currently running")),1)])]),_:1}))}}),Mt=Ze;S();var et={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},tt={class:"flex-shrink-0 flex-grow-0 text-sm"},at={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},st={class:"flex-shrink-0 flex-grow-0 text-sm"},lt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},rt={class:"w-40 flex-grow whitespace-nowrap text-sm"},it={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},nt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},ot={class:"w-40 flex-grow whitespace-nowrap text-sm"},dt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},ut={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},ct={class:"w-40 flex-grow whitespace-nowrap text-sm"},ft={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},vt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},xt={class:"w-40 flex-grow whitespace-nowrap text-sm"},ht={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},mt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},gt={class:"w-40 flex-grow whitespace-nowrap text-sm"},pt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},wt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},_t={class:"w-40 flex-grow whitespace-nowrap text-sm"},bt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},kt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},yt={class:"w-40 flex-grow whitespace-nowrap text-sm"},$t={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},St=C({__name:"ServerSystemInfoCard",setup(t){const l=y(!1),o=y(!0),{data:w,refetch:m}=X({queryKey:["runners",N.value?.serverBaseUrl],retryOnMount:!0,queryFn:()=>$().get("dashboard/tasks/runners").then(({data:s})=>(l.value=!(s.workers>0),s.workers??[]))}),{data:i}=A({path:"dashboard/server/info",queryKey:["serverInfo",N.value?.serverBaseUrl]});function _(){o.value=!0,m()}function b(){o.value=!1}return D(()=>{const s=Y();s?.onreconnected(_),s?.onclose(b)}),(s,k)=>(r(),f(M,{title:"System"},{cta:h(()=>[e("button",et,[x(d,{class:"w-4",icon:"pause"}),e("p",tt,a(s.$t("Pause")),1)]),e("button",at,[x(d,{class:"w-4",icon:"shutdown"}),e("p",st,a(s.$t("Shutdown")),1)])]),default:h(()=>[e("div",lt,[e("p",rt,a(s.$t("Server")),1),e("p",it,a(u(i)?.server),1)]),e("div",nt,[e("p",ot,a(s.$t("Server version")),1),e("p",dt,a(u(i)?.version),1)]),e("div",ut,[e("p",ct,a(s.$t("Uptime")),1),e("p",ft,[(r(),f(W,{key:u(i)?.bootTime,"start-time":u(i)?.bootTime},null,8,["start-time"]))])]),e("div",vt,[e("p",xt,a(s.$t("OS")),1),e("p",ht,a(u(i)?.os.toTitleCase()),1)]),e("div",mt,[e("p",gt,a(s.$t("Architecture")),1),e("p",pt,a(u(i)?.arch),1)]),(r(!0),c(z,null,T(u(i)?.cpu,(n,v)=>(r(),c("div",wt,[e("p",_t,a(s.$t("CPU"))+" #"+a(v+1),1),e("p",bt,a(n),1)]))),256)),(r(!0),c(z,null,T(u(i)?.gpu,(n,v)=>(r(),c("div",kt,[e("p",yt,a(s.$t("GPU"))+" #"+a(v+1),1),e("p",$t,a(n),1)]))),256))]),_:1}))}}),Pt=F(St,[["__scopeId","data-v-c6231921"]]);export{Mt as n,M as r,Pt as t};
