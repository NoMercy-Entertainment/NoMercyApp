{"version":3,"file":"Edit-D1rHOpaz.js","sources":["../../src/views/Dashboard/System/Users/components/DeleteUserModal.vue","../../src/views/Dashboard/System/Users/Edit.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport {PropType, ref} from 'vue';\nimport {useTranslation} from 'i18next-vue';\n\nimport {useQueryClient} from '@tanstack/vue-query';\n\nimport apiClient from '@/lib/clients/apiClient';\nimport {currentServer} from '@/store/currentServer';\n\nimport Modal from '@/components/Modal.vue';\nimport Button from '@/components/Buttons/Button.vue';\n\nconst props = defineProps({\n  open: {\n    type: Boolean,\n    required: true,\n  },\n  close: {\n    type: Function as PropType<() => any>,\n    required: true,\n  },\n  id: {\n    type: String,\n    required: true,\n  },\n  name: {\n    type: String,\n    required: true,\n  },\n  noRedirect: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst {t} = useTranslation();\nconst query = useQueryClient();\n\nconst errorBucket = ref<{\n  type: string,\n  place: string;\n  message: string;\n}[]>([]);\n\nconst handleDelete = () => {\n  if (!props.id) {\n    errorBucket.value.push({\n      type: 'error',\n      place: 'email',\n      message: t('Email is required'),\n    });\n    return;\n  }\n\n  apiClient()\n      .post('server/users', {\n        _method: 'delete',\n        server_id: currentServer.value?.id,\n        user_id: props.id,\n      })\n      .then(() => {\n        query.invalidateQueries({queryKey: ['users']}).then(() => {\n          history.back();\n        });\n      });\n\n  props.close();\n};\n\n</script>\n\n<template>\n  <Modal :open=\"open\"\n         :close=\"close\"\n         :params=\"{name : name}\"\n         :title=\"`Delete server member {{name}}`\">\n\n    <p class=\"my-6 text-sm text-auto-10\">\n      {{ $t('Are you sure you want to delete this server member?') }}<br>\n      {{ $t('They won\\'t be able to access your content anymore until you re-invite them') }}.\n    </p>\n\n    <template v-slot:actions>\n      <Button type=\"button\"\n              id=\"yes\"\n              color=\"red\"\n              variant=\"contained\"\n              endIcon=\"userRemove\"\n              @click=\"handleDelete\">\n        {{ $t('Yes') }}\n      </Button>\n      <Button type=\"button\"\n              id=\"no\"\n              variant=\"text\"\n              color=\"white\"\n              @click=\"close\">\n        {{ $t('Cancel') }}\n      </Button>\n    </template>\n\n  </Modal>\n</template>\n","<script setup lang=\"ts\">\nimport {computed, ref, watch} from 'vue';\nimport {useRoute} from 'vue-router';\nimport {useTranslation} from 'i18next-vue';\n\nimport {useQueryClient} from '@tanstack/vue-query';\n\nimport type {ServerLibrary, User} from '@/types/server';\n\nimport useServerClient from '@/lib/clients/useServerClient';\nimport serverClient from '@/lib/clients/serverClient';\n\nimport DashboardLayout from '@/Layout/Desktop/DashboardLayout.vue';\nimport DeleteUserModal from '@/views/Dashboard/System/Users/components/DeleteUserModal.vue';\nimport Button from '@/components/Buttons/Button.vue';\nimport Toggle from '@/components/Forms/Toggle.vue';\nimport useApiClient from '@/lib/clients/useApiClient';\nimport {ServerUser} from '@/types/auth';\nimport Select from '@/components/Forms/Select.vue';\nimport {currentServer} from \"@/store/currentServer\";\n\nconst query = useQueryClient();\n\nconst route = useRoute();\n\nconst {data: libraries} = useServerClient<ServerLibrary[]>({\n  path: '/dashboard/libraries',\n});\n\nconst {data: serverUsers} = useApiClient<ServerUser[]>({\n  path: 'server_users',\n  params: {\n    server_id: currentServer.value?.id,\n  },\n  queryKey: ['server_users'],\n});\n\nconst {data: permissions, error} = useServerClient<User>({\n  path: `dashboard/users/${route.params.id}/permissions`,\n  queryKey: ['userPermissions', route.params.id],\n});\n\nconst name = computed(() => serverUsers.value?.find(u => u.id == route.params.id)?.name);\n\nconst allowed = ref(permissions.value?.allowed);\nconst manage = ref(permissions.value?.manage);\nconst audioTranscoding = ref(permissions.value?.audio_transcoding);\nconst videoTranscoding = ref(permissions.value?.video_transcoding);\nconst noTranscoding = ref(permissions.value?.no_transcoding);\n\nconst allowedAllLibraries = ref(libraries.value?.filter(l => permissions.value?.libraries?.includes(l.id)).length == libraries.value?.length);\nconst allowedLibraries = ref(libraries.value?.filter(l => permissions.value?.libraries?.includes(l.id)));\n\nwatch(permissions, (value) => {\n  allowed.value = value?.allowed;\n  manage.value = value?.manage;\n  audioTranscoding.value = value?.audio_transcoding;\n  videoTranscoding.value = value?.video_transcoding;\n  noTranscoding.value = value?.no_transcoding;\n\n  allowedLibraries.value = libraries.value?.filter(l => value?.libraries?.includes(l.id));\n  allowedAllLibraries.value = libraries.value?.filter(l => value?.libraries?.includes(l.id)).length == libraries.value?.length;\n});\n\nconst deleteConfirmOpen = ref(false);\nconst openDeleteConfirm = () => {\n  deleteConfirmOpen.value = true;\n};\nconst closeDeleteConfirm = () => {\n  deleteConfirmOpen.value = false;\n};\n\nconst handleCancel = () => {\n  window.history.back();\n};\n\nconst handleSave = () => {\n\n  serverClient()\n      .patch<{ message: string, status: string, args: string[] }>(`dashboard/users/${route.params.id}/permissions`, {\n        allowed: allowed.value,\n        manage: manage.value,\n        audio_transcoding: audioTranscoding.value,\n        video_transcoding: videoTranscoding.value,\n        no_transcoding: noTranscoding.value,\n        libraries: allowedLibraries.value?.map(l => l.id),\n      })\n      .then(({data}) => {\n        query.invalidateQueries({queryKey: ['userPermissions', route.params.id]});\n\n        // showNotification({\n        //     title: translate(data.message, ...data.args),\n        //     type: data.status == 'ok'\n        //         ? TYPE.SUCCESS\n        //         : TYPE.ERROR,\n        //     visibleOnly: true,\n        //     duration: 2000,\n        // });\n\n        handleCancel();\n      });\n};\n\nwatch(allowedAllLibraries, value => {\n  if (!value) return;\n  allowedLibraries.value = libraries.value;\n});\n\nwatch(allowedLibraries, value => {\n  if (!libraries.value || !value) return;\n\n  // allowedAllLibraries.value = value.length == libraries.value.length;\n});\n\n</script>\n\n<template>\n\n  <DashboardLayout :error=\"error\" :title=\"`Server member: {{name}}`\"\n                   :params=\"{ name }\" :back=\"true\">\n    <template v-slot:cta>\n    </template>\n\n    <div v-if=\"permissions\" class=\"mt-4 flex w-full flex-col sm:w-1/2\">\n      <h3 class=\"mt-4 mb-2\">{{ $t('Base permissions') }}:</h3>\n      <div class=\"flex flex-col gap-2\">\n        <label for=\"allowed\"\n               class=\"pointer-events-auto inline-flex h-10 w-full touch-none items-center group\"\n               data-selected=\"true\">\n          <Toggle v-if=\"allowed != undefined\"\n                  id=\"allowed\"\n                  label=\"Manage\"\n                  v-model=\"allowed\"\n                  class=\"mr-2\"/>\n          <span class=\"whitespace-pre-wrap text-sm font-semibold text-contrast\">\n\t{{ $t('Allow this user to access content') }}\n\t</span>\n        </label>\n        <label for=\"manage\"\n               class=\"pointer-events-auto inline-flex h-10 w-full touch-none items-center group\"\n               data-selected=\"true\">\n          <Toggle v-if=\"manage != undefined\"\n                  id=\"manage\"\n                  label=\"Manage\"\n                  v-model=\"manage\"\n                  class=\"mr-2\"/>\n          <span class=\"whitespace-pre-wrap text-sm font-semibold text-contrast\">\n\t{{ $t('Allow this user to manage the server') }}\n\t</span>\n        </label>\n      </div>\n      <h3 class=\"mt-4 mb-2\">{{ $t('Media playback') }}:</h3>\n      <div class=\"flex w-full flex-col gap-2\">\n        <label for=\"audioTranscoding\"\n               class=\"pointer-events-auto inline-flex h-10 w-full touch-none items-center group\"\n               data-selected=\"true\">\n          <Toggle v-if=\"audioTranscoding != undefined\"\n                  id=\"audioTranscoding\"\n                  label=\"AudioTranscoding\"\n                  v-model=\"audioTranscoding\"\n                  class=\"mr-2\"/>\n          <span class=\"whitespace-pre-wrap text-sm font-semibold text-contrast\">\n\t{{ $t('Allow audio playback that requires transcoding') }}\n\t</span>\n        </label>\n        <label for=\"videoTranscoding\"\n               class=\"pointer-events-auto inline-flex h-10 w-full touch-none items-center group\"\n               data-selected=\"true\">\n          <Toggle v-if=\"videoTranscoding != undefined\"\n                  id=\"videoTranscoding\"\n                  label=\"VideoTranscoding\"\n                  v-model=\"videoTranscoding\"\n                  class=\"mr-2\"/>\n          <span class=\"whitespace-pre-wrap text-sm font-semibold text-contrast\">\n\t{{ $t('Allow video playback that requires transcoding') }}\n\t</span>\n        </label>\n      </div>\n      <h3 class=\"mt-4 mb-2\">{{ $t('Library Access') }}:</h3>\n      <div class=\"flex w-1/2 flex-col gap-2\">\n        <label for=\"allowedAllLibraries\"\n               class=\"pointer-events-auto inline-flex h-10 w-full touch-none items-center group\"\n               data-selected=\"true\">\n          <Toggle v-if=\"allowedAllLibraries != undefined\"\n                  id=\"allowedAllLibraries\"\n                  label=\"AllowedAllLibraries\"\n                  v-model=\"allowedAllLibraries\"\n                  class=\"mr-2\"/>\n          <span class=\"whitespace-pre-wrap text-sm font-semibold text-contrast\">\n\t{{ $t('Enable access to all libraries') }}\n\t</span>\n        </label>\n\n        <Select\n            v-if=\"!allowedAllLibraries\"\n            id=\"libraries\"\n            label=\"libraries\"\n            placeholder=\"Select libraries\"\n            multiple\n            :items=\"libraries\"\n            optionLabel=\"title\"\n            v-model=\"allowedLibraries\"\n        />\n      </div>\n    </div>\n\n    <template v-slot:actions>\n      <Button type=\"button\"\n              id=\"yes\"\n              variant=\"text\"\n              class=\"mr-auto\"\n              color=\"text-auto-alpha-11\"\n              startIcon=\"userDelete\"\n              @click=\"openDeleteConfirm\">\n        {{ $t('Remove user') }}\n      </button>\n      <Button type=\"button\"\n              id=\"cancel\"\n              variant=\"text\"\n              color=\"white\"\n              @click=\"handleCancel\">\n        {{ $t('Cancel') }}\n      </Button>\n      <Button type=\"button\"\n              id=\"save\"\n              color=\"theme\"\n              @click=\"handleSave\">\n        {{ $t('Save') }}\n      </button>\n    </template>\n\n    <DeleteUserModal\n        v-if=\"permissions?.id\"\n        :id=\"permissions?.id\"\n        :name=\"permissions?.name\"\n        :close=\"closeDeleteConfirm\"\n        :open=\"deleteConfirmOpen\"\n    />\n  </DashboardLayout>\n</template>\n\n<style scoped>\n\n</style>\n"],"names":["props","__props","t","useTranslation","query","useQueryClient","errorBucket","ref","handleDelete","apiClient","_a","currentServer","route","useRoute","libraries","useServerClient","serverUsers","useApiClient","permissions","error","name","computed","_b","u","allowed","manage","_c","audioTranscoding","_d","videoTranscoding","_e","noTranscoding","_f","allowedAllLibraries","_g","l","_h","allowedLibraries","_i","watch","value","deleteConfirmOpen","openDeleteConfirm","closeDeleteConfirm","handleCancel","handleSave","serverClient","data"],"mappings":"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"}