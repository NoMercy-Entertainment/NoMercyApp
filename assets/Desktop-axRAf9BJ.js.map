{"version":3,"file":"Desktop-axRAf9BJ.js","sources":["../../src/views/Base/Watch/Desktop.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, ref, watch } from 'vue';\nimport { IonPage, isPlatform, onIonViewDidEnter } from '@ionic/vue';\n\nimport { currentServer } from '@/store/currentServer';\nimport { user } from '@/store/user';\nimport { setDisableScreensaver } from '@/store/imageModal';\nimport { isNative } from '@/config/global';\n\nimport type {\n  NMPlayer,\n  PlaylistItem,\n  PlayerConfig\n} from '@/lib/VideoPlayer';\nimport {\n  nmplayer,\n  OctopusPlugin,\n  DesktopUIPlugin,\n  KeyHandlerPlugin,\n  SyncPlugin,\n  AutoSkipPlugin\n} from '@/lib/VideoPlayer';\nimport router from '@/router';\nimport audioPlayer from '@/store/audioPlayer';\n\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\nimport useServerClient from \"@/lib/clients/useServerClient\";\n\nconst { data, isError } = useServerClient<PlaylistItem[]>({\n\n});\n\ninterface MyNmPlayer extends NMPlayer {\n  showInProduction: () => boolean;\n  getPlaylistItem: () => PlaylistItem & {\n    tmdb_id: number,\n    special_id: number,\n    video_type: string,\n    video_id: number;\n  };\n}\n\nconst player = ref<MyNmPlayer>();\nconst playerContainer = ref<HTMLDivElement>();\n\nconst initPlayer = (value: PlaylistItem[] | undefined) => {\n\n  const config: PlayerConfig = {\n    muted: false,\n    controls: false,\n    preload: 'auto',\n    debug: false,\n    autoPlay: true,\n    playlist: value?.filter(item => !!item.id) ?? [],\n    controlsTimeout: 3000,\n    doubleClickDelay: 500,\n    playbackRates: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n    ],\n    accessToken: user.value?.accessToken,\n    basePath: currentServer.value?.serverBaseUrl,\n    forceTvMode: (isPlatform('android') || isPlatform('ios')) && !isPlatform('mobile'),\n    disableTouchControls: false,\n    disableMediaControls: 'mediaSession' in navigator || isPlatform('capacitor'),\n    renderAhead: 100,\n  }\n\n  player.value?.dispose();\n\n  // @ts-ignore\n  player.value = nmplayer('player1')\n    .setup(config);\n\n  player.value?.once('back', () => {\n    router.back();\n  });\n\n  const desktopUIPlugin = new DesktopUIPlugin();\n  player.value?.registerPlugin('desktopUI', desktopUIPlugin);\n  player.value?.usePlugin('desktopUI');\n\n  const autoSkipPlugin = new AutoSkipPlugin();\n  player.value?.registerPlugin('autoSkip', autoSkipPlugin);\n  player.value?.usePlugin('autoSkip');\n\n  const keyHandlerPlugin = new KeyHandlerPlugin();\n  player.value?.registerPlugin('keyHandler', keyHandlerPlugin);\n  player.value?.usePlugin('keyHandler');\n\n  const syncPlugin = new SyncPlugin();\n  player.value?.registerPlugin('sync', syncPlugin);\n  player.value?.usePlugin('sync');\n\n  const octopusPlugin = new OctopusPlugin();\n  player.value?.registerPlugin('octopus', octopusPlugin);\n  player.value?.usePlugin('octopus');\n\n  // const sabrePlugin = new SabrePlugin();\n  // player.value?.registerPlugin('sabre', sabrePlugin);\n  // player.value?.usePlugin('sabre');\n\n  player.value?.once('play', () => {\n    player.value?.enterFullscreen();\n  });\n\n  player.value?.on('playlistComplete', () => {\n    player.value?.dispose();\n    router.back();\n  });\n\n  player.value?.once('back', () => {\n  });\n\n  player.value?.on('play', () => {\n    setDisableScreensaver(true);\n  });\n\n  player.value?.on('pause', () => {\n    setDisableScreensaver(false);\n  });\n\n  player.value?.on('ready', () => {\n\n    audioPlayer.stop();\n\n    const observer = new MutationObserver(mutationList =>\n      mutationList.filter(m => m.type === 'childList').forEach(m => {\n        m.addedNodes.forEach(node => {\n          if (node instanceof HTMLElement) {\n            if (node.tagName === 'VIDEO') {\n              console.log('video removed');\n            }\n          }\n        });\n      }));\n\n    const videoElement = player.value?.getVideoElement();\n    if (videoElement) {\n      observer.observe(videoElement, { childList: true, subtree: true });\n    }\n  });\n\n  player.value?.on('item', () => {\n    player.value?.play();\n  });\n}\n\nwatch(data, (value) => {\n  initPlayer(value);\n});\n\nonMounted(() => {\n  initPlayer(data.value);\n});\n\nonUnmounted(() => {\n  player.value?.dispose();\n  setDisableScreensaver(false);\n});\n</script>\n\n<template>\n  <ion-page>\n    <NotFound v-if=\"isError\" />\n    <Teleport v-else to=\"body\" :keepAlive=\"true\">\n      <div ref=\"playerContainer\" class=\"absolute inset-0 flex h-full w-full overflow-clip bg-black z-1199\" :class=\"{\n        'mb-28': isNative,\n        'mb-0': !isNative,\n      }\">\n        <div id=\"player1\" class=\"group nomercyplayer\"></div>\n      </div>\n    </Teleport>\n  </ion-page>\n</template>\n"],"names":["data","isError","useServerClient","player","ref","playerContainer","initPlayer","value","config","item","_a","user","_b","currentServer","isPlatform","_c","nmplayer","_d","router","desktopUIPlugin","DesktopUIPlugin","_e","_f","autoSkipPlugin","AutoSkipPlugin","_g","_h","keyHandlerPlugin","KeyHandlerPlugin","_i","_j","syncPlugin","SyncPlugin","_k","_l","octopusPlugin","OctopusPlugin","_m","_n","_o","_p","_q","_r","setDisableScreensaver","_s","_t","audioPlayer","observer","mutationList","m","node","videoElement","_u","watch","onMounted","onUnmounted"],"mappings":"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"}