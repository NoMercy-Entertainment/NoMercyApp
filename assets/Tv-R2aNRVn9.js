import{d as r}from"./api-BBofn2cc.js";import{$ as V,d as n,f as S,w as f,c as w,o as c,p as g,z as j,a0 as y,av as A,h as i,j as t,x as o,b as x,b9 as B,as as M}from"./vue-ionic-9j_oSDCB.js";import{bv as q,bw as k,L as z,z as l,bx as L,r as b,by as F}from"./index-CyQIzsKG.js";import"./vendor-Dgtccx1h.js";import"./media-C2AqgyMX.js";import"./icons-BW5E66pf.js";import"./swiper-D00Cnjmx.js";import"./music-player-CxG_wAnH.js";import"./primevue-BfjCwqou.js";import"./rxjs-BCp2L9Rn.js";const H={key:0,class:"flex h-screen w-screen flex-nowrap items-center justify-between gap-4 overflow-hidden p-24 text-slate-light-12 dark:text-slate-dark-12 bg-slate-light-3 dark:bg-slate-dark-1"},I={class:"flex w-2/3 flex-col gap-4 font-semibold"},Q={class:"text-3xl"},R={class:"flex items-start gap-4"},D={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},E={class:"flex flex-col gap-2 text-lg"},K={class:"text-2xl font-semibold whitespace-break-spaces"},P={class:"flex items-start gap-4"},Y={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},G={class:"flex flex-col gap-2 text-lg"},J={class:"grid w-1/3 place-items-center gap-4 p-4 font-semibold"},O=["src"],U={key:1,class:"grid h-screen w-screen place-items-center"},W={role:"status"},ie=V({__name:"Tv",setup(X){const T=n(`https://${l?`${l.replace("-","")}.`:""}nomercy.tv/tv`),p=n(""),$=n(!1),d=n(!1),C=n("L"),N=n("canvas"),s=n();S(async()=>{try{await q(),k();const{isAuthenticated:e}=z();e.value=!0}catch{r.post(`https://auth${l}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/auth/device`,{client_id:"nomercy-ui",scope:"openid profile email",cancelToken:new r.CancelToken(a=>a("Cancel repeated request"))},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(a=>{s.value=a.data,d.value=!0}).catch(a=>{console.log(a)})}}),f(s,e=>{e&&(console.log(e),setTimeout(()=>{u()},e.interval*1e3))});function u(){var e;r.post(`https://auth${l}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/token`,{grant_type:"urn:ietf:params:oauth:grant-type:device_code",client_id:"nomercy-ui",scope:"openid",device_code:(e=s.value)==null?void 0:e.device_code},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(async a=>{L(a.data),k(),setTimeout(async()=>{await b.push({name:"Home"})},500)}).catch(()=>{setTimeout(()=>{u()},s.value.interval*1e3)})}return f(F,e=>{e.length!==0&&setTimeout(async()=>{await b.push({name:"Home"})},1e3)}),(e,a)=>(c(),w(y(M),null,{default:g(()=>[j(y(A),{fullscreen:!0},{default:g(()=>{var h,m,v,_;return[d.value&&((h=s.value)!=null&&h.user_code)&&!$.value?(c(),i("div",H,[t("div",I,[t("h1",Q,o(e.$t("Follow these steps on your computer or mobile device")),1),t("div",R,[t("span",D,o(e.$t("Step"))+" 1",1),t("div",E,[t("p",null,o(e.$t("Scan the QR with your phone or go to"))+":",1),t("p",K,o(T.value)+"?code="+o((m=s.value)==null?void 0:m.user_code),1)])]),t("div",P,[t("span",Y,o(e.$t("Step"))+" 2",1),t("div",G,[t("p",null,o(e.$t("Sign in to NoMercy"))+".",1),t("p",null,o(e.$t("Your tv will be ready to watch"))+".",1)])])]),t("div",J,[(v=s.value)!=null&&v.verification_uri_complete?(c(),w(B,{key:0,level:C.value,"render-as":N.value,size:250,value:(_=s.value)==null?void 0:_.verification_uri_complete,class:"bg-white p-1"},null,8,["level","render-as","value"])):x("",!0),p.value?(c(),i("img",{key:1,src:p.value,alt:"",class:"bg-white p-1"},null,8,O)):x("",!0)])])):(c(),i("div",U,[t("div",W,[t("span",null,o(e.$t("Loading"))+"...",1)])]))]}),_:1})]),_:1}))}});export{ie as default};
