import{C as h,Et as p,J as l,O as f,Q as R,S as _,T as w,Tt as k,X as q,c as S,ct as s,g as A,gt as m,j as x,k as v,kt as d}from"./i18n-Cs-AFcrY.js";import"./ionic-XwZpO7IE.js";import"./vue-core-CKeWI2Kt.js";import{C as T}from"./primevue-DNc5dNs0.js";import"./query-28IwY2wK.js";import{Ji as C,Ki as M,_i as r,n as N,qi as b}from"./index-CVHcgxb0.js";import"./useInfiniteServerClient-XKPGm8OI.js";import{t as j}from"./useServerClient-CrO6998q.js";import"./ScrollContainer-S0oCUCKT.js";import"./useMounted-DpOUPlkZ.js";import"./RipperOverlay-BA1kWUDt.js";import"./ripperSocket-O7Z73wBO.js";import"./FloatingBackButton-CkDR4UTG.js";import{t as K}from"./DashboardLayout-B7gSrvtf.js";import{t as V}from"./DashboardCard-llvq_FR7.js";S();var z={class:"relative flex aspect-video flex-shrink-0 flex-grow-0 flex-col items-center justify-center self-stretch overflow-clip rounded-lg bg-theme-8"},F={key:1,class:"text-xl font-bold text-center"},J=x({__name:"LibraryCard",props:{data:{type:Object,required:!0}},setup(a){return(t,u)=>(l(),h(V,{line1:a.data.title,line2:a.data.folder_library&&a.data.folder_library?.length!==1?`${a.data.folder_library?.length} folders`:`${a.data.folder_library?.length}  folder`,route:`/dashboard/libraries/${a.data.id}`},{image:s(()=>[_("div",z,[u[0]||(u[0]=_("div",{class:"backdropCard-overlay"},null,-1)),a.data.image?(l(),h(N,{key:0,path:a.data.image,aspect:"backdrop",class:"z-0"},null,8,["path"])):(l(),w("span",F,d(a.data.title),1))])]),_:1},8,["line1","line2","route"]))}}),O=J;S();var Q=x({__name:"Desktop",setup(a){const t=T(),{data:u,error:E}=j({path:"dashboard/libraries",queryKey:["dashboard","libraries",C.value?.serverBaseUrl]}),o=m(!1);async function B(){if(!o.value){o.value=!0;try{const{data:e}=await b().post("dashboard/libraries");t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3}),M.invalidateQueries({queryKey:["dashboard","libraries",C.value?.serverBaseUrl]})}catch{t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while creating the library"),life:5e3})}finally{o.value=!1}}}const i=m(!1);function L(){i.value=!0,b().post("dashboard/libraries/refresh").then(({data:e})=>{i.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{i.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}const n=m(!1);function $(){n.value=!0,b().post("dashboard/libraries/scan-new").then(({data:e})=>{n.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{n.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the library folders"),life:5e3})})}const y=m(!1);function D(){y.value=!0,b().post("dashboard/libraries/rescan").then(({data:e})=>{y.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{y.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}return(e,U)=>{const c=R("Button");return l(),h(K,{error:k(E),"grid-style":1,description:"Manage your media libraries and their content here.",title:"Libraries"},{cta:s(()=>[v(c,{id:"newLibrary",disabled:o.value,color:"theme","start-icon":"folderAdd",onClick:B},{default:s(()=>[f(d(o.value?e.$t("Creating..."):e.$t("New library")),1)]),_:1},8,["disabled"])]),actions:s(()=>[v(c,{id:"refresh",class:p(i.value?"first:children:animate-spin cursor-not-allowed":""),disabled:i.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:L},{default:s(()=>[f(d(e.$t("Refresh all libraries")),1)]),_:1},8,["class","disabled"]),v(c,{id:"missing",class:p(n.value?"first:children:animate-spin !cursor-not-allowed":""),disabled:n.value,color:"auto","start-icon":"folderSwap",type:"button",variant:"text",onClick:$},{default:s(()=>[f(d(e.$t("Find missing")),1)]),_:1},8,["class","disabled"]),v(c,{id:"rescan",class:p(i.value?"first:children:animate-spin cursor-not-allowed":""),disabled:i.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:D},{default:s(()=>[f(d(e.$t("Rescan all libraries")),1)]),_:1},8,["class","disabled"])]),default:s(()=>[(l(!0),w(A,null,q(k(u)??[],g=>(l(),h(O,{key:g.id,data:g},null,8,["data"]))),128))]),_:1},8,["error"])}}}),oe=Q;export{oe as default};
