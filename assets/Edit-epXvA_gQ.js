import{I as E,l as u,d,o as i,s as n,a as t,q as p,t as l,j as $,dt as P,R as K,Z as j,du as F,C as I,w as S,c as Y,b as m,K as h,O as Z,dv as D}from"./index-C1DjUpiP.js";import{u as R}from"./useQueryClient-OkkyraFc.js";import{u as L}from"./useServerClient-BNYfM5AW.js";import{_ as z}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-sbqi96AA.js";import{u as G}from"./index-BZgGgbsZ.js";import{_ as H}from"./Modal.vue_vue_type_script_setup_true_lang-D6j5IQAY.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-Ca6MTiOR.js";import{T as V}from"./Toggle-CVGKCDpI.js";import{u as J}from"./useApiClient-BudL2Pjh.js";import{_ as W}from"./Select.vue_vue_type_script_setup_true_lang-BIloIyo3.js";import"./useQuery-8YWJGe_9.js";import"./useBaseQuery-juBGMRNQ.js";import"./useInfiniteServerClient-ARVV4sGq.js";import"./useMounted-DH0cmQgY.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-B1Y7jSwy.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-D4l8g0_V.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-PwHXwbTN.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-C476dfdo.js";import"./ripperSocket-Vx1l3iJq.js";import"./Shadow-CAKQBv9t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./listbox-BGdFZBKy.js";import"./render-xTELsP8z.js";const X={class:"my-6 text-sm text-auto-10"},ee=E({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const g=v,{t:c}=G(),q=R(),o=u([]);function x(){if(!g.id){o.value.push({type:"error",place:"email",message:c("Email is required")});return}P().post("server/server-users",{_method:"delete",id:K.value?.id,user_id:g.id}).then(()=>{q.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),g.close()}return(s,T)=>(i(),d(H,{open:v.open,close:v.close,params:{name:v.name},title:"Delete server member {{name}}"},{actions:n(()=>[$(C,{id:"yes",type:"button",color:"red",variant:"contained","end-icon":"userRemove",onClick:x},{default:n(()=>[p(l(s.$t("Yes")),1)]),_:1}),$(C,{id:"no",type:"button",variant:"text",color:"white",onClick:v.close},{default:n(()=>[p(l(s.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:n(()=>[t("p",X,[p(l(s.$t("Are you sure you want to delete this server member?")),1),T[0]||(T[0]=t("br",null,null,-1)),p(" "+l(s.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),ae={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},te={class:"mt-4 mb-2"},se={class:"flex flex-col gap-2"},le={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},oe={class:"whitespace-pre-wrap text-sm font-semibold"},re={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ie={class:"whitespace-pre-wrap text-sm font-semibold"},ne={class:"mt-4 mb-2"},ue={class:"flex w-full flex-col gap-2"},de={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},me={class:"whitespace-pre-wrap text-sm font-semibold"},ce={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},pe={class:"whitespace-pre-wrap text-sm font-semibold"},ve={class:"mt-4 mb-2"},fe={class:"flex w-1/2 flex-col gap-2"},be={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},he={class:"whitespace-pre-wrap text-sm font-semibold"},Pe=E({__name:"Edit",setup(v){const g=R(),c=j(),q=F(),{data:o}=L({path:"/dashboard/libraries"}),{data:x}=J({path:"server/server-users",params:{id:K.value?.id},queryKey:["server_users"]}),{data:s,error:T}=L({path:`dashboard/users/${c.params.id}/permissions`,queryKey:["userPermissions",c.params.id]}),M=I(()=>x.value?.find(e=>e.id===c.params.id)?.name),y=u(s.value?.allowed),w=u(s.value?.manage),_=u(s.value?.audio_transcoding),k=u(s.value?.video_transcoding),B=u(s.value?.no_transcoding),f=u(o.value?.filter(e=>s.value?.libraries?.includes(e.id)).length===o.value?.length),b=u(o.value?.filter(e=>s.value?.libraries?.includes(e.id)));S(s,e=>{y.value=e?.allowed,w.value=e?.manage,_.value=e?.audio_transcoding,k.value=e?.video_transcoding,B.value=e?.no_transcoding,b.value=o.value?.filter(a=>e?.libraries?.includes(a.id)),f.value=o.value?.filter(a=>e?.libraries?.includes(a.id)).length===o.value?.length});const A=u(!1);function N(){A.value=!0}function Q(){A.value=!1}function U(){window.history.back()}function O(){Z().patch(`dashboard/users/${c.params.id}/permissions`,{allowed:y.value,manage:w.value,audio_transcoding:_.value,video_transcoding:k.value,no_transcoding:B.value,libraries:b.value?.map(e=>e.id)}).then(({data:e})=>{g.invalidateQueries({queryKey:["userPermissions",c.params.id]}),q.add({severity:e.status==="ok"?"success":"error",summary:D(e.status==="ok"?"Success":"Error"),detail:D(e.message,...e.args),life:5e3}),U()})}return S(f,e=>{e&&(b.value=o.value)}),S(b,e=>{o.value}),(e,a)=>(i(),d(z,{error:h(T),title:"Server member: {{name}}",params:{name:M.value},back:!0},{cta:n(()=>[...a[6]||(a[6]=[])]),actions:n(()=>[$(C,{id:"yes",type:"button",variant:"text",class:"mr-auto",color:"auto-alpha","start-icon":"userDelete",onClick:N},{default:n(()=>[p(l(e.$t("Remove user")),1)]),_:1}),$(C,{id:"cancel",type:"button",variant:"text",color:"white",onClick:U},{default:n(()=>[p(l(e.$t("Cancel")),1)]),_:1}),$(C,{id:"save",type:"button",color:"theme",onClick:O},{default:n(()=>[p(l(e.$t("Save")),1)]),_:1})]),default:n(()=>[h(s)?(i(),Y("div",ae,[t("h3",te,l(e.$t("Base permissions"))+": ",1),t("div",se,[t("label",le,[y.value!==void 0?(i(),d(V,{key:0,id:"allowed",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=r=>y.value=r),label:"Manage",class:"mr-2"},null,8,["modelValue"])):m("",!0),t("span",oe,l(e.$t("Allow this user to access content")),1)]),t("label",re,[w.value!==void 0?(i(),d(V,{key:0,id:"manage",modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=r=>w.value=r),label:"Manage",class:"mr-2"},null,8,["modelValue"])):m("",!0),t("span",ie,l(e.$t("Allow this user to manage the server")),1)])]),t("h3",ne,l(e.$t("Media playback"))+": ",1),t("div",ue,[t("label",de,[_.value!==void 0?(i(),d(V,{key:0,id:"audioTranscoding",modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=r=>_.value=r),label:"AudioTranscoding",class:"mr-2"},null,8,["modelValue"])):m("",!0),t("span",me,l(e.$t("Allow audio playback that requires transcoding")),1)]),t("label",ce,[k.value!==void 0?(i(),d(V,{key:0,id:"videoTranscoding",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=r=>k.value=r),label:"VideoTranscoding",class:"mr-2"},null,8,["modelValue"])):m("",!0),t("span",pe,l(e.$t("Allow video playback that requires transcoding")),1)])]),t("h3",ve,l(e.$t("Library Access"))+": ",1),t("div",fe,[t("label",be,[f.value!==void 0?(i(),d(V,{key:0,id:"allowedAllLibraries",modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=r=>f.value=r),label:"AllowedAllLibraries",class:"mr-2"},null,8,["modelValue"])):m("",!0),t("span",he,l(e.$t("Enable access to all libraries")),1)]),f.value?m("",!0):(i(),d(W,{key:0,id:"libraries",modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=r=>b.value=r),label:"libraries",placeholder:"Select libraries",multiple:"",items:h(o),"option-label":"title"},null,8,["modelValue","items"]))])])):m("",!0),h(s)?.id?(i(),d(ee,{key:1,id:h(s)?.id,name:h(s)?.name,close:Q,open:A.value},null,8,["id","name","open"])):m("",!0)]),_:1},8,["error","params"]))}});export{Pe as default};
