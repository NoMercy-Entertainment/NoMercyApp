import{C as f,Ct as m,Dt as n,Et as A,K as r,L,O as N,S as s,T as d,U,Y as x,_ as I,c as w,it as b,j as E,k as F,mt as $,ot as j,rt as G,w as C,wt as D,x as l}from"./i18n-Rm1NkeNf.js";import{U as K,W as P}from"./vue-core-D-3YrIBp.js";import{t as _}from"./signalr-BrWheOh-.js";import{Bn as Q,Ci as W,F as q,Fi as Y,I as J,Ii as X,L as R,Pi as Z,R as ee,Vn as te,pt as ae,qi as c,xa as V,y as se}from"./index-CfsKRNvN.js";import{t as oe}from"./useServerClient-BncyklEm.js";import{t as re}from"./ScrollContainer-BE4_rHEJ.js";import{t as ne}from"./useMounted-A4MEnwHg.js";import{i as le,t as ie}from"./RipperOverlay-DHAc6fBk.js";import{t as ce}from"./FloatingBackButton-DyM5ctnn.js";w();var t=$();const Ne=l(()=>t.value?.connection),u=$(!1);function y(){u.value=!0,document.dispatchEvent(new Event("dashboardHub-connected")),t.value?.connection&&(R(t.value?.connection,"Dashboard Hub"),J(t.value?.connection))}function i(a){u.value=!1,console.log("Disconnected from Dashboard SignalR",a),document.dispatchEvent(new Event("dashboardHub-disconnected"))}function z(a){u.value=!1,console.error("Dashboard SignalR Error:",a),document.dispatchEvent(new Event("dashboardHub-error"))}b(c,async a=>{const o=V.value?.accessToken;a&&u.value&&(t.value?.connection?.stop().then(),t.value?.dispose(),t.value=new q(c.value.serverBaseUrl,o,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",i),await M().catch(z))});async function M(){if(t.value?.connection?.state!==_.Connected)return t.value?.connection?.start().then(y)}async function ue(){try{return t.value?.connection?.state===_.Disconnected?void 0:t.value?.connection?.stop().then(i).catch(i)}catch(a){console.error("Error stopping Dashboard SignalR:",a),i()}}async function H(){const a=V.value?.accessToken;c.value&&(!t.value?.connection?.state||t.value?.connection?.state===_.Disconnected)&&(t.value=new q(c.value.serverBaseUrl,a,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",i),await M().catch(z),t.value?.connection?.onreconnecting(o=>{console.log("SignalR Disconnected.",o?.message),ee(t.value.connection,"Dashboard Hub"),i()}),t.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),R(t.value.connection,"Dashboard Hub"),y()}))}w();K();var de=E({__name:"HelpButton",setup(a){const o=P(),v=l(()=>`https://docs${W}.nomercy.tv${o.path.replace(/\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/gu,"")}`);return(g,k)=>(r(),f(se,{id:"help",href:v.value,variant:"text",component:"link",target:"_blank",color:"auto","start-icon":"messageBubbleQuestion",class:"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5"},{default:j(()=>[N(n(g.$t("Help")),1)]),_:1},8,["href"]))}}),fe=de;w();var ve={key:0,class:"grid h-full w-full place-items-center text-surface-12"},he={class:"relative flex items-center justify-start gap-8 overflow-hidden"},pe={class:"relative flex w-full flex-col gap-4"},me={class:"text-7xl font-bold text-center"},xe={class:"left-0 text-2xl text-center whitespace-pre-line"},ye=["data-music"],ge=["inert"],be={class:"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-surface-8/11 xl:px-6"},we={class:"relative flex h-full flex-col items-start justify-center gap-1"},_e={class:"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold"},ke={key:1,class:"hidden w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex text-surface-12/12"},Se={class:"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row"},Be={key:0,class:"grid h-full w-full place-items-center"},Ce={class:"relative flex flex-col items-center justify-start gap-8 overflow-hidden"},De={class:"relative flex w-full flex-col gap-4"},He={class:"text-7xl font-bold text-center"},Ee={class:"left-0 text-2xl text-center whitespace-pre-line"},$e={key:2,class:"mt-auto bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-surface-8/11 empty:hidden sm:h-16 xl:px-6"},je=E({__name:"DashboardLayout",props:L({title:{type:String,required:!0},params:{type:Object,required:!1},description:{type:String,required:!1},gridStyle:{type:Number,required:!1,default:0},back:{type:Boolean,required:!1,default:!1},error:{type:Object,required:!1},allowAnyone:{type:Boolean,required:!1,default:!1},styles:{type:String,required:!1}},{modelValue:{required:!1,type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const o=a,v=G(a,"modelValue"),{dataUpdatedAt:g,error:k,isPending:O}=oe({path:"dashboard/server",enabled:!o.allowAnyone,refetchInterval:1e4,queryKey:["dashboard","server",u.value]}),T=l(()=>o.gridStyle===1?Y.value:o.gridStyle===2?X.value:o.gridStyle===3?Z.value:o.gridStyle===4?"flex flex-wrap h-available":"flex flex-wrap h-available overflow-clip"),h=l(()=>{if(o.allowAnyone)return null;const e=k.value;if(e?.response?.status!==200)return{code:e?.response?.data?.status??null,message:e?.response?.data?.detail??""}}),p=l(()=>{const e=o.error;if(console.log(e),!(!e?.response||e?.response?.status===200))return{code:e?.response?.status,message:e?.response?.data?.detail??""}}),S=l(()=>(h.value?.code||O.value)&&!o.allowAnyone);return U(()=>{te(null),Q(null)}),ne(H,ue,20),b(S,e=>{e&&v.value!==void 0&&(v.value=!1)}),b(g,e=>{e&&!u.value&&H()}),(e,B)=>(r(),f(I,null,[S.value?(r(),d("div",ve,[s("div",he,[s("div",pe,[s("p",me,n(h.value?.code?h.value?.code:"Offline"),1),s("p",xe,n(h.value?.message),1)])])])):(r(),d("div",{key:1,class:D([{"min-h-[92vh] music-showing:min-h-[85vh] sm:min-h-[85.75vh] music-showing:sm:min-h-[92.75vh] children-not-first:mt-20":!e.$slots.cta,"min-h-[92vh] music-showing:min-h-[92vh] sm:min-h-[82.1vh] music-showing:sm:min-h-[82.1vh] children-not-first:mt-20":!!e.$slots.cta},"flex flex-col relative z-0 flex-1 h-available overflow-clip items-start justify-start self-stretch w-available text-surface-12"]),"data-music":m(ae)},[s("div",{inert:m(le),class:"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch"},[B[0]||(B[0]=s("div",{class:"absolute inset-0 z-0 h-full w-full"},null,-1)),s("div",be,[s("div",we,[s("p",_e,n(e.$t(a.title,a.params)),1),a.back?(r(),f(ce,{key:0,class:"left-4 -mt-1.5",position:"relative"})):(r(),d("p",ke,n(e.$t(a.description??"")),1))]),x(e.$slots,"title"),s("div",Se,[F(fe),x(e.$slots,"cta")])])],8,ge),p.value?(r(),d("div",Be,[s("div",Ce,[s("div",De,[s("p",He,n(p.value.code),1),s("p",Ee,n(p.value.message),1)])])])):(r(),f(re,{key:1,static:!0,class:"z-0 w-full flex-1 overflow-y-auto overflow-x-hidden pt-2 sm:p-4",frame:""},{default:j(()=>[s("div",{class:D([T.value,"h-auto w-full flex-wrap content-start gap-4 flex-1"]),style:A(a.styles)},[x(e.$slots,"default")],6)]),_:3})),!p.value&&e.$slots.actions?(r(),d("div",$e,[x(e.$slots,"actions")])):C("",!0),m(c)?.is_owner||m(c)?.is_manager?(r(),f(ie,{key:3})):C("",!0)],10,ye))],1024))}}),Ue=je;export{Ne as n,u as r,Ue as t};
