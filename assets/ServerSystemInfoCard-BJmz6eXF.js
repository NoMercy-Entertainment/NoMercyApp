import{t as R}from"./useQuery-BZZbL5T1.js";import{As as r,Ds as D,Jo as S,Ms as T,Ns as j,Ps as L,Tr as E,Ui as G,Us as h,Vs as Q,Ys as y,ac as U,as as B,cs as g,fs as N,hs as C,ls as u,m as H,nc as c,oc as a,os as e,ps as x,rc as V,ri as X,sr as M,ss as f,ts as z,wr as $,xa as Y,za as W}from"./index-DHmO9d-Y.js";import{t as A}from"./_plugin-vue_export-helper-CksOYaUN.js";import{t as d}from"./OptimizedIcon-BsR4mq_7.js";import{t as Z}from"./KeepCounting-DjdPibLP.js";import{t as F}from"./card--SR8fflu.js";import{t as K}from"./useServerClient-4jd4Xj-7.js";import{s as I}from"./RipperOverlay-CiaWRqXv.js";import{n as q,r as O}from"./DashboardLayout-CieD9zJ6.js";S();W();var ee={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch w-full pt-1 text-surface-12"},te={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},ae={class:"flex-grow text-xl font-medium"},se={class:"ml-auto flex gap-2 text-surface-12 bg-surface-12/2"},le={key:1,class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch text-surface-12"},re={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},ie={class:"flex-grow text-xl font-medium"},ne={class:"ml-auto flex gap-2 bg-surface-12/2"},oe=C({__name:"ServerSystemCard",props:{title:{type:String,required:!0},background:{type:Boolean,required:!1,default:!0}},setup(t){return(l,o)=>c(G)&&c(O)?(r(),f(c(Y),{key:0},{default:h(()=>[e("div",ee,[e("div",te,[e("p",ae,a(l.$t(t.title)),1),e("div",se,[j(l.$slots,"cta")])]),e("div",{class:V([{" bg-surface-5/6 text-surface-11 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[j(l.$slots,"default")],2)])]),_:3})):c(O)?(r(),u("div",le,[e("div",re,[e("p",ie,a(l.$t(t.title)),1),e("div",ne,[j(l.$slots,"cta")])]),e("div",{class:V([{"bg-surface-12/3 text-surface-12/12 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[j(l.$slots,"default")],2)])):g("",!0)}}),P=oe;S();var de={class:"relative flex w-full items-center justify-center gap-0.5 text-surface-12"},ue=["title"],ce={class:"flex-shrink-0 flex-grow-0 text-right text-xs font-light text-surface-10"},fe={class:"relative flex items-start justify-start gap-2 group/encoderCard"},ve={key:0,class:"relative aspect-video h-auto w-1/3 flex-shrink-0 flex-grow-0 overflow-hidden rounded-sm min-w-36",style:{background:`linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 0) 25%,
            rgba(0, 0, 0, 0) 50%,
            #000 100%
          )`}},xe={class:"absolute inset-0 z-0 h-full w-full bg-white/[0.01] flex flex-col justify-center"},he=["src"],me={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px]"},pe={class:"absolute z-10 flex items-end justify-start left-[3%] bottom-[3%] gap-[2%]"},ge={class:"absolute z-10 flex items-end justify-end right-[3%] bottom-[3%] gap-[2%] text-[10px]"},_e={class:"group-hover/progress:hidden text-right font-bold monospace"},we={class:"grid grid-cols-4 gap-2 flex-1"},be={class:"flex flex-col text-surface-12 col-span-4"},ke={class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},ye={class:"text-surface-12/11"},$e={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Se={class:"text-surface-12/11 text-2xs"},Ce={key:1,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},je={class:"font-medium text-2xs text-surface-12/11"},Ie={class:"flex flex-nowrap gap-4 flex-shrink-0 flex-grow-0 self-stretch text-sm"},qe={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Te={class:"w-full text-xs text-surface-10 line-clamp-1"},ze=["title"],Ne={class:"w-full text-xs text-surface-10 line-clamp-1"},Ee=["title"],Be={class:"w-full text-xs text-surface-10 line-clamp-1"},Pe={key:0,class:"absolute -bottom-0.5 left-0 h-1 w-full blur-[1px]"},Ue=C({__name:"ServerEncoderTaskCard",props:{data:{type:Object,required:!0}},setup(t){const l=t,o=y(l.data?.status);Q(l,s=>{o.value=s.data.status});const _=B(()=>o.value==="running"?"running":"paused"),m=B(()=>l.data.thumbnails?`${`${E.value?.serverBaseUrl}\\${l.data.thumbnails}`.replace(/\\+/gu,"/").replace(/\/\/images/u,"/images")}?token=${X.value.accessToken}`:null);function i(){$().post(`/dashboard/tasks/pause/${l.data.process_id}`).then(({data:s})=>{o.value=s?"paused":o.value}).catch(()=>{})}function w(){$().post(`/dashboard/tasks/resume/${l.data.process_id}`).then(({data:s})=>{o.value=s?"running":o.value}).catch(()=>{})}function b(){o.value==="running"?i():w()}return(s,k)=>(r(),f(c(F),{class:"relative overflow-clip"},{title:h(()=>[e("div",de,[e("p",{title:t.data.title.replace(/NoMercy/giu,""),class:"w-full flex-grow text-sm font-semibold line-clamp-1 h-6"},a(t.data.title.replace(/NoMercy/giu,"")),9,ue),e("p",ce,a(s.$t("Id"))+": "+a(t.data?.process_id),1)])]),content:h(()=>[e("div",fe,[t.data?.message==="Encoding video"?(r(),u("div",ve,[e("div",xe,[k[0]||(k[0]=e("div",{class:"pointer-events-none absolute inset-0 z-10 mt-auto h-4/5 bg-gradient-to-t from-black via-black/60"},null,-1)),m.value?(r(),u("img",{key:0,src:m.value,alt:"",class:"absolute z-0 h-full w-full"},null,8,he)):g("",!0)]),e("button",{class:"absolute top-1/2 left-1/2 z-10 group-hover/encoderCard:flex hidden h-11 w-11 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/60 p-0.5 group/progress text-white flex flex-col",onClick:b},[e("div",me,[_.value==="running"?(r(),f(d,{key:0,class:"w-10",icon:"pause"})):(r(),f(d,{key:1,class:"w-10",icon:"play"}))])]),e("div",pe,[t.data?.has_gpu?(r(),f(d,{key:0,"class-name":"w-[15%]",icon:"gpu"})):(r(),f(d,{key:1,"class-name":"w-[15%]",icon:"cpu"})),t.data?.is_hdr?(r(),f(d,{key:2,"class-name":"w-[15%]",icon:"hdr"})):(r(),f(d,{key:3,"class-name":"w-[15%]",icon:"hdrOff"}))]),e("div",ge,[e("span",_e,a(Math.floor(t.data?.progress??0))+"% ",1)])])):g("",!0),e("div",we,[e("div",be,[e("span",ke,[x(d,{"class-name":"relative w-4",icon:"stickyNote"}),e("span",ye,a(t.data?.message),1)]),t.data?.message==="Encoding video"?(r(),u("span",$e,[x(d,{"class-name":"relative w-4",icon:"dashboard"}),e("span",Se,a(t.data?.speed)+"X ",1)])):g("",!0),t.data?.message==="Encoding video"?(r(),u("span",Ce,[x(d,{"class-name":"relative w-4",icon:"hourglass"}),e("span",je,a(t.data?.remaining_split?.[0]&&t.data?.remaining_split[0]>0?` ${t.data?.remaining_split?.[0]+s.$t("d")} `:"")+" "+a(t.data?.remaining_split?.[1]&&(t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[1]+s.$t("h")} `:"")+" "+a(t.data?.remaining_split?.[2]&&(t.data?.remaining_split[2]>0||t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[2]+s.$t("m")} `:"")+" "+a(t.data?.remaining_split?.[3]?` ${t.data?.remaining_split?.[3]+s.$t("s")} `:""),1)])):g("",!0),e("div",Ie,[t.data?.video_streams&&t.data?.message==="Encoding video"?(r(),u("span",qe,[x(d,{"class-name":"w-4",icon:"film"}),e("span",Te,a(t.data?.video_streams.length),1)])):g("",!0),t.data?.audio_streams&&t.data?.message==="Encoding video"?(r(),u("div",{key:1,title:t.data?.audio_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[x(d,{"class-name":"w-4",icon:"audioFile"}),e("span",Ne,a(t.data?.audio_streams.length),1)],8,ze)):g("",!0),t.data?.subtitle_streams&&t.data?.message==="Encoding video"?(r(),u("div",{key:2,title:t.data?.subtitle_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[x(d,{"class-name":"w-4",icon:"chatBubble"}),e("span",Be,a(t.data?.subtitle_streams.length),1)],8,Ee)):g("",!0)])])])]),t.data?.message==="Encoding video"?(r(),u("div",Pe,[k[1]||(k[1]=e("div",{class:"absolute w-full h-1 left-[-1px] top-[-1px] bg-black/[0.22]"},null,-1)),e("div",{style:U(`width: ${t.data.progress}%;`),class:"w-0 h-1 absolute left-[-1px] top-[-1px] rounded-sm bg-gradient-to-r from-black/5 to-[var(--color-theme-8)] z-10"},null,4),e("div",{style:U(`left: ${t.data.progress}%;`),class:"w-1 h-0.5 absolute top-[-1px] rounded-sm bg-[#f1eefe] -translate-x-[2px] z-0"},null,4)])):g("",!0)]),_:1}))}}),Ve=Ue;S();var Me={class:"flex flex-nowrap w-full justify-between"},Oe={class:"text-surface-12"},De={class:"flex flex-col text-surface-12"},Qe={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Ae={class:"text-surface-12/11"},Fe={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm flex justify-between"},Ke={class:"mr-auto"},Je={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Re={class:"text-surface-12/11"},Le={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Ge={class:"text-surface-12/11"},He=C({__name:"ServerQueueTaskCard",props:{data:{type:Object,required:!0}},setup(t){const l=t,o=y(l.data.priority??0);function _(i){$().patch(`/dashboard/tasks/queue/${l.data.id}`,{id:l.data.id,priority:i}).then(()=>{console.log("Priority updated")})}function m(){$().delete(`/dashboard/tasks/queue/${l.data.id}`).then(()=>{console.log("Item deleted")})}return Q(o,i=>{console.log(i),_(i)}),(i,w)=>{const b=L("InputNumber");return r(),f(c(F),null,{title:h(()=>[e("span",Me,[e("span",Oe,a(t.data.title.replace(/NoMercy/giu,"")),1),e("button",{class:"float-right flex items-center justify-center gap-2 overflow-hidden rounded-lg bg-transparent w-10 -mt-1.5 -mr-1.5 aspect-square",onClick:m},[x(d,{class:"relative h-5 w-5 flex-shrink-0 flex-grow-1",icon:"cross"})])])]),content:h(()=>[e("div",De,[e("p",Qe,[N(a(i.$t("Id"))+": ",1),e("span",Ae,a(t.data.id),1)]),e("span",Fe,[e("span",Ke,a(i.$t("Priority"))+": ",1),x(b,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=s=>o.value=s),max:100,min:0,step:1,class:"ml-auto h-8 first:children:!w-12 last:children:!w-4 children:last:children:!w-4 overflow-clip -mb-2","show-buttons":"",size:"small",variant:"filled"},null,8,["modelValue"])]),e("span",Je,[N(a(i.$t("Profile"))+": ",1),e("span",Re,a(t.data.profile),1)]),e("span",Le,[N(a(i.$t("File"))+": ",1),e("span",Ge,a(t.data.input_file),1)])])]),_:1})}}}),Xe=A(He,[["__scopeId","data-v-a1b0a34e"]]);S();var Ye={class:"flex-shrink-0 flex-grow-0 text-sm"},We={class:"relative flex items-start justify-start gap-2 self-stretch rounded-lg p-4 text-surface-11 bg-surface-12/2"},Ze={class:"flex-shrink-0 flex-grow-0 self-stretch text-sm font-semibold"},et=C({__name:"ServerTasksCard",setup(t){const l=y([]),o=y(!1),{data:_,refetch:m}=K({path:"dashboard/tasks/queue",queryKey:["queue"],refetchInterval:3e4});D(()=>{l.value=[]});function i(n){n.status==="running"||n.status==="paused"?l.value=M([...l.value.filter(v=>v?.id!==n?.id),n],"id"):(l.value=M([...l.value.filter(v=>v?.id!==n?.id)],"id"),m())}const w=B(()=>{const n=_.value?.filter(v=>!l.value.find(p=>p.id===v.payload_id))??[];return o.value||n.length<=20?n:[...n.slice(0,5),...n.slice(-5)]});function b(n){_.value=n}function s(){l.value=[],m()}function k(){o.value=!o.value}return I(q,"encoder-progress",i),I(q,"encoder-queue",b),I(q,"encoder-clear",s),I(q,"disconnected",s),(n,v)=>l.value.length||c(_)?.length?(r(),f(P,{key:0,background:!1,title:"Running tasks"},{cta:h(()=>[e("button",{class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11",onClick:k},[e("p",Ye,a(o.value?n.$t("Show less"):n.$t("Show all")),1)])]),default:h(()=>[(r(!0),u(z,null,T(l.value.toSorted((p,J)=>p.title.localeCompare(J.title))??[],p=>(r(),f(Ve,{key:p.id,data:p},null,8,["data"]))),128)),(r(!0),u(z,null,T(w.value,p=>(r(),f(Xe,{key:p.id,data:p},null,8,["data"]))),128))]),_:1})):(r(),f(P,{key:1,background:!1,title:"Running tasks"},{default:h(()=>[e("div",We,[e("span",Ze,a(n.$t("No tasks are currently running")),1)])]),_:1}))}}),Ut=et;S();var tt={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},at={class:"flex-shrink-0 flex-grow-0 text-sm"},st={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},lt={class:"flex-shrink-0 flex-grow-0 text-sm"},rt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},it={class:"w-40 flex-grow whitespace-nowrap text-sm"},nt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},ot={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},dt={class:"w-40 flex-grow whitespace-nowrap text-sm"},ut={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},ct={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},ft={class:"w-40 flex-grow whitespace-nowrap text-sm"},vt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},xt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},ht={class:"w-40 flex-grow whitespace-nowrap text-sm"},mt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},pt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},gt={class:"w-40 flex-grow whitespace-nowrap text-sm"},_t={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},wt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},bt={class:"w-40 flex-grow whitespace-nowrap text-sm"},kt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},yt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},$t={class:"w-40 flex-grow whitespace-nowrap text-sm"},St={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},Ct=C({__name:"ServerSystemInfoCard",setup(t){const l=y(!1),o=y(!0),{data:_,refetch:m}=R({queryKey:["runners",E.value?.serverBaseUrl],retryOnMount:!0,queryFn:()=>$().get("dashboard/tasks/runners").then(({data:s})=>(l.value=!(s.workers>0),s.workers??[]))}),{data:i}=K({path:"dashboard/server/info",queryKey:["serverInfo",E.value?.serverBaseUrl]});function w(){o.value=!0,m()}function b(){o.value=!1}return D(()=>{const s=H();s?.onreconnected(w),s?.onclose(b)}),(s,k)=>(r(),f(P,{title:"System"},{cta:h(()=>[e("button",tt,[x(d,{class:"w-4",icon:"pause"}),e("p",at,a(s.$t("Pause")),1)]),e("button",st,[x(d,{class:"w-4",icon:"shutdown"}),e("p",lt,a(s.$t("Shutdown")),1)])]),default:h(()=>[e("div",rt,[e("p",it,a(s.$t("Server")),1),e("p",nt,a(c(i)?.server),1)]),e("div",ot,[e("p",dt,a(s.$t("Server version")),1),e("p",ut,a(c(i)?.version),1)]),e("div",ct,[e("p",ft,a(s.$t("Uptime")),1),e("p",vt,[(r(),f(Z,{key:c(i)?.bootTime,"start-time":c(i)?.bootTime},null,8,["start-time"]))])]),e("div",xt,[e("p",ht,a(s.$t("OS")),1),e("p",mt,a(c(i)?.os.toTitleCase()),1)]),e("div",pt,[e("p",gt,a(s.$t("Architecture")),1),e("p",_t,a(c(i)?.arch),1)]),(r(!0),u(z,null,T(c(i)?.cpu,(n,v)=>(r(),u("div",wt,[e("p",bt,a(s.$t("CPU"))+" #"+a(v+1),1),e("p",kt,a(n),1)]))),256)),(r(!0),u(z,null,T(c(i)?.gpu,(n,v)=>(r(),u("div",yt,[e("p",$t,a(s.$t("GPU"))+" #"+a(v+1),1),e("p",St,a(n),1)]))),256))]),_:1}))}}),Vt=A(Ct,[["__scopeId","data-v-8c76d6fe"]]);export{Ut as n,P as r,Vt as t};
