import{C as d,Ct as y,Dt as r,K as n,O as p,S as t,T as W,c as K,it as B,j as N,k as x,mt as i,n as Y,ot as u,w as m,x as z}from"./i18n-fABvX7Av.js";import"./ionic-DIYphHxf.js";import{U as G,W as H}from"./vue-core-hXf_Oh5G.js";import{C as I}from"./primevue-C3smGU9Q.js";import"./dist-CJipjyJM.js";import{c as R}from"./query-BsKzQ1i8.js";import"./esm-D1nPlPuN.js";import{Ki as J,k as Q,mn as X,qi as O,vi as D,x as Z,y as T}from"./index-BLaXrj-1.js";import{t as $}from"./Toggle-C2bkxIuK.js";import"./useInfiniteServerClient--tepFmQf.js";import{t as M}from"./useServerClient-CAFkyL_G.js";import"./ScrollContainer-BIdMCThA.js";import"./useMounted-C90o8FQQ.js";import"./RipperOverlay-p0PnoXvu.js";import"./ripperSocket-DEMNDAP4.js";import"./FloatingBackButton-XFPn3Z70.js";import{t as ee}from"./Select-_l82afTQ.js";import{t as ae}from"./DashboardLayout-3oFUJA9r.js";import{t as te}from"./useApiClient-Ca5DSwVE.js";G();K();var le={class:"my-6 text-sm text-surface-10"},re=N({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(f){const h=f,{t:v}=Y(),q=R(),l=i(!1),S=i([]);async function s(){if(!h.id){S.value.push({type:"error",place:"email",message:v("Email is required")});return}if(!l.value){l.value=!0;try{await X().post("server/server-users",{_method:"delete",id:O.value?.id,user_id:h.id}),await q.invalidateQueries({queryKey:["server_users"]}),h.close(),Q.back()}catch{l.value=!1}}}return(c,A)=>(n(),d(Z,{close:f.close,open:f.open,params:{name:f.name},style:{"max-width":"36rem"},title:"Delete server member {{name}}"},{actions:u(()=>[x(T,{id:"yes",disabled:l.value,color:"red","end-icon":"userRemove",type:"button",variant:"contained",onClick:s},{default:u(()=>[p(r(l.value?c.$t("Deleting..."):c.$t("Yes")),1)]),_:1},8,["disabled"]),x(T,{id:"no",disabled:l.value,color:"white",type:"button",variant:"text",onClick:f.close},{default:u(()=>[p(r(c.$t("Cancel")),1)]),_:1},8,["disabled","onClick"])]),default:u(()=>[t("p",le,[p(r(c.$t("Are you sure you want to delete this server member?")),1),A[0]||(A[0]=t("br",null,null,-1)),p(" "+r(c.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["close","open","params"]))}}),se=re;K();var oe={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2 px-1"},ie={class:"mt-4 mb-2"},ne={class:"flex flex-col gap-2"},ue={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowed"},de={class:"whitespace-pre-wrap text-sm font-semibold"},me={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"manage"},ve={class:"whitespace-pre-wrap text-sm font-semibold"},ce={class:"mt-4 mb-2"},pe={class:"flex w-full flex-col gap-2"},fe={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"audioTranscoding"},be={class:"whitespace-pre-wrap text-sm font-semibold"},_e={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"videoTranscoding"},ye={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ge={class:"flex w-1/2 flex-col gap-2"},we={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowedAllLibraries"},ke={class:"whitespace-pre-wrap text-sm font-semibold"},Ce=N({__name:"Edit",setup(f){const h=R(),v=H(),q=I(),{data:l}=M({path:"/dashboard/libraries"}),{data:S}=te({path:"server/server-users",params:{id:O.value?.id},queryKey:["server_users"]}),{data:s,error:c}=M({path:`dashboard/users/${v.params.id}/permissions`,queryKey:["userPermissions",v.params.id]}),A=z(()=>S.value?.find(e=>e.user_id===v.params.id)?.name),g=i(s.value?.allowed),w=i(s.value?.manage),k=i(s.value?.audio_transcoding),C=i(s.value?.video_transcoding),L=i(s.value?.no_transcoding),b=i(l.value?.filter(e=>s.value?.libraries?.includes(e.id)).length===l.value?.length),_=i(l.value?.filter(e=>s.value?.libraries?.includes(e.id)));B(s,e=>{g.value=e?.allowed,w.value=e?.manage,k.value=e?.audio_transcoding,C.value=e?.video_transcoding,L.value=e?.no_transcoding,_.value=l.value?.filter(a=>e?.libraries?.includes(a.id)),b.value=l.value?.filter(a=>e?.libraries?.includes(a.id)).length===l.value?.length});const U=i(!1);function P(){U.value=!0}function j(){U.value=!1}function E(){Q.back()}const V=i(!1);async function F(){if(!V.value){V.value=!0;try{const{data:e}=await J().patch(`dashboard/users/${v.params.id}/permissions`,{allowed:g.value,manage:w.value,audio_transcoding:k.value,video_transcoding:C.value,no_transcoding:L.value,libraries:_.value?.map(a=>a.id)});h.invalidateQueries({queryKey:["userPermissions",v.params.id]}),q.add({severity:e.status.toLowerCase(),summary:D(e.status),detail:D(e.message,...e.args),life:5e3}),E()}catch{q.add({severity:"error",summary:D("Error"),detail:D("An error occurred while saving permissions"),life:5e3})}finally{V.value=!1}}}return B(b,e=>{e&&(_.value=l.value)}),B(_,e=>{l.value}),(e,a)=>(n(),d(ae,{back:!0,error:y(c),params:{name:A.value},title:"Server member: {{name}}"},{cta:u(()=>[...a[6]||(a[6]=[])]),actions:u(()=>[x(T,{id:"yes",class:"mr-auto",color:"auto","start-icon":"userDelete",type:"button",variant:"text",onClick:P},{default:u(()=>[p(r(e.$t("Remove user")),1)]),_:1}),x(T,{id:"cancel",color:"white",type:"button",variant:"text",onClick:E},{default:u(()=>[p(r(e.$t("Cancel")),1)]),_:1}),x(T,{id:"save",disabled:V.value,color:"theme",type:"button",onClick:F},{default:u(()=>[p(r(V.value?e.$t("Saving..."):e.$t("Save")),1)]),_:1},8,["disabled"])]),default:u(()=>[y(s)?(n(),W("div",oe,[t("h3",ie,r(e.$t("Base permissions"))+": ",1),t("div",ne,[t("label",ue,[g.value!==void 0?(n(),d($,{key:0,id:"allowed",modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=o=>g.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),t("span",de,r(e.$t("Allow this user to access content")),1)]),t("label",me,[w.value!==void 0?(n(),d($,{key:0,id:"manage",modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=o=>w.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),t("span",ve,r(e.$t("Allow this user to manage the server")),1)])]),t("h3",ce,r(e.$t("Media playback"))+": ",1),t("div",pe,[t("label",fe,[k.value!==void 0?(n(),d($,{key:0,id:"audioTranscoding",modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=o=>k.value=o),class:"mr-2",label:"AudioTranscoding"},null,8,["modelValue"])):m("",!0),t("span",be,r(e.$t("Allow audio playback that requires transcoding")),1)]),t("label",_e,[C.value!==void 0?(n(),d($,{key:0,id:"videoTranscoding",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=o=>C.value=o),class:"mr-2",label:"VideoTranscoding"},null,8,["modelValue"])):m("",!0),t("span",ye,r(e.$t("Allow video playback that requires transcoding")),1)])]),t("h3",he,r(e.$t("Library Access"))+": ",1),t("div",ge,[t("label",we,[b.value!==void 0?(n(),d($,{key:0,id:"allowedAllLibraries",modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=o=>b.value=o),class:"mr-2",label:"AllowedAllLibraries"},null,8,["modelValue"])):m("",!0),t("span",ke,r(e.$t("Enable access to all libraries")),1)]),b.value?m("",!0):(n(),d(ee,{key:0,id:"libraries",modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=o=>_.value=o),items:y(l),label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","items"]))])])):m("",!0),y(s)?.id?(n(),d(se,{key:1,id:y(s)?.id,close:j,name:y(s)?.name,open:U.value},null,8,["id","name","open"])):m("",!0)]),_:1},8,["error","params"]))}}),je=Ce;export{je as default};
