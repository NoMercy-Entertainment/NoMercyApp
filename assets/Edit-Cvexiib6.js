import"./useInfiniteServerClient-CUj8KMRn.js";import{t as E}from"./useQueryClient-ku998Trb.js";import{t as H}from"./Select-CzSOCE2q.js";import{$l as S,$o as Y,A as Z,Cl as j,Dl as C,El as v,Hl as i,Ks as z,O as $,R as M,Sl as m,Sr as G,Zi as B,bc as I,bl as l,es as K,hu as _,kl as R,ll as N,su as u,tu as n,xl as d,yc as J,yl as W,yu as s}from"./index-DhiB0zJh.js";import{n as X}from"./dist-T5InuRf4.js";import"./baseeditableholder-Cbt-dKWA.js";import{t as V}from"./Toggle-BjjErFCE.js";import{t as L}from"./useServerClient-CjjHYevH.js";import"./ScrollContainer-BChm2UQW.js";import"./useMounted-DIlhaTne.js";import"./RipperOverlay-CS_l6bBd.js";import"./ripperSocket-DXm9aE1r.js";import"./FloatingBackButton-L9653aMO.js";import{t as ee}from"./DashboardLayout-kueOC_Na.js";import{t as ae}from"./useApiClient-4-pV83Ku.js";J();N();var le={class:"my-6 text-sm text-surface-10"},te=R({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(p){const h=p,{t:c}=X(),A=E(),r=u([]);function T(){if(!h.id){r.value.push({type:"error",place:"email",message:c("Email is required")});return}G().post("server/server-users",{_method:"delete",id:K.value?.id,user_id:h.id}).then(()=>{A.invalidateQueries({queryKey:["server_users"]}).then(()=>{M.back()})}),h.close()}return(t,x)=>(i(),d(Z,{close:p.close,open:p.open,params:{name:p.name},style:{"max-width":"36rem"},title:"Delete server member {{name}}"},{actions:n(()=>[C($,{id:"yes",color:"red","end-icon":"userRemove",type:"button",variant:"contained",onClick:T},{default:n(()=>[v(s(t.$t("Yes")),1)]),_:1}),C($,{id:"no",color:"white",type:"button",variant:"text",onClick:p.close},{default:n(()=>[v(s(t.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:n(()=>[l("p",le,[v(s(t.$t("Are you sure you want to delete this server member?")),1),x[0]||(x[0]=l("br",null,null,-1)),v(" "+s(t.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["close","open","params"]))}}),se=te;N();var re={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2 px-1"},oe={class:"mt-4 mb-2"},ie={class:"flex flex-col gap-2"},ne={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowed"},ue={class:"whitespace-pre-wrap text-sm font-semibold"},de={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"manage"},me={class:"whitespace-pre-wrap text-sm font-semibold"},ce={class:"mt-4 mb-2"},ve={class:"flex w-full flex-col gap-2"},pe={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"audioTranscoding"},fe={class:"whitespace-pre-wrap text-sm font-semibold"},be={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"videoTranscoding"},_e={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ye={class:"flex w-1/2 flex-col gap-2"},ge={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowedAllLibraries"},we={class:"whitespace-pre-wrap text-sm font-semibold"},ke=R({__name:"Edit",setup(p){const h=E(),c=I(),A=z(),{data:r}=L({path:"/dashboard/libraries"}),{data:T}=ae({path:"server/server-users",params:{id:K.value?.id},queryKey:["server_users"]}),{data:t,error:x}=L({path:`dashboard/users/${c.params.id}/permissions`,queryKey:["userPermissions",c.params.id]}),Q=W(()=>T.value?.find(e=>e.user_id===c.params.id)?.name),y=u(t.value?.allowed),g=u(t.value?.manage),w=u(t.value?.audio_transcoding),k=u(t.value?.video_transcoding),D=u(t.value?.no_transcoding),f=u(r.value?.filter(e=>t.value?.libraries?.includes(e.id)).length===r.value?.length),b=u(r.value?.filter(e=>t.value?.libraries?.includes(e.id)));S(t,e=>{y.value=e?.allowed,g.value=e?.manage,w.value=e?.audio_transcoding,k.value=e?.video_transcoding,D.value=e?.no_transcoding,b.value=r.value?.filter(a=>e?.libraries?.includes(a.id)),f.value=r.value?.filter(a=>e?.libraries?.includes(a.id)).length===r.value?.length});const q=u(!1);function O(){q.value=!0}function P(){q.value=!1}function U(){M.back()}function F(){Y().patch(`dashboard/users/${c.params.id}/permissions`,{allowed:y.value,manage:g.value,audio_transcoding:w.value,video_transcoding:k.value,no_transcoding:D.value,libraries:b.value?.map(e=>e.id)}).then(({data:e})=>{h.invalidateQueries({queryKey:["userPermissions",c.params.id]}),A.add({severity:e.status.toLowerCase(),summary:B(e.status),detail:B(e.message,...e.args),life:5e3}),U()})}return S(f,e=>{e&&(b.value=r.value)}),S(b,e=>{r.value}),(e,a)=>(i(),d(ee,{back:!0,error:_(x),params:{name:Q.value},title:"Server member: {{name}}"},{cta:n(()=>[...a[6]||(a[6]=[])]),actions:n(()=>[C($,{id:"yes",class:"mr-auto",color:"auto","start-icon":"userDelete",type:"button",variant:"text",onClick:O},{default:n(()=>[v(s(e.$t("Remove user")),1)]),_:1}),C($,{id:"cancel",color:"white",type:"button",variant:"text",onClick:U},{default:n(()=>[v(s(e.$t("Cancel")),1)]),_:1}),C($,{id:"save",color:"theme",type:"button",onClick:F},{default:n(()=>[v(s(e.$t("Save")),1)]),_:1})]),default:n(()=>[_(t)?(i(),j("div",re,[l("h3",oe,s(e.$t("Base permissions"))+": ",1),l("div",ie,[l("label",ne,[y.value!==void 0?(i(),d(V,{key:0,id:"allowed",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),l("span",ue,s(e.$t("Allow this user to access content")),1)]),l("label",de,[g.value!==void 0?(i(),d(V,{key:0,id:"manage",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=o=>g.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),l("span",me,s(e.$t("Allow this user to manage the server")),1)])]),l("h3",ce,s(e.$t("Media playback"))+": ",1),l("div",ve,[l("label",pe,[w.value!==void 0?(i(),d(V,{key:0,id:"audioTranscoding",modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=o=>w.value=o),class:"mr-2",label:"AudioTranscoding"},null,8,["modelValue"])):m("",!0),l("span",fe,s(e.$t("Allow audio playback that requires transcoding")),1)]),l("label",be,[k.value!==void 0?(i(),d(V,{key:0,id:"videoTranscoding",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=o=>k.value=o),class:"mr-2",label:"VideoTranscoding"},null,8,["modelValue"])):m("",!0),l("span",_e,s(e.$t("Allow video playback that requires transcoding")),1)])]),l("h3",he,s(e.$t("Library Access"))+": ",1),l("div",ye,[l("label",ge,[f.value!==void 0?(i(),d(V,{key:0,id:"allowedAllLibraries",modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=o=>f.value=o),class:"mr-2",label:"AllowedAllLibraries"},null,8,["modelValue"])):m("",!0),l("span",we,s(e.$t("Enable access to all libraries")),1)]),f.value?m("",!0):(i(),d(H,{key:0,id:"libraries",modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=o=>b.value=o),items:_(r),label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","items"]))])])):m("",!0),_(t)?.id?(i(),d(se,{key:1,id:_(t)?.id,close:P,name:_(t)?.name,open:q.value},null,8,["id","name","open"])):m("",!0)]),_:1},8,["error","params"]))}}),Re=ke;export{Re as default};
