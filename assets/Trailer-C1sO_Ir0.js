import{$ as H,At as x,C,Dt as z,Et as m,K as X,S as n,T,Y as g,Z as Y,_t as $,c as L,g as G,h as W,j as q,k,kt as P,lt as S,n as K,q as N,st as O,w as I}from"./i18n-DXLa9EKW.js";import{b as Z,y as J}from"./vue-core-DBpBuPMK.js";import{Sr as Q,W as ee,an as V,b as E,gt as te,n as B,s as U}from"./index-CLM6Y7vI.js";import{a as R,i as ae,t as le}from"./sidebar-LHAvD8Rt.js";import{r as j}from"./swiper-DkXT2e8s.js";import{t as re}from"./Carousel-B9m9x-iy.js";import{t as ie}from"./Select-CpJk9CML.js";import{a as se,i as oe,r as ne,t as ue}from"./VideoPlayer-i9bG4_oF.js";L();J();var de=/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([\w-]{11})/,ce=/^[\w-]{11}$/,w="https://trailer.nomercy.tv",ve=1e4,fe=30;function F(e){const t=e.match(de);return t?t[1]:ce.test(e)?e:null}function me(e){return e.filter(t=>F(t.src)).sort((t,o)=>{const a=t.name?.toLowerCase().includes("trailer")?1:0,d=o.name?.toLowerCase().includes("trailer")?1:0;if(d!==a)return d-a;const l=t.type?.toLowerCase()==="trailer"?1:0,i=o.type?.toLowerCase()==="trailer"?1:0;return i!==l?i-l:(o.size??0)!==(t.size??0)?(o.size??0)-(t.size??0):(o.official?1:0)-(t.official?1:0)})}function A(e){return e.map((t,o)=>({id:o+1,file:t.url.startsWith("http")?t.url:`${w}${t.url}`,kind:"subtitles",language:t.language,label:t.label}))}function Oe(e){const t=$("idle"),o=$(!1),a=$(null);let d=null,l=null;function i(){d?.abort(),d=null,l&&(clearInterval(l),l=null)}async function _(u,s,b,h){try{let r=await(await fetch(`${w}/${s}?v=${Date.now()}`,{signal:b})).json().catch(()=>null);if(!r?.success)return!1;if(r.data.cached&&r.data.duration===0&&r.data.width===0&&r.data.height===0){const f=await(await fetch(`${w}/${s}?revalidate=1&v=${Date.now()}`,{signal:b})).json().catch(()=>null);f?.success&&(r=f)}const y=(r.data.title&&r.data.title!==s?r.data.title:h).replace(/\\\s*/g,"/").trim();return r.data.cached?(a.value={videoId:s,videoUrl:`${w}${r.data.downloadUrl}?v=${Date.now()}`,thumbnailUrl:`${w}/${s}/${s}.jpg`,title:y,subtitles:A(r.data.subtitles??[]),sourceVideo:u},t.value="available",!0):r.data.processing?(t.value="processing",await c(u,s,b,h)):r.status==="queued"?(t.value="queued",await c(u,s,b,h)):!1}catch{return!1}}function c(u,s,b,h){return new Promise(r=>{let y=0;l=setInterval(async()=>{if(b.aborted){clearInterval(l),l=null,r(!1);return}if(y++,y>=fe){clearInterval(l),l=null,r(!1);return}try{const f=await(await fetch(`${w}/${s}?v=${Date.now()}`,{signal:b})).json().catch(()=>null);f?.success&&f.data.cached?(clearInterval(l),l=null,a.value={videoId:s,videoUrl:`${w}${f.data.downloadUrl}?v=${Date.now()}`,thumbnailUrl:`${w}/${s}/${s}.jpg`,title:(f.data.title&&f.data.title!==s?f.data.title:h).replace(/\\\s*/g,"/").trim(),subtitles:A(f.data.subtitles??[]),sourceVideo:u},t.value="available",r(!0)):f?.success&&(f.data.processing||f.status==="processing")&&(t.value="processing")}catch{}},ve)})}async function p(){i();const u=e.value;if(!u?.videos||u.videos.length===0){t.value="unavailable";return}const s=me(u.videos);if(s.length===0){t.value="unavailable";return}t.value="validating",d=new AbortController;const{signal:b}=d,h=u.title??u.name??"";for(const r of s){if(b.aborted)return;const y=F(r.src);if(y&&await _(r,y,b,`${r.name?.toLowerCase().includes(h.toLowerCase())?"":`${h} - `}${r.name}`))return}b.aborted||(t.value="unavailable")}function v(u){if(u?.stopPropagation(),!a.value)return;o.value=!o.value;const s=document.querySelector("#main");s&&(s.style.overflow=o.value?"hidden":"auto")}function D(){o.value=!1;const u=document.querySelector("#main");u&&(u.style.overflow="auto")}return O(e,()=>{a.value=null,p()},{immediate:!0}),Z(()=>{i()}),N(()=>{i()}),{buttonState:t,trailerOpen:o,resolvedTrailer:a,toggleTrailer:v,closeTrailer:D,validate:p}}L();var be={class:"relative mb-1 h-auto w-full overflow-clip rounded-t-md group-focus-visible/season:rounded-b-none group-hover/season:rounded-b-none aspect-backdrop bg-surface-12/12"},ge={class:"transitioning hover:scale-110 text-white/12",style:{"--stroke-width":"1"}},pe={key:0,class:"absolute bottom-0 left-0 z-40 mb-3 w-full px-3"},he=["id"],we=["id"],ye={class:"grid w-full items-stretch gap-1 rounded-b-md p-2 transitioning text-left"},_e=["title"],xe=["title"],ke={class:"relative mb-1 h-auto w-full overflow-clip rounded-t-md group-focus-visible/season:rounded-b-none group-hover/season:rounded-b-none aspect-backdrop bg-surface-1"},$e={class:"transitioning hover:scale-110",style:{"--stroke-width":"1"}},Ce={key:0,class:"absolute bottom-0 left-0 z-40 mb-3 w-full px-3"},Se=["id"],Te=["id"],ze={class:"grid w-full items-stretch gap-1 rounded-b-md p-2 transitioning text-left"},Pe=["title"],Ue=["title"],Le=q({__name:"SeasonCard",props:{data:{type:Object,required:!0},suffix:{type:String,required:!1,default:""}},setup(e){const t=Q(e.data?.color_palette?.still);return(o,a)=>{const d=H("RouterLink");return e.data?.id&&e.data?.available?(g(),C(d,{key:0,id:e.data?.id,class:z([{"cursor-pointer":e.data?.available,"cursor-not-allowed":!e.data?.available},"frosting border-0 border-[var(--color-theme-8)] flex flex-col h-auto items-center group/season focus-shift focus-outline transition-all duration-200 overflow-clip relative !rounded-lg select-none shadow-[0px_0px_0_1px_rgb(from_var(--color-theme-8,var(--color-theme-6))_r_g_b/70%)] w-full z-0 bg-surface-2 text-surface-12/90"]),onfocus:m(V)(),style:P(m(t)?`
       --color-theme-8: ${m(t)};
    `:""),to:e.data?.available?e.data.link:"#","data-card":"true"},{default:S(()=>[n("div",be,[k(B,{"color-palette":e.data?.color_palette?.still,path:e.data?.still,size:660,title:e.data?.title,aspect:"backdrop",class:"h-40","class-name":"pointer-events-none absolute z-20 flex h-full w-full select-none object-cover transitioning trickle-div",loading:"lazy",type:"image"},null,8,["color-palette","path","title"]),n("div",{class:z([{hidden:!e.data?.available},"absolute inset-0 z-30 grid w-full place-items-center group-focus-visible/season:bg-black opacity-0 group-focus-visible/season:opacity-100 transitioning group-hover/season:opacity-100 [background:radial-gradient(75%_50%_at_50%_50%,_rgba(0,_0,_0,_0.40)_0%,_rgba(0,_0,_0,_0.00)_100%),_rgba(0,_0,_0,_0.09)]"])},[n("div",ge,[k(E,{"class-name":"w-20",icon:"playCircle",stroke:"1"})])],2),e.data?.progress?(g(),T("div",pe,[n("div",{id:`episode-${e.data?.id}-slider-container`,class:"relative z-40 flex h-1 w-full overflow-clip rounded-full pt-2 pr-8 bg-gray-dark-12"},[n("div",{id:`episode-${e.data?.id}-progress-bar`,style:P({width:e.data?.progress>=99?"100%":`${e.data?.progress}%`}),class:"absolute top-0 left-0 h-full bg-[var(--color-theme-8)]"},null,12,we)],8,he)])):I("",!0)]),n("div",ye,[n("p",{title:`${e.data?.episode_number?`${e.data?.episode_number} - `:""}${e.data?.title}`,class:"z-10 w-auto text-2xs sm:text-sm font-bold !leading-5 h-10 line-clamp-2 sm:line-clamp-1"},x(e.data?.episode_number?`${e.data?.episode_number} - `:"")+x(e.data?.title),9,_e),n("p",{title:e.data?.overview,class:"z-10 h-8 w-auto hidden sm:flex text-xs min-h-8 line-clamp-2 leading-[1.2]"},x(e.data?.overview),9,xe)])]),_:1},8,["id","class","onfocus","style","to"])):e.data?.id?(g(),T("div",{key:1,class:z(`border-0 border-[var(--color-theme-8)] flex flex-col h-auto items-center group/season focus-shift focus-outline transition-all duration-200 overflow-clip relative !rounded-lg select-none shadow-[0px_0px_0_1px_rgb(from_var(--color-theme-8,var(--color-theme-6))_r_g_b/70%)] w-full z-0 bg-surface-1/12 ${e.data?.available?"cursor-pointer":"cursor-not-allowed"}`),style:P(m(t)?`--color-theme-8: ${m(t)};`:""),"data-card":"true",onFocus:a[0]||(a[0]=l=>m(V)())},[n("div",ke,[k(B,{"color-palette":e.data?.color_palette?.still,path:e.data?.still,size:660,title:e.data?.title,aspect:"backdrop",class:"h-40","class-name":"pointer-events-none absolute z-20 flex h-full w-full select-none object-cover transitioning trickle-div",type:"image"},null,8,["color-palette","path","title"]),n("div",{class:z([{hidden:!e.data?.available},"absolute inset-0 z-30 grid w-full place-items-center group-focus-visible/season:bg-black opacity-0 group-focus-visible/season:opacity-100 transitioning group-hover/season:opacity-100 [background:radial-gradient(75%_50%_at_50%_50%,_rgba(0,_0,_0,_0.40)_0%,_rgba(0,_0,_0,_0.00)_100%),_rgba(0,_0,_0,_0.09)]"])},[n("div",$e,[k(E,{"class-name":"w-20",icon:"playCircle",stroke:"1"})])],2),e.data?.progress?(g(),T("div",Ce,[n("div",{id:`episode-${e.data?.id}-slider-container`,class:"relative z-40 flex h-1 w-full overflow-clip rounded-full pt-2 pr-8 bg-gray-dark-12"},[n("div",{id:`episode-${e.data?.id}-progress-bar`,style:P({width:e.data?.progress>=99?"100%":`${e.data?.progress}%`}),class:"absolute top-0 left-0 h-full bg-[var(--color-theme-8)]"},null,12,Te)],8,Se)])):I("",!0)]),n("div",ze,[n("p",{title:`${e.data?.episode_number?`${e.data?.episode_number} - `:""}${e.data?.title}`,class:"z-10 w-auto text-sm font-bold !leading-5 h-10 line-clamp-1"},x(e.data?.episode_number?`${e.data?.episode_number} - `:"")+x(e.data?.title),9,Pe),n("p",{title:e.data?.overview,class:"z-10 h-8 w-auto text-xs min-h-8 line-clamp-2 leading-[1.2]"},x(e.data?.overview),9,Ue)])],38)):I("",!0)}}}),M=Le;L();var De=q({__name:"SeasonCarousel",props:{data:{type:Array,required:!0},type:{type:String,required:!1,default:"poster"},limitCardCountBy:{type:Number,required:!1}},setup(e){const t=e,{t:o}=K();function a(c){}let d=t.data?.findIndex(c=>c.season_number===1);d===-1&&(d=0);const l=t.data?.map((c,p)=>({index:p,id:c.id,name:`${c.season_number} - ${c.title}`,season_number:c.season_number,episodes:c.episodes}))??[],i=$(l[d]);function _(){document.querySelector(".swiper-undefined")?.swiper?.slideTo(0,300)}return O(i,_),(c,p)=>(g(),C(re,{index:i.value.season_number,"limit-card-count-by":e.limitCardCountBy,type:e.type},{selector:S(()=>[k(ie,{id:"season-selector",modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=v=>i.value=v),disabled:m(l).length===1,items:m(l),"option-label":"title",class:"min-w-[21rem] ml-3",label:"",variant:"normal"},null,8,["modelValue","disabled","items"])]),default:S(()=>[i.value.episodes?.length===0?(g(),C(m(j),{key:0,"virtual-index":0,class:"flex sm:p-1 sm:pl-0"},{default:S(()=>[(g(),C(M,{id:"item-0",key:0,data:{id:1,title:m(o)("To be announced"),season_number:null,episode_number:null,available:!1,overview:"",airDate:"",still:"",link:"",color_palette:{still:{darkVibrant:"",lightVibrant:""}},progress:null},onclick:()=>{}},null,8,["data"]))]),_:1})):(g(!0),T(G,{key:1},Y(i.value.episodes,(v,D)=>(g(),C(m(j),{key:v.id,"virtual-index":D,class:"flex sm:p-1 sm:pl-0"},{default:S(()=>[k(M,{id:`item-${v.id}`,data:v,onclick:()=>void 0},null,8,["id","data","onclick"])]),_:2},1032,["virtual-index"]))),128))]),_:1},8,["index","limit-card-count-by","type"]))}}),Fe=De;L();var Ie=["data-music","data-sidebar"],qe=q({__name:"Trailer",props:{resolvedTrailer:{type:Object,required:!0},toggle:{type:Function,required:!0}},setup(e){const t=e,o=$(),a=$();function d(l){const i={muted:!1,controls:!1,preload:"auto",debug:!1,autoPlay:!0,playlist:[{id:l.videoId,file:l.videoUrl,image:l.thumbnailUrl,title:l.title,duration:"",description:"",tracks:l.subtitles,withCredentials:!1}],controlsTimeout:3e3,doubleClickDelay:300,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2]};a.value=ne("trailer").setup(i),a.value?.once("back",()=>{t.toggle()});const _=new oe;a.value?.registerPlugin("desktopUI",_),a.value?.usePlugin("desktopUI");const c=new se;a.value?.registerPlugin("autoSkip",c),a.value?.usePlugin("autoSkip");const p=new ue;a.value?.registerPlugin("keyHandler",p),a.value?.usePlugin("keyHandler"),a.value?.on("playlistComplete",()=>{t.toggle()}),a.value?.on("play",()=>{U(!0)}),a.value?.on("pause",()=>{U(!1)}),a.value?.on("fullscreen",v=>{window.external?.sendMessage?.(v?"enterFullscreen":"exitFullscreen")}),a.value?.on("remove",()=>{t.toggle()}),a.value?.on("error",()=>{t.toggle()}),a.value?.on("close",()=>{t.toggle()}),a.value?.on("captionsChanged",v=>{v.track===-1?localStorage.setItem("trailerSubtitles","off"):localStorage.setItem("trailerSubtitles",v.track)}),a.value?.once("playing",()=>{a.value?.seek(0)}),a.value?.on("play",()=>{localStorage.getItem("trailerSubtitles")==="off"?a.value?.setCurrentCaption(-1):a.value?.setCurrentCaption(Number.parseInt(localStorage.getItem("trailerSubtitles")??"-1",10))})}return X(()=>{ee.stop(),o.value=R.value,U(!0),le(),d(t.resolvedTrailer)}),N(()=>{if(ae(o.value??"open"),U(!1),a.value)try{a.value?.dispose()}catch{}}),(l,i)=>(g(),T("button",{class:"fixed inset-0 h-available w-available overflow-hidden rounded-lg bg-black/50",onClick:i[1]||(i[1]=_=>e.toggle())},[n("div",{"data-music":m(te),"data-sidebar":m(R),class:"absolute inset-0 w-full h-auto max-w-full max-h-full sm:w-full sm:h-auto sm:overflow-hidden sm:inset-1/2 sm:aspect-video sm:-translate-y-[50%] px-4 py-2 xl:px-[1.8rem] sidebar-closed:xl:py-4 sm:-translate-x-[50%] sidebar-open:px-4 sidebar-open:py-6 sidebar-open:xl:px-[2.8rem] sidebar-open:xl:py-6"},[n("div",{class:"relative rounded-2xl flex overflow-clip mx-auto children:overflow-clip h-auto top-1/4 sm:top-1/2 sm:-translate-y-1/2 w-auto sm:w-fit max-w-available sm:h-full",onClick:i[0]||(i[0]=W(()=>{},["stop"]))},[...i[2]||(i[2]=[n("div",{id:"trailer",class:"group nomercyplayer"},null,-1)])])],8,Ie)]))}}),He=qe;export{Fe as n,Oe as r,He as t};
