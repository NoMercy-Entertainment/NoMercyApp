import"./useInfiniteServerClient-CUj8KMRn.js";import{$l as g,As as c,Bl as v,Dl as w,Hl as u,Js as N,Qc as l,R as r,Z as b,bl as P,ec as _,es as F,hu as y,kl as T,ll as A,s as d,su as x,tu as f,vl as S,xl as h,zl as V}from"./index-DhiB0zJh.js";import{t as B}from"./useServerClient-CjjHYevH.js";import{a as H,i as D,n as R,o as U,r as I,s as K}from"./VideoPlayer-QDIbIl0N.js";import"./buttons-Vl3cDtNu.js";A();var E=class extends K{player={};boundKeyHandler=()=>{};initialize(n){this.player=n,this.boundKeyHandler=this.keyHandler.bind(this)}use(){this.player.options.disableControls||document.addEventListener("keyup",this.boundKeyHandler,!1)}dispose(){document.removeEventListener("keyup",this.boundKeyHandler)}keyHandler(n){if(document.activeElement?.nodeName=="INPUT")return;const o=this.keyBindings();let e=!1;this.player.getVideoElement().getBoundingClientRect().width!=0&&(!e&&this.player&&(e=!0,o.some(a=>a.key===n.key&&a.control===n.ctrlKey)&&(n.preventDefault(),o.find(a=>a.key===n.key&&a.control===n.ctrlKey)?.function())),setTimeout(()=>{e=!1},300))}hasNoMercyConnect(){return this.player.plugins.has("videoNoMercyConnect")}getNoMercyConnectSocket(){return this.hasNoMercyConnect()?this.player.plugins.get("videoNoMercyConnect")?.socket:null}sendNoMercyConnectCommand(n,o){if(this.hasNoMercyConnect())try{const e=this.getNoMercyConnectSocket();e?e.invoke("PlaybackCommand",n,o!==null?o:null):console.error("No NoMercyConnect socket available")}catch(e){console.error("Error invoking PlaybackCommand:",e)}else console.warn("No NoMercyConnect plugin available")}handleForward(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward"):this.player.forwardVideo()}handleBackward(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("backward"):this.player.rewindVideo()}handlePlayback(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand(this.player.isPlaying?"pause":"play"):this.player.togglePlayback()}handlePrevious(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("previous"):this.player.previous()}handleNext(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("next"):this.player.next()}handleCycleCaption(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("cycleCaption"):this.player.cycleSubtitles()}handleCycleAudio(){this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("cycleAudio"):this.player.cycleAudioTracks()}keyBindings(){return[{name:"Play",key:"MediaPlay",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("play"):this.player.play().then())}},{name:"Pause",key:"MediaPause",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("pause"):this.player.pause())}},{name:"Toggle playback",key:" ",control:!1,function:()=>{this.handlePlayback()}},{name:"Toggle playback",key:"MediaPlayPause",control:!1,function:()=>{this.player.options.disableMediaControls||this.handlePlayback()}},{name:"Stop",key:"MediaStop",control:!1,function:()=>{this.player.options.disableMediaControls||(this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("stop"):this.player.stop())}},{name:"Rewind",key:"ArrowLeft",control:!1,function:()=>!this.player.isTv()&&this.handleBackward()},{name:"Rewind",key:"MediaRewind",control:!1,function:()=>{!this.player.isTv()&&this.player.options.disableMediaControls||this.handleBackward()}},{name:"Fast forward",key:"ArrowRight",control:!1,function:()=>!this.player.isTv()&&this.handleForward()},{name:"Fast forward",key:"MediaFastForward",control:!1,function:()=>{this.player.options.disableMediaControls||this.handleForward()}},{name:"Previous item",key:"MediaTrackPrevious",control:!1,function:()=>{this.player.options.disableMediaControls||this.handlePrevious()}},{name:"Previous item",key:"p",control:!1,function:()=>this.handlePrevious()},{name:"Next item",key:"MediaTrackNext",control:!1,function:()=>{this.player.options.disableMediaControls||this.handleNext()}},{name:"Next item",key:"n",control:!1,function:()=>this.handleNext()},{name:"Cycle subtitle tracks",key:"Subtitle",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle subtitle tracks",key:"5",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle subtitle tracks",key:"v",control:!1,function:()=>this.handleCycleCaption()},{name:"Cycle audio tracks",key:"Audio",control:!1,function:()=>this.handleCycleAudio()},{name:"Cycle audio tracks",key:"2",control:!1,function:()=>this.handleCycleAudio()},{name:"Cycle audio",key:"b",control:!1,function:()=>this.handleCycleAudio()},{name:"Forward 30 seconds",key:"ColorF0Red",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",30):this.player.forwardVideo(30)}},{name:"Forward 60 seconds",key:"ColorF1Green",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",60):this.player.forwardVideo(60)}},{name:"Forward 90 seconds",key:"ColorF2Yellow",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",90):this.player.forwardVideo(90)}},{name:"Forward 120 seconds",key:"ColorF3Blue",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",120):this.player.forwardVideo(120)}},{name:"Forward 30 seconds",key:"3",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",30):this.player.forwardVideo(30)}},{name:"Forward 60 seconds",key:"6",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",60):this.player.forwardVideo(60)}},{name:"Forward 90 seconds",key:"9",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",90):this.player.forwardVideo(90)}},{name:"Forward 120 seconds",key:"1",control:!1,function:()=>{this.hasNoMercyConnect()?this.sendNoMercyConnectCommand("forward",120):this.player.forwardVideo(120)}},{name:"Fullscreen",key:"f",control:!1,function:()=>{this.player.toggleFullscreen()}},{name:"Volume up",key:"ArrowUp",control:!1,function:()=>{!this.player.isTv()&&!this.player.isMobile()&&this.player.volumeUp()}},{name:"Volume down",key:"ArrowDown",control:!1,function:()=>{!this.player.isTv()&&!this.player.isMobile()&&this.player.volumeDown()}},{name:"Mute",key:"m",control:!1,function:()=>{this.player.toggleMute()}},{name:"Cycle aspect ratio",key:"BrowserFavorites",control:!1,function:()=>{this.player.cycleAspectRatio()}},{name:"Cycle aspect ratio",key:"a",control:!1,function:()=>{this.player.cycleAspectRatio()}},{name:"Show info",key:"Info",control:!1,function:()=>{}}].map((n,o)=>({...n,id:o}))}},L=E,z=T({__name:"Desktop",setup(n){const{data:o}=B({}),e=x();function a(t){const s={controls:!1,debug:!1,playlist:t?.filter(i=>!!i.id)??[],accessToken:c.value?.accessToken,basePath:F.value?.serverBaseUrl?.replace(/\/$/,""),imageBasePath:"https://app.nomercy.tv/tmdb-images",forceTvMode:(l("android")||l("ios"))&&!l("mobile"),disableTouchControls:!1,disableMediaControls:"mediaSession"in navigator||l("capacitor"),renderAhead:100,disableAutoPlayback:c.value.features?.nomercyConnect};e.value=I("player1").setup(s),e.value.once("back",()=>{history.state.back?r.back():r.replace("/")});const p=new D;e.value.registerPlugin("desktopUI",p),e.value.usePlugin("desktopUI");const m=new H;e.value.registerPlugin("autoSkip",m),e.value.usePlugin("autoSkip");const C=new L;e.value.registerPlugin("keyHandler",C),e.value.usePlugin("keyHandler");const k=new U;e.value.registerPlugin("sync",k),e.value.usePlugin("sync");const M=new R;e.value.registerPlugin("octopus",M),e.value.usePlugin("octopus"),e.value.once("play",()=>{e.value.enterFullscreen()}),e.value.on("playlistComplete",()=>{console.log("Playlist complete"),history.state.back?r.back():r.replace("/")}),e.value.on("play",()=>{d(!0)}),e.value.on("pause",()=>{d(!1)}),e.value.on("fullscreen",i=>{window.external?.sendMessage?.(i?"enterFullscreen":"exitFullscreen")})}return g(o,t=>{t?.length&&a(t)}),V(()=>{b.stop(),c.value.features?.nomercyConnect?a():o.value?.length&&a(o.value)}),v(()=>{e.value?.dispose(),d(!1)}),(t,s)=>(u(),h(y(_),null,{default:f(()=>[w(y(N),{fullscreen:!0},{default:f(()=>[(u(),h(S,{to:"body"},[s[0]||(s[0]=P("div",{id:"player1",class:"group nomercyplayer text-white"},null,-1))]))]),_:1})]),_:1}))}}),Z=z;export{Z as default};
