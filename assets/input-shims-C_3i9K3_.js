import{Go as p,Jo as k,Ko as N,Wo as O,ds as F,fs as C,ls as H,ns as A,qo as $,rs as b,ss as P}from"./index-CANHr9D7.js";var D=new WeakMap,T=(e,r,t,s=0,o=!1)=>{D.has(e)!==t&&(t?G(e,r,s,o):U(e,r))},q=e=>e===e.getRootNode().activeElement,G=(e,r,t,s=!1)=>{const o=r.parentNode,a=r.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,s&&(a.disabled=!0),o.appendChild(a),D.set(e,a);const n=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${n}px,${t}px,0) scale(0)`},U=(e,r)=>{const t=D.get(e);t&&(D.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""};var W=(e,r,t)=>{if(!t||!r)return()=>{};const s=u=>{q(r)&&T(e,r,u)},o=()=>T(e,r,!1),a=()=>s(!0),n=()=>s(!1);return P(t,"ionScrollStart",a),P(t,"ionScrollEnd",n),r.addEventListener("blur",o),()=>{C(t,"ionScrollStart",a),C(t,"ionScrollEnd",n),r.removeEventListener("blur",o)}};var Y=()=>{let e=!0,r=!1;const t=document,s=()=>{r=!0},o=()=>{e=!0},a=n=>{if(r){r=!1;return}const u=t.activeElement;if(!u||u.matches("input, textarea, [no-blur], [contenteditable]"))return;const f=n.target;f!==u&&(f.matches("input, textarea, [no-blur], [contenteditable]")||f.closest("input, textarea, [no-blur], [contenteditable]")||(e=!1,setTimeout(()=>{e||u.blur()},50)))};return P(t,"ionScrollStart",s),t.addEventListener("focusin",o,!0),t.addEventListener("touchend",a,!1),()=>{C(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",o,!0),t.removeEventListener("touchend",a,!1)}},z=.3,j=(e,r,t,s)=>{var o;const a=(o=e.closest("ion-item,[ion-item]"))!==null&&o!==void 0?o:e;return J(a.getBoundingClientRect(),r.getBoundingClientRect(),t,s)},J=(e,r,t,s)=>{const o=e.top,a=e.bottom,n=r.top,u=Math.min(r.bottom,s-t),f=n+15,d=u-50-a,c=f-o,l=Math.round(d<0?-d:c>0?-c:0),v=Math.min(l,o-n),S=Math.abs(v)/z;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(o-f)+4}},B="$ionPaddingTimer",M=(e,r,t)=>{const s=e[B];s&&clearTimeout(s),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[B]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},x=(e,r,t)=>{const s=()=>{r&&M(r,0,t)};e.addEventListener("focusout",s,{once:!0})},g=0,_="data-ionic-skip-scroll-assist",Q=(e,r,t,s,o,a,n,u=!1)=>{const f=a&&(n===void 0||n.mode===p.None);let d=!1;const c=b!==void 0?b.innerHeight:0,l=h=>{if(d===!1){d=!0;return}R(e,r,t,s,h.detail.keyboardHeight,f,u,c,!1)},v=()=>{d=!1,b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute("data-ionic-skip-scroll-assist")){r.removeAttribute(_);return}R(e,r,t,s,o,f,u,c),b===null||b===void 0||b.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},I=e=>{var r;if(document.activeElement===e)return;const t=e.getAttribute("id"),s=e.closest(`label[for="${t}"]`),o=(r=document.activeElement)===null||r===void 0?void 0:r.closest(`label[for="${t}"]`);s!==null&&s===o||(e.setAttribute(_,"true"),e.focus())},R=async(e,r,t,s,o,a,n=!1,u=0,f=!0)=>{if(!t&&!s)return;const d=j(e,t||s,o,u);if(t&&Math.abs(d.scrollAmount)<4){I(r),a&&t!==null&&(M(t,g),x(r,t,()=>g=0));return}if(T(e,r,!0,d.inputSafeY,n),I(r),F(()=>e.click()),a&&t&&(g=d.scrollPadding,M(t,g)),typeof window<"u"){let c;const l=async()=>{c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await k(t,0,d.scrollAmount,d.scrollDuration),T(e,r,!1,d.inputSafeY),I(r),a&&x(r,t,()=>g=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await $(t),h=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>h-S.scrollTop){r.type==="password"?(d.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),c=setTimeout(l,1e3);return}}l()}};var X=async(e,r)=>{if(A===void 0)return;const t=r==="ios",s=r==="android",o=e.getNumber("keyboardHeight",290),a=e.getBoolean("scrollAssist",!0),n=e.getBoolean("hideCaretOnScroll",t),u=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(A.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,l=new WeakMap,v=await O.getResizeMode(),S=async i=>{await new Promise(m=>H(i,m));const y=i.shadowRoot||i,L=y.querySelector("input")||y.querySelector("textarea"),w=N(i),K=w?null:i.closest("ion-footer");if(L){if(w&&n&&!c.has(i)){const m=W(i,L,w);c.set(i,m)}if(!(L.type==="date"||L.type==="datetime-local")&&(w||K)&&a&&!l.has(i)){const m=Q(i,L,w,K,o,f,v,s);l.set(i,m)}}},h=i=>{if(n){const y=c.get(i);y&&y(),c.delete(i)}if(a){const y=l.get(i);y&&y(),l.delete(i)}};u&&Y();for(const i of d)S(i);A.addEventListener("ionInputDidLoad",i=>{S(i.detail)}),A.addEventListener("ionInputDidUnload",i=>{h(i.detail)})};export{X as startInputShims};
