{"version":3,"file":"Mobile-DheypgZR.js","sources":["../../src/views/Base/Library/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {computed, onMounted, onUnmounted, ref, watch} from 'vue';\nimport {useRouter} from 'vue-router';\nimport {IonContent, IonPage} from '@ionic/vue';\n\nimport type {LibraryResponse} from '@/types/api/base/library';\nimport type {PeopleResponse, PersonResponseItem} from '@/types/api/base/person';\nimport type {GenreResponse} from '@/types/api/base/genre';\n\nimport {isNative} from '@/config/global';\nimport {currentSong} from '@/store/audioPlayer';\nimport useInfiniteServerClient from '@/lib/clients/useInfiniteServerClient';\nimport {showBackdrops} from '@/store/preferences';\nimport {setBackground, setColorPalette} from '@/store/ui';\nimport router from '@/router';\nimport {setTitle} from '@/lib/stringArray';\n\nimport Indexer from '@/Layout/Indexer.vue';\n\nimport MediaCard from '@/components/Cards/MediaCard.vue';\nimport PersonCard from '@/components/Cards/PersonCard.vue';\nimport GenreCard from '@/components/Cards/GenreCard.vue';\nimport EmptyCard from '@/components/Cards/EmptyCard.vue';\n\nconst routing = useRouter();\n\nconst {data, fetchNextPage, hasNextPage, isError} = useInfiniteServerClient<{\n  data: Array<LibraryResponse | GenreResponse | PeopleResponse>\n}>({\n  queryKey: ['libraries', ((routing.currentRoute?.value?.params.id ?? routing.currentRoute.value.name) as string)?.split('&').at(0)],\n  limit: 20,\n  keepForever: true,\n});\n\nonMounted(() => {\n  setTitle();\n  setBackground(null);\n  setColorPalette(null);\n  document.dispatchEvent(new Event('sidebar'));\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nconst backdropStyle = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-4 3xl:grid-cols-5 4xl:grid-cols-5 5xl:grid-cols-9 tv:grid-cols-6';\n\nconst posterStyle = 'grid-cols-2 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-7 3xl:grid-cols-9 4xl:grid-cols-10 5xl:grid-cols-[repeat(14,minmax(0,1fr))] tv:grid-cols-6';\n\nconst useBackdropStyle = computed(() => {\n  return showBackdrops.value && data.value?.pages?.[0]?.data[0].media_type !== 'person' && data.value?.pages?.[0]?.data[0].media_type !== 'genres';\n});\n\nonUnmounted(() => {\n  stop();\n  setBackground(null);\n});\n\nconst lib = ref<HTMLDivElement>();\n\nonMounted(() => {\n  if (hasNextPage.value && (data?.value?.pages?.length ?? 0) < 50) {\n    fetchNextPage();\n  }\n\n  document.addEventListener('scrollToDiv', (e: Event) => {\n    lib.value?.scrollTo({\n      // @ts-ignore\n      top: e.detail.top - 100,\n      behavior: 'smooth',\n    });\n  });\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  if (hasNextPage.value && value?.pages?.length < 50) {\n    fetchNextPage();\n  }\n});\n\nconst selectedCard = ref<LibraryResponse | GenreResponse | PeopleResponse>();\nconst cardMenu = ref();\n\nconst onRightClick = (event: Event, data: LibraryResponse | GenreResponse | PeopleResponse) => {\n  selectedCard.value = data;\n  cardMenu.value.show(event);\n};\n\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\" class=\"ion-padding \">\n      <div class=\"fixed top-0 pt-safe w-full bg-slate-light-1 dark:bg-slate-dark-3 z-1199\" ></div>\n      <div ref=\"lib\" class=\"pt-safe-offset-10 flex h-auto w-full pr-8 overflow-auto py-0 scroll-container\">\n        <div\n            class=\"z-0 flex flex-col gap-4 rounded-3xl border-0 w-available scrollbar-none border-auto-3 pt-2\"\n            :class=\"{\n               'pb-2' : isNative && currentSong,\n               'children:pb-4 sm:children:pb-3' : !isNative && currentSong\n            }\"\n            :key=\"router.currentRoute.value.params?.id as string\">\n\n          <div\n              :class=\"`grid w-full gap-4 scroll-smooth music-showing:pb-0 pl-1 ${useBackdropStyle ? backdropStyle : posterStyle}`\">\n            <!--        <ContextMenu ref=\"cardMenu\" :model=\"items\"/>-->\n            <template v-if=\"data\">\n              <template v-for=\"(group, index) in data.pages ?? []\" :key=\"index\">\n                <template v-if=\"group.data.length > 0\">\n                  <template v-for=\"(data, index2) in group.data ?? []\">\n                    <MediaCard\n                        v-if=\"data?.media_type === 'tv' || data?.media_type == 'movie' || data?.media_type == 'collection' || data?.media_type == 'specials'\"\n                        :key=\"data.id\"\n                        :data=\"data as LibraryResponse\"\n                        @context-menu=\"onRightClick($event, data)\"\n                        :index=\"index2\"/>\n                    <PersonCard\n                        v-else-if=\"data?.media_type === 'person'\"\n                        :key=\"data.id + '_person'\"\n                        :data=\"data as PersonResponseItem\"\n                        @context-menu=\"onRightClick($event, data)\"\n                        :index=\"index2\"/>\n                    <GenreCard\n                        v-else-if=\"data?.media_type === 'genres'\"\n                        :key=\"data.id + '_genres'\"\n                        :data=\"data as GenreResponse\"\n                        @context-menu=\"onRightClick($event, data)\"\n                        :index=\"index2\"/>\n                  </template>\n                </template>\n                <template v-else-if=\"data.pages?.[0]?.data?.length == 0\">\n                  <EmptyCard/>\n                </template>\n              </template>\n            </template>\n          </div>\n        </div>\n        <Indexer class=\"w-8 !-mt-4 pt-4 pb-4 mb-0 fixed right-0 bg-slate-light-1 dark:bg-slate-dark-3\"\n                 :class=\"{\n                    'h-available': !isNative,\n                    'h-inherit top-24': isNative\n                 }\"\n        />\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n\n<!--<style scoped>-->\n\n<!--@media screen and (max-width: 800px) {-->\n<!--  ion-content::part(scroll) {-->\n<!--    &#45;&#45;offset-top: -4.5rem;-->\n<!--  }-->\n\n<!--  *:has(ion-toolbar:first-child:nth-last-child(2) ~ *) ion-content::part(scroll) {-->\n<!--    &#45;&#45;offset-top: -8.5rem;-->\n<!--  }-->\n<!--}-->\n<!--</style>-->\n"],"names":["backdropStyle","posterStyle","routing","useRouter","data","fetchNextPage","hasNextPage","isError","useInfiniteServerClient","_c","_b","_a","onMounted","setTitle","setBackground","setColorPalette","watch","value","useBackdropStyle","computed","showBackdrops","_f","_e","_d","onUnmounted","lib","ref","e","selectedCard","cardMenu","onRightClick","event"],"mappings":"moBAmDA,MAAMA,GAAgB,0IAEhBC,GAAc,8MA7BpB,MAAMC,EAAUC,EAAU,EAEpB,CAAC,KAAAC,EAAM,cAAAC,EAAe,YAAAC,EAAa,QAAAC,EAAA,EAAWC,EAEjD,CACD,SAAU,CAAC,aAAeC,IAAAC,GAAAC,EAAAT,EAAQ,eAAR,YAAAS,EAAsB,QAAtB,YAAAD,EAA6B,OAAO,KAAMR,EAAQ,aAAa,MAAM,OAArE,YAAAO,EAAuF,MAAM,KAAK,GAAG,EAAE,EACjI,MAAO,GACP,YAAa,EAAA,CACd,EAEDG,EAAU,IAAM,CACLC,EAAA,EACTC,EAAc,IAAI,EAClBC,EAAgB,IAAI,EACpB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,EAC3C,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAEKC,EAAAZ,EAAOa,GAAU,CAChBA,GACL,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAMK,MAAAC,EAAmBC,EAAS,IAAM,iBAC/B,OAAAC,EAAc,SAASX,GAAAC,GAAAC,EAAAP,EAAK,QAAL,YAAAO,EAAY,QAAZ,YAAAD,EAAoB,KAApB,YAAAD,EAAwB,KAAK,GAAG,cAAe,YAAYY,GAAAC,GAAAC,EAAAnB,EAAK,QAAL,YAAAmB,EAAY,QAAZ,YAAAD,EAAoB,KAApB,YAAAD,EAAwB,KAAK,GAAG,cAAe,QAAA,CACzI,EAEDG,EAAY,IAAM,CACX,KAAA,EACLV,EAAc,IAAI,CAAA,CACnB,EAED,MAAMW,EAAMC,EAAoB,EAEhCd,EAAU,IAAM,SACVN,EAAY,UAAUI,GAAAC,EAAAP,GAAA,YAAAA,EAAM,QAAN,YAAAO,EAAa,QAAb,YAAAD,EAAoB,SAAU,GAAK,IAC7CL,EAAA,EAGP,SAAA,iBAAiB,cAAgBsB,GAAa,QACrDhB,EAAAc,EAAI,QAAJ,MAAAd,EAAW,SAAS,CAElB,IAAKgB,EAAE,OAAO,IAAM,IACpB,SAAU,QAAA,EACX,CACF,CAAA,CACF,EAEKX,EAAAZ,EAAOa,GAAU,OAChBA,GAEDX,EAAY,SAASK,EAAAM,GAAA,YAAAA,EAAO,QAAP,YAAAN,EAAc,QAAS,IAChCN,EAAA,CAChB,CACD,EAED,MAAMuB,EAAeF,EAAsD,EACrEG,EAAWH,EAAI,EAEfI,EAAe,CAACC,EAAc3B,IAA2D,CAC7FwB,EAAa,MAAQxB,EACZyB,EAAA,MAAM,KAAKE,CAAK,CAC3B"}