import{Lt as k,Tt as w,kn as r}from"./index-cywnPOBC.js";import{y as l}from"./client-TRoQZYEY.js";import{t as C,u as h}from"./currentServer-ns-65dJg.js";import{i as T}from"./user-DdN2xDWa.js";import{t as i}from"./serverClient-h83xvsoB.js";import{t as u}from"./router-b6Y7vD7A.js";import{l as m,tt as v}from"./SocketClient-BXQHVNG_.js";import{t as f}from"./musicPlaylists-CRSZ6nMQ.js";import{t as R}from"./esm-DZQicoaf.js";w();var q=(t,a)=>i().get(t);function x(t,a){return i().put(t,{data:a})}function P(t,a){return i().post(t,{data:a})}function M(t,a){return i().delete(t,{data:a})}function E(t,a){return i().patch(t,{data:a})}function B(t){return t.map(a=>{let s;return a.method==="GET"?s=q:a.method==="PUT"?s=x:a.method==="POST"?s=P:a.method==="PATCH"?s=E:a.method==="DELETE"?s=M:s=a.command,{label:a.label,icon:a.icon,confirm:a.confirm,args:a.args,command:()=>s(a.args?.url,S.value).then(()=>{a.args?.replaceKey&&document.dispatchEvent(new CustomEvent("mutateId",{detail:{id:a.args?.replaceKey}}))})}})}const H=r({});var y=r();const O=k(()=>y.value);function j(t){y.value=t}var b=r(null);const S=k(()=>b.value);function z(t){b.value=t}const $=r([]),A=r(),e=r();function F(t,a,s){e.value=s;const d=a.path.startsWith("/music/album"),p=a.path.startsWith("/music/artist"),g=a.path.startsWith("/music/playlists"),n=[],c={label:l("Add to playlist"),icon:"mooooom-add",items:[{label:l("New playlist"),icon:"mooooom-add",command:()=>{const o=new CustomEvent("showModal",{detail:{modalName:"createPlaylist",modalTitle:"Add to new playlist",modalProps:e.value}});document.dispatchEvent(o)}}]};f.value.length===0&&c.items.push({label:l("No playlists")});for(const o of f.value)a.path!==`/music/playlists/${o.id}`&&c.items.push({label:o.name,icon:"mooooom-playlist1Add",args:{disabled:a.path===`/music/playlists/${o.id}`},command:()=>{i().post(`/music/playlists/${o.id}/tracks`,{id:e.value?.id}).then(()=>{v.invalidateQueries({queryKey:["music","tracks"]}).then(()=>{console.log("refetching tracks")})}).catch(_=>{console.error(_)})}});n.push(c),g&&n.push({label:l("Remove from playlist"),icon:"mooooom-remove",command:()=>{i().delete(`/music/playlists/${a.params.id}/tracks/${e.value?.id}`).then(()=>{v.invalidateQueries({queryKey:["music","tracks"]}).then(()=>{console.log("refetching tracks")})}).catch(o=>{console.error(o)})}}),n.push({label:l("Save to your liked songs"),icon:"mooooom-heart",command:async()=>{await i().post(`${e.value?.link}/like`,{value:!e.value?.liked.value}).then(({data:o})=>{e.value&&(e.value.value=o.args?.[0]==="liked"||o.args?.[1]==="liked")})}},{label:l("Add to queue"),icon:"mooooom-currentPlaylist",command:()=>{if(e.value){if(m.currentSong===null){console.log("playing track"),m.playTrack(e.value);return}console.log("adding track to queue"),m.addToQueue(e.value)}}},{separator:!0}),!d&&e.value?.album_track&&e.value?.album_track?.length<2?n.push({label:l("Go to album"),icon:"mooooom-disk",command:async()=>{e.value?.album_track?.[0]?.link&&await u.push(e.value?.album_track?.[0]?.link)}}):!d&&e.value?.album_track&&e.value?.album_track?.length>1&&n.push({label:l("Go to album"),icon:"mooooom-disk",items:e.value?.album_track?.map(o=>({label:o.name,icon:"mooooom-disk",command:async()=>await u.push(o.link)}))}),!p&&e.value?.artist_track&&e.value?.artist_track?.length<2?n.push({label:l("Go to artist"),icon:"mooooom-user",command:async()=>{e.value?.artist_track?.[0]?.link&&await u.push(e.value?.artist_track?.[0]?.link)}}):!p&&e.value?.artist_track&&e.value?.artist_track?.length>1&&n.push({label:l("Go to artist"),icon:"mooooom-user",items:e.value?.artist_track?.map(o=>({label:o.name,icon:"mooooom-user",command:async()=>await u.push(o.link)}))}),n.push({separator:!0},{label:l("Share"),icon:"mooooom-shareSquare",items:[{label:l("Copy page link"),icon:"mooooom-fileCopy",command:async()=>await h(window.location.href)},{label:l("Copy track link"),icon:"mooooom-fileCopy",command:()=>e.value?h(`${C.value?.serverBaseUrl}${e.value?.link}?token=${T.value}`):{}},{label:l("Share page"),icon:"mooooom-fileCopy",command:async()=>{const o={url:window.location.href};await R.share(o)}}]}),$.value=n,A.value.show(t)}export{F as a,$ as c,B as i,H as n,j as o,O as r,z as s,A as t};
