import{l as B,C as r,w,ah as E,R as i,cM as H,dw as N,dx as j,cN as T,I as q,$ as O,ao as G,d as f,o as n,s as z,q as I,t as l,dy as K,cY as U,dz as P,dA as L,dB as Q,E as Y,a8 as F,ab as J,dC as W,c as u,a,b as $,r as x,j as X,K as y,A as Z,n as C}from"./index-4xkagrUD.js";import{u as ee}from"./useMounted-DwAICKQh.js";import{u as te}from"./useServerClient-B7mr_MDk.js";import{H as k}from"./HubConnection-CMQnVIkW.js";import{_ as se}from"./FloatingBackButton.vue_vue_type_script_setup_true_lang-BakoKms1.js";import{_ as ae}from"./Button.vue_vue_type_script_setup_true_lang-BtdLYnKX.js";import{_ as oe}from"./ScrollContainer.vue_vue_type_script_setup_true_lang-QF_JR66q.js";import{r as ne,_ as le}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-CJGz-6CV.js";const t=B(),Ae=r(()=>t.value?.connection),d=B(!1);function g(){d.value=!0,document.dispatchEvent(new Event("dashboardHub-connected")),t.value?.connection&&(j(t.value?.connection,"Dashboard Hub"),T(t.value?.connection))}function c(s){d.value=!1,console.log("Disconnected from Dashboard SignalR",s),document.dispatchEvent(new Event("dashboardHub-disconnected"))}function A(s){d.value=!1,console.error("Dashboard SignalR Error:",s),document.dispatchEvent(new Event("dashboardHub-error"))}w(i,async s=>{const o=E.value?.accessToken;s&&d.value&&(t.value?.connection?.stop().then(),t.value?.dispose(),t.value=new H(i.value.serverBaseUrl,o,"dashboardHub"),t.value?.connection?.on("connected",g),t.value?.connection?.on("disconnected",c),await M().catch(A))});async function M(){if(t.value?.connection?.state!==k.Connected)return t.value?.connection?.start().then(g)}async function re(){try{return t.value?.connection?.state===k.Disconnected?void 0:t.value?.connection?.stop().then(c).catch(c)}catch(s){console.error("Error stopping Dashboard SignalR:",s),c()}}async function D(){const s=E.value?.accessToken;i.value&&(!t.value?.connection?.state||t.value?.connection?.state===k.Disconnected)&&(t.value=new H(i.value.serverBaseUrl,s,"dashboardHub"),t.value?.connection?.on("connected",g),t.value?.connection?.on("disconnected",c),await M().catch(A),t.value?.connection?.onreconnecting(o=>{console.log("SignalR Disconnected.",o?.message),N(t.value.connection,"Dashboard Hub"),c()}),t.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),j(t.value.connection,"Dashboard Hub"),g()}))}const ce=q({__name:"HelpButton",setup(s){const o=O(),v=r(()=>`https://docs${G}.nomercy.tv${o.path.replace(/\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/gu,"")}`);return(b,_)=>(n(),f(ae,{id:"help",href:v.value,variant:"text",component:"link",target:"_blank",color:"auto","start-icon":"messageBubbleQuestion",class:"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5"},{default:z(()=>[I(l(b.$t("Help")),1)]),_:1},8,["href"]))}}),ie={key:0,class:"grid h-full w-full place-items-center"},de={class:"relative flex items-center justify-start gap-8 overflow-hidden"},ue={class:"relative flex w-full flex-col gap-4"},fe={class:"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80"},ve={class:"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line"},he=["inert"],pe={class:"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-auto-7/6 xl:px-6"},me={class:"relative flex h-full flex-col items-start justify-center gap-1 text-slate-light-12/80 dark:text-slate-dark-12/80"},xe={class:"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold"},ge={key:1,class:"hidden h-8 w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex"},be={class:"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row"},ye={key:0,class:"grid h-full w-full place-items-center"},we={class:"relative flex flex-col items-center justify-start gap-8 overflow-hidden"},ke={class:"relative flex w-full flex-col gap-4"},_e={class:"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80"},Se={class:"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line"},$e={key:2,class:"sticky bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-auto-7/6 empty:hidden sm:h-16 xl:px-6"},Me=q({__name:"DashboardLayout",props:K({title:{type:String,required:!0},params:{type:Object,required:!1},description:{type:String,required:!1},gridStyle:{type:Number,required:!1,default:0},back:{type:Boolean,required:!1,default:!1},error:{type:Object,required:!1},allowAnyone:{type:Boolean,required:!1,default:!1},styles:{type:String,required:!1}},{modelValue:{required:!1,type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const o=s,v=U(s,"modelValue"),{dataUpdatedAt:b,error:_,isPending:R}=te({path:"dashboard/server",enabled:!o.allowAnyone,refetchInterval:1e4,queryKey:["dashboard","server",d.value]}),V=r(()=>o.gridStyle===1?P.value:o.gridStyle===2?L.value:o.gridStyle===3?Q.value:o.gridStyle===4?"flex flex-wrap h-available":"flex flex-wrap h-available overflow-clip"),h=r(()=>{if(o.allowAnyone)return null;const e=_.value;if(e?.response?.status!==200)return{code:e?.response?.data?.status??null,message:e?.response?.data?.detail??""}}),p=r(()=>{const e=o.error;if(console.log(e),!(!e?.response||e?.response?.status===200))return{code:e?.response?.status,message:e?.response?.data?.detail??""}});Y(()=>{F(null),J(null)}),ee(D,re,20);const S=r(()=>(h.value?.code||R.value)&&!o.allowAnyone);return w(S,e=>{e&&v.value!==void 0&&(v.value=!1)}),w(b,e=>{e&&!d.value&&D()}),(e,m)=>(n(),f(W,null,[S.value?(n(),u("div",ie,[a("div",de,[a("div",ue,[a("p",fe,l(h.value?.code?h.value?.code:"Offline"),1),a("p",ve,l(h.value?.message),1)])])])):(n(),u("div",{key:1,class:C([{" min-h-[92vh] sm:min-h-[92.75vh]":!e.$slots.cta," min-h-[92vh] sm:min-h-[90.1vh]":!!e.$slots.cta},"flex flex-col relative z-0 flex-1 h-available overflow-clip items-start justify-start self-stretch w-available"])},[a("div",{class:"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch",inert:y(ne)},[m[0]||(m[0]=a("div",{class:"absolute inset-0 z-0 h-full w-full"},null,-1)),a("div",pe,[a("div",me,[a("p",xe,l(e.$t(s.title,s.params)),1),s.back?(n(),f(se,{key:0,position:"relative",class:"left-4"})):(n(),u("p",ge,l(e.$t(s.description??"")),1))]),x(e.$slots,"title"),a("div",be,[X(ce),x(e.$slots,"cta")])])],8,he),p.value?(n(),u("div",ye,[a("div",we,[a("div",ke,[a("p",_e,l(p.value.code),1),a("p",Se,l(p.value.message),1)])])])):(n(),f(oe,{key:1,static:!0,frame:"",class:"z-0 w-full flex-1 overflow-y-auto overflow-x-hidden sm:p-4"},{default:z(()=>[a("div",{class:C(["h-auto w-full flex-wrap content-start gap-4 flex-1",V.value]),style:Z(s.styles)},[x(e.$slots,"default")],6)]),_:3})),!p.value&&e.$slots.actions?(n(),u("div",$e,[m[1]||(m[1]=a("div",{class:"absolute inset-0 -z-10 h-full w-full"},null,-1)),x(e.$slots,"actions")])):$("",!0),y(i)?.is_owner||y(i)?.is_manager?(n(),f(le,{key:3})):$("",!0)],2))],1024))}});export{Me as _,Ae as c,d};
