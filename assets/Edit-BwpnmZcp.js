import{Bt as m,Gt as C,I as G,Ln as b,Lt as I,M as O,Rt as a,Tt as M,Vn as l,Vt as W,Wt as c,cn as i,kn as u,n as Y,qt as E,xn as n,yn as B,zt as d}from"./index-cywnPOBC.js";import"./dist-yzM0QGvF.js";import"./esm-CsGjMs42.js";import"./esm-D4f7ygqA.js";import"./dist-CG1k-g7C.js";import"./focus-visible-dQviwWa0.js";import"./index5-DWzlHdCO.js";import"./client-D7oxUmH6.js";import"./ionic-global-DCe2g38l.js";import"./hardware-back-button-Bqrrbg0Z.js";import"./index3-bIbYCfqw.js";import"./helpers-BGGXVDsd.js";import"./index6-vUi4VFUZ.js";import"./index8-5IzBz0Dr.js";import"./keyboard-CAPY05Np.js";import"./index2-DsYXeg3E.js";import"./ios.transition-DeZfFnMt.js";import"./keyboard2-CYwkuq6R.js";import"./md.transition-CoCDKCK7.js";import"./dir-VVnELOav.js";import"./basecomponent-Dn_g4DAz.js";import"./classnames-C7QsyfAI.js";import"./ui-C0FA7XgL.js";import"./client-TRoQZYEY.js";import{C as S,t as R}from"./currentServer-ns-65dJg.js";import"./config-BZ-AEJ_J.js";import"./core-Byg9KrIc.js";import"./esm-D9ex0nT9.js";import"./global-oyc8MvKQ.js";import"./esm-B2mzPl6v.js";import"./bundle-mjs-BuAB9hD1.js";import"./user-DdN2xDWa.js";import{t as j}from"./serverClient-h83xvsoB.js";import{t as K}from"./router-b6Y7vD7A.js";import"./utils-CfbU6uFB.js";import"./useBaseQuery--g5SyDb6.js";import"./useInfiniteServerClient-DYu8wLRM.js";import"./SocketClient-BXQHVNG_.js";import{t as N}from"./useQueryClient-CeysrMlA.js";import"./useQuery-BSaIeQ43.js";import{t as H}from"./apiClient-cmnl9Hzw.js";import"./notifications-Cig9DoL1.js";import"./utils-D5nhA-44.js";import"./deviceInfo-D74C9RbC.js";import"./auth-Bz7Q9vHJ.js";import{t as J}from"./Select-DpRipP2N.js";import"./use-text-value-fqeYEKbB.js";import"./render-BcWmD943.js";import"./MoooomIcon-DKjYVqpr.js";import{n as X}from"./dist-DxpR9Lgz.js";import"./baseeditableholder-DcNueJrk.js";import{t as V}from"./Toggle-GoePKWpP.js";import{t as U}from"./useServerClient-BCJ_nw8c.js";import"./ScrollContainer-CLVULms8.js";import"./useMounted-Dkn4Sz-t.js";import"./RipperOverlay-Cv7S1oDX.js";import"./HubConnection-BtR614H-.js";import"./ripperSocket-DZD9yWI6.js";import{t as $}from"./Button-CDwGesU1.js";import{t as Z}from"./Modal-tJlDQvid.js";import"./FloatingBackButton-u0-nKBYi.js";import{t as ee}from"./DashboardLayout-BUGBX_-2.js";import{t as te}from"./useApiClient-U1Xq8csi.js";O();M();var ae={class:"my-6 text-sm text-surface-10"},re=E({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const h=v,{t:p}=X(),T=N(),o=u([]);function q(){if(!h.id){o.value.push({type:"error",place:"email",message:p("Email is required")});return}H().post("server/server-users",{_method:"delete",id:R.value?.id,user_id:h.id}).then(()=>{T.invalidateQueries({queryKey:["server_users"]}).then(()=>{K.back()})}),h.close()}return(r,x)=>(i(),d(Z,{close:v.close,open:v.open,params:{name:v.name},style:{"max-width":"36rem"},title:"Delete server member {{name}}"},{actions:n(()=>[C($,{id:"yes",color:"red","end-icon":"userRemove",type:"button",variant:"contained",onClick:q},{default:n(()=>[c(l(r.$t("Yes")),1)]),_:1}),C($,{id:"no",color:"white",type:"button",variant:"text",onClick:v.close},{default:n(()=>[c(l(r.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:n(()=>[a("p",ae,[c(l(r.$t("Are you sure you want to delete this server member?")),1),x[0]||(x[0]=a("br",null,null,-1)),c(" "+l(r.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["close","open","params"]))}}),le=re;M();var oe={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2 px-1"},se={class:"mt-4 mb-2"},ie={class:"flex flex-col gap-2"},ne={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowed"},ue={class:"whitespace-pre-wrap text-sm font-semibold"},de={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"manage"},me={class:"whitespace-pre-wrap text-sm font-semibold"},pe={class:"mt-4 mb-2"},ce={class:"flex w-full flex-col gap-2"},ve={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"audioTranscoding"},fe={class:"whitespace-pre-wrap text-sm font-semibold"},_e={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"videoTranscoding"},be={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ge={class:"flex w-1/2 flex-col gap-2"},ye={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowedAllLibraries"},we={class:"whitespace-pre-wrap text-sm font-semibold"},ke=E({__name:"Edit",setup(v){const h=N(),p=G(),T=Y(),{data:o}=U({path:"/dashboard/libraries"}),{data:q}=te({path:"server/server-users",params:{id:R.value?.id},queryKey:["server_users"]}),{data:r,error:x}=U({path:`dashboard/users/${p.params.id}/permissions`,queryKey:["userPermissions",p.params.id]}),Q=I(()=>q.value?.find(e=>e.user_id===p.params.id)?.name),g=u(r.value?.allowed),y=u(r.value?.manage),w=u(r.value?.audio_transcoding),k=u(r.value?.video_transcoding),D=u(r.value?.no_transcoding),f=u(o.value?.filter(e=>r.value?.libraries?.includes(e.id)).length===o.value?.length),_=u(o.value?.filter(e=>r.value?.libraries?.includes(e.id)));B(r,e=>{g.value=e?.allowed,y.value=e?.manage,w.value=e?.audio_transcoding,k.value=e?.video_transcoding,D.value=e?.no_transcoding,_.value=o.value?.filter(t=>e?.libraries?.includes(t.id)),f.value=o.value?.filter(t=>e?.libraries?.includes(t.id)).length===o.value?.length});const A=u(!1);function P(){A.value=!0}function z(){A.value=!1}function L(){K.back()}function F(){j().patch(`dashboard/users/${p.params.id}/permissions`,{allowed:g.value,manage:y.value,audio_transcoding:w.value,video_transcoding:k.value,no_transcoding:D.value,libraries:_.value?.map(e=>e.id)}).then(({data:e})=>{h.invalidateQueries({queryKey:["userPermissions",p.params.id]}),T.add({severity:e.status.toLowerCase(),summary:S(e.status),detail:S(e.message,...e.args),life:5e3}),L()})}return B(f,e=>{e&&(_.value=o.value)}),B(_,e=>{o.value}),(e,t)=>(i(),d(ee,{back:!0,error:b(x),params:{name:Q.value},title:"Server member: {{name}}"},{cta:n(()=>[...t[6]||(t[6]=[])]),actions:n(()=>[C($,{id:"yes",class:"mr-auto",color:"auto","start-icon":"userDelete",type:"button",variant:"text",onClick:P},{default:n(()=>[c(l(e.$t("Remove user")),1)]),_:1}),C($,{id:"cancel",color:"white",type:"button",variant:"text",onClick:L},{default:n(()=>[c(l(e.$t("Cancel")),1)]),_:1}),C($,{id:"save",color:"theme",type:"button",onClick:F},{default:n(()=>[c(l(e.$t("Save")),1)]),_:1})]),default:n(()=>[b(r)?(i(),W("div",oe,[a("h3",se,l(e.$t("Base permissions"))+": ",1),a("div",ie,[a("label",ne,[g.value!==void 0?(i(),d(V,{key:0,id:"allowed",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),a("span",ue,l(e.$t("Allow this user to access content")),1)]),a("label",de,[y.value!==void 0?(i(),d(V,{key:0,id:"manage",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),a("span",me,l(e.$t("Allow this user to manage the server")),1)])]),a("h3",pe,l(e.$t("Media playback"))+": ",1),a("div",ce,[a("label",ve,[w.value!==void 0?(i(),d(V,{key:0,id:"audioTranscoding",modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),class:"mr-2",label:"AudioTranscoding"},null,8,["modelValue"])):m("",!0),a("span",fe,l(e.$t("Allow audio playback that requires transcoding")),1)]),a("label",_e,[k.value!==void 0?(i(),d(V,{key:0,id:"videoTranscoding",modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s),class:"mr-2",label:"VideoTranscoding"},null,8,["modelValue"])):m("",!0),a("span",be,l(e.$t("Allow video playback that requires transcoding")),1)])]),a("h3",he,l(e.$t("Library Access"))+": ",1),a("div",ge,[a("label",ye,[f.value!==void 0?(i(),d(V,{key:0,id:"allowedAllLibraries",modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s),class:"mr-2",label:"AllowedAllLibraries"},null,8,["modelValue"])):m("",!0),a("span",we,l(e.$t("Enable access to all libraries")),1)]),f.value?m("",!0):(i(),d(J,{key:0,id:"libraries",modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s),items:b(o),label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","items"]))])])):m("",!0),b(r)?.id?(i(),d(le,{key:1,id:b(r)?.id,close:z,name:b(r)?.name,open:A.value},null,8,["id","name","open"])):m("",!0)]),_:1},8,["error","params"]))}}),Lt=ke;export{Lt as default};
