import{I as z,l as u,d as m,o as n,s as d,a,q as f,t as l,j as q,dr as ee,R as G,Y as te,ds as se,B as ae,w as D,c as oe,b as c,K as y,O as le,dt as F}from"./index-C_qNKMWs.js";import{u as H}from"./useQueryClient-C4PrSAx1.js";import{u as I}from"./useServerClient-abD0VdnA.js";import{_ as re}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BIMnyHYU.js";import{u as ie}from"./index-B8V6bTi4.js";import{_ as ne}from"./Modal.vue_vue_type_script_setup_true_lang-DQG8pWuu.js";import{_ as x}from"./Button.vue_vue_type_script_setup_true_lang-Bf-PAW_G.js";import{T}from"./Toggle-BorMjLGt.js";import{u as de}from"./useApiClient-CTZQhxIV.js";import{_ as ue}from"./Select.vue_vue_type_script_setup_true_lang-Dhjalf5P.js";import"./useQuery-DTS8T947.js";import"./useBaseQuery-vm7BPSk-.js";import"./useInfiniteServerClient-BbeQXtgw.js";import"./useMounted-Ds5Nj1YI.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-BGoOpoOy.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-CJu-NfRn.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-CXhFwpxK.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-D2dXGSOx.js";import"./ripperSocket-Bk620TQq.js";import"./Shadow-Ix2lc59_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./listbox-BfmBa6-e.js";const me={class:"my-6 text-sm text-auto-10"},ce=z({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const w=v,{t:p}=ie(),S=H(),i=u([]);function B(){var s;if(!w.id){i.value.push({type:"error",place:"email",message:p("Email is required")});return}ee().post("server/server-users",{_method:"delete",id:(s=G.value)==null?void 0:s.id,user_id:w.id}).then(()=>{S.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),w.close()}return(s,A)=>(n(),m(ne,{open:v.open,close:v.close,params:{name:v.name},title:"Delete server member {{name}}"},{actions:d(()=>[q(x,{id:"yes",type:"button",color:"red",variant:"contained","end-icon":"userRemove",onClick:B},{default:d(()=>[f(l(s.$t("Yes")),1)]),_:1}),q(x,{id:"no",type:"button",variant:"text",color:"white",onClick:v.close},{default:d(()=>[f(l(s.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:d(()=>[a("p",me,[f(l(s.$t("Are you sure you want to delete this server member?")),1),A[0]||(A[0]=a("br",null,null,-1)),f(" "+l(s.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),pe={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},fe={class:"mt-4 mb-2"},ve={class:"flex flex-col gap-2"},be={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},he={class:"whitespace-pre-wrap text-sm font-semibold"},ge={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ye={class:"whitespace-pre-wrap text-sm font-semibold"},we={class:"mt-4 mb-2"},_e={class:"flex w-full flex-col gap-2"},ke={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},Ve={class:"whitespace-pre-wrap text-sm font-semibold"},$e={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},Ce={class:"whitespace-pre-wrap text-sm font-semibold"},Te={class:"mt-4 mb-2"},qe={class:"flex w-1/2 flex-col gap-2"},xe={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},Ae={class:"whitespace-pre-wrap text-sm font-semibold"},Ze=z({__name:"Edit",setup(v){var K,R,M,N,Q,O,P,Y,j;const w=H(),p=te(),S=se(),{data:i}=I({path:"/dashboard/libraries"}),{data:B}=de({path:"server/server-users",params:{id:(K=G.value)==null?void 0:K.id},queryKey:["server_users"]}),{data:s,error:A}=I({path:`dashboard/users/${p.params.id}/permissions`,queryKey:["userPermissions",p.params.id]}),J=ae(()=>{var e,t;return(t=(e=B.value)==null?void 0:e.find(r=>r.id===p.params.id))==null?void 0:t.name}),_=u((R=s.value)==null?void 0:R.allowed),k=u((M=s.value)==null?void 0:M.manage),V=u((N=s.value)==null?void 0:N.audio_transcoding),$=u((Q=s.value)==null?void 0:Q.video_transcoding),L=u((O=s.value)==null?void 0:O.no_transcoding),b=u(((P=i.value)==null?void 0:P.filter(e=>{var t,r;return(r=(t=s.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}).length)===((Y=i.value)==null?void 0:Y.length)),h=u((j=i.value)==null?void 0:j.filter(e=>{var t,r;return(r=(t=s.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}));D(s,e=>{var t,r,C;_.value=e==null?void 0:e.allowed,k.value=e==null?void 0:e.manage,V.value=e==null?void 0:e.audio_transcoding,$.value=e==null?void 0:e.video_transcoding,L.value=e==null?void 0:e.no_transcoding,h.value=(t=i.value)==null?void 0:t.filter(g=>{var o;return(o=e==null?void 0:e.libraries)==null?void 0:o.includes(g.id)}),b.value=((r=i.value)==null?void 0:r.filter(g=>{var o;return(o=e==null?void 0:e.libraries)==null?void 0:o.includes(g.id)}).length)===((C=i.value)==null?void 0:C.length)});const U=u(!1);function W(){U.value=!0}function X(){U.value=!1}function E(){window.history.back()}function Z(){var e;le().patch(`dashboard/users/${p.params.id}/permissions`,{allowed:_.value,manage:k.value,audio_transcoding:V.value,video_transcoding:$.value,no_transcoding:L.value,libraries:(e=h.value)==null?void 0:e.map(t=>t.id)}).then(({data:t})=>{w.invalidateQueries({queryKey:["userPermissions",p.params.id]}),S.add({severity:t.status==="ok"?"success":"error",summary:F(t.status==="ok"?"Success":"Error"),detail:F(t.message,...t.args),life:5e3}),E()})}return D(b,e=>{e&&(h.value=i.value)}),D(h,e=>{i.value}),(e,t)=>(n(),m(re,{error:y(A),title:"Server member: {{name}}",params:{name:J.value},back:!0},{cta:d(()=>t[6]||(t[6]=[])),actions:d(()=>[q(x,{id:"yes",type:"button",variant:"text",class:"mr-auto",color:"auto-alpha","start-icon":"userDelete",onClick:W},{default:d(()=>[f(l(e.$t("Remove user")),1)]),_:1}),q(x,{id:"cancel",type:"button",variant:"text",color:"white",onClick:E},{default:d(()=>[f(l(e.$t("Cancel")),1)]),_:1}),q(x,{id:"save",type:"button",color:"theme",onClick:Z},{default:d(()=>[f(l(e.$t("Save")),1)]),_:1})]),default:d(()=>{var r,C,g;return[y(s)?(n(),oe("div",pe,[a("h3",fe,l(e.$t("Base permissions"))+": ",1),a("div",ve,[a("label",be,[_.value!==void 0?(n(),m(T,{key:0,id:"allowed",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),label:"Manage",class:"mr-2"},null,8,["modelValue"])):c("",!0),a("span",he,l(e.$t("Allow this user to access content")),1)]),a("label",ge,[k.value!==void 0?(n(),m(T,{key:0,id:"manage",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=o=>k.value=o),label:"Manage",class:"mr-2"},null,8,["modelValue"])):c("",!0),a("span",ye,l(e.$t("Allow this user to manage the server")),1)])]),a("h3",we,l(e.$t("Media playback"))+": ",1),a("div",_e,[a("label",ke,[V.value!==void 0?(n(),m(T,{key:0,id:"audioTranscoding",modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=o=>V.value=o),label:"AudioTranscoding",class:"mr-2"},null,8,["modelValue"])):c("",!0),a("span",Ve,l(e.$t("Allow audio playback that requires transcoding")),1)]),a("label",$e,[$.value!==void 0?(n(),m(T,{key:0,id:"videoTranscoding",modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=o=>$.value=o),label:"VideoTranscoding",class:"mr-2"},null,8,["modelValue"])):c("",!0),a("span",Ce,l(e.$t("Allow video playback that requires transcoding")),1)])]),a("h3",Te,l(e.$t("Library Access"))+": ",1),a("div",qe,[a("label",xe,[b.value!==void 0?(n(),m(T,{key:0,id:"allowedAllLibraries",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o),label:"AllowedAllLibraries",class:"mr-2"},null,8,["modelValue"])):c("",!0),a("span",Ae,l(e.$t("Enable access to all libraries")),1)]),b.value?c("",!0):(n(),m(ue,{key:0,id:"libraries",modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=o=>h.value=o),label:"libraries",placeholder:"Select libraries",multiple:"",items:y(i),"option-label":"title"},null,8,["modelValue","items"]))])])):c("",!0),(r=y(s))!=null&&r.id?(n(),m(ce,{key:1,id:(C=y(s))==null?void 0:C.id,name:(g=y(s))==null?void 0:g.name,close:X,open:U.value},null,8,["id","name","open"])):c("",!0)]}),_:1},8,["error","params"]))}});export{Ze as default};
