import"./i18n-Rm1NkeNf.js";import{cn as r}from"./index-nwvNBojr.js";import{t as n}from"./pwa-ClLXpcWV.js";function s(){return localStorage.getItem("language")||navigator.language.split("-")[0]||"en"}function c(){const e=n[s()]||n.en;return{id:"sw-update-pending",type:"update",title:e.newVersion,body:e.updateNow,from:"system",read:!1,created_at:Date.now(),updated_at:Date.now(),notify:!0,link:"reload"}}var o=null,a=!1;function f(){"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistration().then(e=>{e&&(l(e),e.waiting&&(o=e.waiting,i()),e.update().catch(()=>{}))}).catch(()=>{}),document.addEventListener("sw-update-accepted",()=>{o?(o.postMessage({type:"SKIP_WAITING"}),setTimeout(()=>{window.location.reload()},2e3)):window.location.reload()}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(e=>{e&&(console.log("Checking for updates..."),e.update().then())}).catch(e=>{console.log("Periodic update check failed:",e)})},6e4))}function l(e){a||(a=!0,e.addEventListener("updatefound",()=>{console.log("New service worker found!");const t=e.installing;if(!t){console.log("No installing worker found");return}console.log("New worker state:",t.state),t.addEventListener("statechange",()=>{console.log("Service worker state changed to:",t.state),t.state==="installed"&&(navigator.serviceWorker.controller?(console.log("New version installed, showing notification"),o=t,i()):console.log("Service worker installed for the first time"))})}))}function i(){r(c())}export{f as setupServiceWorkerUpdates};
