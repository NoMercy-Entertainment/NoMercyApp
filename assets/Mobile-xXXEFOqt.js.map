{"version":3,"file":"Mobile-xXXEFOqt.js","sources":["../../src/views/Music/List/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {onMounted, ref, watch} from 'vue';\nimport {useRouter} from 'vue-router';\nimport {IonContent, IonPage, onIonViewWillEnter} from '@ionic/vue';\n\nimport type {ScrollCustomEvent} from '@ionic/core/dist/types/components/content/content-interface';\nimport type {DisplayList} from '@/types/api/music/musicPlayer';\n\nimport {PlaylistItem, SortOrder, SortType} from '@/types/musicPlayer';\n\nimport useServerClient from '@/lib/clients/useServerClient';\nimport {breakTitle2, setTitle, sortByType} from '@/lib/stringArray';\nimport {setColorPalette, setSortOrder, sortOrder, sortType} from '@/store/ui';\n\nimport ControlHeader from '@/views/Music/List/components/ControlHeader.vue';\nimport ArtistHeader from '@/views/Music/List/components/ArtistHeader.vue';\nimport SortHeader from '@/views/Music/List/components/SortHeader.vue';\nimport TrackRow from '@/views/Music/List/components/TrackRow.vue';\nimport MoooomIcon from '@/components/Images/icons/MoooomIcon.vue';\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\n\nconst router = useRouter();\n\nconst {data, isError} = useServerClient<DisplayList>({\n  path: router.currentRoute.value.fullPath,\n  keepForever: true,\n});\n\nconst main = ref<HTMLDivElement | null>(null);\n\nconst displayList = ref<PlaylistItem[]>();\nconst filter = ref('');\n\nwatch(data, (value) => {\n  setTitle(value?.name ?? null);\n\n  sort(value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n\n  setColorPalette(value?.color_palette?.cover);\n});\n\nwatch(sortOrder, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, value, filter.value);\n});\nwatch(sortType, (value) => {\n  sort(data.value?.tracks ?? [], value, sortOrder.value, filter.value);\n});\nwatch(filter, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, sortOrder.value, value);\n});\n\nconst sort = (songs: PlaylistItem[], sortType: SortType, sortOrder: SortOrder, value: string) => {\n\n  const newList = sortByType<PlaylistItem>(songs ?? [], sortType, sortOrder, setSortOrder);\n\n  if (value == '') {\n    displayList.value = newList;\n  } else {\n    // @ts-ignore\n    displayList.value = newList?.filter(t =>\n        t.name?.toLowerCase().includes(value?.toLowerCase?.())\n        || t.artist_track?.some(a => a.name.toLowerCase().includes(value?.toLowerCase?.()))\n        || t.album_track?.[0]?.name.toLowerCase().includes(value?.toLowerCase?.())) ?? [];\n  }\n};\n\nonMounted(() => {\n  if (data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n});\n\nonIonViewWillEnter(() => {\n  sort(data?.value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n  if (data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n});\n\nconst handleBack = () => {\n  window.history.back();\n};\n\nconst showScrollHeader = ref(false);\nconst showScrollHeaderText = ref(false);\nconst sortHeader = ref<VueDivElement>();\n\nconst onScroll = (e: ScrollCustomEvent) => {\n  console.log(sortHeader.value?.$el?.getBoundingClientRect().top);\n  const headerScrollTop = 290;\n  const headerScrollTextTop = 310;\n  const sortHeaderTop = 88;\n\n  showScrollHeader.value = e.detail?.scrollTop >= headerScrollTop;\n  showScrollHeaderText.value = e.detail?.scrollTop >= headerScrollTextTop;\n\n  if (sortHeader.value?.$el?.getBoundingClientRect().top == sortHeaderTop) {\n    sortHeader.value?.$el?.classList.add('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.add('!bg-slate-light-10/11', 'dark:!bg-[rgb(var(--background-auto)/79%)]');\n  } else {\n    sortHeader.value?.$el?.classList.remove('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.remove('!bg-slate-light-10/11', 'dark:!bg-[rgb(var(--background-auto)/79%)]');\n  }\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\" @ionScroll=\"onScroll\" :scrollEvents=\"true\">\n      <NotFound v-if=\"isError\" />\n      <div\n          v-else-if=\"!router.currentRoute.value.params.id || (router.currentRoute.value.params.id && data?.id == router.currentRoute.value.params.id)\"\n          ref=\"main\"\n          class=\"flex flex-col overflow-x-clip w-available h-min sm:rounded-2xl -mt-safe-offset-12 bg-[rgb(var(--background-auto))]\"\n      >\n        <ArtistHeader\n            :data=\"data\"\n        />\n\n        <div class=\"relative z-0 flex h-auto flex-shrink-0 flex-grow flex-col items-start justify-start self-stretch\">\n\n          <div class=\"pointer-events-none absolute z-0 h-96 w-full bg-spotifyBottom bg-focus\"></div>\n\n          <div id=\"navbar\"\n               class=\" fixed z-1099 -mx-2 flex gap-4 p-2 px-4 w-available sm:hidden bg-slate-light-11 dark:bg-slate-dark-1 top-0 pt-safe-offset-4 transition-opacity duration-300\"\n               :class=\"{\n                  'opacity-0 pointer-events-none': !showScrollHeader,\n                  'opacity-100 pointer-events-auto': showScrollHeader\n               }\"\n          >\n            <div id=\"navBg\"\n                 class=\"z-20 absolute flex items-center inset-0 w-available h-full bg-focus/12 dark:bg-focus transition-transform duration-300 bg-spotifyTop opacity-50 pointer-events-none\">\n            </div>\n\n            <button @click=\"handleBack\" class=\"z-30 flex h-10 w-12 items-center justify-center rounded-md\">\n              <MoooomIcon icon=\"arrowLeft\"/>\n            </button>\n\n            <div id=\"navText\"\n                 class=\"pointer-events-none whitespace-pre text-left relative z-20 h-auto line-clamp-2 w-full self-center text-xl font-bold leading-none transition-opacity duration-300\"\n                 :class=\"{\n                  'opacity-0 pointer-events-none': !showScrollHeader,\n                  'opacity-100 pointer-events-auto': showScrollHeader\n               }\"\n                 v-html=\"breakTitle2(data?.name ?? 'Songs you like', 'text-sm line-clamp-2')\"\n            >\n            </div>\n          </div>\n\n          <ControlHeader\n              :key=\"data?.id\"\n              :data=\"data\"\n              :filter=\"filter\"\n              @filter-change=\"(e: string) => filter = e\"/>\n\n          <div\n              class=\"flex flex-1 flex-shrink-0 flex-col items-start justify-start self-stretch bg-slate-dark-12 dark:bg-transparent flex-grow-1 gap-0.5 sm:p-4\">\n            <SortHeader\n                ref=\"sortHeader\"\n                :key=\"data?.id\"/>\n\n            <TrackRow\n                v-for=\"(item, index) in displayList\"\n                :key=\"item.id\"\n                :data=\"item\"\n                :displayList=\"displayList\"\n                :index=\"index\"/>\n          </div>\n        </div>\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["router","useRouter","data","isError","useServerClient","main","ref","displayList","filter","watch","value","setTitle","sort","sortType","sortOrder","setColorPalette","_a","songs","newList","sortByType","setSortOrder","_b","t","_c","a","_f","_d","_e","onMounted","onIonViewWillEnter","handleBack","showScrollHeader","showScrollHeaderText","sortHeader","onScroll","e","headerScrollTop","headerScrollTextTop","sortHeaderTop","_h","_g","_k","_j","_i","_m","_l","_p","_o","_n"],"mappings":"u8BAqBA,MAAMA,EAASC,EAAU,EAEnB,CAAC,KAAAC,EAAM,QAAAC,CAAO,EAAIC,EAA6B,CACnD,KAAMJ,EAAO,aAAa,MAAM,SAChC,YAAa,EAAA,CACd,EAEKK,EAAOC,EAA2B,IAAI,EAEtCC,EAAcD,EAAoB,EAClCE,EAASF,EAAI,EAAE,EAEfG,EAAAP,EAAOQ,GAAU,OACZC,GAAAD,GAAA,YAAAA,EAAO,OAAQ,IAAI,EAEvBE,GAAAF,GAAA,YAAAA,EAAO,SAAU,GAAIG,EAAS,MAAOC,EAAU,MAAON,EAAO,KAAK,EAEvDO,GAAAC,EAAAN,GAAA,YAAAA,EAAO,gBAAP,YAAAM,EAAsB,KAAK,CAAA,CAC5C,EAEKP,EAAAK,EAAYJ,GAAU,OACrBE,IAAAI,EAAAd,EAAK,QAAL,YAAAc,EAAY,SAAU,CAAA,EAAIH,EAAS,MAAOH,EAAOF,EAAO,KAAK,CAAA,CACnE,EACKC,EAAAI,EAAWH,GAAU,OACpBE,IAAAI,EAAAd,EAAK,QAAL,YAAAc,EAAY,SAAU,CAAA,EAAIN,EAAOI,EAAU,MAAON,EAAO,KAAK,CAAA,CACpE,EACKC,EAAAD,EAASE,GAAU,OAClBE,IAAAI,EAAAd,EAAK,QAAL,YAAAc,EAAY,SAAU,CAAA,EAAIH,EAAS,MAAOC,EAAU,MAAOJ,CAAK,CAAA,CACtE,EAED,MAAME,EAAO,CAACK,EAAuBJ,EAAoBC,EAAsBJ,IAAkB,CAE/F,MAAMQ,EAAUC,EAAyBF,GAAS,CAAIJ,EAAAA,EAAUC,EAAWM,CAAY,EAEnFV,GAAS,GACXH,EAAY,MAAQW,EAGpBX,EAAY,OAAQW,GAAA,YAAAA,EAAS,UACzB,iBAAA,QAAAG,EAAAC,EAAE,OAAF,YAAAD,EAAQ,cAAc,UAASL,EAAAN,GAAA,YAAAA,EAAO,cAAP,YAAAM,EAAA,KAAAN,QAC5Ba,EAAAD,EAAE,eAAF,YAAAC,EAAgB,KAAKC,GAAK,OAAA,OAAAA,EAAE,KAAK,YAAc,EAAA,UAASR,EAAAN,GAAA,YAAAA,EAAO,cAAP,YAAAM,EAAA,KAAAN,EAAsB,QAC9Ee,GAAAC,EAAAJ,EAAE,cAAF,YAAAI,EAAgB,KAAhB,YAAAD,EAAoB,KAAK,cAAc,UAASE,EAAAjB,GAAA,YAAAA,EAAO,cAAP,YAAAiB,EAAA,KAAAjB,SAA4B,CAAC,CAExF,EAEAkB,EAAU,IAAM,cACVP,GAAAL,EAAAd,EAAK,QAAL,YAAAc,EAAY,gBAAZ,MAAAK,EAA2B,OACbN,GAAAW,GAAAH,EAAArB,EAAK,QAAL,YAAAqB,EAAY,gBAAZ,YAAAG,EAA2B,KAAK,CAClD,CACD,EAEDG,EAAmB,IAAM,eAClBjB,IAAAI,EAAAd,GAAA,YAAAA,EAAM,QAAN,YAAAc,EAAa,SAAU,CAAC,EAAGH,EAAS,MAAOC,EAAU,MAAON,EAAO,KAAK,GACzEe,GAAAF,EAAAnB,EAAK,QAAL,YAAAmB,EAAY,gBAAZ,MAAAE,EAA2B,OACbR,GAAAY,GAAAD,EAAAxB,EAAK,QAAL,YAAAwB,EAAY,gBAAZ,YAAAC,EAA2B,KAAK,CAClD,CACD,EAED,MAAMG,EAAa,IAAM,CACvB,OAAO,QAAQ,KAAK,CACtB,EAEMC,EAAmBzB,EAAI,EAAK,EAC5B0B,EAAuB1B,EAAI,EAAK,EAChC2B,EAAa3B,EAAmB,EAEhC4B,EAAYC,GAAyB,qCACzC,QAAQ,KAAId,GAAAL,EAAAiB,EAAW,QAAX,YAAAjB,EAAkB,MAAlB,YAAAK,EAAuB,wBAAwB,GAAG,EAC9D,MAAMe,EAAkB,IAClBC,EAAsB,IACtBC,EAAgB,GAELP,EAAA,QAAQR,EAAAY,EAAE,SAAF,YAAAZ,EAAU,YAAaa,EAC3BJ,EAAA,QAAQN,EAAAS,EAAE,SAAF,YAAAT,EAAU,YAAaW,IAEhDZ,GAAAE,EAAAM,EAAW,QAAX,YAAAN,EAAkB,MAAlB,YAAAF,EAAuB,wBAAwB,MAAOa,IACxDC,GAAAC,EAAAP,EAAW,QAAX,YAAAO,EAAkB,MAAlB,MAAAD,EAAuB,UAAU,IAAI,cACrCE,GAAAC,GAAAC,EAAAV,EAAW,QAAX,YAAAU,EAAkB,MAAlB,YAAAD,EAAuB,aAAvB,MAAAD,EAAmC,UAAU,IAAI,wBAAyB,iDAE1EG,GAAAC,EAAAZ,EAAW,QAAX,YAAAY,EAAkB,MAAlB,MAAAD,EAAuB,UAAU,OAAO,cACxCE,GAAAC,GAAAC,EAAAf,EAAW,QAAX,YAAAe,EAAkB,MAAlB,YAAAD,EAAuB,aAAvB,MAAAD,EAAmC,UAAU,OAAO,wBAAyB,8CAEjF"}