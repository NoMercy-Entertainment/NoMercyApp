{"version":3,"file":"Trailer.vue_vue_type_script_setup_true_lang-C77p7Wc7.js","sources":["../../src/views/Base/Info/components/Trailer.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { onMounted, onUnmounted, type PropType, ref, toRaw } from 'vue';\n\nimport type { InfoResponse } from '@/types/api/base/info';\n\nimport type { NMPlayer, PlaylistItem, SetupConfig } from '@/lib/VideoPlayer';\nimport { DesktopUIPlugin, KeyHandlerPlugin, nmplayer, } from '@/lib/VideoPlayer';\nimport { closeSidebar, setSidebar, sidebar } from '@/store/sidebar';\nimport { setDisableScreensaver } from '@/store/imageModal';\nimport { musicVisibility } from '@/store/audioPlayer';\nimport { App } from \"@capacitor/app\";\nimport { isNative } from \"@/config/global\";\n\nconst props = defineProps({\n  videos: {\n    type: Array as PropType<InfoResponse['videos']>,\n    required: true,\n  },\n  toggle: {\n    type: Function as PropType<() => void>,\n    required: true,\n  },\n  open: {\n    type: Boolean,\n    required: true,\n  },\n  title: {\n    type: String,\n    required: true,\n  },\n  index: {\n    type: Number,\n    required: true,\n  },\n  incrementTrailerIndex: {\n    type: Function as PropType<() => void>,\n    required: true,\n  },\n});\n\nconst trailerContainer = ref<HTMLElement>();\nconst sidebarState = ref();\n\ninterface MyNmPlayer extends NMPlayer {\n  showInProduction: () => boolean;\n  getPlaylistItem: () => PlaylistItem & {\n    tmdb_id: number,\n    special_id: number,\n    video_type: string,\n    video_id: number;\n  };\n}\n\nconst trailer = ref<MyNmPlayer>();\n\nonMounted(() => {\n  sidebarState.value = sidebar.value;\n\n  closeSidebar();\n\n  setDisableScreensaver(true);\n\n  if (!props.videos[props.index]?.src) return;\n\n  const config: SetupConfig = {\n    muted: false,\n    controls: false,\n    autoPlay: true,\n    chapters: false,\n    preload: 'auto',\n    playlist: [\n      {\n        id: props.videos[props.index].src,\n        image: `https://trailer.nomercy.tv/${props.videos[props.index].src}/${props.videos[props.index].src}.jpg`,\n        file: `https://trailer.nomercy.tv/${props.videos[props.index].src}/${props.videos[props.index].src}.webm`,\n        title: `${props.videos[props.index].name.toLocaleLowerCase().includes(props.title.toLocaleLowerCase())\n          ? ''\n          : `${props.title} - `}${props.videos[props.index].name}`.toTitleCase(),\n        duration: '',\n        description: '',\n        tracks: [\n          {\n            label: 'full',\n            file: `https://trailer.nomercy.tv/${props.videos[props.index].src}/${props.videos[props.index].src}.en.vtt`,\n            language: 'eng',\n            kind: 'subtitles',\n          },\n        ],\n      },\n    ],\n    playbackRates: [],\n  };\n\n  // @ts-ignore\n  trailer.value = nmplayer('trailer')\n    .setup(config);\n\n  trailer.value?.once('back', () => {\n    props.toggle();\n  });\n\n  const desktopUIPlugin = new DesktopUIPlugin();\n  trailer.value?.registerPlugin('desktopUI', desktopUIPlugin);\n  trailer.value?.usePlugin('desktopUI');\n\n  const keyHandlerPlugin = new KeyHandlerPlugin();\n  trailer.value?.registerPlugin('keyHandler', keyHandlerPlugin);\n  trailer.value?.usePlugin('keyHandler');\n\n  // @ts-ignore\n  window.trailer = toRaw(trailer.value);\n\n  trailer.value?.once('ready', () => {\n    if (isNative.value) {\n      trailer.value?.enterFullscreen();\n    }\n  });\n\n  trailer.value?.on('ended', () => {\n\n    setSidebar(sidebarState.value);\n    props.toggle();\n  });\n  trailer.value?.on('remove', () => {\n    props.toggle();\n    props.incrementTrailerIndex();\n  });\n  trailer.value?.on('error', () => {\n    props.toggle();\n  });\n  trailer.value?.on('close', () => {\n    props.toggle();\n  });\n\n  trailer.value?.on('captionsChanged', (item: any) => {\n    if (item.track == -1) {\n      localStorage.setItem('trailerSubtitles', 'off');\n    } else {\n      localStorage.setItem('trailerSubtitles', item.track);\n    }\n  });\n\n  trailer.value?.on('play', () => {\n    if (localStorage.getItem('trailerSubtitles') == 'off') {\n      trailer.value?.setCurrentCaption(-1);\n    } else {\n      trailer.value?.setCurrentCaption(parseInt(localStorage.getItem('trailerSubtitles') ?? '-1', 10));\n    }\n  });\n\n  App.addListener('backButton', props.toggle);\n\n});\n\nonUnmounted(() => {\n  setSidebar(sidebarState.value);\n  setDisableScreensaver(false);\n\n  if (trailer.value) {\n    try {\n      trailer.value?.dispose();\n    } catch (e) {\n      //\n    }\n  }\n});\n\n</script>\n\n<style scoped></style>\n\n<template>\n  <div @click=\"toggle\" class=\"fixed h-full w-full overflow-hidden rounded-lg bg-black/50\">\n    <div :data-music=\"musicVisibility\" :data-sidebar=\"sidebar\" class=\"absolute w-screen h-available sm:w-auto sm:overflow-hidden sm:inset-1/2 sm:aspect-video sm:-translate-y-[50%]\n              sidebar-closed:sm:h-full\n              sidebar-closed:sm:max-w-[90vw]\n              sidebar-closed:sm:max-h-[93%]\n              sidebar-closed:px-4\n              sidebar-closed:py-2\n              sidebar-closed:xl:px-[1.8rem]\n              sidebar-closed:xl:py-4\n\n              sm:-translate-x-[50%]\n              sidebar-open:h-5/6\n              sidebar-open:px-10\n              sidebar-open:py-6\n              sidebar-open:xl:px-[2.8rem]\n              sidebar-open:xl:py-6\n      \">\n      <div ref=\"trailerContainer\" @click=\"(e: MouseEvent) => e.stopPropagation()\"\n        class=\"relative rounded-2xl flex overflow-clip children:overflow-clip h-auto top-1/2 -translate-y-1/2 w-full sm:h-full children:!w-full children:!h-auto children:!aspect-video\">\n        <div id=\"trailer\" class=\"group nomercyplayer\"></div>\n      </div>\n    </div>\n  </div>\n</template>\n"],"names":["props","__props","trailerContainer","ref","sidebarState","trailer","onMounted","sidebar","closeSidebar","setDisableScreensaver","_a","config","nmplayer","_b","desktopUIPlugin","DesktopUIPlugin","_c","_d","keyHandlerPlugin","KeyHandlerPlugin","_e","_f","toRaw","_g","isNative","_h","setSidebar","_i","_j","_k","_l","item","_m","App","onUnmounted"],"mappings":"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"}