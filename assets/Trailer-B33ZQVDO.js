import{C,Et as z,G as H,J as b,K as N,Ot as P,Q as X,S as o,T,Tt as f,X as G,c as I,ct as S,g as Y,gt as k,h as Z,j as V,k as x,kt as _,n as J,ot as O,w as D}from"./i18n-Cs-AFcrY.js";import{F as K,P as Q}from"./vue-core-CKeWI2Kt.js";import{H as W,_r as ee,b as q,n as E,pt as ae,s as U,tn as A}from"./index-CvT5Tomq.js";import{a as B,i as te,t as le}from"./sidebar-CJeADY8q.js";import{r as R}from"./swiper-DjMBAKTb.js";import{t as re}from"./Carousel-DfQJ8v2P.js";import{t as ie}from"./Select-2nwE_sQn.js";import{a as oe,i as se,r as ne,t as ue}from"./VideoPlayer-Fs2UBy4n.js";I();Q();var de=/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,ce=/^[a-zA-Z0-9_-]{11}$/,w="https://trailer.nomercy.tv",ve=1e4,fe=30;function F(e){const a=e.match(de);return a?a[1]:ce.test(e)?e:null}function me(e){return e.filter(a=>F(a.src)).sort((a,i)=>{const t=a.name?.toLowerCase().includes("trailer")?1:0,u=i.name?.toLowerCase().includes("trailer")?1:0;if(u!==t)return u-t;const l=a.type?.toLowerCase()==="trailer"?1:0,r=i.type?.toLowerCase()==="trailer"?1:0;return r!==l?r-l:(i.size??0)!==(a.size??0)?(i.size??0)-(a.size??0):(i.official?1:0)-(a.official?1:0)})}function j(e){return e.map((a,i)=>({id:i+1,file:a.url.startsWith("http")?a.url:`${w}${a.url}`,kind:"subtitles",language:a.language,label:a.label}))}function Oe(e){const a=k("idle"),i=k(!1),t=k(null);let u=null,l=null;function r(){u?.abort(),u=null,l&&(clearInterval(l),l=null)}async function y(n,s,m,p){try{const d=await(await fetch(`${w}/${s}?v=${Date.now()}`,{signal:m})).json().catch(()=>null);return d?.success?d.data.cached?(t.value={videoId:s,videoUrl:`${w}${d.data.downloadUrl}?v=${Date.now()}`,thumbnailUrl:`${w}/${s}/${s}.jpg`,title:p,subtitles:j(d.data.subtitles??[]),sourceVideo:n},a.value="available",!0):d.data.processing?(a.value="processing",await c(n,s,m,p)):d.status==="queued"?(a.value="queued",await c(n,s,m,p)):!1:!1}catch{return!1}}function c(n,s,m,p){return new Promise(d=>{let $=0;l=setInterval(async()=>{if(m.aborted){clearInterval(l),l=null,d(!1);return}if($++,$>=fe){clearInterval(l),l=null,d(!1);return}try{const h=await(await fetch(`${w}/${s}?v=${Date.now()}`,{signal:m})).json().catch(()=>null);h?.success&&h.data.cached?(clearInterval(l),l=null,t.value={videoId:s,videoUrl:`${w}${h.data.downloadUrl}?v=${Date.now()}`,thumbnailUrl:`${w}/${s}/${s}.jpg`,title:p,subtitles:j(h.data.subtitles??[]),sourceVideo:n},a.value="available",d(!0)):h?.success&&(h.data.processing||h.status==="processing")&&(a.value="processing")}catch{}},ve)})}async function g(){r();const n=e.value;if(!n?.videos||n.videos.length===0){a.value="unavailable";return}const s=me(n.videos);if(s.length===0){a.value="unavailable";return}a.value="validating",u=new AbortController;const{signal:m}=u,p=n.title??n.name??"";for(const d of s){if(m.aborted)return;const $=F(d.src);if($&&await y(d,$,m,`${d.name?.toLowerCase().includes(p.toLowerCase())?"":`${p} - `}${d.name}`))return}m.aborted||(a.value="unavailable")}function v(n){if(n?.stopPropagation(),!t.value)return;i.value=!i.value;const s=document.querySelector("#main");s&&(s.style.overflow=i.value?"hidden":"auto")}function L(){i.value=!1;const n=document.querySelector("#main");n&&(n.style.overflow="auto")}return O(e,()=>{t.value=null,g()},{immediate:!0}),K(()=>{r()}),N(()=>{r()}),{buttonState:a,trailerOpen:i,resolvedTrailer:t,toggleTrailer:v,closeTrailer:L,validate:g}}I();var be={class:"relative mb-1 h-auto w-full overflow-clip rounded-t-md group-focus-visible/season:rounded-b-none group-hover/season:rounded-b-none aspect-backdrop bg-surface-12/12"},ge={class:"transitioning hover:scale-110 text-white/12",style:{"--stroke-width":"1"}},pe={key:0,class:"absolute bottom-0 left-0 z-40 mb-3 w-full px-3"},he=["id"],we=["id"],ye={class:"grid w-full items-stretch gap-1 rounded-b-md p-2 transitioning text-left"},_e=["title"],xe=["title"],ke={class:"relative mb-1 h-auto w-full overflow-clip rounded-t-md group-focus-visible/season:rounded-b-none group-hover/season:rounded-b-none aspect-backdrop bg-surface-1"},$e={class:"transitioning hover:scale-110",style:{"--stroke-width":"1"}},Ce={key:0,class:"absolute bottom-0 left-0 z-40 mb-3 w-full px-3"},Se=["id"],Te=["id"],ze={class:"grid w-full items-stretch gap-1 rounded-b-md p-2 transitioning text-left"},Pe=["title"],Ue=["title"],Ie=V({__name:"SeasonCard",props:{data:{type:Object,required:!0},suffix:{type:String,required:!1,default:""}},setup(e){const a=ee(e.data?.color_palette?.still);return(i,t)=>{const u=X("RouterLink");return e.data?.id&&e.data?.available?(b(),C(u,{key:0,id:e.data?.id,class:z([{"cursor-pointer":e.data?.available,"cursor-not-allowed":!e.data?.available},"frosting border-0 border-[var(--color-theme-8)] flex flex-col h-auto items-center group/season focus-shift focus-outline transition-all duration-200 overflow-clip relative !rounded-lg select-none shadow-[0px_0px_0_1px_rgb(from_var(--color-theme-8,var(--color-theme-6))_r_g_b/70%)] w-full z-0 bg-surface-2 text-surface-12/90"]),onfocus:f(A)(),style:P(f(a)?`
       --color-theme-8: ${f(a)};
    `:""),to:e.data?.available?e.data.link:"#","data-card":"true"},{default:S(()=>[o("div",be,[x(E,{"color-palette":e.data?.color_palette?.still,path:e.data?.still,size:660,title:e.data?.title,aspect:"backdrop",class:"h-40","class-name":"pointer-events-none absolute z-20 flex h-full w-full select-none object-cover transitioning trickle-div",loading:"lazy",type:"image"},null,8,["color-palette","path","title"]),o("div",{class:z([{hidden:!e.data?.available},"absolute inset-0 z-30 grid w-full place-items-center group-focus-visible/season:bg-black opacity-0 group-focus-visible/season:opacity-100 transitioning group-hover/season:opacity-100 [background:radial-gradient(75%_50%_at_50%_50%,_rgba(0,_0,_0,_0.40)_0%,_rgba(0,_0,_0,_0.00)_100%),_rgba(0,_0,_0,_0.09)]"])},[o("div",ge,[x(q,{"class-name":"w-20",icon:"playCircle",stroke:"1"})])],2),e.data?.progress?(b(),T("div",pe,[o("div",{id:`episode-${e.data?.id}-slider-container`,class:"relative z-40 flex h-1 w-full overflow-clip rounded-full pt-2 pr-8 bg-gray-dark-12"},[o("div",{id:`episode-${e.data?.id}-progress-bar`,style:P({width:e.data?.progress>=99?"100%":`${e.data?.progress}%`}),class:"absolute top-0 left-0 h-full bg-[var(--color-theme-8)]"},null,12,we)],8,he)])):D("",!0)]),o("div",ye,[o("p",{title:`${e.data?.episode_number?`${e.data?.episode_number} - `:""}${e.data?.title}`,class:"z-10 w-auto text-2xs sm:text-sm font-bold !leading-5 h-10 line-clamp-2 sm:line-clamp-1"},_(e.data?.episode_number?`${e.data?.episode_number} - `:"")+_(e.data?.title),9,_e),o("p",{title:e.data?.overview,class:"z-10 h-8 w-auto hidden sm:flex text-xs min-h-8 line-clamp-2 leading-[1.2]"},_(e.data?.overview),9,xe)])]),_:1},8,["id","class","onfocus","style","to"])):e.data?.id?(b(),T("div",{key:1,class:z(`border-0 border-[var(--color-theme-8)] flex flex-col h-auto items-center group/season focus-shift focus-outline transition-all duration-200 overflow-clip relative !rounded-lg select-none shadow-[0px_0px_0_1px_rgb(from_var(--color-theme-8,var(--color-theme-6))_r_g_b/70%)] w-full z-0 bg-surface-1/12 ${e.data?.available?"cursor-pointer":"cursor-not-allowed"}`),style:P(f(a)?`--color-theme-8: ${f(a)};`:""),"data-card":"true",onFocus:t[0]||(t[0]=l=>f(A)())},[o("div",ke,[x(E,{"color-palette":e.data?.color_palette?.still,path:e.data?.still,size:660,title:e.data?.title,aspect:"backdrop",class:"h-40","class-name":"pointer-events-none absolute z-20 flex h-full w-full select-none object-cover transitioning trickle-div",type:"image"},null,8,["color-palette","path","title"]),o("div",{class:z([{hidden:!e.data?.available},"absolute inset-0 z-30 grid w-full place-items-center group-focus-visible/season:bg-black opacity-0 group-focus-visible/season:opacity-100 transitioning group-hover/season:opacity-100 [background:radial-gradient(75%_50%_at_50%_50%,_rgba(0,_0,_0,_0.40)_0%,_rgba(0,_0,_0,_0.00)_100%),_rgba(0,_0,_0,_0.09)]"])},[o("div",$e,[x(q,{"class-name":"w-20",icon:"playCircle",stroke:"1"})])],2),e.data?.progress?(b(),T("div",Ce,[o("div",{id:`episode-${e.data?.id}-slider-container`,class:"relative z-40 flex h-1 w-full overflow-clip rounded-full pt-2 pr-8 bg-gray-dark-12"},[o("div",{id:`episode-${e.data?.id}-progress-bar`,style:P({width:e.data?.progress>=99?"100%":`${e.data?.progress}%`}),class:"absolute top-0 left-0 h-full bg-[var(--color-theme-8)]"},null,12,Te)],8,Se)])):D("",!0)]),o("div",ze,[o("p",{title:`${e.data?.episode_number?`${e.data?.episode_number} - `:""}${e.data?.title}`,class:"z-10 w-auto text-sm font-bold !leading-5 h-10 line-clamp-1"},_(e.data?.episode_number?`${e.data?.episode_number} - `:"")+_(e.data?.title),9,Pe),o("p",{title:e.data?.overview,class:"z-10 h-8 w-auto text-xs min-h-8 line-clamp-2 leading-[1.2]"},_(e.data?.overview),9,Ue)])],38)):D("",!0)}}}),M=Ie;I();var Le=V({__name:"SeasonCarousel",props:{data:{type:Array,required:!0},type:{type:String,required:!1,default:"poster"},limitCardCountBy:{type:Number,required:!1}},setup(e){const a=e,{t:i}=J();function t(c){}let u=a.data?.findIndex(c=>c.season_number===1);u===-1&&(u=0);const l=a.data?.map((c,g)=>({index:g,id:c.id,name:`${c.season_number} - ${c.title}`,season_number:c.season_number,episodes:c.episodes}))??[],r=k(l[u]);function y(){document.querySelector(".swiper-undefined")?.swiper?.slideTo(0,300)}return O(r,y),(c,g)=>(b(),C(re,{index:r.value.season_number,"limit-card-count-by":e.limitCardCountBy,type:e.type},{selector:S(()=>[x(ie,{id:"season-selector",modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=v=>r.value=v),disabled:f(l).length===1,items:f(l),"option-label":"title",class:"min-w-[21rem] ml-3",label:"",variant:"normal"},null,8,["modelValue","disabled","items"])]),default:S(()=>[r.value.episodes?.length===0?(b(),C(f(R),{key:0,"virtual-index":0,class:"flex sm:p-1 sm:pl-0"},{default:S(()=>[(b(),C(M,{id:"item-0",key:0,data:{id:1,title:f(i)("To be announced"),season_number:null,episode_number:null,available:!1,overview:"",airDate:"",still:"",link:"",color_palette:{still:{darkVibrant:"",lightVibrant:""}},progress:null},onclick:()=>{}},null,8,["data"]))]),_:1})):(b(!0),T(Y,{key:1},G(r.value.episodes,(v,L)=>(b(),C(f(R),{key:v.id,"virtual-index":L,class:"flex sm:p-1 sm:pl-0"},{default:S(()=>[x(M,{id:`item-${v.id}`,data:v,onclick:()=>void 0},null,8,["id","data","onclick"])]),_:2},1032,["virtual-index"]))),128))]),_:1},8,["index","limit-card-count-by","type"]))}}),Fe=Le;I();var De=["data-music","data-sidebar"],Ve=V({__name:"Trailer",props:{resolvedTrailer:{type:Object,required:!0},toggle:{type:Function,required:!0}},setup(e){const a=e,i=k(),t=k();function u(l){const r={muted:!1,controls:!1,preload:"auto",debug:!1,autoPlay:!0,playlist:[{id:l.videoId,file:l.videoUrl,image:l.thumbnailUrl,title:l.title,duration:"",description:"",tracks:l.subtitles,withCredentials:!1}],controlsTimeout:3e3,doubleClickDelay:300,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2]};t.value=ne("trailer").setup(r),t.value?.once("back",()=>{a.toggle()});const y=new se;t.value?.registerPlugin("desktopUI",y),t.value?.usePlugin("desktopUI");const c=new oe;t.value?.registerPlugin("autoSkip",c),t.value?.usePlugin("autoSkip");const g=new ue;t.value?.registerPlugin("keyHandler",g),t.value?.usePlugin("keyHandler"),t.value?.on("playlistComplete",()=>{a.toggle()}),t.value?.on("play",()=>{U(!0)}),t.value?.on("pause",()=>{U(!1)}),t.value?.on("fullscreen",v=>{window.external?.sendMessage?.(v?"enterFullscreen":"exitFullscreen")}),t.value?.on("remove",()=>{a.toggle()}),t.value?.on("error",()=>{a.toggle()}),t.value?.on("close",()=>{a.toggle()}),t.value?.on("captionsChanged",v=>{v.track===-1?localStorage.setItem("trailerSubtitles","off"):localStorage.setItem("trailerSubtitles",v.track)}),t.value?.once("playing",()=>{t.value?.seek(0)}),t.value?.on("play",()=>{localStorage.getItem("trailerSubtitles")==="off"?t.value?.setCurrentCaption(-1):t.value?.setCurrentCaption(Number.parseInt(localStorage.getItem("trailerSubtitles")??"-1",10))})}return H(()=>{W.stop(),i.value=B.value,U(!0),le(),u(a.resolvedTrailer)}),N(()=>{if(te(i.value??"open"),U(!1),t.value)try{t.value?.dispose()}catch{}}),(l,r)=>(b(),T("button",{class:"fixed inset-0 h-available w-available overflow-hidden rounded-lg bg-black/50",onClick:r[1]||(r[1]=y=>e.toggle())},[o("div",{"data-music":f(ae),"data-sidebar":f(B),class:"absolute inset-0 w-full h-auto max-w-full max-h-full sm:w-full sm:h-auto sm:overflow-hidden sm:inset-1/2 sm:aspect-video sm:-translate-y-[50%] px-4 py-2 xl:px-[1.8rem] sidebar-closed:xl:py-4 sm:-translate-x-[50%] sidebar-open:px-4 sidebar-open:py-6 sidebar-open:xl:px-[2.8rem] sidebar-open:xl:py-6"},[o("div",{class:"relative rounded-2xl flex overflow-clip mx-auto children:overflow-clip h-auto top-1/4 sm:top-1/2 sm:-translate-y-1/2 w-auto sm:w-fit max-w-available sm:h-full",onClick:r[0]||(r[0]=Z(()=>{},["stop"]))},[...r[2]||(r[2]=[o("div",{id:"trailer",class:"group nomercyplayer"},null,-1)])])],8,De)]))}}),He=Ve;export{Fe as n,Oe as r,He as t};
