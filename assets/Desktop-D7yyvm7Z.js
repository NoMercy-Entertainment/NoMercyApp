import{C as p,G as j,J as l,Ot as $,S as r,T as g,Tt as k,X,c as S,ct as d,g as b,gt as h,j as A,k as f,kt as C,ot as ce,w as P,x as n}from"./i18n-Cs-AFcrY.js";import"./ionic-XwZpO7IE.js";import"./vue-core-DdAfjTDT.js";import{t as ve}from"./primevue-DNc5dNs0.js";import"./query-28IwY2wK.js";import{Gi as de,Ji as Y,Wi as Z,ca as Q,hr as _,ja as pe,mr as ee,pr as L,ur as te,z as fe,zi as E}from"./index-Be8CUPKr.js";import"./KeepCounting-1q_tWo-E.js";import"./useInfiniteServerClient-qKbbBITJ.js";import{t as z}from"./useServerClient-DosXNpPr.js";import"./ScrollContainer-CESIT4qR.js";import{t as me}from"./useMounted-DpOUPlkZ.js";import{s as xe}from"./RipperOverlay-Cada8rNd.js";import"./ripperSocket-CYD7YjNS.js";import"./FloatingBackButton-DylT1Srz.js";import{n as w,r as G,t as ge}from"./DashboardLayout-C4e-_9ud.js";import{t as ye}from"./ActivityCard-CsZ-3bJ0.js";import{n as F,r as M,t as H}from"./ServerSystemInfoCard-BiNd2Fwu.js";S();var he={class:"flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch text-slate-11/80 dark:text-slate-11/80"},_e={class:"flex flex-grow flex-col items-start justify-start gap-1 text-left"},we={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start self-stretch"},ke={class:"w-8 flex-shrink-0 flex-grow-0 text-sm"},Ce={class:"relative h-2 flex-grow rounded-lg"},be={class:"w-10 flex-shrink-0 flex-grow-0 text-right text-sm"},Se=A({__name:"ResourceBar",props:{cpu:{type:Number,required:!0,default:0},value:{type:Number,required:!0,default:0}},setup(u){const a=u,s=n(()=>Q.value?te(a.value,ee):"var(--color-theme-8)");return(m,c)=>(l(),g("div",he,[r("div",_e,[r("div",we,[r("p",ke,C(u.cpu),1),r("div",Ce,[c[0]||(c[0]=r("div",{class:"absolute h-2 w-full rounded left-[-1px] top-[-1px] bg-surface-2 dark:bg-surface-1"},null,-1)),r("div",{style:$({width:`${u.value}%`,backgroundImage:`linear-gradient(90deg, ${s.value} 0%, ${s.value} 100%)`}),class:"absolute h-2 rounded transition-all duration-500 left-[-1px] top-[-1px]"},null,4)]),r("p",be,C(Math.floor(u.value))+"% ",1)])])]))}}),Ae=Se;S();var Re={class:"relative flex aspect-video h-auto w-full flex-1 flex-shrink-0 flex-col items-start justify-center gap-1 flex-grow-1 text-surface-12/11"},Pe={class:"relative h-full flex-1 flex-shrink-0 w-available"},$e={class:"absolute top-2/3 left-1/2 -translate-x-1/2 text-center font-semibold text-[2.5vw] monospace sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.6vw]"},ze={class:"flex-shrink-0 flex-grow-0 scale-75 self-stretch text-center text-sm font-semibold w-available text-[2.5vw] sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.7vw]"},Me=A({__name:"ResourceCircle",props:{name:{type:String,required:!0},value:{type:Number,required:!0},size:{type:Number,required:!0}},setup(u){const a=u,s=n(()=>{if(Q.value)return te(a.value,ee);switch(a.name){case"CPU":return _(de,50);case"Memory":return _(Z,50);case"GPU":return _(E,50);default:return _(E,50)}}),m=n(()=>Math.PI*72),c=n(()=>(1-(a.value===-1?0:a.value)/100)*m.value);return(v,o)=>(l(),g("div",Re,[r("div",Pe,[(l(),g("svg",{style:$({width:u.size*2,height:u.size*2}),class:"absolute inset-2 mx-auto rounded",fill:"none",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 152 148",xmlns:"http://www.w3.org/2000/svg"},[o[0]||(o[0]=r("path",{class:"stroke-black/50",d:"M148 76C148 66.5448 146.138 57.1822 142.519 48.4468C138.901 39.7114 133.598 31.7741 126.912 25.0883C120.226 18.4025 112.289 13.099 103.553 9.48068C94.8178 5.86234 85.4552 4 76 4C66.5448 3.99999 57.1823 5.86232 48.4468 9.48066C39.7114 13.099 31.7742 18.4025 25.0883 25.0883C18.4025 31.7741 13.099 39.7113 9.48069 48.4468C5.86234 57.1822 4 66.5448 4 76","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8"},null,-1)),r("path",{style:$({stroke:s.value,strokeDasharray:m.value,strokeDashoffset:c.value}),class:"absolute -top-1 -left-1 h-2 rounded transition-all duration-500",d:"M4 76C4 56.9044 11.5857 38.5909 25.0883 25.0883C38.5909 11.5857 56.9044 4 76 4C95.0956 4 113.409 11.5857 126.912 25.0883C140.414 38.5909 148 56.9044 148 76","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8"},null,4)],4)),r("p",$e,C(u.value===-1?v.$t(""):Math.floor(u.value))+C(u.value===-1?"":"%"),1)]),r("p",ze,C(u.name),1)]))}}),B=Me;S();var Ne={class:"flex items-start justify-between gap-2 overflow-clip w-available text-surface-12/80"},Oe={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start self-stretch"},y=40,De=A({__name:"ServerResourceCard",setup(u){const{data:a}=z({path:"dashboard/server/info",queryKey:["serverInfo",Y.value?.serverBaseUrl]}),s=h(),m=h("graph"),c=h(Array.from({length:y}).fill("")),v=h(Array.from({length:y}).fill(null)),o=h(Array.from({length:y}).fill(null)),N=h(Array.from({length:y}).fill([null]));me(()=>w.value?.invoke("StartResources"),()=>w.value?.invoke("StopResources").catch(),10);function re(){w.value?.invoke("StartResources")}j(()=>{fe()?.onreconnected(re)});const q=n(()=>s.value?.cpu?.core?.toSorted((e,t)=>e.index-t.index)??[]),O=n(()=>s.value?.gpu?.toSorted((e,t)=>e.index-t.index).map(e=>(e.power+e.core)/2)??[]),V=n(()=>s.value?.cpu?.core?.length?Math.floor(q.value?.reduce((e,t)=>e+t.utilization,0)/q.value.length):-1),T=n(()=>s.value?.memory?.percentage==="NaN"?-1:s.value?.memory?.percentage??-1),ae=n(()=>{if(s.value?.gpu?.length===0)return-1;const e=Math.floor(O.value?.reduce((t,i)=>t+i,0)/O.value.length);return Number.isNaN(e)?-1:e}),D=n(()=>(window.innerWidth-5e3)/3);function le(e){if(e.length===1)return[{color:L(e[0]),opacity:50}];const I=(75-25)/(3-1),K=[];for(let R=0;R<e.length;R++){const ie=25+R%3*I;K.push({color:L(e[R]),opacity:ie})}return K}function se(e){e&&(s.value=e,v.value=[...v.value.slice(-y),V.value],o.value=[...o.value.slice(-y),T.value],N.value=[...N.value.slice(-y),O.value])}xe(w,"ResourceUpdate",se);const oe=n(()=>({labels:c.value,datasets:[...a.value?.cpu?.map((e,t)=>{const i="#94f";return{label:`CPU ${a.value?.cpu.length>1?t:""}`,data:v.value,yAxisID:"y",borderColor:_(i,50)}})??[],{label:"Memory",data:o.value,yAxisID:"y",borderColor:_(Z,50)},...a.value?.gpu?.map((e,t)=>{const i=le(a.value?.gpu)[t],x=_(i.color,i.opacity);return{label:`GPU ${a.value?.gpu.length>1?t:""}`,data:N.value.map(I=>I[t]),yAxisID:"y",borderColor:x}})??[]]})),U=pe("legendPosition","bottom"),ue=n(()=>{const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--surface-12"),i=e.getPropertyValue("--p-content-border-color"),x=["left","top","right","bottom"];return{indexAxis:"x",maintainAspectRatio:!1,animation:!1,plugins:{legend:{labels:{color:t},value:U.value,onClick(){U.value=x[(x.indexOf(U.value)+1)%x.length]}}},elements:{line:{tension:.2},point:{pointStyle:!1}},scales:{x:{ticks:{color:"transparent"},grid:{color:"transparent"}},y:{min:0,max:100,beginAtZero:!0,clip:!0,ticks:{color:t},grid:{color:i}}}}}),ne=n(()=>`${(a.value?.gpu?.length??0)*40+120}px`);return(e,t)=>(l(),p(M,{title:"Resources monitor"},{cta:d(()=>[...t[0]||(t[0]=[])]),default:d(()=>[r("div",Ne,[f(B,{size:D.value,value:V.value,name:"CPU"},null,8,["size","value"]),t[1]||(t[1]=r("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),f(B,{size:D.value,value:T.value,name:"Memory"},null,8,["size","value"]),t[2]||(t[2]=r("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),f(B,{size:D.value,value:ae.value,name:"GPU"},null,8,["size","value"])]),r("div",Oe,[m.value==="bar"?(l(!0),g(b,{key:0},X(s.value?.cpu?.core??[],(i,x)=>(l(),g(b,{key:i.index},[Number.isNaN(i.utilization)?P("",!0):(l(),p(Ae,{key:0,cpu:x,value:i.utilization},null,8,["cpu","value"]))],64))),128)):P("",!0),m.value==="graph"?(l(),p(k(ve),{key:1,data:oe.value,options:ue.value,style:$(`height: ${ne.value}`),class:"w-available",type:"line"},null,8,["data","options","style"])):P("",!0)])]),_:1}))}}),J=De;S();var Ue=A({__name:"ServerActivityCard",setup(u){const{data:a}=z({path:"dashboard/activity",refetchInterval:1e4,data:{take:999},queryKey:["server","activity"]}),{data:s}=z({path:"dashboard/devices",refetchInterval:1e4,queryKey:["devices"]});return(m,c)=>k(G)?(l(),p(M,{key:0,title:"Activity",background:!1},{cta:d(()=>[...c[0]||(c[0]=[])]),default:d(()=>[(l(!0),g(b,null,X(k(a)?.slice(0,5)??[],v=>(l(),p(ye,{key:v?.id,devices:k(s)??[],activity:v},null,8,["devices","activity"]))),128))]),_:1})):P("",!0)}}),W=Ue;S();var Ie={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-1 xl:row-start-1"},Be={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-3 xl:row-start-1"},je={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 lg:col-start-1 lg:row-start-2 2xl:col-span-2 2xl:col-start-5 2xl:row-start-1 2xl:flex"},Ge=A({__name:"Desktop",setup(u){const a=h(!0);ce(w,v=>{a.value=!!v}),j(()=>{setTimeout(()=>{a.value=!!w.value},1e3)});const{data:s,error:m}=z({path:"dashboard/server/storage",queryKey:["dashboard","storage",Y.value?.serverBaseUrl]});j(()=>{console.raw(s.value)});const c=n(()=>window.CSS.supports("grid-template-rows: masonry"));return(v,o)=>(l(),p(ge,{"grid-style":c.value?3:2,styles:"grid-template-rows: masonry; masonry-surface-flow: next;",title:"Dashboard overview"},{cta:d(()=>[...o[0]||(o[0]=[])]),default:d(()=>[c.value?(l(),g(b,{key:0},[f(H),f(F),f(W),k(G)?(l(),p(J,{key:0})):(l(),p(M,{key:1,class:"animate-pulse",title:"Resources monitor"},{cta:d(()=>[...o[1]||(o[1]=[])]),default:d(()=>[o[2]||(o[2]=r("div",{class:"min-h-80"},null,-1))]),_:1}))],64)):(l(),g(b,{key:1},[r("div",Ie,[f(H),k(G)?(l(),p(J,{key:0})):(l(),p(M,{key:1,class:"animate-pulse",title:"Resources monitor"},{cta:d(()=>[...o[3]||(o[3]=[])]),default:d(()=>[o[4]||(o[4]=r("div",{class:"min-h-80"},null,-1))]),_:1}))]),r("div",Be,[f(F)]),r("div",je,[f(W)])],64))]),_:1},8,["grid-style"]))}}),lt=Ge;export{lt as default};
