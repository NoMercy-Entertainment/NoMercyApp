import{aw as I,q as x,o as c,e as _,a7 as l,a as i,c as $,a_ as A,I as v,bu as M,aC as B,v as n,a6 as p,t as f,aB as h,bt as j,b1 as k,bg as E,u as T,F as U,bF as F,bG as L}from"./index-Cfspi3yO.js";import{u as N}from"./useApiClient-DTjuqj09.js";import{_ as z}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-yjgiH69J.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-2Q8UJgJV.js";import{_ as D}from"./DashboardCard.vue_vue_type_script_setup_true_lang-CDlwuaBW.js";import{_ as K}from"./Modal.vue_vue_type_script_setup_true_lang-CJCb5MvA.js";import"./useMounted-7qPXBrPm.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-B1eDrjD1.js";const O={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},Z=["src"],G=I({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(u,d)=>{const a=x("Avatar");return c(),_(D,{route:`/dashboard/users/${r.data.id}`,line1:r.data.name,line2:""},{image:l(()=>[i("div",O,[d[0]||(d[0]=i("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(c(),$("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,Z)):(c(),_(a,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"])}}}),P={class:"flex w-full flex-col justify-start text-left"},Q={class:"py-4 text-sm text-auto-10"},W={class:"flex flex-col gap-2 w-full"},H={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},J=I({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const{t:u}=A(),d=r;v(null);const a=v(""),m=v([]),{data:b}=M({path:"/dashboard/libraries"}),o=v(),g=()=>{m.value=[],d.close()},y=s=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(s).toLowerCase()),S=B(()=>y(a.value)),q=()=>{var s,e;if(!a.value){m.value.push({type:"error",place:"email",message:u("Email is required")});return}if(!y(a.value)){m.value.push({type:"error",place:"email",message:u("Invalid email address")});return}j().post("server/users",{server_id:(s=k.value)==null?void 0:s.id,email:a.value,libraries:(e=o.value)==null?void 0:e.map(t=>t.id)}).then(()=>{E.invalidateQueries({queryKey:["server_users"]}),a.value="",d.close()}).catch(({response:t})=>{(t==null?void 0:t.status)!=200&&(t!=null&&t.data)&&m.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})};return(s,e)=>{const t=x("InputText"),V=x("MultiSelect");return c(),_(K,{open:r.open,close:g,title:"Invite user"},{actions:l(()=>[n(C,{type:"button",id:"yes",color:"theme",variant:"contained",endIcon:"emailSend",disabled:!S.value,onClick:q},{default:l(()=>[p(f(s.$t("Send")),1)]),_:1},8,["disabled"]),n(C,{type:"button",id:"no",variant:"text",onClick:g},{default:l(()=>[p(f(s.$t("Cancel")),1)]),_:1})]),default:l(()=>[i("div",P,[i("p",Q,[p(f(s.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=i("br",null,null,-1)),p(" "+f(s.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",W,[e[3]||(e[3]=i("label",{for:"email"},"Email",-1)),n(t,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=w=>a.value=w),class:"mb-4"},null,8,["modelValue"])]),i("div",H,[e[4]||(e[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),n(V,{id:"libraries",display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:h(b),optionLabel:"title",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=w=>o.value=w)},null,8,["options","modelValue"])])])]),_:1},8,["open"])}}}),se=I({__name:"Desktop",setup(r){var b;const u=v(!1),{data:d}=N({path:"server_users",params:{server_id:(b=k.value)==null?void 0:b.id},queryKey:["server_users"]}),a=()=>{u.value=!0,setTimeout(()=>{var o;(o=document.querySelector("#email"))==null||o.focus()},300)},m=()=>{u.value=!1};return(o,g)=>(c(),_(h(L),null,{default:l(()=>[n(h(F),{fullscreen:!0},{default:l(()=>[n(z,{gridStyle:1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[n(C,{id:"invite",color:"theme",startIcon:"userAdd",onClick:a},{default:l(()=>[p(f(o.$t("Invite user")),1)]),_:1})]),default:l(()=>[(c(!0),$(U,null,T(h(d),y=>(c(),_(G,{data:y},null,8,["data"]))),256)),n(J,{open:u.value,close:m},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{se as default};
//# sourceMappingURL=Desktop-BRcypbKe.js.map
