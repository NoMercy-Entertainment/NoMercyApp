{"version":3,"file":"Desktop-xCpcco3o.js","sources":["../../src/views/Base/Library/Desktop.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\nimport {IonContent, IonPage, onIonViewDidEnter} from '@ionic/vue';\nimport { isNative } from '@/config/global';\nimport { currentSong } from '@/store/audioPlayer';\n\nimport type { LibraryResponse } from '@/types/api/base/library';\nimport type { PeopleResponse, PersonResponseItem } from '@/types/api/base/person';\nimport type { GenreResponse } from '@/types/api/base/genre';\n\nimport useInfiniteServerClient from '@/lib/clients/useInfiniteServerClient';\nimport { showBackdrops } from '@/store/preferences';\nimport { setBackground, setColorPalette } from '@/store/ui';\nimport router from '@/router';\nimport { setTitle } from '@/lib/stringArray';\n\nimport MediaCard from '@/components/Cards/MediaCard.vue';\nimport PersonCard from '@/components/Cards/PersonCard.vue';\nimport GenreCard from '@/components/Cards/GenreCard.vue';\nimport EmptyCard from '@/components/Cards/EmptyCard.vue';\nimport ScrollContainer from '@/Layout/Desktop/components/ScrollContainer.vue';\nimport {useRoute} from 'vue-router';\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\n\nconst route = useRoute();\n\nconst { data, fetchNextPage, hasNextPage, isError } = useInfiniteServerClient<{\n  data: Array<LibraryResponse | GenreResponse | PeopleResponse>\n}>({\n  queryKey: ['libraries', route?.params.id ?? route.name],\n  limit: 20,\n  keepForever: true,\n});\n\nonMounted(() => {\n  setTitle();\n  setBackground(null);\n  setColorPalette(null);\n  document.dispatchEvent(new Event('sidebar'));\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nconst backdropStyle = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-4 3xl:grid-cols-5 4xl:grid-cols-5 5xl:grid-cols-9 tv:grid-cols-6';\n\nconst posterStyle = 'grid-cols-2 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-7 3xl:grid-cols-9 4xl:grid-cols-10 5xl:grid-cols-[repeat(14,minmax(0,1fr))] tv:grid-cols-6';\n\nconst useBackdropStyle = computed(() => {\n  const firstItem = data.value?.pages?.[0]?.data?.[0];\n  return (\n      firstItem &&\n      showBackdrops.value &&\n      firstItem.media_type !== 'person' &&\n      firstItem.media_type !== 'genres'\n  );\n});\n\nonUnmounted(() => {\n  stop();\n  setBackground(null);\n});\n\nconst lib = ref<HTMLDivElement>();\nconst id = ref();\n\nonMounted(() => {\n  id.value = route.params.id ?? route.name as string;\n\n  if (hasNextPage.value && (data?.value?.pages?.length ?? 0) < 50) {\n    fetchNextPage();\n  }\n\n  document.addEventListener('scrollToDiv', (e: Event) => {\n    lib.value?.scrollTo({\n      // @ts-ignore\n      top: e.detail.top - 100,\n      behavior: 'smooth',\n    });\n  });\n});\n\nonIonViewDidEnter(() => {\n  document.dispatchEvent(new Event('indexer'));\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  if (hasNextPage.value && value?.pages?.length < 50) {\n    fetchNextPage();\n  }\n});\n\nconst selectedCard = ref<LibraryResponse | GenreResponse | PeopleResponse>();\nconst cardMenu = ref();\n\nconst onRightClick = (event: Event, data: LibraryResponse | GenreResponse | PeopleResponse) => {\n  selectedCard.value = data;\n  cardMenu.value.show(event);\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n      <NotFound v-if=\"isError && !data?.pages\" />\n      <ScrollContainer v-else :autoHide=\"true\" :static=\"true\" :id=\"router.currentRoute.value.fullPath\">\n        <div\n            ref=\"containerRef\"\n            class=\"z-0 flex flex-col gap-4 rounded-3xl border-0 p-4 w-available scrollbar-none border-auto-3 transform-gpu will-change-auto\"\n            :class=\"{\n            'pb-24': isNative && !currentSong,\n            'pb-40': isNative && currentSong,\n            'children:pb-4 sm:children:pb-3': !isNative && currentSong\n          }\"\n            :key=\"router.currentRoute.value.params?.id as string\"\n        >\n          <div\n              :class=\"`grid w-full gap-4 scroll-smooth music-showing:pb-0 whitespace-pre ${\n              useBackdropStyle ? backdropStyle : posterStyle\n            }`\"\n          >\n            <!--        <ContextMenu ref=\"cardMenu\" :model=\"items\"/>-->\n            <template v-for=\"(group, index) in data?.pages ?? []\" :key=\"index\">\n              <template v-if=\"group.data.length > 0\">\n                <template v-for=\"(item, index2) in group.data ?? []\">\n                  <MediaCard\n                    v-if=\"item?.media_type === 'tv' || item?.media_type == 'movie' || item?.media_type == 'collection' || item?.media_type == 'specials'\"\n                    :key=\"item.id\" :data=\"item as LibraryResponse\" @context-menu=\"onRightClick($event, item)\"\n                    :index=\"index2\" />\n                  <PersonCard v-else-if=\"item?.media_type === 'person'\" :key=\"item.id + '_person'\"\n                    :data=\"item as PersonResponseItem\" @context-menu=\"onRightClick($event, item)\" :index=\"index2\" />\n                  <GenreCard v-else-if=\"item?.media_type === 'genres'\" :key=\"item.id + '_genres'\"\n                    :data=\"item as GenreResponse\" @context-menu=\"onRightClick($event, item)\" :index=\"index2\" />\n                </template>\n              </template>\n              <template v-else-if=\"data?.pages?.[0]?.data?.length == 0\">\n                <EmptyCard />\n              </template>\n            </template>\n          </div>\n        </div>\n      </ScrollContainer>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["backdropStyle","posterStyle","route","useRoute","data","fetchNextPage","hasNextPage","isError","useInfiniteServerClient","onMounted","setTitle","setBackground","setColorPalette","watch","value","useBackdropStyle","computed","firstItem","_d","_c","_b","_a","showBackdrops","onUnmounted","lib","ref","id","e","onIonViewDidEnter","selectedCard","cardMenu","onRightClick","event"],"mappings":"muBAmDA,MAAMA,GAAgB,0IAEhBC,GAAc,qMA7BpB,MAAMC,EAAQC,EAAS,EAEjB,CAAE,KAAAC,EAAM,cAAAC,EAAe,YAAAC,EAAa,QAAAC,CAAA,EAAYC,EAEnD,CACD,SAAU,CAAC,aAAaN,GAAA,YAAAA,EAAO,OAAO,KAAMA,EAAM,IAAI,EACtD,MAAO,GACP,YAAa,EAAA,CACd,EAEDO,EAAU,IAAM,CACLC,EAAA,EACTC,EAAc,IAAI,EAClBC,EAAgB,IAAI,EACpB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,EAC3C,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAEKC,EAAAT,EAAOU,GAAU,CAChBA,GACL,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAMK,MAAAC,EAAmBC,EAAS,IAAM,aACtC,MAAMC,GAAYC,GAAAC,GAAAC,GAAAC,EAAAjB,EAAK,QAAL,YAAAiB,EAAY,QAAZ,YAAAD,EAAoB,KAApB,YAAAD,EAAwB,OAAxB,YAAAD,EAA+B,GACjD,OACID,GACAK,EAAc,OACdL,EAAU,aAAe,UACzBA,EAAU,aAAe,QAAA,CAE9B,EAEDM,EAAY,IAAM,CACX,KAAA,EACLZ,EAAc,IAAI,CAAA,CACnB,EAED,MAAMa,EAAMC,EAAoB,EAC1BC,EAAKD,EAAI,EAEfhB,EAAU,IAAM,SACdiB,EAAG,MAAQxB,EAAM,OAAO,IAAMA,EAAM,KAEhCI,EAAY,UAAUc,GAAAC,EAAAjB,GAAA,YAAAA,EAAM,QAAN,YAAAiB,EAAa,QAAb,YAAAD,EAAoB,SAAU,GAAK,IAC7Cf,EAAA,EAGP,SAAA,iBAAiB,cAAgBsB,GAAa,QACrDN,EAAAG,EAAI,QAAJ,MAAAH,EAAW,SAAS,CAElB,IAAKM,EAAE,OAAO,IAAM,IACpB,SAAU,QAAA,EACX,CACF,CAAA,CACF,EAEDC,EAAkB,IAAM,CACtB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,CAAA,CAC5C,EAEKf,EAAAT,EAAOU,GAAU,OAChBA,GAEDR,EAAY,SAASe,EAAAP,GAAA,YAAAA,EAAO,QAAP,YAAAO,EAAc,QAAS,IAChChB,EAAA,CAChB,CACD,EAED,MAAMwB,EAAeJ,EAAsD,EACrEK,EAAWL,EAAI,EAEfM,EAAe,CAACC,EAAc5B,IAA2D,CAC7FyB,EAAa,MAAQzB,EACZ0B,EAAA,MAAM,KAAKE,CAAK,CAC3B"}