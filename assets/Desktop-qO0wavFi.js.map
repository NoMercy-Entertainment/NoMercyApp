{"version":3,"file":"Desktop-qO0wavFi.js","sources":["../../src/views/Base/Library/Desktop.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {computed, onMounted, onUnmounted, ref, watch} from 'vue';\nimport {IonContent, IonPage} from '@ionic/vue';\nimport {isNative} from '@/config/global';\nimport {currentSong} from '@/store/audioPlayer';\n\nimport type {LibraryResponse} from '@/types/api/base/library';\nimport type {PeopleResponse, PersonResponseItem} from '@/types/api/base/person';\nimport type {GenreResponse} from '@/types/api/base/genre';\n\nimport useInfiniteServerClient from '@/lib/clients/useInfiniteServerClient';\nimport {showBackdrops} from '@/store/preferences';\nimport {setBackground, setColorPalette} from '@/store/ui';\nimport router from '@/router';\nimport {setTitle} from '@/lib/stringArray';\n\nimport MediaCard from '@/components/Cards/MediaCard.vue';\nimport PersonCard from '@/components/Cards/PersonCard.vue';\nimport GenreCard from '@/components/Cards/GenreCard.vue';\nimport EmptyCard from '@/components/Cards/EmptyCard.vue';\nimport ScrollContainer from '@/Layout/Desktop/components/ScrollContainer.vue';\nimport {useRouter} from 'vue-router';\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\n\nconst routing = useRouter();\n\nconst {data, fetchNextPage, hasNextPage, isError} = useInfiniteServerClient<{\n  data: Array<LibraryResponse | GenreResponse | PeopleResponse>\n}>({\n  queryKey: ['libraries', routing.currentRoute?.value?.params.id ?? routing.currentRoute.value.name],\n  limit: 20,\n  keepForever: true,\n});\n\nconst backdropStyle = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-4 3xl:grid-cols-5 4xl:grid-cols-5 5xl:grid-cols-9 tv:grid-cols-6';\n\nconst posterStyle = 'grid-cols-2 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-7 3xl:grid-cols-9 4xl:grid-cols-10 5xl:grid-cols-[repeat(14,minmax(0,1fr))] tv:grid-cols-6';\n\nconst useBackdropStyle = computed(() => {\n  return showBackdrops.value && data.value?.pages?.[0]?.data[0].media_type !== 'person' && data.value?.pages?.[0]?.data[0].media_type !== 'genres';\n});\n\nonMounted(() => {\n  setTitle();\n  setBackground(null);\n  setColorPalette(null);\n\n  if (hasNextPage.value && (data?.value?.pages?.length ?? 0) < 50) {\n    fetchNextPage();\n  }\n\n  document.dispatchEvent(new Event('sidebar'));\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 500);\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  if (hasNextPage.value && value?.pages?.length < 50) {\n    fetchNextPage();\n  }\n\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 500);\n});\n\nonUnmounted(() => {\n  setTitle();\n  setBackground(null);\n  setColorPalette(null);\n});\n\nconst selectedCard = ref<LibraryResponse | GenreResponse | PeopleResponse>();\nconst cardMenu = ref();\n\nconst onRightClick = (event: Event, data: LibraryResponse | GenreResponse | PeopleResponse) => {\n  selectedCard.value = data;\n  cardMenu.value.show(event);\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n      <NotFound v-if=\"isError\" />\n      <ScrollContainer v-else :autoHide=\"true\" :static=\"true\" :id=\"router.currentRoute.value.fullPath\">\n      <div\n           class=\"z-0 flex flex-col gap-4 rounded-3xl border-0 p-4 w-available scrollbar-none border-auto-3\"\n           :class=\"{\n             'pb-24' : isNative &&  !currentSong,\n             'pb-40' : isNative &&  currentSong,\n             'children:pb-4 sm:children:pb-3' : !isNative &&  currentSong\n          }\"\n           :key=\"router.currentRoute.value.params?.id as string\">\n\n        <div\n            :class=\"`grid w-full gap-4 scroll-smooth music-showing:pb-0 whitespace-pre ${useBackdropStyle ? backdropStyle : posterStyle}`\">\n  <!--        <ContextMenu ref=\"cardMenu\" :model=\"items\"/>-->\n            <template v-for=\"(group, index) in data?.pages ?? []\" :key=\"index\">\n              <template v-if=\"group.data.length > 0\">\n                <template v-for=\"(item, index2) in group.data ?? []\">\n                  <MediaCard\n                      v-if=\"item?.media_type === 'tv' || item?.media_type == 'movie' || item?.media_type == 'collection' || item?.media_type == 'specials'\"\n                      :key=\"item.id\"\n                      :data=\"item as LibraryResponse\"\n                      @context-menu=\"onRightClick($event, item)\"\n                      :index=\"index2\"/>\n                  <PersonCard\n                      v-else-if=\"item?.media_type === 'person'\"\n                      :key=\"item.id + '_person'\"\n                      :data=\"item as PersonResponseItem\"\n                      @context-menu=\"onRightClick($event, item)\"\n                      :index=\"index2\"/>\n                  <GenreCard\n                      v-else-if=\"item?.media_type === 'genres'\"\n                      :key=\"item.id + '_genres'\"\n                      :data=\"item as GenreResponse\"\n                      @context-menu=\"onRightClick($event, item)\"\n                      :index=\"index2\"/>\n                </template>\n              </template>\n              <template v-else-if=\"data?.pages?.[0]?.data?.length == 0\">\n                <EmptyCard/>\n              </template>\n          </template>\n        </div>\n      </div>\n    </ScrollContainer>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["backdropStyle","posterStyle","routing","useRouter","data","fetchNextPage","hasNextPage","isError","useInfiniteServerClient","_b","_a","useBackdropStyle","computed","showBackdrops","_c","_f","_e","_d","onMounted","setTitle","setBackground","setColorPalette","watch","value","onUnmounted","selectedCard","ref","cardMenu","onRightClick","event"],"mappings":"ytBAkCA,MAAMA,GAAgB,0IAEhBC,GAAc,6MAZpB,MAAMC,EAAUC,EAAU,EAEpB,CAAC,KAAAC,EAAM,cAAAC,EAAe,YAAAC,EAAa,QAAAC,CAAA,EAAWC,EAEjD,CACD,SAAU,CAAC,cAAaC,GAAAC,EAAAR,EAAQ,eAAR,YAAAQ,EAAsB,QAAtB,YAAAD,EAA6B,OAAO,KAAMP,EAAQ,aAAa,MAAM,IAAI,EACjG,MAAO,GACP,YAAa,EAAA,CACd,EAMKS,EAAmBC,EAAS,IAAM,iBAC/B,OAAAC,EAAc,SAASC,GAAAL,GAAAC,EAAAN,EAAK,QAAL,YAAAM,EAAY,QAAZ,YAAAD,EAAoB,KAApB,YAAAK,EAAwB,KAAK,GAAG,cAAe,YAAYC,GAAAC,GAAAC,EAAAb,EAAK,QAAL,YAAAa,EAAY,QAAZ,YAAAD,EAAoB,KAApB,YAAAD,EAAwB,KAAK,GAAG,cAAe,QAAA,CACzI,EAEDG,EAAU,IAAM,SACLC,EAAA,EACTC,EAAc,IAAI,EAClBC,EAAgB,IAAI,EAEhBf,EAAY,UAAUG,GAAAC,EAAAN,GAAA,YAAAA,EAAM,QAAN,YAAAM,EAAa,QAAb,YAAAD,EAAoB,SAAU,GAAK,IAC7CJ,EAAA,EAGhB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,EAC3C,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAG,CAAA,CACP,EAEKiB,EAAAlB,EAAOmB,GAAU,OAChBA,IAEDjB,EAAY,SAASI,EAAAa,GAAA,YAAAA,EAAO,QAAP,YAAAb,EAAc,QAAS,IAChCL,EAAA,EAGhB,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAG,EAAA,CACP,EAEDmB,EAAY,IAAM,CACPL,EAAA,EACTC,EAAc,IAAI,EAClBC,EAAgB,IAAI,CAAA,CACrB,EAED,MAAMI,EAAeC,EAAsD,EACrEC,EAAWD,EAAI,EAEfE,EAAe,CAACC,EAAczB,IAA2D,CAC7FqB,EAAa,MAAQrB,EACZuB,EAAA,MAAM,KAAKE,CAAK,CAC3B"}