{"version":3,"file":"Mobile-53RM811v.js","sources":["../../src/views/Base/Watch/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onBeforeUnmount, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { IonContent, IonPage, isPlatform, onIonViewDidEnter } from '@ionic/vue';\nimport { App } from '@capacitor/app';\n\nimport { disableImmersiveMode, enableImmersiveMode, lockLandscape, lockPortrait } from '@/lib/utils';\nimport { isNative } from '@/config/global';\nimport { currentServer } from '@/store/currentServer';\nimport { user } from '@/store/user';\nimport { setDisableScreensaver } from '@/store/imageModal';\n\nimport type { NMPlayer, PlaylistItem, PlayerConfig } from '@/lib/VideoPlayer';\nimport {\n  AutoSkipPlugin,\n  DesktopUIPlugin,\n  nmplayer,\n  OctopusPlugin,\n  SyncPlugin\n} from '@/lib/VideoPlayer';\n\nimport audioPlayer from '@/store/audioPlayer';\nimport router from \"@/router\";\nimport useServerClient from \"@/lib/clients/useServerClient\";\nimport { setNavBarVisible } from \"@/store/ui\";\n\nconst { data, isError } = useServerClient<PlaylistItem[]>({\n\n});\n\ninterface MyNmPlayer extends NMPlayer {\n  showInProduction: () => boolean;\n  getPlaylistItem: () => PlaylistItem & {\n    tmdb_id: number,\n    special_id: number,\n    video_type: string,\n    video_id: number;\n  };\n}\n\nconst player = ref<MyNmPlayer>();\n\nconst initPlayer = (value: PlaylistItem[] | undefined) => {\n\n  const config: PlayerConfig = {\n    muted: false,\n    controls: false,\n    preload: 'auto',\n    debug: false,\n    autoPlay: true,\n    playlist: value?.filter(item => !!item.id) ?? [],\n\n    controlsTimeout: 3000,\n    doubleClickDelay: 300,\n    playbackRates: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n    ],\n    accessToken: user.value?.accessToken || localStorage.getItem('access_token') || '',\n    basePath: currentServer.value?.serverBaseUrl,\n    forceTvMode: (isPlatform('android') || isPlatform('ios')) && !isPlatform('mobile'),\n    disableTouchControls: false,\n    disableMediaControls: 'mediaSession' in navigator || isPlatform('capacitor'),\n    renderAhead: 100,\n  };\n\n  // @ts-ignore\n  player.value = nmplayer('player1')\n    .setup(config);\n\n  player.value?.once('back', () => {\n    //\n  });\n\n  const desktopUIPlugin = new DesktopUIPlugin();\n  player.value?.registerPlugin('desktopUI', desktopUIPlugin);\n  player.value?.usePlugin('desktopUI');\n\n  const autoSkipPlugin = new AutoSkipPlugin();\n  player.value?.registerPlugin('autoSkip', autoSkipPlugin);\n  player.value?.usePlugin('autoSkip');\n\n  const syncPlugin = new SyncPlugin();\n  player.value?.registerPlugin('sync', syncPlugin);\n  player.value?.usePlugin('sync');\n\n  const octopusPlugin = new OctopusPlugin();\n  player.value?.registerPlugin('octopus', octopusPlugin);\n  player.value?.usePlugin('octopus');\n\n  // const sabrePlugin = new SabrePlugin();\n  // player.value?.registerPlugin('sabre', sabrePlugin);\n  // player.value?.usePlugin('sabre');\n\n  player.value?.once('play', () => {\n    player.value?.enterFullscreen();\n  });\n\n  player.value?.on('playlistComplete', () => {\n    player.value?.dispose();\n    router.back();\n  });\n\n  player.value?.on('back', () => {\n    router.back();\n  });\n\n  player.value?.on('play', () => {\n    setDisableScreensaver(true);\n  });\n\n  player.value?.on('pause', () => {\n    setDisableScreensaver(false);\n  });\n\n  player.value?.on('ready', () => {\n    lockLandscape();\n    enableImmersiveMode();\n    audioPlayer.stop();\n  });\n\n  player.value?.on('item', () => {\n    player.value?.play();\n  });\n\n  App.addListener('backButton', () => {\n    player.value?.emit('back-button-hyjack');\n    router.back();\n  });\n\n};\n\nwatch(data, (value) => {\n  if (!value) return;\n  initPlayer(value);\n});\n\nonMounted(() => {\n  setNavBarVisible(false);\n  if (data.value) {\n    initPlayer(data.value);\n  }\n});\n\nonBeforeUnmount(() => {\n  lockPortrait();\n  disableImmersiveMode();\n});\n\nonUnmounted(() => {\n  player.value?.dispose();\n  setDisableScreensaver(false);\n});\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\">\n      <Teleport to=\"body\">\n        <div class=\"absolute inset-0 flex h-full w-full overflow-clip bg-black z-1199\" :class=\"{\n          'mb-28': isNative,\n          'mb-0': !isNative,\n        }\">\n          <div id=\"player1\" class=\"group nomercyplayer\"></div>\n        </div>\n      </Teleport>\n    </ion-content>\n  </ion-page>\n</template>\n\n<style>\n.nomercyplayer .top-bar {\n  @apply pt-safe-offset-4;\n}\n</style>\n"],"names":["data","useServerClient","player","ref","initPlayer","value","config","item","_a","user","_b","currentServer","isPlatform","nmplayer","_c","desktopUIPlugin","DesktopUIPlugin","_d","_e","autoSkipPlugin","AutoSkipPlugin","_f","_g","syncPlugin","SyncPlugin","_h","_i","octopusPlugin","OctopusPlugin","_j","_k","_l","_m","router","_n","_o","setDisableScreensaver","_p","_q","lockLandscape","enableImmersiveMode","audioPlayer","_r","App","watch","onMounted","setNavBarVisible","onBeforeUnmount","lockPortrait","disableImmersiveMode","onUnmounted"],"mappings":"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"}