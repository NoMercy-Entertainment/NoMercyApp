import{n as ae}from"./rolldown-runtime-C0YIJfRR.js";var x,k,B,f,H,w,R,L,P,W,g,j,v,M,_,C,N,D,K,U,Y,A,G,I,q,z,F,J,m,Q,V,X,E,O,Z,T,ee,te,re,oe,ne,b,se,ce,le,y,ie,$,pe,ue=ae(()=>{x=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),k=e=>{const t=[];let o=0;return e=e.replace(/(\[[^\]]*\])/g,(n,r)=>{const s=`__ph-${o}__`;return t.push(r),o++,s}),{content:e.replace(/(:nth-[-\w]+)(\([^)]+\))/g,(n,r,s)=>{const c=`__ph-${o}__`;return t.push(s),o++,r+c}),placeholders:t}},B=(e,t)=>t.replace(/__ph-(\d+)__/g,(o,n)=>e[+n]),f="-shadowcsshost",H="-shadowcssslotted",w="-shadowcsscontext",R=")(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))?([^,{]*)",L=new RegExp("("+f+R,"gim"),P=new RegExp("("+w+R,"gim"),W=new RegExp("("+H+R,"gim"),g=f+"-no-combinator",j=/-shadowcsshost-no-combinator([^\s]*)/,v=[/::shadow/g,/::content/g],M="([>\\s~+[.,{:][\\s\\S]*)?$",_=/-shadowcsshost/gim,C=e=>new RegExp(`((?<!(^@supports(.*)))|(?<={.*))(${e}\\b)`,"gim"),N=C("::slotted"),D=C(":host"),K=C(":host-context"),U=/\/\*\s*[\s\S]*?\*\//g,Y=e=>e.replace(U,""),A=/\/\*\s*#\s*source(Mapping)?URL=[\s\S]+?\*\//g,G=e=>e.match(A)||[],I=/(\s*)([^;\{\}]+?)(\s*)((?:{%BLOCK%}?\s*;?)|(?:\s*;))/g,q=/([{}])/g,z=/(^.*?[^\\])??((:+)(.*)|$)/,F="{",J="}",m="%BLOCK%",Q=(e,t)=>{const o=V(e);let n=0;return o.escapedString.replace(I,(...r)=>{const s=r[2];let c="",l=r[4],i="";l&&l.startsWith("{"+m)&&(c=o.blocks[n++],l=l.substring(m.length+1),i="{");const u=t({selector:s,content:c});return`${r[1]}${u.selector}${r[3]}${i}${u.content}${l}`})},V=e=>{const t=e.split(q),o=[],n=[];let r=0,s=[];for(let c=0;c<t.length;c++){const l=t[c];l===J&&r--,r>0?s.push(l):(s.length>0&&(n.push(s.join("")),o.push(m),s=[]),o.push(l)),l===F&&r++}return s.length>0&&(n.push(s.join("")),o.push(m)),{escapedString:o.join(""),blocks:n}},X=e=>(e=e.replace(K,`$1${w}`).replace(D,`$1${f}`).replace(N,`$1${H}`),e),E=(e,t,o)=>e.replace(t,(...n)=>{if(n[2]){const r=n[2].split(","),s=[];for(let c=0;c<r.length;c++){const l=r[c].trim();if(!l)break;s.push(o(g,l,n[3]))}return s.join(",")}else return g+n[3]}),O=(e,t,o)=>e+t.replace(f,"")+o,Z=e=>E(e,L,O),T=(e,t,o)=>t.indexOf(f)>-1?O(e,t,o):e+t+o+", "+t+" "+e+o,ee=(e,t)=>{const o="."+t+" > ",n=[];return e=e.replace(W,(...r)=>{if(r[2]){const s=r[2].trim(),c=r[3],l=o+s+c;let i="";for(let h=r[4]-1;h>=0;h--){const a=r[5][h];if(a==="}"||a===",")break;i=a+i}const u=(i+l).trim(),d=`${i.trimEnd()}${l.trim()}`.trim();if(u!==d){const h=`${d}, ${u}`;n.push({orgSelector:u,updatedSelector:h})}return l}else return g+r[3]}),{selectors:n,cssText:e}},te=e=>E(e,P,T),re=e=>v.reduce((t,o)=>t.replace(o," "),e),oe=e=>(e=e.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),new RegExp("^("+e+")"+M,"m")),ne=(e,t)=>!oe(t).test(e),b=(e,t)=>e.replace(z,(o,n="",r,s="",c="")=>n+t+s+c),se=(e,t,o)=>{if(_.lastIndex=0,_.test(e)){const n=`.${o}`;return e.replace(j,(r,s)=>b(s,n)).replace(_,n+" ")}return t+" "+e},ce=(e,t,o)=>{t=t.replace(/\[is=([^\]]*)\]/g,(a,...p)=>p[0]);const n="."+t,r=a=>{let p=a.trim();if(!p)return"";if(a.indexOf(g)>-1)p=se(a,t,o);else{const S=a.replace(_,"");S.length>0&&(p=b(S,n))}return p},s=k(e);e=s.content;let c="",l=0,i;const u=/( |>|\+|~(?!=))\s*/g;let d=!(e.indexOf(g)>-1);for(;(i=u.exec(e))!==null;){const a=i[1],p=e.slice(l,i.index).trim();d=d||p.indexOf(g)>-1;const S=d?r(p):p;c+=`${S} ${a} `,l=u.lastIndex}const h=e.substring(l);return d=d||h.indexOf(g)>-1,c+=d?r(h):h,B(s.placeholders,c)},le=(e,t,o,n)=>e.split(",").map(r=>n&&r.indexOf("."+n)>-1?r.trim():ne(r,t)?ce(r,t,o).trim():r.trim()).join(", "),y=(e,t,o,n)=>Q(e,r=>{let s=r.selector,c=r.content;return r.selector[0]!=="@"?s=le(r.selector,t,o,n):(r.selector.startsWith("@media")||r.selector.startsWith("@supports")||r.selector.startsWith("@page")||r.selector.startsWith("@document"))&&(c=y(r.content,t,o,n)),{selector:s.replace(/\s{2,}/g," ").trim(),content:c}}),ie=(e,t,o,n)=>{e=X(e),e=Z(e),e=te(e);const r=ee(e,n);return e=r.cssText,e=re(e),t&&(e=y(e,t,o,n)),e=$(e,o),e=e.replace(/>\s*\*\s+([^{, ]+)/gm," $1 "),{cssText:e.trim(),slottedSelectors:r.selectors.map(s=>({orgSelector:$(s.orgSelector,o),updatedSelector:$(s.updatedSelector,o)}))}},$=(e,t)=>e.replace(/-shadowcsshost-no-combinator/g,`.${t}`),pe=(e,t)=>{const o=t+"-h",n=t+"-s",r=G(e);e=Y(e);const s=ie(e,t,o,n);return e=[s.cssText,...r].join(`
`),s.slottedSelectors.forEach(c=>{const l=new RegExp(x(c.orgSelector),"g");e=e.replace(l,c.updatedSelector)}),e}});ue();export{pe as scopeCss};
