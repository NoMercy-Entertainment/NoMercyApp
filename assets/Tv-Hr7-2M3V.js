import{d as p}from"./api-BBofn2cc.js";import{$,ab as j,d as l,f as A,w as g,c as x,o as r,p as y,z as B,a0 as s,av as M,h as d,j as e,x as o,b as k,b9 as q,as as z}from"./vue-ionic-CBB0-pQG.js";import{bv as L,bw as b,L as F,z as i,bx as H,r as T,by as I}from"./index-DWqVqnNr.js";import"./vendor-Dgtccx1h.js";import"./media-C2AqgyMX.js";import"./icons-BW5E66pf.js";import"./swiper-D00Cnjmx.js";import"./music-player-B5ZIX8zK.js";import"./primevue-C9gt6Imy.js";import"./rxjs-BCp2L9Rn.js";const Q={key:0,class:"flex h-screen w-screen flex-nowrap items-center justify-between gap-4 overflow-hidden p-24 text-slate-light-12 dark:text-slate-dark-12 bg-slate-light-3 dark:bg-slate-dark-1"},R={class:"flex w-2/3 flex-col gap-4 font-semibold"},D={class:"text-3xl"},E={class:"flex items-start gap-4"},K={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},P={class:"flex flex-col gap-2 text-lg"},Y={class:"text-2xl font-semibold whitespace-break-spaces"},G={class:"flex items-start gap-4"},J={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},O={class:"flex flex-col gap-2 text-lg"},U={class:"grid w-1/3 place-items-center gap-4 p-4 font-semibold"},W=["src"],X={key:1,class:"grid h-screen w-screen place-items-center"},Z={role:"status"},de=$({__name:"Tv",setup(ee){const{t:c}=j(),C=l(`https://${i?`${i.replace("-","")}.`:""}nomercy.tv/tv`),u=l(""),N=l(!1),h=l(!1),V=l("L"),S=l("canvas"),a=l();A(async()=>{try{await L(),b();const{isAuthenticated:t}=F();t.value=!0}catch{p.post(`https://auth${i}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/auth/device`,{client_id:"nomercy-ui",scope:"openid profile email",cancelToken:new p.CancelToken(n=>n("Cancel repeated request"))},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(n=>{a.value=n.data,h.value=!0}).catch(n=>{console.log(n)})}}),g(a,t=>{t&&(console.log(t),setTimeout(()=>{m()},t.interval*1e3))});function m(){var t;p.post(`https://auth${i}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/token`,{grant_type:"urn:ietf:params:oauth:grant-type:device_code",client_id:"nomercy-ui",scope:"openid",device_code:(t=a.value)==null?void 0:t.device_code},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(async n=>{H(n.data),b(),setTimeout(async()=>{await T.push({name:"Home"})},500)}).catch(()=>{setTimeout(()=>{m()},a.value.interval*1e3)})}return g(I,t=>{t.length!==0&&setTimeout(async()=>{await T.push({name:"Home"})},1e3)}),(t,n)=>(r(),x(s(z),null,{default:y(()=>[B(s(M),{fullscreen:!0},{default:y(()=>{var v,_,f,w;return[h.value&&((v=a.value)!=null&&v.user_code)&&!N.value?(r(),d("div",Q,[e("div",R,[e("h1",D,o(s(c)("Follow these steps on your computer or mobile device")),1),e("div",E,[e("span",K,o(s(c)("Step"))+" 1",1),e("div",P,[e("p",null,o(s(c)("Scan the QR with your phone or go to"))+":",1),e("p",Y,o(C.value)+"?code="+o((_=a.value)==null?void 0:_.user_code),1)])]),e("div",G,[e("span",J,o(s(c)("Step"))+" 2",1),e("div",O,[e("p",null,o(s(c)("Sign in to NoMercy"))+".",1),e("p",null,o(s(c)("Your tv will be ready to watch"))+".",1)])])]),e("div",U,[(f=a.value)!=null&&f.verification_uri_complete?(r(),x(q,{key:0,level:V.value,"render-as":S.value,size:250,value:(w=a.value)==null?void 0:w.verification_uri_complete,class:"bg-white p-1"},null,8,["level","render-as","value"])):k("",!0),u.value?(r(),d("img",{key:1,src:u.value,alt:"",class:"bg-white p-1"},null,8,W)):k("",!0)])])):(r(),d("div",X,[e("div",Z,[e("span",null,o(s(c)("Loading"))+"...",1)])]))]}),_:1})]),_:1}))}});export{de as default};
