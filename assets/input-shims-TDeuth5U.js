import{Gn as z}from"./index-CymNhKD_.js";import{n as j,r as h,t as T}from"./index5-BTkjd2bP.js";import{f as J,g as _,h as Q,i as V,t as B}from"./helpers-mTEs7qfJ.js";import{d as X,i as Z,o as E,s as ee}from"./index8-DyEBw6N5.js";import{n as te,r as re,t as se}from"./keyboard-CzXNBarC.js";var A,D,N,O,F,K,H,C,$,G,U,Y,x,I,p,y,M,q,P,R,W,oe,ie=z(()=>{j(),ee(),J(),re(),A=new WeakMap,D=(e,r,t,s=0,o=!1)=>{A.has(e)!==t&&(t?O(e,r,s,o):F(e,r))},N=e=>e===e.getRootNode().activeElement,O=(e,r,t,s=!1)=>{const o=r.parentNode,i=r.cloneNode(!1);i.classList.add("cloned-input"),i.tabIndex=-1,s&&(i.disabled=!0),o.appendChild(i),A.set(e,i);const a=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${a}px,${t}px,0) scale(0)`},F=(e,r)=>{const t=A.get(e);t&&(A.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""},K=50,H=(e,r,t)=>{if(!t||!r)return()=>{};const s=u=>{N(r)&&D(e,r,u)},o=()=>D(e,r,!1),i=()=>s(!0),a=()=>s(!1);return B(t,"ionScrollStart",i),B(t,"ionScrollEnd",a),r.addEventListener("blur",o),()=>{_(t,"ionScrollStart",i),_(t,"ionScrollEnd",a),r.removeEventListener("blur",o)}},C="input, textarea, [no-blur], [contenteditable]",$=()=>{let e=!0,r=!1;const t=document,s=()=>{r=!0},o=()=>{e=!0},i=a=>{if(r){r=!1;return}const u=t.activeElement;if(!u||u.matches(C))return;const f=a.target;f!==u&&(f.matches(C)||f.closest(C)||(e=!1,setTimeout(()=>{e||u.blur()},50)))};return B(t,"ionScrollStart",s),t.addEventListener("focusin",o,!0),t.addEventListener("touchend",i,!1),()=>{_(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",o,!0),t.removeEventListener("touchend",i,!1)}},G=.3,U=(e,r,t,s)=>{var o;return Y(((o=e.closest("ion-item,[ion-item]"))!==null&&o!==void 0?o:e).getBoundingClientRect(),r.getBoundingClientRect(),t,s)},Y=(e,r,t,s)=>{const o=e.top,i=e.bottom,a=r.top,u=Math.min(r.bottom,s-t),f=a+15,d=u-K-i,c=f-o,l=Math.round(d<0?-d:c>0?-c:0),v=Math.min(l,o-a),S=Math.abs(v)/G;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(o-f)+4}},x="$ionPaddingTimer",I=(e,r,t)=>{const s=e[x];s&&clearTimeout(s),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[x]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},p=(e,r,t)=>{const s=()=>{r&&I(r,0,t)};e.addEventListener("focusout",s,{once:!0})},y=0,M="data-ionic-skip-scroll-assist",q=(e,r,t,s,o,i,a,u=!1)=>{const f=i&&(a===void 0||a.mode===te.None);let d=!1;const c=h!==void 0?h.innerHeight:0,l=w=>{if(d===!1){d=!0;return}R(e,r,t,s,w.detail.keyboardHeight,f,u,c,!1)},v=()=>{d=!1,h===null||h===void 0||h.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute(M)){r.removeAttribute(M);return}R(e,r,t,s,o,f,u,c),h===null||h===void 0||h.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),h===null||h===void 0||h.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},P=e=>{document.activeElement!==e&&(e.setAttribute(M,"true"),e.focus())},R=async(e,r,t,s,o,i,a=!1,u=0,f=!0)=>{if(!t&&!s)return;const d=U(e,t||s,o,u);if(t&&Math.abs(d.scrollAmount)<4){P(r),i&&t!==null&&(I(t,y),p(r,t,()=>y=0));return}if(D(e,r,!0,d.inputSafeY,a),P(r),Q(()=>e.click()),i&&t&&(y=d.scrollPadding,I(t,y)),typeof window<"u"){let c;const l=async()=>{c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await X(t,0,d.scrollAmount,d.scrollDuration),D(e,r,!1,d.inputSafeY),P(r),i&&p(r,t,()=>y=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await E(t),w=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>w-S.scrollTop){r.type==="password"?(d.scrollAmount+=K,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),c=setTimeout(l,1e3);return}}l()}},W=!0,oe=async(e,r)=>{if(T===void 0)return;const t=r==="ios",s=r==="android",o=e.getNumber("keyboardHeight",290),i=e.getBoolean("scrollAssist",!0),a=e.getBoolean("hideCaretOnScroll",t),u=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(T.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,l=new WeakMap,v=await se.getResizeMode(),S=async n=>{await new Promise(g=>V(n,g));const m=n.shadowRoot||n,L=m.querySelector("input")||m.querySelector("textarea"),b=Z(n),k=b?null:n.closest("ion-footer");if(L){if(b&&a&&!c.has(n)){const g=H(n,L,b);c.set(n,g)}if(!(L.type==="date"||L.type==="datetime-local")&&(b||k)&&i&&!l.has(n)){const g=q(n,L,b,k,o,f,v,s);l.set(n,g)}}},w=n=>{if(a){const m=c.get(n);m&&m(),c.delete(n)}if(i){const m=l.get(n);m&&m(),l.delete(n)}};u&&W&&$();for(const n of d)S(n);T.addEventListener("ionInputDidLoad",n=>{S(n.detail)}),T.addEventListener("ionInputDidUnload",n=>{w(n.detail)})}});ie();export{oe as startInputShims};
