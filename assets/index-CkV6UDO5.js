const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BaseLayout-0DTXo1OM.js","assets/i18n-Rm1NkeNf.js","assets/rolldown-runtime-C0YIJfRR.js","assets/vue-core-ChFWZS_w.js","assets/ionic-vX7GXDhi.js","assets/vue-core-ClHTSD12.css","assets/primevue-DkuV93HA.js","assets/query-BPfDyGC_.js","assets/colorScheme-BCEYcXwj.js","assets/md5-D_U-4vyd.js","assets/ChristmasSnow-B4SfeHRB.js","assets/Toggle-2XMrw9sI.js","assets/OfflineBanner-Bk1_yeQt.js","assets/OfflineBanner-DBYvJb0q.css","assets/profileMenu-DjNgSaT0.js","assets/BaseLayout-BN_w_pJt.css","assets/BaseLayout-CiANVFJ2.js","assets/DropdownMenu-Bbdk7pq6.js","assets/utils-D8i-hqKp.js","assets/LyricsOverlay-DahtzPvq.js","assets/icons-Cxv3Wtj4.js","assets/ScrollContainer-BQALzZ77.js","assets/ScrollContainer-CG0oxH43.css","assets/RipperOverlay-BiDt3dFj.js","assets/useMounted-A4MEnwHg.js","assets/ripperSocket-CgRvpbcK.js","assets/signalr-BrWheOh-.js","assets/Indexer-0808JIWo.js","assets/scrollHandlers-DnAB8gDU.js","assets/Indexer-CS654PhQ.css","assets/AppLogo-BXPG5fmA.js","assets/AppLogo-BxAvpjKC.css","assets/KeepCounting-CyiGNbx9.js","assets/useInfiniteServerClient-B6aRbCAO.js","assets/useServerClient-DUgKKIQ0.js","assets/konami-DwN7YsPz.js","assets/search-DMAcnF_G.js","assets/sidebar-0N2uvkvI.js","assets/BaseLayout-CFhGdijD.css","assets/Collection-BI7XzdSX.js","assets/AuthView-BpbuPqei.js","assets/Logout-WJJ--PtA.js","assets/ExploreContainer-_ZRuHPkV.js","assets/ExploreContainer-BZmj7tlQ.css","assets/Home-JKe1-c-F.js","assets/Info-DjUPuGfq.js","assets/Libraries-Bmwlpw-s.js","assets/Library-DBH_BVfu.js","assets/PaginatedLibrary-DAaPYnxt.js","assets/Person-am8K3Nzj.js","assets/Search-D4W44KAZ.js","assets/Watch-BhliEb1d.js","assets/Artist-DGjKGV5m.js","assets/Cards-BGmovMEZ.js","assets/List-C9smz6BL.js","assets/Start-DD6I_QFs.js","assets/Logs-CoU-j2XG.js","assets/Plugins-GvjUfzCy.js","assets/Schedule-DB1DAkPN.js","assets/Metadata-Cj3Lch7w.js","assets/Ripper-C-D4StE_.js","assets/Specials-COMdJfv7.js","assets/Activity-D9JJp66g.js","assets/Devices-BeCsD-XP.js","assets/Dlna-D8uVg7vg.js","assets/EncoderProfiles-CFK-9ud2.js","assets/General-D25E2ZGi.js","assets/Libraries-BLx859uZ.js","assets/Notifications-CHWSH0bR.js","assets/System-Dy-feKyU.js","assets/Users-Bp68riHZ.js","assets/Controls-CPQJEEtP.js","assets/Display-BD47jM6Z.js","assets/Profile-CVvd5lrM.js","assets/Subtitles-JTRX0vMN.js","assets/Cast-BrERAbt4.js","assets/Download-C1E4CvpE.js","assets/SelectServers-StLhA0zp.js","assets/NoServers-Cb48rLnw.js","assets/ServerOffline-DO0y3TtK.js","assets/PostInstall-TytRGxSX.js","assets/NotFound-uqU14GR_.js","assets/Edit-DHrGYfZE.js","assets/DashboardLayout-DEfvDTrt.js","assets/FloatingBackButton-mMiqQgv8.js","assets/Select-FBpxu9wg.js","assets/useApiClient-C7K5Atb5.js","assets/Edit-ZzqtfFEO.js","assets/FolderBrowser-DOs-67GM.js","assets/LanguageSelect-CPabpubG.js","assets/NoResultImage-Cku4LMz1.js","assets/Edit-BRitjS3S.js","assets/Show-CecvAmTt.js","assets/ActivityCard-DxsQTyv8.js","assets/Edit-CQrYkFGm.js","assets/web-Ch-Bphel.js","assets/esm-CVivdEa_.js","assets/esm-B_9M_EjO.js","assets/router-CpaYH2tE.js","assets/deviceInfo-7OX-7MwJ.js","assets/utils-CD8_BsI7.js","assets/user-BGp2frU-.js","assets/routeState-BHfsUTzP.js","assets/PreloadService-B-1jbWNC.js","assets/setupApp-CNe524co.js","assets/setupApp-AD3fIyUN.css","assets/dist-CwT09umP.js","assets/versionCheck-CijlhitS.js","assets/pwa-ClLXpcWV.js","assets/updateState-CMA_0NzW.js"])))=>i.map(i=>d[i]);
import{a as __toCommonJS,n as __esmMin,r as __export,t as __commonJSMin}from"./rolldown-runtime-C0YIJfRR.js";import{B as onBeforeMount,C as createBlock,Ct as unref,D as createStaticVNode,Dt as toDisplayString,E as createSlots,Et as normalizeStyle,F as inject,K as openBlock,M as getCurrentInstance,O as createTextVNode,P as hasInjectionContext,R as mergeProps,S as createBaseVNode,T as createElementBlock,U as onMounted,V as onBeforeUnmount,X as resolveComponent,Y as renderSlot,_t as shallowRef,a as t,at as watchEffect,bt as toRefs,c as init_vue_runtime_esm_bundler,ct as customRef,d as createApp,dt as onScopeDispose,ft as reactive,gt as shallowReadonly,i as instance,it as watch,j as defineComponent,k as createVNode,lt as getCurrentScope,mt as ref,nt as useId,o as __vitePreload,ot as withCtx,pt as readonly,r as esm_default,s as init_preload_helper,tt as useAttrs,ut as isRef,v as Suspense,vt as toRaw,w as createCommentVNode,wt as normalizeClass,x as computed,xt as toValue,yt as toRef$1,z as nextTick}from"./i18n-Rm1NkeNf.js";import{ya as isPlatform}from"./ionic-vX7GXDhi.js";import{E as IonRouterOutlet,V as useKeyboard,d as dist_exports,f as init_dist$1,h as IonApp,m as createWebHistory,p as createRouter,u as $}from"./vue-core-ChFWZS_w.js";import{C as useToast,_ as script$1,b as script,g as script$2}from"./primevue-DkuV93HA.js";import{a as axios_default,i as clsx,n as cva,r as twMerge}from"./utils-D8i-hqKp.js";import{s as QueryClient}from"./query-BPfDyGC_.js";import{i as LogLevel,n as HubConnectionBuilder,r as HttpTransportType}from"./signalr-BrWheOh-.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))E(S);new MutationObserver(S=>{for(const R of S)if(R.type==="childList")for(const L of R.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&E(L)}).observe(document,{childList:!0,subtree:!0});function g(S){const R={};return S.integrity&&(R.integrity=S.integrity),S.referrerPolicy&&(R.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?R.credentials="include":S.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function E(S){if(S.ep)return;S.ep=!0;const R=g(S);fetch(S.href,R)}})();var RECOVERY_KEY="nomercy_chunk_recovery";async function clearCachesAndReload(){if(!sessionStorage.getItem(RECOVERY_KEY)){sessionStorage.setItem(RECOVERY_KEY,"1");try{if("caches"in window){const c=await caches.keys();await Promise.all(c.map(h=>caches.delete(h)))}if("serviceWorker"in navigator){const c=await navigator.serviceWorker.getRegistrations();await Promise.all(c.map(h=>h.unregister()))}}catch{}window.location.reload()}}function isChunkError(c){const h=c.toLowerCase();return h.includes("loading chunk")||h.includes("failed to fetch dynamically imported module")||h.includes("importing a module script failed")||h.includes("error loading dynamically imported module")||h.includes("failed to load module script")||h.includes("load failed")&&h.includes("module")||h.includes("syntaxerror")&&h.includes("expected")}function setupChunkErrorRecovery(){window.addEventListener("error",c=>{const h=c.target;if(h?.tagName==="SCRIPT"||h?.tagName==="LINK"){console.error("Asset load failed:",h.src||h.href),clearCachesAndReload();return}c.message&&isChunkError(c.message)&&(console.error("Chunk loading failed:",c.message),clearCachesAndReload())},!0),window.addEventListener("unhandledrejection",c=>{const h=c.reason,g=h?.message||String(h||"");if(isChunkError(g)){console.error("Chunk loading failed (promise):",g),clearCachesAndReload();return}h instanceof TypeError&&/fetch|module|chunk|import/i.test(g)&&(console.error("Module fetch failed:",g),clearCachesAndReload())})}var MIGRATION_VERSION="v2",MIGRATION_KEY="nomercy_cache_migration";async function runCacheMigration(){if(localStorage.getItem(MIGRATION_KEY)!==MIGRATION_VERSION){console.log("Running cache migration...");try{if("caches"in window){const c=await caches.keys();await Promise.all(c.map(h=>caches.delete(h)))}if("serviceWorker"in navigator){const c=await navigator.serviceWorker.getRegistrations();await Promise.all(c.map(h=>h.unregister()))}localStorage.setItem(MIGRATION_KEY,MIGRATION_VERSION),console.log("Cache migration complete, reloading..."),window.location.reload()}catch(c){console.error("Cache migration failed:",c),localStorage.setItem(MIGRATION_KEY,MIGRATION_VERSION)}}}init_vue_runtime_esm_bundler();function tryOnScopeDispose(c){return getCurrentScope()?(onScopeDispose(c),!0):!1}var localProvidedStateMap=new WeakMap,injectLocal=(...c)=>{var h;const g=c[0],E=(h=getCurrentInstance())==null?void 0:h.proxy;if(E==null&&!hasInjectionContext())throw new Error("injectLocal must be called in setup");return E&&localProvidedStateMap.has(E)&&g in localProvidedStateMap.get(E)?localProvidedStateMap.get(E)[g]:inject(...c)},isClient=typeof window<"u"&&typeof document<"u",isWorker=typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope,notNullish=c=>c!=null,toString=Object.prototype.toString,isObject$1=c=>toString.call(c)==="[object Object]",timestamp=()=>+Date.now(),noop=()=>{},isIOS=getIsIOS();function getIsIOS(){var c,h;return isClient&&((c=window?.navigator)==null?void 0:c.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((h=window?.navigator)==null?void 0:h.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function toRef(...c){if(c.length!==1)return toRef$1(...c);const h=c[0];return typeof h=="function"?readonly(customRef(()=>({get:h,set:noop}))):ref(h)}function createFilterWrapper(c,h){function g(...E){return new Promise((S,R)=>{Promise.resolve(c(()=>h.apply(this,E),{fn:h,thisArg:this,args:E})).then(S).catch(R)})}return g}var bypassFilter=c=>c();function debounceFilter(c,h={}){let g,E,S=noop;const R=C=>{clearTimeout(C),S(),S=noop};let L;return C=>{const x=toValue(c),q=toValue(h.maxWait);return g&&R(g),x<=0||q!==void 0&&q<=0?(E&&(R(E),E=void 0),Promise.resolve(C())):new Promise((X,ie)=>{S=h.rejectOnCancel?ie:X,L=C,q&&!E&&(E=setTimeout(()=>{g&&R(g),E=void 0,X(L())},q)),g=setTimeout(()=>{E&&R(E),E=void 0,X(C())},x)})}}function throttleFilter(...c){let h=0,g,E=!0,S=noop,R,L,k,C,x;!isRef(c[0])&&typeof c[0]=="object"?{delay:L,trailing:k=!0,leading:C=!0,rejectOnCancel:x=!1}=c[0]:[L,k=!0,C=!0,x=!1]=c;const q=()=>{g&&(clearTimeout(g),g=void 0,S(),S=noop)};return ie=>{const se=toValue(L),ue=Date.now()-h,ge=()=>R=ie();return q(),se<=0?(h=Date.now(),ge()):(ue>se&&(C||!E)?(h=Date.now(),ge()):k&&(R=new Promise((ae,Se)=>{S=x?Se:ae,g=setTimeout(()=>{h=Date.now(),E=!0,ae(ge()),q()},Math.max(0,se-ue))})),!C&&!g&&(g=setTimeout(()=>E=!0,se)),E=!1,R)}}function pausableFilter(c=bypassFilter,h={}){const{initialState:g="active"}=h,E=toRef(g==="active");function S(){E.value=!1}function R(){E.value=!0}const L=(...k)=>{E.value&&c(...k)};return{isActive:readonly(E),pause:S,resume:R,eventFilter:L}}function pxValue(c){return c.endsWith("rem")?Number.parseFloat(c)*16:Number.parseFloat(c)}function toArray(c){return Array.isArray(c)?c:[c]}function cacheStringFunction(c){const h=Object.create(null);return g=>h[g]||(h[g]=c(g))}var hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(c=>c.replace(hyphenateRE,"-$1").toLowerCase()),camelizeRE=/-(\w)/g,camelize=cacheStringFunction(c=>c.replace(camelizeRE,(h,g)=>g?g.toUpperCase():""));function getLifeCycleTarget(c){return c||getCurrentInstance()}function useDebounceFn(c,h=200,g={}){return createFilterWrapper(debounceFilter(h,g),c)}function refDebounced(c,h=200,g={}){const E=ref(toValue(c)),S=useDebounceFn(()=>{E.value=c.value},h,g);return watch(c,()=>S()),shallowReadonly(E)}function watchWithFilter(c,h,g={}){const{eventFilter:E=bypassFilter,...S}=g;return watch(c,createFilterWrapper(E,h),S)}function watchPausable(c,h,g={}){const{eventFilter:E,initialState:S="active",...R}=g,{eventFilter:L,pause:k,resume:C,isActive:x}=pausableFilter(E,{initialState:S});return{stop:watchWithFilter(c,h,{...R,eventFilter:L}),pause:k,resume:C,isActive:x}}function tryOnMounted(c,h=!0,g){getLifeCycleTarget(g)?onMounted(c,g):h?c():nextTick(c)}function useToggle(c=!1,h={}){const{truthyValue:g=!0,falsyValue:E=!1}=h,S=isRef(c),R=shallowRef(c);function L(k){if(arguments.length)return R.value=k,R.value;{const C=toValue(g);return R.value=R.value===C?toValue(E):C,R.value}}return S?L:[R,L]}function watchImmediate(c,h,g){return watch(c,h,{...g,immediate:!0})}init_vue_runtime_esm_bundler();var defaultWindow=isClient?window:void 0,defaultDocument=isClient?window.document:void 0,defaultNavigator=isClient?window.navigator:void 0,defaultLocation=isClient?window.location:void 0;function unrefElement(c){var h;const g=toValue(c);return(h=g?.$el)!=null?h:g}function useEventListener(...c){const h=[],g=()=>{h.forEach(k=>k()),h.length=0},E=(k,C,x,q)=>(k.addEventListener(C,x,q),()=>k.removeEventListener(C,x,q)),S=computed(()=>{const k=toArray(toValue(c[0])).filter(C=>C!=null);return k.every(C=>typeof C!="string")?k:void 0}),R=watchImmediate(()=>{var k,C;return[(C=(k=S.value)==null?void 0:k.map(x=>unrefElement(x)))!=null?C:[defaultWindow].filter(x=>x!=null),toArray(toValue(S.value?c[1]:c[0])),toArray(unref(S.value?c[2]:c[1])),toValue(S.value?c[3]:c[2])]},([k,C,x,q])=>{if(g(),!k?.length||!C?.length||!x?.length)return;const X=isObject$1(q)?{...q}:q;h.push(...k.flatMap(ie=>C.flatMap(se=>x.map(ue=>E(ie,se,ue,X)))))},{flush:"post"}),L=()=>{R(),g()};return tryOnScopeDispose(g),L}var _iOSWorkaround=!1;function onClickOutside(c,h,g={}){const{window:E=defaultWindow,ignore:S=[],capture:R=!0,detectIframe:L=!1,controls:k=!1}=g;if(!E)return k?{stop:noop,cancel:noop,trigger:noop}:noop;if(isIOS&&!_iOSWorkaround){_iOSWorkaround=!0;const ae={passive:!0};Array.from(E.document.body.children).forEach(Se=>Se.addEventListener("click",noop,ae)),E.document.documentElement.addEventListener("click",noop,ae)}let C=!0;const x=ae=>toValue(S).some(Se=>{if(typeof Se=="string")return Array.from(E.document.querySelectorAll(Se)).some(xe=>xe===ae.target||ae.composedPath().includes(xe));{const xe=unrefElement(Se);return xe&&(ae.target===xe||ae.composedPath().includes(xe))}});function q(ae){const Se=toValue(ae);return Se&&Se.$.subTree.shapeFlag===16}function X(ae,Se){const xe=toValue(ae),$e=xe.$.subTree&&xe.$.subTree.children;return $e==null||!Array.isArray($e)?!1:$e.some(nt=>nt.el===Se.target||Se.composedPath().includes(nt.el))}const ie=ae=>{const Se=unrefElement(c);if(ae.target!=null&&!(!(Se instanceof Element)&&q(c)&&X(c,ae))&&!(!Se||Se===ae.target||ae.composedPath().includes(Se))){if("detail"in ae&&ae.detail===0&&(C=!x(ae)),!C){C=!0;return}h(ae)}};let se=!1;const ue=[useEventListener(E,"click",ae=>{se||(se=!0,setTimeout(()=>{se=!1},0),ie(ae))},{passive:!0,capture:R}),useEventListener(E,"pointerdown",ae=>{const Se=unrefElement(c);C=!x(ae)&&!!(Se&&!ae.composedPath().includes(Se))},{passive:!0}),L&&useEventListener(E,"blur",ae=>{setTimeout(()=>{var Se;const xe=unrefElement(c);((Se=E.document.activeElement)==null?void 0:Se.tagName)==="IFRAME"&&!xe?.contains(E.document.activeElement)&&h(ae)},0)},{passive:!0})].filter(Boolean),ge=()=>ue.forEach(ae=>ae());return k?{stop:ge,cancel:()=>{C=!1},trigger:ae=>{C=!0,ie(ae),C=!1}}:ge}function useMounted(){const c=shallowRef(!1),h=getCurrentInstance();return h&&onMounted(()=>{c.value=!0},h),c}function useSupported(c){const h=useMounted();return computed(()=>(h.value,!!c()))}var ssrWidthSymbol=Symbol("vueuse-ssr-width");function useSSRWidth(){const c=hasInjectionContext()?injectLocal(ssrWidthSymbol,null):null;return typeof c=="number"?c:void 0}function useMediaQuery(c,h={}){const{window:g=defaultWindow,ssrWidth:E=useSSRWidth()}=h,S=useSupported(()=>g&&"matchMedia"in g&&typeof g.matchMedia=="function"),R=shallowRef(typeof E=="number"),L=shallowRef(),k=shallowRef(!1),C=x=>{k.value=x.matches};return watchEffect(()=>{if(R.value){R.value=!S.value,k.value=toValue(c).split(",").some(x=>{const q=x.includes("not all"),X=x.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),ie=x.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let se=!!(X||ie);return X&&se&&(se=E>=pxValue(X[1])),ie&&se&&(se=E<=pxValue(ie[1])),q?!se:se});return}S.value&&(L.value=g.matchMedia(toValue(c)),k.value=L.value.matches)}),useEventListener(L,"change",C,{passive:!0}),computed(()=>k.value)}var _global=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},globalKey="__vueuse_ssr_handlers__",handlers=getHandlers();function getHandlers(){return globalKey in _global||(_global[globalKey]=_global[globalKey]||{}),_global[globalKey]}function getSSRHandler(c,h){return handlers[c]||h}function usePreferredDark(c){return useMediaQuery("(prefers-color-scheme: dark)",c)}function guessSerializerType(c){return c==null?"any":c instanceof Set?"set":c instanceof Map?"map":c instanceof Date?"date":typeof c=="boolean"?"boolean":typeof c=="string"?"string":typeof c=="object"?"object":Number.isNaN(c)?"any":"number"}var StorageSerializers={boolean:{read:c=>c==="true",write:c=>String(c)},object:{read:c=>JSON.parse(c),write:c=>JSON.stringify(c)},number:{read:c=>Number.parseFloat(c),write:c=>String(c)},any:{read:c=>c,write:c=>String(c)},string:{read:c=>c,write:c=>String(c)},map:{read:c=>new Map(JSON.parse(c)),write:c=>JSON.stringify(Array.from(c.entries()))},set:{read:c=>new Set(JSON.parse(c)),write:c=>JSON.stringify(Array.from(c))},date:{read:c=>new Date(c),write:c=>c.toISOString()}},customStorageEventName="vueuse-storage";function useStorage(c,h,g,E={}){var S;const{flush:R="pre",deep:L=!0,listenToStorageChanges:k=!0,writeDefaults:C=!0,mergeDefaults:x=!1,shallow:q,window:X=defaultWindow,eventFilter:ie,onError:se=re=>{console.error(re)},initOnMounted:ue}=E,ge=(q?shallowRef:ref)(typeof h=="function"?h():h),ae=computed(()=>toValue(c));if(!g)try{g=getSSRHandler("getDefaultStorage",()=>{var re;return(re=defaultWindow)==null?void 0:re.localStorage})()}catch(re){se(re)}if(!g)return ge;const Se=toValue(h),xe=guessSerializerType(Se),$e=(S=E.serializer)!=null?S:StorageSerializers[xe],{pause:nt,resume:we}=watchPausable(ge,re=>ne(re),{flush:R,deep:L,eventFilter:ie});watch(ae,()=>Je(),{flush:R});let ht=!1;const Pe=re=>{ue&&!ht||Je(re)},Ee=re=>{ue&&!ht||A(re)};X&&k&&(g instanceof Storage?useEventListener(X,"storage",Pe,{passive:!0}):useEventListener(X,customStorageEventName,Ee)),ue?tryOnMounted(()=>{ht=!0,Je()}):Je();function Ne(re,U){if(X){const bt={key:ae.value,oldValue:re,newValue:U,storageArea:g};X.dispatchEvent(g instanceof Storage?new StorageEvent("storage",bt):new CustomEvent(customStorageEventName,{detail:bt}))}}function ne(re){try{const U=g.getItem(ae.value);if(re==null)Ne(U,null),g.removeItem(ae.value);else{const bt=$e.write(re);U!==bt&&(g.setItem(ae.value,bt),Ne(U,bt))}}catch(U){se(U)}}function It(re){const U=re?re.newValue:g.getItem(ae.value);if(U==null)return C&&Se!=null&&g.setItem(ae.value,$e.write(Se)),Se;if(!re&&x){const bt=$e.read(U);return typeof x=="function"?x(bt,Se):xe==="object"&&!Array.isArray(bt)?{...Se,...bt}:bt}else return typeof U!="string"?U:$e.read(U)}function Je(re){if(!(re&&re.storageArea!==g)){if(re&&re.key==null){ge.value=Se;return}if(!(re&&re.key!==ae.value)){nt();try{const U=$e.write(ge.value);(re===void 0||re?.newValue!==U)&&(ge.value=It(re))}catch(U){se(U)}finally{re?nextTick(we):we()}}}}function A(re){Je(re.detail)}return ge}var CSS_DISABLE_TRANS="*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}";function useColorMode(c={}){const{selector:h="html",attribute:g="class",initialValue:E="auto",window:S=defaultWindow,storage:R,storageKey:L="vueuse-color-scheme",listenToStorageChanges:k=!0,storageRef:C,emitAuto:x,disableTransition:q=!0}=c,X={auto:"",light:"light",dark:"dark",...c.modes||{}},ie=usePreferredDark({window:S}),se=computed(()=>ie.value?"dark":"light"),ue=C||(L==null?toRef(E):useStorage(L,E,R,{window:S,listenToStorageChanges:k})),ge=computed(()=>ue.value==="auto"?se.value:ue.value),ae=getSSRHandler("updateHTMLAttrs",(nt,we,ht)=>{const Pe=typeof nt=="string"?S?.document.querySelector(nt):unrefElement(nt);if(!Pe)return;const Ee=new Set,Ne=new Set;let ne=null;if(we==="class"){const Je=ht.split(/\s/g);Object.values(X).flatMap(A=>(A||"").split(/\s/g)).filter(Boolean).forEach(A=>{Je.includes(A)?Ee.add(A):Ne.add(A)})}else ne={key:we,value:ht};if(Ee.size===0&&Ne.size===0&&ne===null)return;let It;q&&(It=S.document.createElement("style"),It.appendChild(document.createTextNode(CSS_DISABLE_TRANS)),S.document.head.appendChild(It));for(const Je of Ee)Pe.classList.add(Je);for(const Je of Ne)Pe.classList.remove(Je);ne&&Pe.setAttribute(ne.key,ne.value),q&&(S.getComputedStyle(It).opacity,document.head.removeChild(It))});function Se(nt){var we;ae(h,g,(we=X[nt])!=null?we:nt)}function xe(nt){c.onChanged?c.onChanged(nt,Se):Se(nt)}watch(ge,xe,{flush:"post",immediate:!0}),tryOnMounted(()=>xe(ge.value));const $e=computed({get(){return x?ue.value:ge.value},set(nt){ue.value=nt}});return Object.assign($e,{store:ue,system:se,state:ge})}function useCycleList(c,h){const g=shallowRef(x()),E=toRef(c),S=computed({get(){var q;const X=E.value;let ie=h?.getIndexOf?h.getIndexOf(g.value,X):X.indexOf(g.value);return ie<0&&(ie=(q=h?.fallbackIndex)!=null?q:0),ie},set(q){R(q)}});function R(q){const X=E.value,ie=X.length,se=X[(q%ie+ie)%ie];return g.value=se,se}function L(q=1){return R(S.value+q)}function k(q=1){return L(q)}function C(q=1){return L(-q)}function x(){var q,X;return(X=toValue((q=h?.initialValue)!=null?q:toValue(c)[0]))!=null?X:void 0}return watch(E,()=>R(S.value)),{state:g,index:S,next:k,prev:C,go:R}}function useIntersectionObserver(c,h,g={}){const{root:E,rootMargin:S="0px",threshold:R=0,window:L=defaultWindow,immediate:k=!0}=g,C=useSupported(()=>L&&"IntersectionObserver"in L),x=computed(()=>toArray(toValue(c)).map(unrefElement).filter(notNullish));let q=noop;const X=shallowRef(k),ie=C.value?watch(()=>[x.value,unrefElement(E),X.value],([ue,ge])=>{if(q(),!X.value||!ue.length)return;const ae=new IntersectionObserver(h,{root:unrefElement(ge),rootMargin:S,threshold:R});ue.forEach(Se=>Se&&ae.observe(Se)),q=()=>{ae.disconnect(),q=noop}},{immediate:k,flush:"post"}):noop,se=()=>{q(),ie(),X.value=!1};return tryOnScopeDispose(se),{isSupported:C,isActive:X,pause(){q(),X.value=!1},resume(){X.value=!0},stop:se}}var defaultEvents$1=["mousemove","mousedown","resize","keydown","touchstart","wheel"],oneMinute=6e4;function useIdle(c=oneMinute,h={}){const{initialState:g=!1,listenForVisibilityChange:E=!0,events:S=defaultEvents$1,window:R=defaultWindow,eventFilter:L=throttleFilter(50)}=h,k=shallowRef(g),C=shallowRef(timestamp());let x;const q=()=>{k.value=!1,clearTimeout(x),x=setTimeout(()=>k.value=!0,c)},X=createFilterWrapper(L,()=>{C.value=timestamp(),q()});if(R){const ie=R.document,se={passive:!0};for(const ue of S)useEventListener(R,ue,X,se);E&&useEventListener(ie,"visibilitychange",()=>{ie.hidden||X()},se),g||q()}return{idle:k,lastActive:C,reset:q}}function useLocalStorage(c,h,g={}){const{window:E=defaultWindow}=g;return useStorage(c,h,E?.localStorage,g)}function useNetwork(c={}){const{window:h=defaultWindow}=c,g=h?.navigator,E=useSupported(()=>g&&"connection"in g),S=shallowRef(!0),R=shallowRef(!1),L=shallowRef(void 0),k=shallowRef(void 0),C=shallowRef(void 0),x=shallowRef(void 0),q=shallowRef(void 0),X=shallowRef(void 0),ie=shallowRef("unknown"),se=E.value&&g.connection;function ue(){g&&(S.value=g.onLine,L.value=S.value?void 0:Date.now(),k.value=S.value?Date.now():void 0,se&&(C.value=se.downlink,x.value=se.downlinkMax,X.value=se.effectiveType,q.value=se.rtt,R.value=se.saveData,ie.value=se.type))}const ge={passive:!0};return h&&(useEventListener(h,"offline",()=>{S.value=!1,L.value=Date.now()},ge),useEventListener(h,"online",()=>{S.value=!0,k.value=Date.now()},ge)),se&&useEventListener(se,"change",ue,ge),ue(),{isSupported:E,isOnline:readonly(S),saveData:readonly(R),offlineAt:readonly(L),onlineAt:readonly(k),downlink:readonly(C),downlinkMax:readonly(x),effectiveType:readonly(X),rtt:readonly(q),type:readonly(ie)}}function useOnline(c={}){const{isOnline:h}=useNetwork(c);return h}function useSwipe(c,h={}){const{threshold:g=50,onSwipe:E,onSwipeEnd:S,onSwipeStart:R,passive:L=!0}=h,k=reactive({x:0,y:0}),C=reactive({x:0,y:0}),x=computed(()=>k.x-C.x),q=computed(()=>k.y-C.y),{max:X,abs:ie}=Math,se=computed(()=>X(ie(x.value),ie(q.value))>=g),ue=shallowRef(!1),ge=computed(()=>se.value?ie(x.value)>ie(q.value)?x.value>0?"left":"right":q.value>0?"up":"down":"none"),ae=Pe=>[Pe.touches[0].clientX,Pe.touches[0].clientY],Se=(Pe,Ee)=>{k.x=Pe,k.y=Ee},xe=(Pe,Ee)=>{C.x=Pe,C.y=Ee},$e={passive:L,capture:!L},nt=Pe=>{ue.value&&S?.(Pe,ge.value),ue.value=!1},we=[useEventListener(c,"touchstart",Pe=>{if(Pe.touches.length!==1)return;const[Ee,Ne]=ae(Pe);Se(Ee,Ne),xe(Ee,Ne),R?.(Pe)},$e),useEventListener(c,"touchmove",Pe=>{if(Pe.touches.length!==1)return;const[Ee,Ne]=ae(Pe);xe(Ee,Ne),$e.capture&&!$e.passive&&Math.abs(x.value)>Math.abs(q.value)&&Pe.preventDefault(),!ue.value&&se.value&&(ue.value=!0),ue.value&&E?.(Pe)},$e),useEventListener(c,["touchend","touchcancel"],nt,$e)];return{isSwiping:ue,direction:ge,coordsStart:k,coordsEnd:C,lengthX:x,lengthY:q,stop:()=>we.forEach(Pe=>Pe()),isPassiveEventSupported:!0}}var DEFAULT_UNITS=[{max:6e4,value:1e3,name:"second"},{max:276e4,value:6e4,name:"minute"},{max:72e6,value:36e5,name:"hour"},{max:5184e5,value:864e5,name:"day"},{max:24192e5,value:6048e5,name:"week"},{max:28512e6,value:2592e6,name:"month"},{max:Number.POSITIVE_INFINITY,value:31536e6,name:"year"}];init_vue_runtime_esm_bundler();const u=ref({accessToken:localStorage.getItem("access_token")||"",refreshToken:localStorage.getItem("refresh_token")||"",idToken:localStorage.getItem("id_token")||""}),user=computed(()=>u.value),testUserToken=ref("test"),keycloak=ref({});function setUser(c){u.value=c}function setUserFromWebKeycloak(c){c&&c.decodedToken&&(keycloak.value=c.keycloak.value,u.value={...u.value,name:c.decodedToken.value.display_name,email:c.decodedToken.value.email,id:c.decodedToken.value.sub,accessToken:c.token.value,locale:c.decodedToken.value.locale,moderator:c.decodedToken.value.realm_access?.roles.includes("nova")||!1})}function updateUserFromApi(c){u.value={...u.value,avatarUrl:c.avatarUrl,receivedMessages:c.receivedMessages,sendMessages:c.sendMessages,notifications:c.notifications}}var ExceptionCode,CapacitorException,getPlatformId,createCapacitor,initCapacitorGlobal,Capacitor,registerPlugin,WebPlugin,encode,decode,CapacitorCookiesPluginWeb,CapacitorCookies,readBlobAsBase64,normalizeHttpHeaders,buildUrlParams,buildRequestInit,CapacitorHttpPluginWeb,CapacitorHttp,init_dist=__esmMin(()=>{(function(c){c.Unimplemented="UNIMPLEMENTED",c.Unavailable="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={})),CapacitorException=class extends Error{constructor(c,h,g){super(c),this.message=c,this.code=h,this.data=g}},getPlatformId=c=>{var h,g;return c?.androidBridge?"android":!((g=(h=c?.webkit)===null||h===void 0?void 0:h.messageHandlers)===null||g===void 0)&&g.bridge?"ios":"web"},createCapacitor=c=>{const h=c.CapacitorCustomPlatform||null,g=c.Capacitor||{},E=g.Plugins=g.Plugins||{},S=()=>h!==null?h.name:getPlatformId(c),R=()=>S()!=="web",L=X=>{const ie=x.get(X);return!!(ie?.platforms.has(S())||k(X))},k=X=>{var ie;return(ie=g.PluginHeaders)===null||ie===void 0?void 0:ie.find(se=>se.name===X)},C=X=>c.console.error(X),x=new Map,q=(X,ie={})=>{const se=x.get(X);if(se)return console.warn(`Capacitor plugin "${X}" already registered. Cannot register plugins twice.`),se.proxy;const ue=S(),ge=k(X);let ae;const Se=async()=>(!ae&&ue in ie?ae=typeof ie[ue]=="function"?ae=await ie[ue]():ae=ie[ue]:h!==null&&!ae&&"web"in ie&&(ae=typeof ie.web=="function"?ae=await ie.web():ae=ie.web),ae),xe=(Ee,Ne)=>{var ne,It;if(ge){const Je=ge?.methods.find(A=>Ne===A.name);if(Je)return Je.rtype==="promise"?A=>g.nativePromise(X,Ne.toString(),A):(A,re)=>g.nativeCallback(X,Ne.toString(),A,re);if(Ee)return(ne=Ee[Ne])===null||ne===void 0?void 0:ne.bind(Ee)}else{if(Ee)return(It=Ee[Ne])===null||It===void 0?void 0:It.bind(Ee);throw new CapacitorException(`"${X}" plugin is not implemented on ${ue}`,ExceptionCode.Unimplemented)}},$e=Ee=>{let Ne;const ne=(...It)=>{const Je=Se().then(A=>{const re=xe(A,Ee);if(re){const U=re(...It);return Ne=U?.remove,U}else throw new CapacitorException(`"${X}.${Ee}()" is not implemented on ${ue}`,ExceptionCode.Unimplemented)});return Ee==="addListener"&&(Je.remove=async()=>Ne()),Je};return ne.toString=()=>`${Ee.toString()}() { [capacitor code] }`,Object.defineProperty(ne,"name",{value:Ee,writable:!1,configurable:!1}),ne},nt=$e("addListener"),we=$e("removeListener"),ht=(Ee,Ne)=>{const ne=nt({eventName:Ee},Ne),It=async()=>{we({eventName:Ee,callbackId:await ne},Ne)},Je=new Promise(A=>ne.then(()=>A({remove:It})));return Je.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await It()},Je},Pe=new Proxy({},{get(Ee,Ne){switch(Ne){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ge?ht:nt;case"removeListener":return we;default:return $e(Ne)}}});return E[X]=Pe,x.set(X,{name:X,proxy:Pe,platforms:new Set([...Object.keys(ie),...ge?[ue]:[]])}),Pe};return g.convertFileSrc||(g.convertFileSrc=X=>X),g.getPlatform=S,g.handleError=C,g.isNativePlatform=R,g.isPluginAvailable=L,g.registerPlugin=q,g.Exception=CapacitorException,g.DEBUG=!!g.DEBUG,g.isLoggingEnabled=!!g.isLoggingEnabled,g},initCapacitorGlobal=c=>c.Capacitor=createCapacitor(c),Capacitor=initCapacitorGlobal(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),registerPlugin=Capacitor.registerPlugin,WebPlugin=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(c,h){let g=!1;this.listeners[c]||(this.listeners[c]=[],g=!0),this.listeners[c].push(h);const E=this.windowListeners[c];E&&!E.registered&&this.addWindowListener(E),g&&this.sendRetainedArgumentsForEvent(c);const S=async()=>this.removeListener(c,h);return Promise.resolve({remove:S})}async removeAllListeners(){this.listeners={};for(const c in this.windowListeners)this.removeWindowListener(this.windowListeners[c]);this.windowListeners={}}notifyListeners(c,h,g){const E=this.listeners[c];if(!E){if(g){let S=this.retainedEventArguments[c];S||(S=[]),S.push(h),this.retainedEventArguments[c]=S}return}E.forEach(S=>S(h))}hasListeners(c){var h;return!!(!((h=this.listeners[c])===null||h===void 0)&&h.length)}registerWindowListener(c,h){this.windowListeners[h]={registered:!1,windowEventName:c,pluginEventName:h,handler:g=>{this.notifyListeners(h,g)}}}unimplemented(c="not implemented"){return new Capacitor.Exception(c,ExceptionCode.Unimplemented)}unavailable(c="not available"){return new Capacitor.Exception(c,ExceptionCode.Unavailable)}async removeListener(c,h){const g=this.listeners[c];if(!g)return;const E=g.indexOf(h);this.listeners[c].splice(E,1),this.listeners[c].length||this.removeWindowListener(this.windowListeners[c])}addWindowListener(c){window.addEventListener(c.windowEventName,c.handler),c.registered=!0}removeWindowListener(c){c&&(window.removeEventListener(c.windowEventName,c.handler),c.registered=!1)}sendRetainedArgumentsForEvent(c){const h=this.retainedEventArguments[c];h&&(delete this.retainedEventArguments[c],h.forEach(g=>{this.notifyListeners(c,g)}))}},encode=c=>encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),decode=c=>c.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),CapacitorCookiesPluginWeb=class extends WebPlugin{async getCookies(){const c=document.cookie,h={};return c.split(";").forEach(g=>{if(g.length<=0)return;let[E,S]=g.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");E=decode(E).trim(),S=decode(S).trim(),h[E]=S}),h}async setCookie(c){try{const h=encode(c.key),g=encode(c.value),E=`; expires=${(c.expires||"").replace("expires=","")}`,S=(c.path||"/").replace("path=",""),R=c.url!=null&&c.url.length>0?`domain=${c.url}`:"";document.cookie=`${h}=${g||""}${E}; path=${S}; ${R};`}catch(h){return Promise.reject(h)}}async deleteCookie(c){try{document.cookie=`${c.key}=; Max-Age=0`}catch(h){return Promise.reject(h)}}async clearCookies(){try{const c=document.cookie.split(";")||[];for(const h of c)document.cookie=h.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(c){return Promise.reject(c)}}async clearAllCookies(){try{await this.clearCookies()}catch(c){return Promise.reject(c)}}},CapacitorCookies=registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb}),readBlobAsBase64=async c=>new Promise((h,g)=>{const E=new FileReader;E.onload=()=>{const S=E.result;h(S.indexOf(",")>=0?S.split(",")[1]:S)},E.onerror=S=>g(S),E.readAsDataURL(c)}),normalizeHttpHeaders=(c={})=>{const h=Object.keys(c);return Object.keys(c).map(g=>g.toLocaleLowerCase()).reduce((g,E,S)=>(g[E]=c[h[S]],g),{})},buildUrlParams=(c,h=!0)=>c?Object.entries(c).reduce((g,E)=>{const[S,R]=E;let L,k;return Array.isArray(R)?(k="",R.forEach(C=>{L=h?encodeURIComponent(C):C,k+=`${S}=${L}&`}),k.slice(0,-1)):(L=h?encodeURIComponent(R):R,k=`${S}=${L}`),`${g}&${k}`},"").substr(1):null,buildRequestInit=(c,h={})=>{const g=Object.assign({method:c.method||"GET",headers:c.headers},h),E=normalizeHttpHeaders(c.headers)["content-type"]||"";if(typeof c.data=="string")g.body=c.data;else if(E.includes("application/x-www-form-urlencoded")){const S=new URLSearchParams;for(const[R,L]of Object.entries(c.data||{}))S.set(R,L);g.body=S.toString()}else if(E.includes("multipart/form-data")||c.data instanceof FormData){const S=new FormData;if(c.data instanceof FormData)c.data.forEach((L,k)=>{S.append(k,L)});else for(const L of Object.keys(c.data))S.append(L,c.data[L]);g.body=S;const R=new Headers(g.headers);R.delete("content-type"),g.headers=R}else(E.includes("application/json")||typeof c.data=="object")&&(g.body=JSON.stringify(c.data));return g},CapacitorHttpPluginWeb=class extends WebPlugin{async request(c){const h=buildRequestInit(c,c.webFetchExtra),g=buildUrlParams(c.params,c.shouldEncodeUrlParams),E=g?`${c.url}?${g}`:c.url,S=await fetch(E,h),R=S.headers.get("content-type")||"";let{responseType:L="text"}=S.ok?c:{};R.includes("application/json")&&(L="json");let k,C;switch(L){case"arraybuffer":case"blob":C=await S.blob(),k=await readBlobAsBase64(C);break;case"json":k=await S.json();break;case"document":case"text":default:k=await S.text()}const x={};return S.headers.forEach((q,X)=>{x[X]=q}),{data:k,headers:x,status:S.status,url:S.url}}async get(c){return this.request(Object.assign(Object.assign({},c),{method:"GET"}))}async post(c){return this.request(Object.assign(Object.assign({},c),{method:"POST"}))}async put(c){return this.request(Object.assign(Object.assign({},c),{method:"PUT"}))}async patch(c){return this.request(Object.assign(Object.assign({},c),{method:"PATCH"}))}async delete(c){return this.request(Object.assign(Object.assign({},c),{method:"DELETE"}))}},CapacitorHttp=registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb})});init_dist();init_preload_helper();var Preferences=registerPlugin("Preferences",{web:()=>__vitePreload(()=>import("./web-D04n_TZ1.js"),[]).then(c=>new c.PreferencesWeb)}),language=localStorage.getItem("displayLanguage")?.replace(/"/gu,"")||navigator.language.split("-")?.[0];instance.use(esm_default).init({lng:language,fallbackLng:"en",debug:!1,load:"currentOnly",interpolation:{escapeValue:!1}}).then();var i18next_default=instance;const availableTranslations=["en","nl"],languages=[{iso_639_1:"kw",english_name:"Cornish",name:""},{iso_639_1:"ff",english_name:"Fulah",name:"Fulfulde"},{iso_639_1:"gn",english_name:"Guarani",name:""},{iso_639_1:"id",english_name:"Indonesian",name:"Bahasaindonesia"},{iso_639_1:"lu",english_name:"Luba-Katanga",name:""},{iso_639_1:"nr",english_name:"Ndebele",name:""},{iso_639_1:"os",english_name:"Ossetian; Ossetic",name:""},{iso_639_1:"ru",english_name:"Russian",name:"Pусский"},{iso_639_1:"se",english_name:"Northern Sami",name:""},{iso_639_1:"so",english_name:"Somali",name:"Somali"},{iso_639_1:"es",english_name:"Spanish",name:"Español"},{iso_639_1:"sv",english_name:"Swedish",name:"svenska"},{iso_639_1:"ta",english_name:"Tamil",name:"தமிழ்"},{iso_639_1:"te",english_name:"Telugu",name:"తెలుగు"},{iso_639_1:"tn",english_name:"Tswana",name:""},{iso_639_1:"uk",english_name:"Ukrainian",name:"Український"},{iso_639_1:"uz",english_name:"Uzbek",name:"ozbek"},{iso_639_1:"el",english_name:"Greek",name:"ελληνικά"},{iso_639_1:"co",english_name:"Corsican",name:""},{iso_639_1:"dv",english_name:"Divehi",name:""},{iso_639_1:"kk",english_name:"Kazakh",name:"қазақ"},{iso_639_1:"ki",english_name:"Kikuyu",name:""},{iso_639_1:"or",english_name:"Oriya",name:""},{iso_639_1:"si",english_name:"Sinhalese",name:"සිංහල"},{iso_639_1:"st",english_name:"Sotho",name:""},{iso_639_1:"sr",english_name:"Serbian",name:"Srpski"},{iso_639_1:"ss",english_name:"Swati",name:""},{iso_639_1:"tr",english_name:"Turkish",name:"Türkçe"},{iso_639_1:"wa",english_name:"Walloon",name:""},{iso_639_1:"cn",english_name:"Cantonese",name:"广州话 / 廣州話"},{iso_639_1:"bi",english_name:"Bislama",name:""},{iso_639_1:"cr",english_name:"Cree",name:""},{iso_639_1:"cy",english_name:"Welsh",name:"Cymraeg"},{iso_639_1:"eu",english_name:"Basque",name:"euskera"},{iso_639_1:"hz",english_name:"Herero",name:""},{iso_639_1:"ho",english_name:"Hiri Motu",name:""},{iso_639_1:"ka",english_name:"Georgian",name:"ქართული"},{iso_639_1:"kr",english_name:"Kanuri",name:""},{iso_639_1:"km",english_name:"Khmer",name:""},{iso_639_1:"kj",english_name:"Kuanyama",name:""},{iso_639_1:"to",english_name:"Tonga",name:""},{iso_639_1:"vi",english_name:"Vietnamese",name:"Tiếng Việt"},{iso_639_1:"zu",english_name:"Zulu",name:"isiZulu"},{iso_639_1:"zh",english_name:"Mandarin",name:"普通话"},{iso_639_1:"ps",english_name:"Pushto",name:"پښتو"},{iso_639_1:"mk",english_name:"Macedonian",name:""},{iso_639_1:"ae",english_name:"Avestan",name:""},{iso_639_1:"az",english_name:"Azerbaijani",name:"Azərbaycan"},{iso_639_1:"ba",english_name:"Bashkir",name:""},{iso_639_1:"sh",english_name:"Serbo-Croatian",name:""},{iso_639_1:"lv",english_name:"Latvian",name:"Latviešu"},{iso_639_1:"lt",english_name:"Lithuanian",name:"Lietuvių"},{iso_639_1:"ms",english_name:"Malay",name:"Bahasa melayu"},{iso_639_1:"rm",english_name:"Raeto-Romance",name:""},{iso_639_1:"as",english_name:"Assamese",name:""},{iso_639_1:"gd",english_name:"Gaelic",name:""},{iso_639_1:"ja",english_name:"Japanese",name:"日本語"},{iso_639_1:"ko",english_name:"Korean",name:"한국어/조선말"},{iso_639_1:"ku",english_name:"Kurdish",name:""},{iso_639_1:"mo",english_name:"Moldavian",name:""},{iso_639_1:"mn",english_name:"Mongolian",name:""},{iso_639_1:"nb",english_name:"Norwegian Bokmål",name:"Bokmål"},{iso_639_1:"om",english_name:"Oromo",name:""},{iso_639_1:"pi",english_name:"Pali",name:""},{iso_639_1:"sq",english_name:"Albanian",name:"shqip"},{iso_639_1:"vo",english_name:"Volapük",name:""},{iso_639_1:"bo",english_name:"Tibetan",name:""},{iso_639_1:"da",english_name:"Danish",name:"Dansk"},{iso_639_1:"kl",english_name:"Kalaallisut",name:""},{iso_639_1:"kn",english_name:"Kannada",name:"?????"},{iso_639_1:"nl",english_name:"Dutch",name:"Nederlands"},{iso_639_1:"nn",english_name:"Norwegian Nynorsk",name:""},{iso_639_1:"sa",english_name:"Sanskrit",name:""},{iso_639_1:"am",english_name:"Amharic",name:""},{iso_639_1:"hy",english_name:"Armenian",name:""},{iso_639_1:"bs",english_name:"Bosnian",name:"Bosanski"},{iso_639_1:"hr",english_name:"Croatian",name:"Hrvatski"},{iso_639_1:"mh",english_name:"Marshall",name:""},{iso_639_1:"mg",english_name:"Malagasy",name:""},{iso_639_1:"ne",english_name:"Nepali",name:""},{iso_639_1:"su",english_name:"Sundanese",name:""},{iso_639_1:"ts",english_name:"Tsonga",name:""},{iso_639_1:"ug",english_name:"Uighur",name:""},{iso_639_1:"cs",english_name:"Czech",name:"Český"},{iso_639_1:"jv",english_name:"Javanese",name:""},{iso_639_1:"ro",english_name:"Romanian",name:"Română"},{iso_639_1:"sm",english_name:"Samoan",name:""},{iso_639_1:"tg",english_name:"Tajik",name:""},{iso_639_1:"wo",english_name:"Wolof",name:"Wolof"},{iso_639_1:"br",english_name:"Breton",name:""},{iso_639_1:"fr",english_name:"French",name:"Français"},{iso_639_1:"ga",english_name:"Irish",name:"Gaeilge"},{iso_639_1:"ht",english_name:"Haitian; Haitian Creole",name:""},{iso_639_1:"kv",english_name:"Komi",name:""},{iso_639_1:"mi",english_name:"Maori",name:""},{iso_639_1:"th",english_name:"Thai",name:"ภาษาไทย"},{iso_639_1:"xx",english_name:"No Language",name:"No Language"},{iso_639_1:"af",english_name:"Afrikaans",name:"Afrikaans"},{iso_639_1:"av",english_name:"Avaric",name:""},{iso_639_1:"bm",english_name:"Bambara",name:"Bamanankan"},{iso_639_1:"ca",english_name:"Catalan",name:"Català"},{iso_639_1:"ce",english_name:"Chechen",name:""},{iso_639_1:"de",english_name:"German",name:"Deutsch"},{iso_639_1:"gv",english_name:"Manx",name:""},{iso_639_1:"rw",english_name:"Kinyarwanda",name:"Kinyarwanda"},{iso_639_1:"ky",english_name:"Kirghiz",name:"??????"},{iso_639_1:"ln",english_name:"Lingala",name:""},{iso_639_1:"sn",english_name:"Shona",name:""},{iso_639_1:"yi",english_name:"Yiddish",name:""},{iso_639_1:"be",english_name:"Belarusian",name:"беларуская мова"},{iso_639_1:"cu",english_name:"Slavic",name:""},{iso_639_1:"dz",english_name:"Dzongkha",name:""},{iso_639_1:"eo",english_name:"Esperanto",name:"Esperanto"},{iso_639_1:"fi",english_name:"Finnish",name:"suomi"},{iso_639_1:"fy",english_name:"Frisian",name:""},{iso_639_1:"ie",english_name:"Interlingue",name:""},{iso_639_1:"ia",english_name:"Interlingua",name:""},{iso_639_1:"it",english_name:"Italian",name:"Italiano"},{iso_639_1:"ng",english_name:"Ndonga",name:""},{iso_639_1:"pa",english_name:"Punjabi",name:"ਪੰਜਾਬੀ"},{iso_639_1:"pt",english_name:"Portuguese",name:"Português"},{iso_639_1:"rn",english_name:"Rundi",name:"Kirundi"},{iso_639_1:"fa",english_name:"Persian",name:"فارسی"},{iso_639_1:"ch",english_name:"Chamorro",name:"Finu' Chamorro"},{iso_639_1:"cv",english_name:"Chuvash",name:""},{iso_639_1:"en",english_name:"English",name:"English"},{iso_639_1:"hu",english_name:"Hungarian",name:"Magyar"},{iso_639_1:"ii",english_name:"Yi",name:""},{iso_639_1:"kg",english_name:"Kongo",name:""},{iso_639_1:"li",english_name:"Limburgish",name:""},{iso_639_1:"ml",english_name:"Malayalam",name:""},{iso_639_1:"nv",english_name:"Navajo",name:""},{iso_639_1:"ny",english_name:"Chichewa; Nyanja",name:""},{iso_639_1:"sg",english_name:"Sango",name:""},{iso_639_1:"tw",english_name:"Twi",name:""},{iso_639_1:"ab",english_name:"Abkhazian",name:""},{iso_639_1:"ar",english_name:"Arabic",name:"العربية"},{iso_639_1:"ee",english_name:"Ewe",name:"Èʋegbe"},{iso_639_1:"fo",english_name:"Faroese",name:""},{iso_639_1:"ik",english_name:"Inupiaq",name:""},{iso_639_1:"ks",english_name:"Kashmiri",name:""},{iso_639_1:"lb",english_name:"Letzeburgesch",name:""},{iso_639_1:"nd",english_name:"Ndebele",name:""},{iso_639_1:"oc",english_name:"Occitan",name:""},{iso_639_1:"sk",english_name:"Slovak",name:"Slovenčina"},{iso_639_1:"tt",english_name:"Tatar",name:""},{iso_639_1:"ve",english_name:"Venda",name:""},{iso_639_1:"ay",english_name:"Aymara",name:""},{iso_639_1:"fj",english_name:"Fijian",name:""},{iso_639_1:"gu",english_name:"Gujarati",name:""},{iso_639_1:"io",english_name:"Ido",name:""},{iso_639_1:"lo",english_name:"Lao",name:""},{iso_639_1:"la",english_name:"Latin",name:"Latin"},{iso_639_1:"no",english_name:"Norwegian",name:"Norsk"},{iso_639_1:"oj",english_name:"Ojibwa",name:""},{iso_639_1:"pl",english_name:"Polish",name:"Polski"},{iso_639_1:"qu",english_name:"Quechua",name:""},{iso_639_1:"sl",english_name:"Slovenian",name:"Slovenščina"},{iso_639_1:"sc",english_name:"Sardinian",name:""},{iso_639_1:"sw",english_name:"Swahili",name:"Kiswahili"},{iso_639_1:"tl",english_name:"Tagalog",name:""},{iso_639_1:"ur",english_name:"Urdu",name:"اردو"},{iso_639_1:"bg",english_name:"Bulgarian",name:"български език"},{iso_639_1:"hi",english_name:"Hindi",name:"हिन्दी"},{iso_639_1:"yo",english_name:"Yoruba",name:"Èdè Yorùbá"},{iso_639_1:"ak",english_name:"Akan",name:""},{iso_639_1:"an",english_name:"Aragonese",name:""},{iso_639_1:"bn",english_name:"Bengali",name:"বাংলা"},{iso_639_1:"et",english_name:"Estonian",name:"Eesti"},{iso_639_1:"gl",english_name:"Galician",name:"Galego"},{iso_639_1:"ha",english_name:"Hausa",name:"Hausa"},{iso_639_1:"ig",english_name:"Igbo",name:""},{iso_639_1:"iu",english_name:"Inuktitut",name:""},{iso_639_1:"lg",english_name:"Ganda",name:""},{iso_639_1:"mr",english_name:"Marathi",name:""},{iso_639_1:"mt",english_name:"Maltese",name:"Malti"},{iso_639_1:"my",english_name:"Burmese",name:""},{iso_639_1:"na",english_name:"Nauru",name:""},{iso_639_1:"sd",english_name:"Sindhi",name:""},{iso_639_1:"xh",english_name:"Xhosa",name:""},{iso_639_1:"za",english_name:"Zhuang",name:""},{iso_639_1:"aa",english_name:"Afar",name:""},{iso_639_1:"is",english_name:"Icelandic",name:"Íslenska"},{iso_639_1:"ty",english_name:"Tahitian",name:""},{iso_639_1:"ti",english_name:"Tigrinya",name:""},{iso_639_1:"tk",english_name:"Turkmen",name:""},{iso_639_1:"he",english_name:"Hebrew",name:"עִבְרִית"}];init_vue_runtime_esm_bundler();function persistPreference(c,h){Preferences.set({key:c,value:h}).catch(g=>{console.error(`Failed to persist preference "${c}":`,g)})}var autoThemeColors=useLocalStorage("autoThemeColors",!0);const useAutoThemeColors=computed(()=>autoThemeColors.value);(async()=>{try{const{value:c}=await Preferences.get({key:"autoThemeColors"});if(c===null){autoThemeColors.value=!0,persistPreference("autoThemeColors","true");return}autoThemeColors.value=!!c}catch(c){console.error("Failed to load autoThemeColors:",c)}})();function setUseAutoThemeColors(c){autoThemeColors.value=c,persistPreference("autoThemeColors",c.toString())}var backdrops=useLocalStorage("showBackdrops",!1);const showBackdrops=computed(()=>backdrops.value);(async()=>{try{const{value:c}=await Preferences.get({key:"showBackdrops"});if(c===null){backdrops.value=!1,persistPreference("showBackdrops","false");return}backdrops.value=c==="true"}catch(c){console.error("Failed to load showBackdrops:",c)}})();function setShowBackdrops(c){backdrops.value=c,persistPreference("showBackdrops",c.toString())}var overlayCarouselButtons=useLocalStorage("useOverlayCarouselButtons",!1);const useOverlayCarouselButtons=computed(()=>overlayCarouselButtons.value);(async()=>{try{const{value:c}=await Preferences.get({key:"useOverlayCarouselButtons"});if(c===null){overlayCarouselButtons.value=!1,persistPreference("useOverlayCarouselButtons","false");return}overlayCarouselButtons.value=c==="true"}catch(c){console.error("Failed to load useOverlayCarouselButtons:",c)}})();function setOverlayCarouselButtons(c){overlayCarouselButtons.value=c,persistPreference("useOverlayCarouselButtons",c.toString())}var percentageColors=useLocalStorage("percentageColors",!0);const usePercentageColors=computed(()=>percentageColors.value);(async()=>{try{const{value:c}=await Preferences.get({key:"percentageColors"});if(c===null){percentageColors.value=!0,persistPreference("percentageColors","true");return}percentageColors.value=(c||!0)==="true"}catch(c){console.error("Failed to load percentageColors:",c)}})();function setUsePercentageColors(c){percentageColors.value=c,persistPreference("percentageColors",c.toString())}var screensaverDelayData=useLocalStorage("screensaverDelay",5);const screensaverDelay=computed(()=>screensaverDelayData.value);(async()=>{try{const{value:c}=await Preferences.get({key:"screensaverDelay"});if(c===null){screensaverDelayData.value=5,persistPreference("screensaverDelay","5");return}screensaverDelayData.value=Number.parseInt(c??"5")}catch(c){console.error("Failed to load screensaverDelay:",c)}})();function setScreensaverDelay(c){screensaverDelayData.value=c,persistPreference("screensaverDelay",c.toString())}var lang=useLocalStorage("displayLanguage",window.navigator.language.split("-")?.[0]);const displayLanguage=computed(()=>lang.value);async function setDisplayLanguage(c){lang.value=c,await i18next_default.changeLanguage(c),persistPreference("display_language",c)}(async()=>{try{const{value:c}=await Preferences.get({key:"display_language"});await setDisplayLanguage(c??window.navigator.language.split("-")?.[0])}catch(c){console.error("Failed to load display_language:",c)}})();var client_default=({baseUrl:c,timeout:h})=>{const g=axios_default.create({headers:{Accept:"application/json","Accept-Language":displayLanguage.value,Authorization:`Bearer ${user.value?.accessToken||localStorage.getItem("access_token")}`},timeout:h?h*1e3:void 0,baseURL:c});return g.interceptors.request.use(E=>(keycloak.value.authenticated&&(E.headers.Authorization=`Bearer ${keycloak.value.token||localStorage.getItem("access_token")}`),E),async E=>{if(E.response?.status===401)await keycloak.value.keycloak.updateToken(5).then(()=>axios_default.request(E.config)).catch(()=>Promise.reject(E));else return Promise.reject(E)}),g};init_vue_runtime_esm_bundler();var cs=ref(null);const currentServer=computed(()=>cs.value);function setCurrentServer(c){c?.id&&localStorage.setItem("currentServer",c?.id),cs.value=c}watch(useOnline(),c=>{c&&cs.value&&pingServer(cs.value).then(h=>{cs.value={...cs.value,serverBaseUrl:h.replace(/\/$/,""),serverApiUrl:`${h.replace(/\/$/,"")}/api/v1`}}).catch(h=>{console.error("Failed to ping server:",h)})});async function pingServer(c){const h=`https://${c.internal_domain}:${c.internal_port}`,g=`https://${c.external_domain}:${c.external_port}`;try{return await client_default({baseUrl:h}).get("/api/v1/dashboard/server"),h}catch{}try{return await client_default({baseUrl:g}).get("/api/v1/dashboard/server"),g}catch{throw new Error(`Both internal (${h}) and external (${g}) URLs unreachable`)}}var serverClient_default=c=>{if(!currentServer.value?.serverApiUrl)throw new Error("Server not selected");return client_default({baseUrl:currentServer.value.serverApiUrl,timeout:c})},pendingRequests=new Map;function deduplicatedRequest(c,h){if(pendingRequests.has(c))return pendingRequests.get(c);const g=h().finally(()=>{pendingRequests.delete(c)});return pendingRequests.set(c,g),g}const queryClient=new QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,refetchOnMount:!1,retry:1,retryDelay:c=>Math.min(1e3*2**c,3e4),experimental_prefetchInRender:!0,staleTime:1e3*60*5,gcTime:1e3*60*30}}});init_dist();init_preload_helper();var Device=registerPlugin("Device",{web:()=>__vitePreload(()=>import("./web-DaxF7BXY.js"),[]).then(c=>new c.DeviceWeb)});init_vue_runtime_esm_bundler();const isMobile=useMediaQuery("(max-width: 600px) and (orientation: portrait), (max-height: 600px) and (orientation: landscape)");var nativeOverride=useLocalStorage("nativeOverride",!1);const isNative=computed(()=>isPlatform("cordova")||isPlatform("pwa")||nativeOverride.value),dashboardCardGrid=ref("grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 3xl:grid-cols-7 5xl:grid-cols-10"),dashboardBigCardGrid=ref("grid grid-cols-1 xl:grid-cols-3"),dashboardColumnGrid=ref("grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-6 5xl:grid-cols-10"),buttonClasses="grid relative place-content-center h-10 min-w-10 active:outline outline-focus focus-visible:outline z-0 justify-center disabled:opacity-50 disabled:text-surface-9 text-surface-12/12 disabled:hover:!bg-transparent overflow-clip pointer-events-auto border-none focus:border-none active:border-none focus-visible:sm:ring-white focus-visible:sm:ring-2 group/button gap-2 p-2.5 items-center rounded-lg sm:bg-surface-12/2 active:sm:bg-surface-12/4 focus-visible:sm:bg-surface-12/4 hover:sm:bg-surface-12/4",purple="#94f",blue="#39f",green="#4b4",orange="#f90",red="#f44",brown="#963",gray="#999",isDarkMode=ref(document.body.parentElement.classList.contains("scheme-dark"));function genreColors(c){let h,g,E;switch(c){case"Action & Adventure":h="theme-grass",E="lightning",g="";break;case"Action":h="theme-orange",E="muscle",g="theme-orange";break;case"Adventure":h="theme-gold",E="mapClue",g="theme-gold";break;case"Animation":h="theme-cyan",E="designerTools",g="theme-cyan";break;case"Comedy":h="theme-purple",E="openSmile",g="theme-purple";break;case"Crime":h="theme-tomato",E="chefKnife",g="theme-tomato";break;case"Documentary":h="theme-gray",E="folderOpen",g="theme-gray";break;case"Drama":h="theme-pink",E="sweatSmile",g="theme-pink";break;case"Family":h="theme-indigo",E="multiUsers",g="theme-indigo";break;case"Fantasy":h="theme-green",E="witchHat",g="theme-green";break;case"History":h="theme-brown",E="paperScroll",g="theme-brown";break;case"Horror":h="theme-red",E="ghost",g="theme-red";break;case"Kids":h="theme-blue",E="mouse",g="theme-blue";break;case"Music":h="theme-amber",E="noteSixteenthPair",g="theme-amber";break;case"Mystery":h="theme-teal",E="footPrint",g="theme-teal";break;case"News":h="theme-red",E="globe",g="theme-red";break;case"Reality":h="theme-sky",E="eye",g="theme-sky";break;case"Romance":h="theme-crimson",E="bubbles",g="theme-crimson";break;case"Sci-Fi & Fantasy":h="theme-blue",E="ussEnterprise",g="theme-blue";break;case"Science Fiction":h="theme-sky",E="rocket",g="theme-sky";break;case"Soap":h="theme-violet",E="bubbles",g="theme-violet";break;case"Talk":h="theme-slate",E="megaphone",g="theme-surface";break;case"Thriller":h="theme-mint",E="searchMagnifyingGlass",g="theme-mint";break;case"TV Movie":h="theme-yellow",E="tv",g="theme-yellow";break;case"War & Politics":h="theme-sand",E="medal",g="theme-sand";break;case"War":h="theme-green",E="gun",g="theme-green";break;case"Western":h="theme-yellow",E="cowboyHat",g="theme-yellow";break;default:h=" bg-surface-6/11",E="bat",g=""}return{bg:h,iconBg:g,icon:E}}const media_types=[{title:"Anime",value:"anime"},{title:"Movie",value:"movie"},{title:"TV Show",value:"tv"},{title:"Music",value:"music"},{title:"Images",value:"image"},{title:"Audio Books",value:"audiobook"}],greetingValue=computed(()=>{const c=new Date().getHours();switch(!0){case(c>=6&&c<12):return"Morning";case(c>=12&&c<18):return"Afternoon";case(c>=18&&c<24):return"Evening";case(c>=24||c<6):return"Night"}return"Day"});console.raw=(...c)=>{console.log(...c.map(h=>toRaw(h)))};(async()=>{const c=await Device.getId().then(h=>h.identifier);console.raw({isMobile:isMobile.value,isNativeMobile:isPlatform("mobile"),isWebMobile:isPlatform("mobileweb"),isNative:isNative.value,nativeOverride:nativeOverride.value,isDarkMode:isDarkMode.value,greetingValue:greetingValue.value,device_id:c})})();init_vue_runtime_esm_bundler();var libraries=ref([]);function setLibraries(c){libraries.value=c}function clearLibraries(){libraries.value=[]}var libraries_default=libraries;init_preload_helper();var MobileBaseLayout=()=>__vitePreload(()=>import("./BaseLayout-0DTXo1OM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),DesktopBaseLayout=()=>__vitePreload(()=>import("./BaseLayout-CiANVFJ2.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,17,18,10,19,20,21,22,23,24,25,26,27,28,29,11,12,13,30,31,32,33,34,35,36,37,38])),BaseCollection=()=>__vitePreload(()=>import("./Collection-BI7XzdSX.js"),__vite__mapDeps([39,1,2,3,4,5])),AuthView=()=>__vitePreload(()=>import("./AuthView-BpbuPqei.js"),__vite__mapDeps([40,1,2,3,4,5])),Logout=()=>__vitePreload(()=>import("./Logout-WJJ--PtA.js"),__vite__mapDeps([41,1,2,3,4,5,42,43])),BaseIndex=()=>__vitePreload(()=>import("./Home-JKe1-c-F.js"),__vite__mapDeps([44,1,2,3,4,5])),BaseInfo=()=>__vitePreload(()=>import("./Info-DjUPuGfq.js"),__vite__mapDeps([45,1,2,3,4,5])),BaseLibraries=()=>__vitePreload(()=>import("./Libraries-Bmwlpw-s.js"),__vite__mapDeps([46,1,2,3,4,5])),BaseLibrary=()=>__vitePreload(()=>import("./Library-DBH_BVfu.js"),__vite__mapDeps([47,1,2,3,4,5])),PaginatedLibrary=()=>__vitePreload(()=>import("./PaginatedLibrary-DAaPYnxt.js"),__vite__mapDeps([48,1,2,3,4,5])),BasePerson=()=>__vitePreload(()=>import("./Person-am8K3Nzj.js"),__vite__mapDeps([49,1,2,3,4,5])),Search=()=>__vitePreload(()=>import("./Search-D4W44KAZ.js"),__vite__mapDeps([50,1,2,3,4,5])),BaseWatch=()=>__vitePreload(()=>import("./Watch-BhliEb1d.js"),__vite__mapDeps([51,1,2,3,4,5])),MusicArtist=()=>__vitePreload(()=>import("./Artist-DGjKGV5m.js"),__vite__mapDeps([52,1,2,3,4,5])),MusicCards=()=>__vitePreload(()=>import("./Cards-BGmovMEZ.js"),__vite__mapDeps([53,1,2,3,4,5])),MusicList=()=>__vitePreload(()=>import("./List-C9smz6BL.js"),__vite__mapDeps([54,1,2,3,4,5])),MusicStart=()=>__vitePreload(()=>import("./Start-DD6I_QFs.js"),__vite__mapDeps([55,1,2,3,4,5])),DashboardLogs=()=>__vitePreload(()=>import("./Logs-CoU-j2XG.js"),__vite__mapDeps([56,1,2,3,4,5])),DashboardPlugins=()=>__vitePreload(()=>import("./Plugins-GvjUfzCy.js"),__vite__mapDeps([57,1,2,3,4,5])),DashboardSchedule=()=>__vitePreload(()=>import("./Schedule-DB1DAkPN.js"),__vite__mapDeps([58,1,2,3,4,5])),DashboardMetadata=()=>__vitePreload(()=>import("./Metadata-Cj3Lch7w.js"),__vite__mapDeps([59,1,2,3,4,5])),DashboardRipper=()=>__vitePreload(()=>import("./Ripper-C-D4StE_.js"),__vite__mapDeps([60,1,2,3,4,5])),DashboardSpecials=()=>__vitePreload(()=>import("./Specials-COMdJfv7.js"),__vite__mapDeps([61,1,2,3,4,5])),DashboardActivity=()=>__vitePreload(()=>import("./Activity-D9JJp66g.js"),__vite__mapDeps([62,1,2,3,4,5])),DashboardDevices=()=>__vitePreload(()=>import("./Devices-BeCsD-XP.js"),__vite__mapDeps([63,1,2,3,4,5])),DashboardDlna=()=>__vitePreload(()=>import("./Dlna-D8uVg7vg.js"),__vite__mapDeps([64,1,2,3,4,5]));function DashboardEncoderProfiles(){return __vitePreload(()=>import("./EncoderProfiles-CFK-9ud2.js"),__vite__mapDeps([65,1,2,3,4,5]))}var DashboardGeneral=()=>__vitePreload(()=>import("./General-D25E2ZGi.js"),__vite__mapDeps([66,1,2,3,4,5])),DashboardLibraries=()=>__vitePreload(()=>import("./Libraries-BLx859uZ.js"),__vite__mapDeps([67,1,2,3,4,5]));function DashboardNotifications(){return __vitePreload(()=>import("./Notifications-CHWSH0bR.js"),__vite__mapDeps([68,1,2,3,4,5]))}var DashboardSystem=()=>__vitePreload(()=>import("./System-Dy-feKyU.js"),__vite__mapDeps([69,1,2,3,4,5])),DashboardUsers=()=>__vitePreload(()=>import("./Users-Bp68riHZ.js"),__vite__mapDeps([70,1,2,3,4,5])),PreferencesControls=()=>__vitePreload(()=>import("./Controls-CPQJEEtP.js"),__vite__mapDeps([71,1,2,3,4,5])),PreferencesDisplay=()=>__vitePreload(()=>import("./Display-BD47jM6Z.js"),__vite__mapDeps([72,1,2,3,4,5])),PreferencesProfile=()=>__vitePreload(()=>import("./Profile-CVvd5lrM.js"),__vite__mapDeps([73,1,2,3,4,5])),PreferencesSubtitles=()=>__vitePreload(()=>import("./Subtitles-JTRX0vMN.js"),__vite__mapDeps([74,1,2,3,4,5])),DevCast=()=>__vitePreload(()=>import("./Cast-BrERAbt4.js"),__vite__mapDeps([75,1,2,3,4,5])),DevDownload=()=>__vitePreload(()=>import("./Download-C1E4CvpE.js"),__vite__mapDeps([76,1,2,3,4,5])),SetupSelectServer=()=>__vitePreload(()=>import("./SelectServers-StLhA0zp.js"),__vite__mapDeps([77,1,2,3,4,5])),SetupNoServer=()=>__vitePreload(()=>import("./NoServers-Cb48rLnw.js"),__vite__mapDeps([78,1,2,3,4,5])),SetupServerOffline=()=>__vitePreload(()=>import("./ServerOffline-DO0y3TtK.js"),__vite__mapDeps([79,1,2,3,4,5])),SetupPostInstall=()=>__vitePreload(()=>import("./PostInstall-TytRGxSX.js"),__vite__mapDeps([80,1,2,3,4,5])),NotFound=()=>__vitePreload(()=>import("./NotFound-uqU14GR_.js"),__vite__mapDeps([81,1,2,3,4,5]));function getBaseLayout(){return isMobile.value?MobileBaseLayout():DesktopBaseLayout()}const routes=[{path:"/",redirect:"/home"},{path:"/",component:getBaseLayout,children:[{path:"",redirect:"/home"},{path:"home",name:"Home",component:BaseIndex},{path:"search",name:"Search",component:Search,meta:{type:"all"}},{path:"libraries",name:"Libraries",component:BaseLibraries,beforeEnter:(c,h,g)=>{const E=libraries_default.value.at(0);E&&!isMobile.value?g({path:E.link}):g()}},{path:"libraries/:id/letter/:letter",name:"Library paginated",strict:!0,component:BaseLibrary},{path:"libraries/:id",name:"Library",strict:!0,component:BaseLibrary},{path:"specials",name:"Specials",component:BaseLibrary},{path:"specials/:id",name:"Special",component:BaseCollection},{path:"genre",name:"Genres",component:BaseLibrary},{path:"genre/:id",name:"Genre",component:BaseLibrary},{path:"collection",name:"Collections",component:BaseLibrary},{path:"collection/:id",name:"Collection",component:BaseCollection},{path:"person",name:"People",component:PaginatedLibrary},{path:"person/:id",name:"Person",component:BasePerson},{path:"movie/:id",name:"Movie",component:BaseInfo},{path:"tv/:id",name:"TV Show",component:BaseInfo},{path:":type/:id/watch",name:"Watch",component:BaseWatch}]},{path:"/music",component:getBaseLayout,children:[{path:"music",redirect:"/music/start"},{path:"start",name:"Music Start",component:MusicStart},{path:"artists",redirect:"/music/artists/_"},{path:"artists/:letter",name:"Artists",component:MusicCards,meta:{type:"artists"}},{path:"artist/:id",name:"Artist",component:MusicArtist,meta:{type:"artists"}},{path:"albums",redirect:"/music/albums/_"},{path:"albums/:letter",name:"Albums",component:MusicCards,meta:{type:"albums"}},{path:"album/:id",name:"Album",component:MusicList,meta:{type:"albums"}},{path:"genres",redirect:"/music/genres/letter/_"},{path:"genres/letter/:letter",name:"Music Genres",component:MusicCards,meta:{type:"genres"}},{path:"genres/:id",name:"Music Genre",component:MusicList,meta:{type:"genres"}},{path:"playlists",name:"Music Playlists",component:MusicCards,meta:{type:"playlists"}},{path:"playlists/:id",name:"Music Playlist",component:MusicList,meta:{type:"playlists"}},{path:"tracks",name:"Tracks",component:MusicList,meta:{type:"tracks"}}]},{path:"/dashboard",component:getBaseLayout,children:[{path:"dashboard",name:"System",redirect:"/dashboard/system"},{path:"system",name:"System",component:DashboardSystem},{path:"general",name:"General",component:DashboardGeneral},{path:"users",name:"Users",component:DashboardUsers},{path:"users/:id",name:"Edit user",component:()=>__vitePreload(()=>import("./Edit-DHrGYfZE.js"),__vite__mapDeps([82,1,2,3,4,5,6,7,83,26,23,24,25,21,22,84,34,33,85,11,86]))},{path:"libraries",name:"Dashboard Libraries",component:DashboardLibraries},{path:"libraries/:id",name:"Dashboard Library",component:()=>__vitePreload(()=>import("./Edit-ZzqtfFEO.js"),__vite__mapDeps([87,1,2,3,4,5,6,7,83,26,23,24,25,21,22,84,34,33,88,89,90]))},{path:"specials",name:"Dashboard Specials",component:DashboardSpecials},{path:"specials/:id",name:"Dashboard Special",component:()=>__vitePreload(()=>import("./Edit-BRitjS3S.js"),__vite__mapDeps([91,1,2,3,4,5,6,7,83,26,23,24,25,21,22,84,34,33]))},{path:"devices",name:"Devices",component:DashboardDevices},{path:"devices/:id",name:"Device",component:()=>__vitePreload(()=>import("./Show-CecvAmTt.js"),__vite__mapDeps([92,1,2,3,4,5,6,7,83,26,23,24,25,21,22,84,34,33,93]))},{path:"ripper",name:"Ripper",component:DashboardRipper},{path:"encoderprofiles",name:"Encoder Profiles",component:DashboardEncoderProfiles},{path:"encoderprofiles/:id",name:"Encoder Profile",component:()=>__vitePreload(()=>import("./Edit-CQrYkFGm.js"),__vite__mapDeps([94,1,2,3,4,5,6,7,83,26,23,24,25,21,22,84,34,33]))},{path:"notifications",name:"Notifications",component:DashboardNotifications},{path:"notifications/:id",name:"Notification",component:DashboardNotifications},{path:"metadata",name:"Metadata",component:DashboardMetadata},{path:"activity",name:"Activity",component:DashboardActivity},{path:"dlna",name:"DLNA",component:DashboardDlna},{path:"logs",name:"Logs",component:DashboardLogs},{path:"plugins",name:"Plugins",component:DashboardPlugins},{path:"plugins/:id",name:"Plugin",component:DashboardPlugins},{path:"schedule",name:"Scheduled Tasks",component:DashboardSchedule},{path:"schedule/:id",name:"Scheduled Task",component:DashboardSchedule}]},{path:"/preferences",component:getBaseLayout,children:[{path:"display",name:"Display",component:PreferencesDisplay},{path:"profile",name:"Profile",component:PreferencesProfile},{path:"controls",name:"Controls",component:PreferencesControls},{path:"subtitles",name:"Subtitles",component:PreferencesSubtitles}]},{path:"/dev",component:getBaseLayout,children:[{path:"cast",name:"Cast",component:DevCast},{path:"download",name:"Download",component:DevDownload}]},{path:"/setup",component:getBaseLayout,children:[{path:"setup",redirect:"setup/select-servers"},{path:"select-servers",name:"Select Server",component:SetupSelectServer},{path:"no-servers",name:"No Servers",component:SetupNoServer},{path:"server-offline",name:"Server offline",component:SetupServerOffline},{path:"post-install",name:"Post Install",component:SetupPostInstall}]},{path:"/auth",name:"Auth",component:AuthView,meta:{public:!0,bypassSetup:!0}},{path:"/logout",name:"Logout",component:Logout,meta:{public:!0,bypassSetup:!0}},{path:"/:catchAll(.*)*",component:NotFound,meta:{message:"Page not found",status:404}}];var removableQueries=["code","state","session_state"];function beforeEach(c){return c.beforeEach((h,g,E)=>{if(!isPlatform("capacitor")){const S={...h.query};let R=!1;removableQueries.forEach(L=>{S[L]&&(delete S[L],R=!0)});for(const L in S)S[L]?.includes("?")&&(S[L]=S[L].split("?").at(0));R&&c.replace({query:S}).then()}E()})}var beforeEach_default=beforeEach,PREFETCH_ROUTES={Home:["/libraries","/music"],Libraries:[]},prefetchCooldown=new Map,COOLDOWN_MS=3e4;function canPrefetch(c){const h=prefetchCooldown.get(c);return!(h&&Date.now()-h<COOLDOWN_MS)}function markPrefetched(c){prefetchCooldown.set(c,Date.now())}async function prefetchPath(c){if(!currentServer.value?.serverApiUrl||!canPrefetch(c))return;const h=c.split("/").filter(Boolean);if(!queryClient.getQueryData(h)){markPrefetched(c);try{await queryClient.prefetchQuery({queryKey:h,queryFn:async()=>{const g=await serverClient_default().get(c);return g.data?.data??g.data},staleTime:1e3*60*5})}catch{}}}function prefetchForRoute(c){const h=PREFETCH_ROUTES[c.name];!h||h.length===0||requestIdleCallback(()=>{h.forEach(g=>{prefetchPath(g)})})}function afterEach(c){return c.afterEach(h=>{h.name&&(document.title=h.name),isPlatform("capacitor")||setTimeout(()=>{document.querySelector(".ion-page .ion-page-invisible")?.classList.remove("ion-page-invisible")},500),prefetchForRoute(h)})}var afterEach_default=afterEach,RGB_MAX=255,HUE_MAX=360,angleUnits={grad:HUE_MAX/400,turn:HUE_MAX,rad:HUE_MAX/(Math.PI*2)},rgbaToHex=c=>{var{r:h,g,b:E}=c;return rgbToHex$1({r:h,g,b:E})},rgbToHex$1=c=>{var{r:h,g,b:E}=c;return"#"+(S=>new Array(7-S.length).join("0")+S)((h<<16|g<<8|E).toString(16))},hexToRgba=c=>{var h=c.replace("#","");/^#?/.test(c)&&h.length===3&&(c="#"+h.charAt(0)+h.charAt(0)+h.charAt(1)+h.charAt(1)+h.charAt(2)+h.charAt(2));var g=new RegExp("[A-Za-z0-9]{2}","g"),[E,S,R=0,L]=c.match(g).map(k=>parseInt(k,16));return{r:E,g:S,b:R,a:(L??255)/RGB_MAX}};let VisibilityState=function(c){return c.hidden="hidden",c.showing="showing",c}({}),SizeState=function(c){return c.compact="compact",c.full="full",c}({}),SortType=function(c){return c.index="index",c.name="name",c.artist="artist",c.album="album",c.duration="duration",c.date="date",c}({}),SortOrder=function(c){return c.asc="asc",c.desc="desc",c}({});const siteTitle="NoMercy TV",suffix=location.hostname.includes("dev")||location.hostname.includes("vscode")||location.hostname.includes("12")||location.hostname.includes("192")?"-dev":"",authBaseUrl=`https://auth${suffix}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/`,keycloakConfig={clientId:"nomercy-ui",realm:"NoMercyTV",url:`https://auth${suffix}.nomercy.tv`},tmdbImageBaseUrl="https://image.tmdb.org/t/p",tmdbApiKey="ed3bf860adef0537783e4abee86d65af",libraryTypes=[{name:"Movies",value:"movie"},{name:"TV Shows",value:"tv"},{name:"Music",value:"music"},{name:"Images",value:"image"}];function setTitle$1(c){if(!c||c===""){document.title=siteTitle;return}const h=[];c&&h.push(c),window.matchMedia("(display-mode: standalone)").matches||(c&&h.push("-"),h.push(siteTitle)),document.title=h.join(" ")}function breakLogoTitle(c,h=[":","!","?"]){if(!c)return"";if(c.split("").some(g=>h.includes(g))){const g=new RegExp(h.map(L=>L==="?"?`\\${L}`:L).join("|"),"u"),E=new RegExp(h.map(L=>L==="?"?`\\${L}\\s`:`${L}\\s`).join("|"),"u"),S=c.match(E),R=c.match(g);if(g&&E&&S&&R)return c.replace(S[0],`${R[0]}
`)}return c}async function copyToClipboard(c){if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(c),!0}catch{return!1}else{const h=document.createElement("textarea");h.value=c,h.style.position="absolute",h.style.left="-999999px",document.body.prepend(h),h.select();try{return document.execCommand("copy"),Promise.resolve(!0)}catch(g){return console.error(g),Promise.resolve(!1)}finally{h.remove()}}}function generateRandomString(c){let h="";const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let E=0;E<c;E++)h+=g.charAt(Math.floor(Math.random()*62));return h}function hash(c){const h=c,g=Array.from({length:c.length});for(let E=0;E<c.length;E++)g[E]=E;return Array.prototype.map.call(g,E=>h.charCodeAt(E).toString(16)).join("")}function limitSentenceByCharacters(c,h=340){if(!c)return"";const g=c.substring(0,h).split(".");return g.pop(),`${g.join(".")}.`}function lineBreakLongTitle(c,h=45){if(!c)return"";const g=c.match(/S\d{2}E\d{2}/u);if(g&&c.length>h){const E=c.split(/\sS\d{2}E\d{2}\s/u);return`${E[0]} 
${g[0]} ${E[1]}`}return c}function lineBreakShowTitle(c,h=!1){if(!c)return"";const g=c.match(/S\d{2}E\d{2}/u);if(g){const E=c.split(/\sS\d{2}E\d{2}\s/u);return h?`${g[0]} ${E[1]}`:`${E[0]} 
${g[0]} ${E[1]}`}return c}function pad(c,h=2){if(typeof c<"u"){const g=h-c.toString().length+1;return Array.from({length:+(g>0&&g)}).join("0")+c}return""}function ucfirst(c){return c.substr(0,1).toUpperCase()+c.substr(1)}function random_string(c){let h="";const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let S=0;S<c;S++)h+=g.charAt(Math.floor(Math.random()*62));return h}function create_UUID(){let c=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,h=>{const g=(c+Math.random()*16)%16|0;return c=Math.floor(c/16),(h==="x"?g:g&3|8).toString(16)})}function stringFormat(c,...h){const g=c.match(/\{(?<index>\d+)\}/gu);if(!g||g?.length===null)return c;let E=c;for(let S=0;S<g.length;S++){const R=g[S],L=Number.parseInt(g[S][1],10);E=E.replace(R,h[L].toString())}return E}function translate(c,...h){return stringFormat(instance.t(c),...h)??c}function breakTitle(c,h=null){if(!c)return"";const g=c.split(/(:\s|\sand\sthe\s|\sen\sde\s|\s-\s|\s–\s|\s&\s)/iu);return(g.includes(" - ")||g.includes(" – "))&&g.includes(": ")?c?.replace(/(.+)(:\s|sand\sthe|\sen\sde|\s&\s)(.*)/u,`<span class=''>$1</span><span class='${h}'>$3</span>`).replace(/\s-.+$/u," "):g.length===3&&c.length>30?c.includes(":")?c?.replace(/(.+)(:\s|sand\sthe|\sen\sde|\s&\s)(.*)/u,`<span class=''>$1</span><span class='${h}'>$3</span>`):c?.replace(/(.+)(\sand\sthe\s|\sen\sde\s|\s-\s|\s&\s)(.+)/iu,`<span class=''>$1</span><span class='${h}'>$3</span>`):(g.includes(" and the ")||g.includes(" en de "))&&c.length>25&&!g.includes(": ")?c?.replace(/(.+)(:\s|\sand\sthe\s|\sen\sde\s|\s-\s|\s&\s)(.+)/iu,`<span class=''>$1</span><span class='${h}'>$3</span>`).replace(/\sand\sthe\s|\sen\sde\s/iu," "):(g.includes(" and the ")||g.includes(" en de "))&&c.length>40&&g.includes(": ")?c?.replace(/(.+)(\sand\sthe\s|\sen\sde\s|\s-\s|\s&\s)(.+)/iu,`<span class=''>$1</span><span class='${h}'>$3</span>`).replace(/\sand\sthe\s|\sen\sde\s/iu," "):c.includes(":")&&c.split(/[I\-]+$/iu)[0].length>20?c?.replace(/(.+)(:\s|sand\sthe|\sen\sde|\s&\s)(.*)/u,`<span class=''>$1</span><span class='${h}'>$3</span>`):c}function breakTitle2(c,h=null){return c?c?.replace(/(:\s|\sand\sthe|\sen\sde)(.*)/u,`:</br><span class='${h}'>$2</span>`):""}function breakDescription(c){return c?.split(/\.\s/u).filter(h=>!h.includes("Wikipedia")&&!h.includes("CC-")).join(`.
`)}const alphaNumericRange=function(){const c="_#ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");return function(h,g){const E=c.indexOf(h),S=c.indexOf(g);return!~h||!~g?null:c.slice(E,S+1)}}();function isIp(c){return c.match(/^(?:\d{1,3}\.){3}\d{1,3}$/u)}function isPublicIp(c){return!c.startsWith("192")&&!c.startsWith("10.")&&!c.startsWith("172")}function censorPublicIpAddresses(c){return c?suffix!==""?c.replace(/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(\d{1,3}-\d{1,3}-\d{1,3}-\d{1,3})/gu,h=>isPublicIp(h)?"XXX.XXX.XXX.XXX":h):c:""}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.toTitleCase=function(){let c,h,g;g=this.replace(/([^\W_][^\s-]*) */gu,R=>R.charAt(0).toUpperCase()+R.substr(1).toLowerCase());const E=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"];for(c=0,h=E.length;c<h;c++)g=g.replace(new RegExp(`\\s${E[c]}\\s`,"gu"),R=>R.toLowerCase());const S=["Id","Tv"];for(c=0,h=S.length;c<h;c++)g=g.replace(new RegExp(`\\b${S[c]}\\b`,"gu"),S[c].toUpperCase());return g};String.prototype.titleCase=function(c=navigator.language.split("-")[0],h=!0){let g,E=[];if(g=this.replace(/([^\s:\-'])([^\s:\-']*)/gu,R=>R.charAt(0).toUpperCase()+R.substr(1).toLowerCase()).replace(/Mc(.)/gu,(R,L)=>`Mc${L.toUpperCase()}`),h){E=["A","An","The","At","By","For","In","Of","On","To","Up","And","As","But","Or","Nor","Not"],c==="FR"?E=["Un","Une","Le","La","Les","Du","De","Des","À","Au","Aux","Par","Pour","Dans","Sur","Et","Comme","Mais","Ou","Où","Ne","Ni","Pas"]:c==="NL"&&(E=["De","Het","Een","En","Van","Naar","Op","Door","Voor","In","Als","Maar","Waar","Niet","Bij","Aan"]);for(let R=0;R<E.length;R++)g=g.replace(new RegExp(`\\s${E[R]}\\s`,"gu"),L=>L.toLowerCase())}const S=["Id","R&d"];for(let R=0;R<S.length;R++)g=g.replace(new RegExp(`\\b${S[R]}\\b`,"gu"),S[R].toUpperCase());return g};String.prototype.toPascalCase=function(){return this.match(/[a-z0-9]+/giu).map(c=>c.charAt(0).toUpperCase()+c.substr(1).toLowerCase()).join("_")};String.prototype.toInt=function(){return Number.parseInt(this,10)};function formatDuration(c){const h=Math.floor(c/60),g=Math.floor(c-h*60);return`${pad(h,1)}:${pad(g,2)}`}function humanFileSize(c,h=!1,g=1){const E=h?1e3:1024;if(Math.abs(c)<E)return`${c} B`;const S=h?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let R=-1;const L=10**g;do c/=E,++R;while(Math.round(Math.abs(c)*L)/L>=E&&R<S.length-1);return`${c.toFixed(g)} ${S[R]}`}function mathPercentage(c,h){let g=0;for(let E=c.length;E-=1;)typeof h[E]>"u"||c[E]===h[E]||(c[E].toLowerCase()===h[E].toLowerCase()?g+=1:g+=4);return 100-(g+4*Math.abs(c.length-h.length))/(2*(c.length+h.length))*100}function getRandomNumberBetween(c,h){return Math.floor(Math.random()*(h-c+1))+c}function getCommonSize(c){const h=["w92","w185","w342","w500","w780","original"];if(!c)return"original";const g=Number.parseInt(c.toString(),10);let E=h[0];for(const S of h){if(S==="original")return"original";if(Number.parseInt(S.replace("w",""),10)>=g){E=S;break}}return E}async function getDataUrl(c,h){return await fetch(encodeURI(c).replace(/#/gu,"%23"),{headers:{Authorization:`Bearer ${h}`}}).then(g=>g.blob()).then(g=>URL.createObjectURL(g)).catch(g=>{console.error(g)})}init_vue_runtime_esm_bundler();function createEnumFromArray(c){return c.reduce((h,g,E)=>(h[g]=E+1,h),{})}function find_most(c){return c.reduce((h,g,E,S)=>S.filter(R=>R===h).length>=S.filter(R=>R===g).length?h:g,c[0])}function groupBy(c,h){const g={};return c.forEach(E=>{const S=String(E[h]);g[S]=c.filter(R=>R[h]===E[h])}),g}function shuffle(c){for(let h=c.length-1;h>0;h--){const g=Math.floor(Math.random()*(h+1));[c[h],c[g]]=[c[g],c[h]]}return c}function sort_updated_asc(c,h){const g=new Date(c.updated_at),E=new Date(h.updated_at);return g>E?-1:g<E?1:0}function sort_updated_desc(c,h){const g=new Date(c.updated_at),E=new Date(h.updated_at);return g<E?-1:g>E?1:0}function sortBy(c,h,g="asc",E){return[...c??[]].sort((S,R)=>{const L=S,k=R;let C,x;return g==="desc"?(C=E?k[h]?.[E]??"0":k[h]??"0",x=E?L[h]?.[E]??"0":L[h]??"0"):(C=E?L[h]?.[E]??"0":L[h]??"0",x=E?k[h]?.[E]??"0":k[h]??"0"),C<x?-1:C>x?1:0})}function sortBy2(c,h,g,E="asc",S){return[...c??[]].sort((R,L)=>{const k=(ie,se)=>{const ue=ie;return S?ue[se]?.[S]??"0":ue[se]??"0"};let C=k(R,h),x=k(L,h);if(E==="desc"&&([C,x]=[x,C]),C<x)return-1;if(C>x)return 1;let q=k(R,g),X=k(L,g);return E==="desc"&&([q,X]=[X,q]),q<X?-1:q>X?1:0})}function sortByPriorityKeyed(c,h,g="desc"){return Array.isArray(c)&&(c=createEnumFromArray(c)),function(E,S){if(!E.hasOwnProperty(h)||!S.hasOwnProperty(h)||!E[h])return 0;const R=E[h].toString().toLowerCase()in c?c[E[h]]:Number.MAX_SAFE_INTEGER,L=S[h].toString().toLowerCase()in c?c[S[h]]:Number.MAX_SAFE_INTEGER;let k=0;return R>L?k=-1:R<L&&(k=1),g==="desc"?~k:k}}function sortByType(c,h,g,E){let S=g;return h===SortType.name?(S||(S=SortOrder.asc,E(S)),sortBy(c,"name",S)):h===SortType.artist?(S||(S=SortOrder.asc,E(S)),sortBy(c,"artist_track[0]",S,SortType.name)):h===SortType.album?(S||(S=SortOrder.asc,E(S)),sortBy(c,"album_track[0]",S,SortType.name)):h===SortType.date?(S||(S=SortOrder.desc,E(S)),sortBy(c,"date",S)):h===SortType.duration?(S||(S=SortOrder.desc,E(S)),sortBy(c,"duration",S)):sortBy2(c,"disc","track",S||SortOrder.desc)}function unique(c,h){return!c||!Array.isArray(c)?[]:c.filter((g,E,S)=>S.map(R=>R[h]).indexOf(g[h])===E)}function uniqueBy(c,h){return c?Array.from(new Map(c.map(g=>[h(g),g])).values()):[]}function distinct(c,h,g){return g.indexOf(c)===h}function Unique(c,h,g){return g.indexOf(c)===h}function sortByPriority(c,h){const g=[];let E,S;for(E=0;E<h.length;E++)for(;(S=c.indexOf(h[E]))!==-1;)g.push(c.splice(S,1)[0]);return g.concat(c)}function sort_updated(c,h,g="asc"){const E=new Date(c.updated_at),S=new Date(h.updated_at);return E<S?g==="desc"?-1:1:E>S?g==="desc"?1:-1:0}function trackSort(c,h){return c.disc===h.disc?Number.parseInt(`${c.track}`,10)-Number.parseInt(`${h.track}`,10):Number.parseInt(`${c.track}`,10)>Number.parseInt(`${h.track}`,10)?1:-1}function uniqBy(c,h){return Array.from(new Map(c.map(g=>[g[h],g])).values())}function sortByPosterAlphabetized(c,h="name",g=null){c=toRaw(c),g&&(c=unique(c,g));const E=Object.create(null),S=[];c.forEach(k=>{const C=k;E[C.name]||(E[C.name]=[],S.push({...C,department:E[C.name]})),E[C.name].push(C.department)});const R=S.filter(k=>k.profile!==null).sort((k,C)=>{const x=String(k[h]),q=String(C[h]);return+(x>q)||-(x<q)}),L=S.filter(k=>k.profile===null).sort((k,C)=>{const x=String(k[h]),q=String(C[h]);return+(x>q)||-(x<q)});return R.concat(L)}function chunk(c,h){const g=[];for(let E=0;E<Math.ceil(c.length/h);E++)g[E]=c.slice(E*h,E*h+h);return g}function sortByMathPercentage(c,h,g){return c.sort((E,S)=>{const R=mathPercentage(g,E[h]),L=mathPercentage(g,S[h]);return R>L?-1:R<L?1:0})}function objectsEqual(c,h){return h===null&&c!==null?!1:c!==null&&typeof c=="object"&&Object.keys(c).length>0?Object.keys(c).length===Object.keys(h).length&&Object.keys(c).every(g=>objectsEqual(c[g],h[g])):c!==null&&Array.isArray(c)&&Array.isArray(h)&&!c.length&&!h.length?!0:c===h}function mappedEntries(c){return Object.entries(c)}function byObjectValues(c){return function(h,g){const E=c[0],S=typeof E=="string",R=S?E:E.key,L=S?!1:!!E.reverse,k=S?null:E.map||null,C=k?k(h[R]):h[R],x=k?k(g[R]):g[R];return C===x?c.length===1?0:byObjectValues(c.slice(1))(h,g):L?C>x?-1:1:C>x?1:-1}}Array.prototype.latest=function(){return[...this].sort((c,h)=>c.updated_at>h.updated_at?-1:c.updated_at<h.updated_at?1:0)};Date.prototype.timestamp=function(){return Math.floor(this.getTime()/1e3)};const greenToRed=[{pct:0,color:{r:0,g:64,b:0}},{pct:1,color:{r:0,g:144,b:0}},{pct:50,color:{r:255,g:255,b:0}},{pct:100,color:{r:255,g:0,b:0}}],redToGreen=[{pct:0,color:{r:204,g:0,b:0}},{pct:50,color:{r:238,g:238,b:0}},{pct:99,color:{r:0,g:144,b:0}},{pct:100,color:{r:0,g:64,b:0}}];function getColorFromPercent(c,h=greenToRed){let g;for(g=1;g<h.length-1&&!(c<h[g].pct);g++);const E=h[g-1],S=h[g],R=S.pct-E.pct,L=(c-E.pct)/R,k=1-L,C=L,x={r:Math.floor(E.color.r*k+S.color.r*C),g:Math.floor(E.color.g*k+S.color.g*C),b:Math.floor(E.color.b*k+S.color.b*C)};return`rgb(${[x.r,x.g,x.b].join(",")})`}function getLuminosity(c){const h=RGBString2hex(c).substring(1),g=Number.parseInt(h,16),E=g>>16&255,S=g>>8&255,R=g>>0&255;return .2126*E+.7152*S+.0722*R}function tooLight(c,h=130){if(c){let g=c;if(g.includes("#")){const E=hexToRgba(g);g=`rgb(${E.r} ${E.g} ${E.b})`}return getLuminosity(g)>h}return!1}function tooDark(c,h=50){if(c){let g=c;if(g.includes("#")){const E=hexToRgba(g);g=`rgb(${E.r} ${E.g} ${E.b})`}return getLuminosity(g)<h}return!1}function byte2Hex(c){const h="0123456789ABCDEF";return String(h.substr(c>>4&15,1))+h.substr(c&15,1)}function RGBString2hex(c){const h=c.replace("rgb(","").replace(")","").split(/,|\s/gu).slice(0,3).map(g=>Number.parseInt(g,10));return`#${byte2Hex(h[0])}${byte2Hex(h[1])}${byte2Hex(h[2])}`}function pickPaletteColor(c,h=60,g=160){return!c||!c.darkVibrant?"":!tooLight(c.lightVibrant,g)&&!tooDark(c.lightVibrant,h)?c.lightVibrant:!tooDark(c.primary,h)&&!tooLight(c.primary,g)?c.primary:!tooDark(c.dominant,h)&&!tooLight(c.dominant,g)?c.dominant:!tooDark(c.darkVibrant,h)&&!tooLight(c.darkVibrant,g)?c.darkVibrant:!tooDark(c.darkMuted,h)&&!tooLight(c.darkMuted,g)?c.darkMuted:!tooLight(c.lightMuted,g)&&!tooDark(c.lightMuted,h)?c.lightMuted:""}const themeColors=[{title:"red",color:"var(--color-red-6)"},{title:"tomato",color:"var(--color-tomato-6)"},{title:"orange",color:"var(--color-orange-6)"},{title:"amber",color:"var(--color-amber-6)"},{title:"yellow",color:"var(--color-yellow-6)"},{title:"lime",color:"var(--color-lime-6)"},{title:"grass",color:"var(--color-grass-6)"},{title:"green",color:"var(--color-green-6)"},{title:"mint",color:"var(--color-mint-6)"},{title:"teal",color:"var(--color-teal-6)"},{title:"cyan",color:"var(--color-cyan-6)"},{title:"sky",color:"var(--color-sky-6)"},{title:"blue",color:"var(--color-blue-6)"},{title:"indigo",color:"var(--color-indigo-6)"},{title:"violet",color:"var(--color-violet-6)"},{title:"purple",color:"var(--color-purple-6)"},{title:"plum",color:"var(--color-plum-6)"},{title:"pink",color:"var(--color-pink-6)"},{title:"crimson",color:"var(--color-crimson-6)"},{title:"bronze",color:"var(--color-bronze-6)"},{title:"brown",color:"var(--color-brown-6)"},{title:"gold",color:"var(--color-gold-6)"},{title:"olive",color:"var(--color-olive-6)"},{title:"sage",color:"var(--color-sage-6)"},{title:"mauve",color:"var(--color-mauve-6)"},{title:"sand",color:"var(--color-sand-6)"}];function hexOpacity(c,h){const g=hexToRgba(c);return`rgba(${g.r} ${g.g} ${g.b}/ ${h}%)`}function getGpuColor(c){return c.toLowerCase().includes("nvidia")?green:c.toLowerCase().includes("amd")?red:c.toLowerCase().includes("intel")?blue:gray}function getCpuColor(c){return c.toLowerCase().includes("amd")?red:c.toLowerCase().includes("intel")?blue:c.toLowerCase().includes("arm")?brown:gray}function getEdgeStyle(c,h){const g=parseColorToHex("black",h);switch(c){case"depressed":return`1px 1px 2px ${g}`;case"dropShadow":return`2px 2px 4px ${g}`;case"raised":return`-1px -1px 2px ${g}`;case"uniform":return`0px 0px 4px ${g}`;case"textShadow":return`${g} 0px 0px 4px, ${g} 0px 0px 4px, 
					${g} 0px 0px 4px, ${g} 0px 0px 4px, 
					${g} 0px 0px 4px, ${g} 0px 0px 4px, 
					${g} 0px 0px 4px`;default:return""}}const namedColors={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function parseColorToHex(c,h=1){const g=document.createElement("canvas").getContext("2d");if(!g)return null;if(c.toLowerCase()==="transparent")return"#00000000";if(namedColors[c.toLowerCase()])return normalizeHex(namedColors[c.toLowerCase()],h);g.fillStyle=c;const E=g.fillStyle;return E.startsWith("rgb")?rgbToHex(E,h):E.startsWith("hsl")?hslToHex(E,h):/^#[0-9A-F]{3,8}$/i.test(E)?normalizeHex(E,h):E}function rgbToHex(c,h){const g=c.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/i);if(!g)return"#00000000";const E=Number(g[1]),S=Number(g[2]),R=Number(g[3]),L=g[4]!==void 0?Number(g[4]):h,k=Math.round(L*255).toString(16).padStart(2,"0").toUpperCase();return`#${E.toString(16).padStart(2,"0").toUpperCase()}${S.toString(16).padStart(2,"0").toUpperCase()}${R.toString(16).padStart(2,"0").toUpperCase()}${k}`}function hslToHex(c,h){const g=c.match(/\d+/g);if(!g||g.length<3)return"#00000000";let[E,S,R]=g.map(Number);S/=100,R/=100;const L=q=>(q+E/30)%12,k=S*Math.min(R,1-R),C=q=>Math.round((R-k*Math.max(-1,Math.min(L(q)-3,Math.min(9-L(q),1))))*255),x=Math.round(h*255).toString(16).padStart(2,"0").toUpperCase();return`#${C(0).toString(16).padStart(2,"0")}${C(8).toString(16).padStart(2,"0")}${C(4).toString(16).padStart(2,"0")}${x}`}function normalizeHex(c,h){if(c.length===4&&(c=`#${c[1]}${c[1]}${c[2]}${c[2]}${c[3]}${c[3]}`.toUpperCase()),c.length===7){const g=Math.round(h*255).toString(16).padStart(2,"0").toUpperCase();return c.toUpperCase()+g}return c.toUpperCase()}function isJsonString(c){try{JSON.parse(c)}catch{return!1}return!0}function isValidObject(c){return Array.isArray(c)?c.length>0:typeof c=="object"&&c!==null&&Object.keys(c).length>0}function checkboxValue(c,h){return c.length===0?!1:c.length===h?.length?!0:null}function convertToHumanReact(c,h,g=!1){let E=Number.parseInt(h.toString(),10),S=Math.floor(E/(3600*24));E-=S*3600*24;let R=Math.floor(E/3600);E-=R*3600;let L=Math.floor(E/60);return E-=L*60,S===0?S="":S>0&&S<2?S=`${S} ${c(g?"d":"day")}`:S>0&&(S=`${S} ${c(g?"d":"days")}`),R===0?R="":R>0&&R<2?R=`${R} ${c(g?"hr":"hour")}`:R>0&&(R=`${R} ${c(g?"hrs":"hours")}`),L===0?L="":L>0&&L<2?L=`${L} ${c(g?"min":"minute")}`:L>0&&(L=`${L} ${c(g?"min":"minutes")}`),E>0&&!g?E=`${E} ${c(g?"sec":"seconds")}`:E="",`${S} ${R} ${L} ${E}`}function humanTime(c){const h=Number.parseInt(`${c}`,10);let g=pad(Number.parseInt(`${h%86400/3600}`,10),2),E=Number.parseInt(`${h%3600/60}`,10),S=Number.parseInt(`${h%60}`,10);return`${E}`.length===1&&(E=`0${E}`),`${S}`.length===1&&(S=`0${S}`),g==="00"?g="00:":g=`${g}:`,E==="0"||E===0?E="00:":E=`${E}:`,g==="00:"&&(g=""),(g+E+S).replace("NaN:NaN:NaN","00:00")}function humanTimeExtended(c,h,g=!1){const E=new Date().timestamp(),S=Math.floor(E-new Date(h).timestamp());let R=Math.floor(S/(3600*24)),L=Math.floor(S%(3600*24)/3600),k=Math.floor(S%3600/60),C=S%60;return R===0?R="":R>0&&R<2?R=`${R} ${c("day")}`:R>0&&(R=`${R} ${c("days")}`),L===0?L="":L>0&&L<2?L=`${L} ${c("hour")}`:L>0&&(L=`${L} ${c("hours")}`),k===0?k="":k>0&&k<2?k=`${k} ${c("minute")}`:k>0&&(k=`${k} ${c("minutes")}`),C>0&&!g?C=`${C} ${c("seconds")}`:C="",`${R} ${L} ${k} ${C}`}function convertToSeconds(c){if(!c)return 0;const h=c.split(":").map(g=>Number.parseInt(g,10));return h.length<3&&h.unshift(0),+h[0]*60*60+ +h[1]*60+ +h[2]}function parseYear(c){return c?new Date(c).getFullYear():""}function calculateDuration(c){if(c)return convertToHumanReact(t,c?.tracks?.map(h=>convertToSeconds(h.duration)).reduce((h,g)=>h+g,0)??0)}function timeAgoShort(c){const h=new Intl.RelativeTimeFormat(navigator.language.split("-")?.[0],{numeric:"auto",style:"short"});c=new Date(c).getTime();const g=Date.now(),E=Math.floor((g-(c>1e12?c:c*1e3))/1e3);if(E<60)return t("just now");const S=Math.floor(E/60);if(S<60)return h.format(-S,"minute");const R=Math.floor(S/60);if(R<24)return h.format(-R,"hour");const L=Math.floor(R/24);if(L<7)return h.format(-L,"day");const k=Math.floor(L/7);if(k<4)return h.format(-k,"week");const C=Math.floor(L/30);if(C<12)return h.format(-C,"month");const x=Math.floor(L/365);return h.format(-x,"year")}function userTime(c){return new Date(c).toLocaleString(i18next_default.language,{timeZone:"UTC",day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}function isXmasTime(){const c=new Date,h=c.getFullYear();let g,E;return c>=new Date(h,5,1)?(g=new Date(h,11,7),E=new Date(h+1,0,5)):(g=new Date(h-1,11,7),E=new Date(h,0,5)),c>=g&&c<=E}var KeyboardStyle;(function(c){c.Dark="DARK",c.Light="LIGHT",c.Default="DEFAULT"})(KeyboardStyle||(KeyboardStyle={}));var KeyboardResize;(function(c){c.Body="body",c.Ionic="ionic",c.Native="native",c.None="none"})(KeyboardResize||(KeyboardResize={}));init_dist();var Keyboard=registerPlugin("Keyboard");init_vue_runtime_esm_bundler();const scrollContainerElement=shallowRef(),sidebarContainerElement=shallowRef(),setupComplete=ref(!1);var posterData=ref(null);const poster=computed(()=>posterData.value);function setPoster(c){posterData.value=c??null}var titleData=ref(null);const title=computed(()=>titleData.value);function setTitle(c){titleData.value=c??null}var backgroundData=ref(null);const background=computed(()=>backgroundData.value);function setBackground(c){backgroundData.value=c??null}var focusColorData=ref("var(--color-theme-8)");const focusColor=computed(()=>focusColorData.value);var colorPaletteData=shallowRef(null);const colorPalette=computed(()=>colorPaletteData.value);async function setColorPalette(c){colorPaletteData.value=c??null,useAutoThemeColors.value?(focusColorData.value=pickPaletteColor(c,20,160),document.documentElement.style.setProperty("--color-theme-8",focusColorData.value)):(focusColorData.value="",document.documentElement.style.removeProperty("--color-theme-8"))}var logoData=ref(null);const logo=computed(()=>logoData.value);function setLogo(c){logoData.value=c??null}var sortTypeData=ref(SortType.index);const sortType=computed(()=>sortTypeData.value);function setSortType(c){sortTypeData.value=c}var sortOrderData=ref(SortOrder.asc);const sortOrder=computed(()=>sortOrderData.value);function setSortOrder(c){sortOrderData.value=c}var navBarVisibleData=ref(!0);const navBarVisible=computed(()=>navBarVisibleData.value);(async()=>isXmasTime()&&document.documentElement.classList.add("xmas"))();var{keyboardHeight}=useKeyboard();watch(keyboardHeight,c=>{c?(document.documentElement.classList.add("keyboard-open"),document.documentElement.style.setProperty("--keyboard-height",`${c}px`)):(document.documentElement.classList.remove("keyboard-open"),document.documentElement.style.setProperty("--keyboard-height","0px"))});isPlatform("capacitor")&&(Keyboard.addListener("keyboardWillShow",c=>{console.log("keyboard did show with height:",c.keyboardHeight),document.documentElement.classList.add("keyboard-open"),c.keyboardHeight?document.documentElement.style.setProperty("--keyboard-height",`${c.keyboardHeight}px`):document.documentElement.style.setProperty("--keyboard-height","0px")}).catch(c=>{console.error("Failed to add keyboardWillShow listener:",c)}),Keyboard.addListener("keyboardWillHide",()=>{document.documentElement.classList.remove("keyboard-open"),document.documentElement.style.setProperty("--keyboard-height","0px")}).catch(c=>{console.error("Failed to add keyboardWillHide listener:",c)}));init_vue_runtime_esm_bundler();const redirectUrl=useLocalStorage("redirectUrl","/home"),isSearchRoute=computed(()=>router_default.currentRoute.value.path==="/search"),isMusicSearchRoute=computed(()=>router_default.currentRoute.value.path==="/music/search"),isHomeRoute=computed(()=>router_default.currentRoute.value.path==="/home"||router_default.currentRoute.value.path==="/"),isMusicRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music")),isLibraryRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/libraries")||router_default.currentRoute.value.path.startsWith("/library")),isDashboardRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/dashboard")),isPreferencesRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/preferences")),hasMusicLibrary=computed(()=>libraries_default.value?.some?.(c=>c.type==="music")),isAlbumRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/album")),isArtistRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/artist")),isPlaylistRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/playlist")),isSongRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/song")),isQueueRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/queue")),isTrackRoute=computed(()=>router_default.currentRoute.value.path.startsWith("/music/artist/")||router_default.currentRoute.value.path.startsWith("/music/album/")),searchUrl=computed(()=>isMusicRoute.value?"/search?from=music":"/search");init_vue_runtime_esm_bundler();const serverSetupComplete=ref(!1),serverInfoRequested=ref(!1),serverLibraries=ref(!1),servers=ref([]);function setServers(c){servers.value=c.map(h=>({...h,serverApiUrl:h.serverApiUrl.replace(/\/$/,""),serverBaseUrl:h.serverBaseUrl.replace(/\/$/,"")}))}var servers_default=servers;init_vue_runtime_esm_bundler();var done$5=ref(!1);function getLibraries(){return new Promise((c,h)=>{if(done$5.value){c();return}if(libraries_default.value.length>0||serverLibraries.value){c();return}if(!currentServer.value){c();return}deduplicatedRequest("setup/libraries",()=>serverClient_default(5).get("setup/libraries")).then(({data:g})=>{setLibraries(g.data),setupComplete.value=!0,serverLibraries.value=!0,c(),done$5.value=!0,router_default.replace(redirectUrl.value).then()}).catch(async()=>{done$5.value=!0,await router_default.replace({name:"Server offline"}).then(()=>c()),c()})})}var getLibraries_default=getLibraries,apiClient_default=c=>client_default({baseUrl:`https://api${suffix}.nomercy.tv/v1`,timeout:c});init_vue_runtime_esm_bundler();var messages=ref([]),messagesState=computed(()=>messages.value);function setMessages(c){messages.value=c}function removeMessage(c){const h=messages.value.indexOf(c);h!==-1&&(messages.value=messages.value.toSpliced(h,1)),apiClient_default().delete(`/messages/${c.id}`).catch(console.error)}function markAllMessagesRead(){messages.value.forEach(c=>c.read=!0),apiClient_default().patch("/messages",{read:!0}).catch(console.error)}var messages_default=messagesState;init_vue_runtime_esm_bundler();var notifications=ref([]),notificationsState=computed(()=>notifications.value);function setNotifications(c){const h=notifications.value.filter(g=>g.from==="system"&&(g.id.startsWith("sw-update")||g.id.startsWith("version-update")));notifications.value=[...c,...h]}function addNotification(c){notifications.value.find(h=>h.id===c.id)||notifications.value.push(c)}function removeNotification(c){const h=notifications.value.indexOf(c);h!==-1&&(notifications.value=notifications.value.toSpliced(h,1)),c.from!=="system"&&apiClient_default().delete(`/notifications/${c.id}`).catch(console.error)}function clearNotifications(){notifications.value=[],apiClient_default().delete("/notifications").catch(console.error)}var notifications_default=notificationsState;init_vue_runtime_esm_bundler();var done$4=ref(!1);function getLocations(){return new Promise((c,h)=>{if(done$4.value)return c();apiClient_default().get("/app_config").then(async({data:g})=>{if(!g?.data){await router_default.replace({name:"Select Server"}),h("No data returned from API");return}return setServers(g.data.servers),setMessages(g.data.messages??[]),setNotifications(g.data.notifications??[]),setUser({...user.value,locale:g.data.locale,name:g.data.name,avatarUrl:g.data.avatarUrl,features:g.data.features,moderator:!!g.data.moderator}),done$4.value=!0,servers.value.length===0?await router_default.replace({name:"No Servers"}).then(()=>c()):servers.value.length===1?setCurrentServer(servers.value[0]):servers.value.length>1&&localStorage.getItem("currentServer")?setCurrentServer(servers.value.find(E=>E.id===localStorage.getItem("currentServer"))):servers.value.length>1&&await router_default.replace({name:"Select Server"}),c()}).catch(g=>{h(g)})})}var getLocations_default=getLocations,init_definitions=__esmMin(()=>{}),esm_exports=__export({MediaSession:()=>MediaSession$1},1),MediaSession$1,init_esm=__esmMin(()=>{init_dist(),init_definitions(),init_preload_helper(),MediaSession$1=registerPlugin("MediaSession",{web:()=>__vitePreload(()=>import("./web-Ch-Bphel.js"),__vite__mapDeps([95,2])).then(c=>new c.MediaSessionWeb),ios:()=>__vitePreload(()=>import("./web-Ch-Bphel.js"),__vite__mapDeps([95,2])).then(c=>new c.MediaSessionWeb)})}),require_dist$2=__commonJSMin(c=>{Object.defineProperty(c,"__esModule",{value:!0});var h=(init_esm(),__toCommonJS(esm_exports)),g=class{setActionHandler({play:E,pause:S,stop:R,previous:L,next:k,seek:C,getPosition:x}){"mediaSession"in navigator?(navigator.mediaSession.setActionHandler("previoustrack",L??(()=>{})),navigator.mediaSession.setActionHandler("nexttrack",k??(()=>{})),typeof C=="function"&&typeof x=="function"&&(navigator.mediaSession.setActionHandler("seekbackward",q=>C(x()-(q.seekTime??30))),navigator.mediaSession.setActionHandler("seekforward",q=>C(x()+(q.seekTime??30))),navigator.mediaSession.setActionHandler("seekto",q=>C(q.seekTime))),navigator.mediaSession.setActionHandler("play",E??(()=>{})),navigator.mediaSession.setActionHandler("stop",R??(()=>{})),navigator.mediaSession.setActionHandler("pause",S??(()=>{}))):(h.MediaSession.setActionHandler({action:"play"},E).then(),h.MediaSession.setActionHandler({action:"pause"},S).then(),typeof C=="function"&&typeof x=="function"&&(h.MediaSession.setActionHandler({action:"seekbackward"},q=>C(x()-(q.seekTime??30))).then(),h.MediaSession.setActionHandler({action:"seekforward"},q=>C(x()+(q.seekTime??30))).then(),h.MediaSession.setActionHandler({action:"seekto"},q=>C(q.seekTime??0)).then()),h.MediaSession.setActionHandler({action:"previoustrack"},L).then(),h.MediaSession.setActionHandler({action:"nexttrack"},k).then(),h.MediaSession.setActionHandler({action:"stop"},R).then())}setPlaybackState(E){"mediaSession"in navigator?navigator.mediaSession.playbackState=E:h.MediaSession.setPlaybackState({playbackState:E}).then()}setMetadata({title:E,artist:S,album:R,artwork:L}){let k=[];if(typeof L<"u"&&Array.isArray(L)?k=L:typeof L=="string"&&(k=L?[{src:encodeURI(`${L}?width=96&type=png&aspect_ratio=1`),sizes:"96x96",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpeg"},{src:encodeURI(`${L}?width=128&type=png&aspect_ratio=1`),sizes:"128x128",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpeg"},{src:encodeURI(`${L}?width=192&type=png&aspect_ratio=1`),sizes:"192x192",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpeg"},{src:encodeURI(`${L}?width=256&type=png&aspect_ratio=1`),sizes:"256x256",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpeg"},{src:encodeURI(`${L}?width=384&type=png&aspect_ratio=1`),sizes:"384x384",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpeg"},{src:encodeURI(`${L}?width=512&type=png&aspect_ratio=1`),sizes:"512x512",type:L.endsWith(".png")||L.includes("type=png")?"image/png":"image/jpg"}]:[]),"mediaSession"in navigator)navigator.mediaSession.metadata=null,navigator.mediaSession.metadata=new MediaMetadata({title:E,artist:S,album:R,artwork:k});else try{h.MediaSession.setMetadata({title:E,artist:S,album:R,artwork:k}).then()}catch(C){console.error("CapMediaSession.setMetadata",C)}}setPositionState({duration:E,playbackRate:S,position:R}){"mediaSession"in navigator?navigator.mediaSession.setPositionState({duration:E,playbackRate:S,position:R}):h.MediaSession.setPositionState({duration:E,playbackRate:S,position:R}).then()}};c.default=g}),require_hls=__commonJSMin((c,h)=>{(function g(E){(function(S,R){typeof c=="object"&&typeof h<"u"?h.exports=R():typeof define=="function"&&define.amd?define(R):(S=typeof globalThis<"u"?globalThis:S||self,S.Hls=R())})(this,function(){"use strict";function S(o,a){var n=Object.keys(o);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(o);a&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),n.push.apply(n,e)}return n}function R(o){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?S(Object(n),!0).forEach(function(e){q(o,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function L(o,a){if(typeof o!="object"||!o)return o;var n=o[Symbol.toPrimitive];if(n!==void 0){var e=n.call(o,a||"default");if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(o)}function k(o){var a=L(o,"string");return typeof a=="symbol"?a:String(a)}function C(o,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,k(e.key),e)}}function x(o,a,n){return a&&C(o.prototype,a),n&&C(o,n),Object.defineProperty(o,"prototype",{writable:!1}),o}function q(o,a,n){return a=k(a),a in o?Object.defineProperty(o,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[a]=n,o}function X(){return X=Object.assign?Object.assign.bind():function(o){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(o[e]=n[e])}return o},X.apply(this,arguments)}function ie(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,ue(o,a)}function se(o){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},se(o)}function ue(o,a){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},ue(o,a)}function ge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ae(o,a,n){return ge()?ae=Reflect.construct.bind():ae=function(r,i,s){var l=[null];l.push.apply(l,i);var d=new(Function.bind.apply(r,l));return s&&ue(d,s.prototype),d},ae.apply(null,arguments)}function Se(o){try{return Function.toString.call(o).indexOf("[native code]")!==-1}catch{return typeof o=="function"}}function xe(o){var a=typeof Map=="function"?new Map:void 0;return xe=function(e){if(e===null||!Se(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(e))return a.get(e);a.set(e,r)}function r(){return ae(e,arguments,se(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ue(r,e)},xe(o)}function $e(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function nt(o,a){if(o){if(typeof o=="string")return we(o,a);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor&&(n=o.constructor.name),n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(o,a)}}function we(o,a){(a==null||a>o.length)&&(a=o.length);for(var n=0,e=new Array(a);n<a;n++)e[n]=o[n];return e}function ht(o,a){var n=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(n)return(n=n.call(o)).next.bind(n);if(Array.isArray(o)||(n=nt(o))||a&&o&&typeof o.length=="number"){n&&(o=n);var e=0;return function(){return e>=o.length?{done:!0}:{done:!1,value:o[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pe(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Ee={exports:{}};(function(o,a){(function(n){var e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(d,f,v){if(v=v||{},d=d.trim(),f=f.trim(),!f){if(!v.alwaysNormalize)return d;var m=l.parseURL(d);if(!m)throw new Error("Error trying to parse base URL.");return m.path=l.normalizePath(m.path),l.buildURLFromParts(m)}var p=l.parseURL(f);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return v.alwaysNormalize?(p.path=l.normalizePath(p.path),l.buildURLFromParts(p)):f;var y=l.parseURL(d);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var _=r.exec(y.path);y.netLoc=_[1],y.path=_[2]}y.netLoc&&!y.path&&(y.path="/");var b={scheme:y.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(b.netLoc=y.netLoc,p.path[0]!=="/"))if(!p.path)b.path=y.path,p.params||(b.params=y.params,p.query||(b.query=y.query));else{var T=y.path,w=T.substring(0,T.lastIndexOf("/")+1)+p.path;b.path=l.normalizePath(w)}return b.path===null&&(b.path=v.alwaysNormalize?l.normalizePath(p.path):p.path),l.buildURLFromParts(b)},parseURL:function(d){var f=e.exec(d);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(i,"");d.length!==(d=d.replace(s,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};o.exports=l})()})(Ee);var Ne=Ee.exports,ne=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},It=Number.isSafeInteger||function(o){return typeof o=="number"&&Math.abs(o)<=Je},Je=Number.MAX_SAFE_INTEGER||9007199254740991,A=function(o){return o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached",o.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",o}({}),re=function(o){return o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o}({}),U=function(o){return o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",o.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",o.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_PARSING_ERROR="levelParsingError",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.FRAG_GAP="fragGap",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.UNKNOWN="unknown",o}({}),bt=function(){},Rr={trace:bt,debug:bt,log:bt,warn:bt,info:bt,error:bt},qr=Rr;function li(o){var a=self.console[o];return a?a.bind(self.console,"["+o+"] >"):bt}function M(o){for(var a=arguments.length,n=new Array(a>1?a-1:0),e=1;e<a;e++)n[e-1]=arguments[e];n.forEach(function(r){qr[r]=o[r]?o[r].bind(o):li(r)})}function z(o,a){if(typeof console=="object"&&o===!0||typeof o=="object"){M(o,"debug","log","info","warn","error");try{qr.log('Debug logs enabled for "'+a+'" in hls.js version 1.5.13')}catch{qr=Rr}}else qr=Rr}var P=qr,ce=/^(\d+)x(\d+)$/,oe=/(.+?)=(".*?"|.*?)(?:,|$)/g,te=function(){function o(n){typeof n=="string"&&(n=o.parseAttrList(n)),X(this,n)}var a=o.prototype;return a.decimalInteger=function(e){var r=parseInt(this[e],10);return r>Number.MAX_SAFE_INTEGER?1/0:r},a.hexadecimalInteger=function(e){if(this[e]){var r=(this[e]||"0x").slice(2);r=(r.length&1?"0":"")+r;for(var i=new Uint8Array(r.length/2),s=0;s<r.length/2;s++)i[s]=parseInt(r.slice(s*2,s*2+2),16);return i}else return null},a.hexadecimalIntegerAsNumber=function(e){var r=parseInt(this[e],16);return r>Number.MAX_SAFE_INTEGER?1/0:r},a.decimalFloatingPoint=function(e){return parseFloat(this[e])},a.optionalFloat=function(e,r){var i=this[e];return i?parseFloat(i):r},a.enumeratedString=function(e){return this[e]},a.bool=function(e){return this[e]==="YES"},a.decimalResolution=function(e){var r=ce.exec(this[e]);if(r!==null)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}},o.parseAttrList=function(e){var r,i={},s='"';for(oe.lastIndex=0;(r=oe.exec(e))!==null;){var l=r[2];l.indexOf(s)===0&&l.lastIndexOf(s)===l.length-1&&(l=l.slice(1,-1));var d=r[1].trim();i[d]=l}return i},x(o,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(e){return e.substring(0,2)==="X-"})}}]),o}();function K(o){return o!=="ID"&&o!=="CLASS"&&o!=="START-DATE"&&o!=="DURATION"&&o!=="END-DATE"&&o!=="END-ON-NEXT"}function ee(o){return o==="SCTE35-OUT"||o==="SCTE35-IN"}var be=function(){function o(a,n){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,n){var e=n.attr;for(var r in e)if(Object.prototype.hasOwnProperty.call(a,r)&&a[r]!==e[r]){P.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+a.ID+'"'),this._badValueForSameId=r;break}a=X(new te({}),e,a)}if(this.attr=a,this._startDate=new Date(a["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);ne(i.getTime())&&(this._endDate=i)}}return x(o,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var n=this.duration;return n!==null?new Date(this._startDate.getTime()+n*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(ne(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&ne(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),o}(),pe=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Ce={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Pt=function(){function o(n){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(e={},e[Ce.AUDIO]=null,e[Ce.VIDEO]=null,e[Ce.AUDIOVIDEO]=null,e),this.baseurl=n}var a=o.prototype;return a.setByteRange=function(e,r){var i=e.split("@",2),s;i.length===1?s=r?.byteRangeEndOffset||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]},x(o,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ne.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),o}(),sr=function(o){ie(a,o);function a(e,r){var i=o.call(this,r)||this;return i._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new pe,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=e,i}var n=a.prototype;return n.setKeyFormat=function(r){if(this.levelkeys){var i=this.levelkeys[r];i&&!this._decryptdata&&(this._decryptdata=i.getDecryptData(this.sn))}},n.abortRequests=function(){var r,i;(r=this.loader)==null||r.abort(),(i=this.keyLoader)==null||i.abort()},n.setElementaryStreamInfo=function(r,i,s,l,d,f){f===void 0&&(f=!1);var v=this.elementaryStreams,m=v[r];if(!m){v[r]={startPTS:i,endPTS:s,startDTS:l,endDTS:d,partial:f};return}m.startPTS=Math.min(m.startPTS,i),m.endPTS=Math.max(m.endPTS,s),m.startDTS=Math.min(m.startDTS,l),m.endDTS=Math.max(m.endDTS,d)},n.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[Ce.AUDIO]=null,r[Ce.VIDEO]=null,r[Ce.AUDIOVIDEO]=null},x(a,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var r=this.levelkeys.identity;if(r)this._decryptdata=r.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!ne(this.programDateTime))return null;var r=ne(this.duration)?this.duration:0;return this.programDateTime+r*1e3}},{key:"encrypted",get:function(){var r;if((r=this._decryptdata)!=null&&r.encrypted)return!0;if(this.levelkeys){var i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&this.levelkeys[i[0]].encrypted)return!0}return!1}}]),a}(Pt),fr=function(o){ie(a,o);function a(n,e,r,i,s){var l=o.call(this,r)||this;l.fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new pe,l.duration=n.decimalFloatingPoint("DURATION"),l.gap=n.bool("GAP"),l.independent=n.bool("INDEPENDENT"),l.relurl=n.enumeratedString("URI"),l.fragment=e,l.index=i;var d=n.enumeratedString("BYTERANGE");return d&&l.setByteRange(d,s),s&&(l.fragOffset=s.fragOffset+s.duration),l}return x(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),a}(Pt),xi=10,wn=function(){function o(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}var a=o.prototype;return a.reloaded=function(e){if(!e){this.advanced=!0,this.updated=!0;return}var r=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!r||!this.live,this.advanced=this.endSN>e.endSN||r>0||r===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},x(o,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?ne(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||xi}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),o}();function Fi(o){return Uint8Array.from(atob(o),function(a){return a.charCodeAt(0)})}function In(o){var a=rr(o).subarray(0,16),n=new Uint8Array(16);return n.set(a,16-a.length),n}function kn(o){var a=function(e,r,i){var s=e[r];e[r]=e[i],e[i]=s};a(o,0,3),a(o,1,2),a(o,4,5),a(o,6,7)}function Cn(o){var a=o.split(":"),n=null;if(a[0]==="data"&&a.length===2){var e=a[1].split(";"),r=e[e.length-1].split(",");if(r.length===2){var i=r[0]==="base64",s=r[1];i?(e.splice(-1,1),n=Fi(s)):n=In(s)}}return n}function rr(o){return Uint8Array.from(unescape(encodeURIComponent(o)),function(a){return a.charCodeAt(0)})}var Hr=typeof self<"u"?self:void 0,pt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ut={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ji(o){switch(o){case Ut.FAIRPLAY:return pt.FAIRPLAY;case Ut.PLAYREADY:return pt.PLAYREADY;case Ut.WIDEVINE:return pt.WIDEVINE;case Ut.CLEARKEY:return pt.CLEARKEY}}var Ni={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function hr(o){if(o===Ni.WIDEVINE)return pt.WIDEVINE}function O(o){switch(o){case pt.FAIRPLAY:return Ut.FAIRPLAY;case pt.PLAYREADY:return Ut.PLAYREADY;case pt.WIDEVINE:return Ut.WIDEVINE;case pt.CLEARKEY:return Ut.CLEARKEY}}function Q(o){var a=o.drmSystems,n=o.widevineLicenseUrl,e=a?[pt.FAIRPLAY,pt.WIDEVINE,pt.PLAYREADY,pt.CLEARKEY].filter(function(r){return!!a[r]}):[];return!e[pt.WIDEVINE]&&n&&e.push(pt.WIDEVINE),e}var le=function(o){return Hr!=null&&(o=Hr.navigator)!=null&&o.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function ye(o,a,n,e){var r;switch(o){case pt.FAIRPLAY:r=["cenc","sinf"];break;case pt.WIDEVINE:case pt.PLAYREADY:r=["cenc"];break;case pt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+o)}return Ie(r,a,n,e)}function Ie(o,a,n,e){return[{initDataTypes:o,persistentState:e.persistentState||"optional",distinctiveIdentifier:e.distinctiveIdentifier||"optional",sessionTypes:e.sessionTypes||[e.sessionType||"temporary"],audioCapabilities:a.map(function(r){return{contentType:'audio/mp4; codecs="'+r+'"',robustness:e.audioRobustness||"",encryptionScheme:e.audioEncryptionScheme||null}}),videoCapabilities:n.map(function(r){return{contentType:'video/mp4; codecs="'+r+'"',robustness:e.videoRobustness||"",encryptionScheme:e.videoEncryptionScheme||null}})}]}function Le(o,a,n){return Uint8Array.prototype.slice?o.slice(a,n):new Uint8Array(Array.prototype.slice.call(o,a,n))}var Ae=function(a,n){return n+10<=a.length&&a[n]===73&&a[n+1]===68&&a[n+2]===51&&a[n+3]<255&&a[n+4]<255&&a[n+6]<128&&a[n+7]<128&&a[n+8]<128&&a[n+9]<128},De=function(a,n){return n+10<=a.length&&a[n]===51&&a[n+1]===68&&a[n+2]===73&&a[n+3]<255&&a[n+4]<255&&a[n+6]<128&&a[n+7]<128&&a[n+8]<128&&a[n+9]<128},Xe=function(a,n){for(var e=n,r=0;Ae(a,n);){r+=10;var i=Ve(a,n+6);r+=i,De(a,n+10)&&(r+=10),n+=r}if(r>0)return a.subarray(e,e+r)},Ve=function(a,n){var e=0;return e=(a[n]&127)<<21,e|=(a[n+1]&127)<<14,e|=(a[n+2]&127)<<7,e|=a[n+3]&127,e},Ke=function(a,n){return Ae(a,n)&&Ve(a,n+6)+10<=a.length-n},lt=function(a){for(var n=Mt(a),e=0;e<n.length;e++){var r=n[e];if(At(r))return Rt(r)}},At=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},zt=function(a){var n=String.fromCharCode(a[0],a[1],a[2],a[3]),e=Ve(a,4),r=10;return{type:n,size:e,data:a.subarray(r,r+e)}},Mt=function(a){for(var n=0,e=[];Ae(a,n);){var r=Ve(a,n+6);n+=10;for(var i=n+r;n+8<i;){var s=zt(a.subarray(n)),l=Nt(s);l&&e.push(l),n+=s.size+10}De(a,n)&&(n+=10)}return e},Nt=function(a){return a.type==="PRIV"?Lt(a):a.type[0]==="W"?rt(a):or(a)},Lt=function(a){if(!(a.size<2)){var n=Ot(a.data,!0),e=new Uint8Array(a.data.subarray(n.length+1));return{key:a.type,info:n,data:e.buffer}}},or=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var n=1,e=Ot(a.data.subarray(n),!0);n+=e.length+1;var r=Ot(a.data.subarray(n));return{key:a.type,info:e,data:r}}var i=Ot(a.data.subarray(1));return{key:a.type,data:i}}},rt=function(a){if(a.type==="WXXX"){if(a.size<2)return;var n=1,e=Ot(a.data.subarray(n),!0);n+=e.length+1;var r=Ot(a.data.subarray(n));return{key:a.type,info:e,data:r}}var i=Ot(a.data);return{key:a.type,data:i}},Rt=function(a){if(a.data.byteLength===8){var n=new Uint8Array(a.data),e=n[3]&1,r=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return r/=45,e&&(r+=4772185884e-2),Math.round(r)}},Ot=function(a,n){n===void 0&&(n=!1);var e=it();if(e){var r=e.decode(a);if(n){var i=r.indexOf("\0");return i!==-1?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var s=a.length,l,d,f,v="",m=0;m<s;){if(l=a[m++],l===0&&n)return v;if(l===0||l===3)continue;switch(l>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:v+=String.fromCharCode(l);break;case 12:case 13:d=a[m++],v+=String.fromCharCode((l&31)<<6|d&63);break;case 14:d=a[m++],f=a[m++],v+=String.fromCharCode((l&15)<<12|(d&63)<<6|(f&63)<<0);break}}return v},Vt;function it(){if(!navigator.userAgent.includes("PlayStation 4"))return!Vt&&typeof self.TextDecoder<"u"&&(Vt=new self.TextDecoder("utf-8")),Vt}var yt={hexDump:function(a){for(var n="",e=0;e<a.length;e++){var r=a[e].toString(16);r.length<2&&(r="0"+r),n+=r}return n}},Et=Math.pow(2,32)-1,$t=[].push,W={video:1,audio:2,id3:3,text:4};function je(o){return String.fromCharCode.apply(null,o)}function _r(o,a){var n=o[a]<<8|o[a+1];return n<0?65536+n:n}function ve(o,a){var n=dt(o,a);return n<0?4294967296+n:n}function vt(o,a){var n=ve(o,a);return n*=Math.pow(2,32),n+=ve(o,a+4),n}function dt(o,a){return o[a]<<24|o[a+1]<<16|o[a+2]<<8|o[a+3]}function Ze(o,a,n){o[a]=n>>24,o[a+1]=n>>16&255,o[a+2]=n>>8&255,o[a+3]=n&255}function Fe(o){for(var a=o.byteLength,n=0;n<a;){var e=ve(o,n);if(e>8&&o[n+4]===109&&o[n+5]===111&&o[n+6]===111&&o[n+7]===102)return!0;n=e>1?n+e:a}return!1}function he(o,a){var n=[];if(!a.length)return n;for(var e=o.byteLength,r=0;r<e;){var i=ve(o,r),s=je(o.subarray(r+4,r+8)),l=i>1?r+i:e;if(s===a[0])if(a.length===1)n.push(o.subarray(r+8,l));else{var d=he(o.subarray(r+8,l),a.slice(1));d.length&&$t.apply(n,d)}r=l}return n}function ft(o){var a=[],n=o[0],e=8,r=ve(o,e);e+=4;var i=0,s=0;n===0?(i=ve(o,e),s=ve(o,e+4),e+=8):(i=vt(o,e),s=vt(o,e+8),e+=16),e+=2;var l=o.length+s,d=_r(o,e);e+=2;for(var f=0;f<d;f++){var v=e,m=ve(o,v);v+=4;var p=m&2147483647;if((m&2147483648)>>>31===1)return P.warn("SIDX has hierarchical references (not supported)"),null;var y=ve(o,v);v+=4,a.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/r,start:l,end:l+p-1}}),l+=p,v+=4,e=v}return{earliestPresentationTime:i,timescale:r,version:n,referencesCount:d,references:a}}function Xt(o){for(var a=[],n=he(o,["moov","trak"]),e=0;e<n.length;e++){var r=n[e],i=he(r,["tkhd"])[0];if(i){var s=i[0],l=ve(i,s===0?12:20),d=he(r,["mdia","mdhd"])[0];if(d){s=d[0];var f=ve(d,s===0?12:20),v=he(r,["mdia","hdlr"])[0];if(v){var m=je(v.subarray(8,12)),p={soun:Ce.AUDIO,vide:Ce.VIDEO}[m];if(p){var y=he(r,["mdia","minf","stbl","stsd"])[0],_=xt(y);a[l]={timescale:f,type:p},a[p]=R({timescale:f,id:l},_)}}}}}return he(o,["moov","mvex","trex"]).forEach(function(b){var T=a[ve(b,4)];T&&(T.default={duration:ve(b,12),flags:ve(b,20)})}),a}function xt(o){var a=o.subarray(8),n=a.subarray(86),e=je(a.subarray(4,8)),r=e,i=e==="enca"||e==="encv";switch(i&&he(he(a,[e])[0].subarray(e==="enca"?28:78),["sinf"]).forEach(function(ur){var Sr=he(ur,["schm"])[0];if(Sr){var ut=je(Sr.subarray(4,8));if(ut==="cbcs"||ut==="cenc"){var cr=he(ur,["frma"])[0];cr&&(r=je(cr))}}}),r){case"avc1":case"avc2":case"avc3":case"avc4":var s=he(n,["avcC"])[0];r+="."+ir(s[1])+ir(s[2])+ir(s[3]);break;case"mp4a":var l=he(a,[e])[0],d=he(l.subarray(28),["esds"])[0];if(d&&d.length>12){var f=4;if(d[f++]!==3)break;f=et(d,f),f+=2;var v=d[f++];if(v&128&&(f+=2),v&64&&(f+=d[f++]),d[f++]!==4)break;f=et(d,f);var m=d[f++];if(m===64)r+="."+ir(m);else break;if(f+=12,d[f++]!==5)break;f=et(d,f);var p=d[f++],y=(p&248)>>3;y===31&&(y+=1+((p&7)<<3)+((d[f]&224)>>5)),r+="."+y}break;case"hvc1":case"hev1":var _=he(n,["hvcC"])[0],b=_[1],T=["","A","B","C"][b>>6],w=b&31,I=ve(_,2),D=(b&32)>>5?"H":"L",N=_[12],F=_.subarray(6,12);r+="."+T+w,r+="."+I.toString(16).toUpperCase(),r+="."+D+N;for(var V="",G=F.length;G--;){var B=F[G];(B||V)&&(V="."+B.toString(16).toUpperCase()+V)}r+=V;break;case"dvh1":case"dvhe":var H=he(n,["dvcC"])[0],Y=H[2]>>1&127,J=H[2]<<5&32|H[3]>>3&31;r+="."+Ge(Y)+"."+Ge(J);break;case"vp09":var j=he(n,["vpcC"])[0],me=j[4],Re=j[5],Te=j[6]>>4&15;r+="."+Ge(me)+"."+Ge(Re)+"."+Ge(Te);break;case"av01":var Qe=he(n,["av1C"])[0],Ue=Qe[1]>>>5,qe=Qe[1]&31,He=Qe[2]>>>7?"H":"M",ze=(Qe[2]&64)>>6,at=(Qe[2]&32)>>5,qt=Ue===2&&ze?at?12:10:ze?10:8,Bt=(Qe[2]&16)>>4,tr=(Qe[2]&8)>>3,Ht=(Qe[2]&4)>>2,gt=Qe[2]&3;r+="."+Ue+"."+Ge(qe)+He+"."+Ge(qt)+"."+Bt+"."+tr+Ht+gt+"."+Ge(1)+"."+Ge(1)+"."+Ge(1)+".0";break}return{codec:r,encrypted:i}}function et(o,a){for(var n=a+5;o[a++]&128&&a<n;);return a}function ir(o){return("0"+o.toString(16).toUpperCase()).slice(-2)}function Ge(o){return(o<10?"0":"")+o}function mt(o,a){if(!o||!a)return o;var n=a.keyId;return n&&a.isCommonEncryption&&he(o,["moov","trak"]).forEach(function(e){var r=he(e,["mdia","minf","stbl","stsd"])[0].subarray(8),i=he(r,["enca"]),s=i.length>0;s||(i=he(r,["encv"])),i.forEach(function(l){he(s?l.subarray(28):l.subarray(78),["sinf"]).forEach(function(d){var f=We(d);if(f){var v=f.subarray(8,24);v.some(function(m){return m!==0})||(P.log("[eme] Patching keyId in 'enc"+(s?"a":"v")+">sinf>>tenc' box: "+yt.hexDump(v)+" -> "+yt.hexDump(n)),f.set(n,8))}})})}),o}function We(o){var a=he(o,["schm"])[0];if(a){var n=je(a.subarray(4,8));if(n==="cbcs"||n==="cenc")return he(o,["schi","tenc"])[0]}return P.error("[eme] missing 'schm' box"),null}function tt(o,a){return he(a,["moof","traf"]).reduce(function(n,e){var r=he(e,["tfdt"])[0],i=r[0],s=he(e,["tfhd"]).reduce(function(l,d){var f=o[ve(d,4)];if(f){var v=ve(r,4);if(i===1){if(v===Et)return P.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),l;v*=Et+1,v+=ve(r,8)}var m=f.timescale||9e4,p=v/m;if(ne(p)&&(l===null||p<l))return p}return l},null);return s!==null&&ne(s)&&(n===null||s<n)?s:n},null)}function kt(o,a){for(var n=0,e=0,r=0,i=he(o,["moof","traf"]),s=0;s<i.length;s++){var l=i[s],d=he(l,["tfhd"])[0],f=a[ve(d,4)];if(f){var v=f.default,m=ve(d,0)|v?.flags,p=v?.duration;m&8&&(m&2?p=ve(d,12):p=ve(d,8));for(var y=f.timescale||9e4,_=he(l,["trun"]),b=0;b<_.length;b++){if(n=Qt(_[b]),!n&&p){var T=ve(_[b],4);n=p*T}f.type===Ce.VIDEO?e+=n/y:f.type===Ce.AUDIO&&(r+=n/y)}}}if(e===0&&r===0){for(var w=1/0,I=0,D=0,N=he(o,["sidx"]),F=0;F<N.length;F++){var V=ft(N[F]);if(V!=null&&V.references){w=Math.min(w,V.earliestPresentationTime/V.timescale);var G=V.references.reduce(function(B,H){return B+H.info.duration||0},0);I=Math.max(I,G+V.earliestPresentationTime/V.timescale),D=I-w}}if(D&&ne(D))return D}return e||r}function Qt(o){var a=ve(o,0),n=8;a&1&&(n+=4),a&4&&(n+=4);for(var e=0,r=ve(o,4),i=0;i<r;i++){if(a&256){var s=ve(o,n);e+=s,n+=4}a&512&&(n+=4),a&1024&&(n+=4),a&2048&&(n+=4)}return e}function Tt(o,a,n){he(a,["moof","traf"]).forEach(function(e){he(e,["tfhd"]).forEach(function(r){var i=o[ve(r,4)];if(i){var s=i.timescale||9e4;he(e,["tfdt"]).forEach(function(l){var d=l[0],f=n*s;if(f){var v=ve(l,4);if(d===0)v-=f,v=Math.max(v,0),Ze(l,4,v);else{v*=Math.pow(2,32),v+=ve(l,8),v-=f,v=Math.max(v,0);var m=Math.floor(v/(Et+1)),p=Math.floor(v%(Et+1));Ze(l,4,m),Ze(l,8,p)}}})}})})}function Kt(o){var a={valid:null,remainder:null},n=he(o,["moof"]);if(n.length<2)return a.remainder=o,a;var e=n[n.length-1];return a.valid=Le(o,0,e.byteOffset-8),a.remainder=Le(o,e.byteOffset-8),a}function Be(o,a){var n=new Uint8Array(o.length+a.length);return n.set(o),n.set(a,o.length),n}function _t(o,a){var n=[],e=a.samples,r=a.timescale,i=a.id,s=!1;return he(e,["moof"]).map(function(l){var d=l.byteOffset-8;he(l,["traf"]).map(function(f){var v=he(f,["tfdt"]).map(function(m){var p=m[0],y=ve(m,4);return p===1&&(y*=Math.pow(2,32),y+=ve(m,8)),y/r})[0];return v!==void 0&&(o=v),he(f,["tfhd"]).map(function(m){var p=ve(m,4),y=ve(m,0)&16777215,_=(y&1)!==0,b=(y&2)!==0,T=(y&8)!==0,w=0,I=(y&16)!==0,D=0,N=(y&32)!==0,F=8;p===i&&(_&&(F+=8),b&&(F+=4),T&&(w=ve(m,F),F+=4),I&&(D=ve(m,F),F+=4),N&&(F+=4),a.type==="video"&&(s=st(a.codec)),he(f,["trun"]).map(function(V){var G=V[0],B=ve(V,0)&16777215,H=(B&1)!==0,Y=0,J=(B&4)!==0,j=(B&256)!==0,me=0,Re=(B&512)!==0,Te=0,Qe=(B&1024)!==0,Ue=(B&2048)!==0,qe=0,He=ve(V,4),ze=8;H&&(Y=ve(V,ze),ze+=4),J&&(ze+=4);for(var at=Y+d,qt=0;qt<He;qt++){if(j?(me=ve(V,ze),ze+=4):me=w,Re?(Te=ve(V,ze),ze+=4):Te=D,Qe&&(ze+=4),Ue&&(G===0?qe=ve(V,ze):qe=dt(V,ze),ze+=4),a.type===Ce.VIDEO)for(var Bt=0;Bt<Te;){var tr=ve(e,at);at+=4,Tr(s,e[at])&&vr(e.subarray(at,at+tr),s?2:1,o+qe/r,n),at+=tr,Bt+=tr+4}o+=me/r}}))})})}),n}function st(o){if(!o)return!1;var a=o.indexOf("."),n=a<0?o:o.substring(0,a);return n==="hvc1"||n==="hev1"||n==="dvh1"||n==="dvhe"}function Tr(o,a){if(o){var n=a>>1&63;return n===39||n===40}else return(a&31)===6}function vr(o,a,n,e){var r=ei(o),i=0;i+=a;for(var s=0,l=0,d=0;i<r.length;){s=0;do{if(i>=r.length)break;d=r[i++],s+=d}while(d===255);l=0;do{if(i>=r.length)break;d=r[i++],l+=d}while(d===255);var f=r.length-i,v=i;if(l<f)i+=l;else if(l>f){P.error("Malformed SEI payload. "+l+" is too small, only "+f+" bytes left to parse.");break}if(s===4){if(r[v++]===181){var m=_r(r,v);if(v+=2,m===49){var p=ve(r,v);if(v+=4,p===1195456820){var y=r[v++];if(y===3){var _=r[v++],b=31&_,T=64&_,w=T?2+b*3:0,I=new Uint8Array(w);if(T){I[0]=_;for(var D=1;D<w;D++)I[D]=r[v++]}e.push({type:y,payloadType:s,pts:n,bytes:I})}}}}}else if(s===5&&l>16){for(var N=[],F=0;F<16;F++){var V=r[v++].toString(16);N.push(V.length==1?"0"+V:V),(F===3||F===5||F===7||F===9)&&N.push("-")}for(var G=l-16,B=new Uint8Array(G),H=0;H<G;H++)B[H]=r[v++];e.push({payloadType:s,pts:n,uuid:N.join(""),userData:Ot(B),userDataBytes:B})}}}function ei(o){for(var a=o.byteLength,n=[],e=1;e<a-2;)o[e]===0&&o[e+1]===0&&o[e+2]===3?(n.push(e+2),e+=2):e++;if(n.length===0)return o;var r=a-n.length,i=new Uint8Array(r),s=0;for(e=0;e<r;s++,e++)s===n[0]&&(s++,n.shift()),i[e]=o[s];return i}function br(o){var a=o[0],n="",e="",r=0,i=0,s=0,l=0,d=0,f=0;if(a===0){for(;je(o.subarray(f,f+1))!=="\0";)n+=je(o.subarray(f,f+1)),f+=1;for(n+=je(o.subarray(f,f+1)),f+=1;je(o.subarray(f,f+1))!=="\0";)e+=je(o.subarray(f,f+1)),f+=1;e+=je(o.subarray(f,f+1)),f+=1,r=ve(o,12),i=ve(o,16),l=ve(o,20),d=ve(o,24),f=28}else if(a===1){f+=4,r=ve(o,f),f+=4;var v=ve(o,f);f+=4;var m=ve(o,f);for(f+=4,s=Math.pow(2,32)*v+m,It(s)||(s=Number.MAX_SAFE_INTEGER,P.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=ve(o,f),f+=4,d=ve(o,f),f+=4;je(o.subarray(f,f+1))!=="\0";)n+=je(o.subarray(f,f+1)),f+=1;for(n+=je(o.subarray(f,f+1)),f+=1;je(o.subarray(f,f+1))!=="\0";)e+=je(o.subarray(f,f+1)),f+=1;e+=je(o.subarray(f,f+1)),f+=1}var p=o.subarray(f,o.byteLength);return{schemeIdUri:n,value:e,timeScale:r,presentationTime:s,presentationTimeDelta:i,eventDuration:l,id:d,payload:p}}function Bi(o){for(var a=arguments.length,n=new Array(a>1?a-1:0),e=1;e<a;e++)n[e-1]=arguments[e];for(var r=n.length,i=8,s=r;s--;)i+=n[s].byteLength;var l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(o,4),s=0,i=8;s<r;s++)l.set(n[s],i),i+=n[s].byteLength;return l}function ui(o,a,n){if(o.byteLength!==16)throw new RangeError("Invalid system id");var e,r;if(a){e=1,r=new Uint8Array(a.length*16);for(var i=0;i<a.length;i++){var s=a[i];if(s.byteLength!==16)throw new RangeError("Invalid key");r.set(s,i*16)}}else e=0,r=new Uint8Array;var l;e>0?(l=new Uint8Array(4),a.length>0&&new DataView(l.buffer).setUint32(0,a.length,!1)):l=new Uint8Array;var d=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(d.buffer).setUint32(0,n.byteLength,!1),Bi([112,115,115,104],new Uint8Array([e,0,0,0]),o,l,r,d,n||new Uint8Array)}function Mr(o){if(!(o instanceof ArrayBuffer)||o.byteLength<32)return null;var a={version:0,systemId:"",kids:null,data:null},n=new DataView(o),e=n.getUint32(0);if(o.byteLength!==e&&e>44||n.getUint32(4)!==1886614376||(a.version=n.getUint32(8)>>>24,a.version>1))return null;a.systemId=yt.hexDump(new Uint8Array(o,12,16));var r=n.getUint32(28);if(a.version===0){if(e-32<r)return null;a.data=new Uint8Array(o,32,r)}else if(a.version===1){a.kids=[];for(var i=0;i<r;i++)a.kids.push(new Uint8Array(o,32+i*16,16))}return a}var pi={},Ui=function(){o.clearKeyUriToKeyIdMap=function(){pi={}};function o(n,e,r,i,s){i===void 0&&(i=[1]),s===void 0&&(s=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=n,this.uri=e,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=n?n!=="NONE":!1,this.isCommonEncryption=this.encrypted&&n!=="AES-128"}var a=o.prototype;return a.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ut.FAIRPLAY:case Ut.WIDEVINE:case Ut.PLAYREADY:case Ut.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},a.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&P.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var r=ya(e);return new o(this.method,this.uri,"identity",this.keyFormatVersions,r)}var i=Cn(this.uri);if(i)switch(this.keyFormat){case Ut.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case Ut.PLAYREADY:this.pssh=ui(new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),null,i);var s=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),l=String.fromCharCode.apply(null,Array.from(s)),d=l.substring(l.indexOf("<"),l.length),f=new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("KID")[0];if(f){var v=f.childNodes[0]?f.childNodes[0].nodeValue:f.getAttribute("VALUE");if(v){var m=Fi(v).subarray(0,16);kn(m),this.keyId=m}}break;default:var p=i.subarray(0,16);if(p.length!==16){var y=new Uint8Array(16);y.set(p,16-p.length),p=y}this.keyId=p;break}if(!this.keyId||this.keyId.byteLength!==16){var _=pi[this.uri];if(!_){var b=Object.keys(pi).length%Number.MAX_SAFE_INTEGER;_=new Uint8Array(16),new DataView(_.buffer,12,4).setUint32(0,b),pi[this.uri]=_}this.keyId=_}return this},o}();function ya(o){for(var a=new Uint8Array(16),n=12;n<16;n++)a[n]=o>>8*(15-n)&255;return a}var ti=/\{\$([a-zA-Z0-9-_]+)\}/g;function yi(o){return ti.test(o)}function nr(o,a,n){if(o.variableList!==null||o.hasVariableRefs)for(var e=n.length;e--;){var r=n[e],i=a[r];i&&(a[r]=Vi(o,i))}}function Vi(o,a){if(o.variableList!==null||o.hasVariableRefs){var n=o.variableList;return a.replace(ti,function(e){var r=e.substring(2,e.length-1),i=n?.[r];return i===void 0?(o.playlistParsingError||(o.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),e):i})}return a}function Wi(o,a,n){var e=o.variableList;e||(o.variableList=e={});var r,i;if("QUERYPARAM"in a){r=a.QUERYPARAM;try{var s=new self.URL(n).searchParams;if(s.has(r))i=s.get(r);else throw new Error('"'+r+'" does not match any query parameter in URI: "'+n+'"')}catch(l){o.playlistParsingError||(o.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+l.message))}}else r=a.NAME,i=a.VALUE;r in e?o.playlistParsingError||(o.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+r+'"')):e[r]=i||""}function Gi(o,a,n){var e=a.IMPORT;if(n&&e in n){var r=o.variableList;r||(o.variableList=r={}),r[e]=n[e]}else o.playlistParsingError||(o.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+e+'"'))}function wr(o){if(o===void 0&&(o=!0),!(typeof self>"u"))return(o||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function zr(o){return typeof self<"u"&&o===self.ManagedMediaSource}var Ei={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Yi(o,a){var n=Ei[a];return!!n&&!!n[o.slice(0,4)]}function _i(o,a,n){return n===void 0&&(n=!0),!o.split(",").some(function(e){return!qi(e,a,n)})}function qi(o,a,n){var e;n===void 0&&(n=!0);var r=wr(n);return(e=r?.isTypeSupported(de(o,a)))!=null?e:!1}function de(o,a){return a+'/mp4;codecs="'+o+'"'}function Ye(o){if(o){var a=o.substring(0,4);return Ei.video[a]}return 2}function lr(o){return o.split(",").reduce(function(a,n){var e=Ei.video[n];return e?(e*2+a)/(a?3:2):(Ei.audio[n]+a)/(a?2:1)},0)}var Ft={};function Si(o,a){if(a===void 0&&(a=!0),Ft[o])return Ft[o];for(var n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[o],e=0;e<n.length;e++)if(qi(n[e],"audio",a))return Ft[o]=n[e],n[e];return o}var xr=/flac|opus/i;function mr(o,a){return a===void 0&&(a=!0),o.replace(xr,function(n){return Si(n.toLowerCase(),a)})}function Fr(o,a){return o&&o!=="mp4a"?o:a&&a.split(",")[0]}function Kr(o){for(var a=o.split(","),n=0;n<a.length;n++){var e=a[n].split(".");if(e.length>2){var r=e.shift()+".";r+=parseInt(e.shift()).toString(16),r+=("000"+parseInt(e.shift()).toString(16)).slice(-4),a[n]=r}}return a.join(",")}var Nr=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ti=/#EXT-X-MEDIA:(.*)/g,$i=/^#EXT(?:INF|-X-TARGETDURATION):/m,Xi=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Qi=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ir=function(){function o(){}return o.findGroup=function(n,e){for(var r=0;r<n.length;r++){var i=n[r];if(i.id===e)return i}},o.resolve=function(n,e){return Ne.buildAbsoluteURL(e,n,{alwaysNormalize:!0})},o.isMediaPlaylist=function(n){return $i.test(n)},o.parseMasterPlaylist=function(n,e){var r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:yi(n)},i=[];Nr.lastIndex=0;for(var s;(s=Nr.exec(n))!=null;)if(s[1]){var l,d=new te(s[1]);nr(r,d,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var f=Vi(r,s[2]),v={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:o.resolve(f,e)},m=d.decimalResolution("RESOLUTION");m&&(v.width=m.width,v.height=m.height),Hi(d.CODECS,v),(l=v.unknownCodecs)!=null&&l.length||i.push(v),r.levels.push(v)}else if(s[3]){var p=s[3],y=s[4];switch(p){case"SESSION-DATA":var _=new te(y);nr(r,_,["DATA-ID","LANGUAGE","VALUE","URI"]);var b=_["DATA-ID"];b&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[b]=_);break;case"SESSION-KEY":var T=gr(y,e,r);T.encrypted&&T.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(T)):P.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+y+'"');break;case"DEFINE":var w=new te(y);nr(r,w,["NAME","VALUE","QUERYPARAM"]),Wi(r,w,e);break;case"CONTENT-STEERING":var I=new te(y);nr(r,I,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:o.resolve(I["SERVER-URI"],e),pathwayId:I["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=Ai(y);break}}return r.levels=i.length>0&&i.length<r.levels.length?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},o.parseMasterPlaylistMedia=function(n,e,r){var i,s={},l=r.levels,d={AUDIO:l.map(function(F){return{id:F.attrs.AUDIO,audioCodec:F.audioCodec}}),SUBTITLES:l.map(function(F){return{id:F.attrs.SUBTITLES,textCodec:F.textCodec}}),"CLOSED-CAPTIONS":[]},f=0;for(Ti.lastIndex=0;(i=Ti.exec(n))!==null;){var v=new te(i[1]),m=v.TYPE;if(m){var p=d[m],y=s[m]||[];s[m]=y,nr(r,v,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var _=v.LANGUAGE,b=v["ASSOC-LANGUAGE"],T=v.CHANNELS,w=v.CHARACTERISTICS,I=v["INSTREAM-ID"],D={attrs:v,bitrate:0,id:f++,groupId:v["GROUP-ID"]||"",name:v.NAME||_||"",type:m,default:v.bool("DEFAULT"),autoselect:v.bool("AUTOSELECT"),forced:v.bool("FORCED"),lang:_,url:v.URI?o.resolve(v.URI,e):""};if(b&&(D.assocLang=b),T&&(D.channels=T),w&&(D.characteristics=w),I&&(D.instreamId=I),p!=null&&p.length){var N=o.findGroup(p,D.groupId)||p[0];pr(D,N,"audioCodec"),pr(D,N,"textCodec")}y.push(D)}}return s},o.parseLevelPlaylist=function(n,e,r,i,s,l){var d=new wn(e),f=d.fragments,v=null,m=0,p=0,y=0,_=0,b=null,T=new sr(i,e),w,I,D,N=-1,F=!1,V=null;for(Xi.lastIndex=0,d.m3u8=n,d.hasVariableRefs=yi(n);(w=Xi.exec(n))!==null;){F&&(F=!1,T=new sr(i,e),T.start=y,T.sn=m,T.cc=_,T.level=r,v&&(T.initSegment=v,T.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null,V&&(T.setByteRange(V),V=null)));var G=w[1];if(G){T.duration=parseFloat(G);var B=(" "+w[2]).slice(1);T.title=B||null,T.tagList.push(B?["INF",G,B]:["INF",G])}else if(w[3]){if(ne(T.duration)){T.start=y,D&&Me(T,D,d),T.sn=m,T.level=r,T.cc=_,f.push(T);var H=(" "+w[3]).slice(1);T.relurl=Vi(d,H),ke(T,b),b=T,y+=T.duration,m++,p=0,F=!0}}else if(w[4]){var Y=(" "+w[4]).slice(1);b?T.setByteRange(Y,b):T.setByteRange(Y)}else if(w[5])T.rawProgramDateTime=(" "+w[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),N===-1&&(N=f.length);else{if(w=w[0].match(Qi),!w){P.warn("No matches on slow regex match for level playlist!");continue}for(I=1;I<w.length&&!(typeof w[I]<"u");I++);var J=(" "+w[I]).slice(1),j=(" "+w[I+1]).slice(1),me=w[I+2]?(" "+w[I+2]).slice(1):"";switch(J){case"PLAYLIST-TYPE":d.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":m=d.startSN=parseInt(j);break;case"SKIP":var Re=new te(j);nr(d,Re,["RECENTLY-REMOVED-DATERANGES"]);var Te=Re.decimalInteger("SKIPPED-SEGMENTS");if(ne(Te)){d.skippedSegments=Te;for(var Qe=Te;Qe--;)f.unshift(null);m+=Te}var Ue=Re.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ue&&(d.recentlyRemovedDateranges=Ue.split("	"));break;case"TARGETDURATION":d.targetduration=Math.max(parseInt(j),1);break;case"VERSION":d.version=parseInt(j);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(j||me)&&T.tagList.push(me?[j,me]:[j]);break;case"DISCONTINUITY":_++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([J]);break;case"BITRATE":T.tagList.push([J,j]);break;case"DATERANGE":var qe=new te(j);nr(d,qe,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),nr(d,qe,qe.clientAttrs);var He=new be(qe,d.dateRanges[qe.ID]);He.isValid||d.skippedSegments?d.dateRanges[He.id]=He:P.warn('Ignoring invalid DATERANGE tag: "'+j+'"'),T.tagList.push(["EXT-X-DATERANGE",j]);break;case"DEFINE":var ze=new te(j);nr(d,ze,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ze?Gi(d,ze,l):Wi(d,ze,e);break;case"DISCONTINUITY-SEQUENCE":_=parseInt(j);break;case"KEY":var at=gr(j,e,d);if(at.isSupported()){if(at.method==="NONE"){D=void 0;break}D||(D={}),D[at.keyFormat]&&(D=X({},D)),D[at.keyFormat]=at}else P.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+j+'"');break;case"START":d.startTimeOffset=Ai(j);break;case"MAP":var qt=new te(j);if(nr(d,qt,["BYTERANGE","URI"]),T.duration){var Bt=new sr(i,e);Oe(Bt,qt,r,D),v=Bt,T.initSegment=v,v.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=v.rawProgramDateTime)}else{var tr=T.byteRangeEndOffset;if(tr){var Ht=T.byteRangeStartOffset;V=tr-Ht+"@"+Ht}else V=null;Oe(T,qt,r,D),v=T,F=!0}break;case"SERVER-CONTROL":var gt=new te(j);d.canBlockReload=gt.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=gt.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&gt.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=gt.optionalFloat("PART-HOLD-BACK",0),d.holdBack=gt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":d.partTarget=new te(j).decimalFloatingPoint("PART-TARGET");break;case"PART":var ur=d.partList;ur||(ur=d.partList=[]);var Sr=p>0?ur[ur.length-1]:void 0,ut=p++,cr=new te(j);nr(d,cr,["BYTERANGE","URI"]);var Er=new fr(cr,T,e,ut,Sr);ur.push(Er),T.duration+=Er.duration;break;case"PRELOAD-HINT":var dr=new te(j);nr(d,dr,["URI"]),d.preloadHint=dr;break;case"RENDITION-REPORT":var Yt=new te(j);nr(d,Yt,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(Yt);break;default:P.warn("line parsed but not handled: "+w);break}}}b&&!b.relurl?(f.pop(),y-=b.duration,d.partList&&(d.fragmentHint=b)):d.partList&&(ke(T,b),T.cc=_,d.fragmentHint=T,D&&Me(T,D,d));var St=f.length,Jr=f[0],Or=f[St-1];if(y+=d.skippedSegments*d.targetduration,y>0&&St&&Or){d.averagetargetduration=y/St;var Zr=Or.sn;d.endSN=Zr!=="initSegment"?Zr:0,d.live||(Or.endList=!0),Jr&&(d.startCC=Jr.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(y+=d.fragmentHint.duration),d.totalduration=y,d.endCC=_,N>0&&fi(f,N),d},o}();function gr(o,a,n){var e,r,i=new te(o);nr(n,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var s=(e=i.METHOD)!=null?e:"",l=i.URI,d=i.hexadecimalInteger("IV"),f=i.KEYFORMATVERSIONS,v=(r=i.KEYFORMAT)!=null?r:"identity";return l&&i.IV&&!d&&P.error("Invalid IV: "+i.IV),new Ui(s,l?Ir.resolve(l,a):"",v,(f||"1").split("/").map(Number).filter(Number.isFinite),d)}function Ai(o){var a=new te(o).decimalFloatingPoint("TIME-OFFSET");return ne(a)?a:null}function Hi(o,a){var n=(o||"").split(/[ ,]+/).filter(function(e){return e});["video","audio","text"].forEach(function(e){var r=n.filter(function(i){return Yi(i,e)});r.length&&(a[e+"Codec"]=r.join(","),n=n.filter(function(i){return r.indexOf(i)===-1}))}),a.unknownCodecs=n}function pr(o,a,n){var e=a[n];e&&(o[n]=e)}function fi(o,a){for(var n=o[a],e=a;e--;){var r=o[e];if(!r)return;r.programDateTime=n.programDateTime-r.duration*1e3,n=r}}function ke(o,a){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):a!=null&&a.programDateTime&&(o.programDateTime=a.endProgramDateTime),ne(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}function Oe(o,a,n,e){o.relurl=a.URI,a.BYTERANGE&&o.setByteRange(a.BYTERANGE),o.level=n,o.sn="initSegment",e&&(o.levelkeys=e),o.initSegment=null}function Me(o,a,n){o.levelkeys=a;var e=n.encryptedFragments;(!e.length||e[e.length-1].levelkeys!==a)&&Object.keys(a).some(function(r){return a[r].isCommonEncryption})&&e.push(o)}var _e={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},fe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Jt(o){switch(o.type){case _e.AUDIO_TRACK:return fe.AUDIO;case _e.SUBTITLE_TRACK:return fe.SUBTITLE;default:return fe.MAIN}}function yr(o,a){var n=o.url;return(n===void 0||n.indexOf("data:")===0)&&(n=a.url),n}var Br=function(){function o(n){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=n,this.registerListeners()}var a=o.prototype;return a.startLoad=function(e){},a.stopLoad=function(){this.destroyInternalLoaders()},a.registerListeners=function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.unregisterListeners=function(){var e=this.hls;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.createInternalLoader=function(e){var r=this.hls.config,i=r.pLoader,s=r.loader,l=new(i||s)(r);return this.loaders[e.type]=l,l},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var r=this.loaders[e];r&&r.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},a.onManifestLoading=function(e,r){var i=r.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:_e.MANIFEST,url:i,deliveryDirectives:null})},a.onLevelLoading=function(e,r){var i=r.id,s=r.level,l=r.pathwayId,d=r.url,f=r.deliveryDirectives;this.load({id:i,level:s,pathwayId:l,responseType:"text",type:_e.LEVEL,url:d,deliveryDirectives:f})},a.onAudioTrackLoading=function(e,r){var i=r.id,s=r.groupId,l=r.url,d=r.deliveryDirectives;this.load({id:i,groupId:s,level:null,responseType:"text",type:_e.AUDIO_TRACK,url:l,deliveryDirectives:d})},a.onSubtitleTrackLoading=function(e,r){var i=r.id,s=r.groupId,l=r.url,d=r.deliveryDirectives;this.load({id:i,groupId:s,level:null,responseType:"text",type:_e.SUBTITLE_TRACK,url:l,deliveryDirectives:d})},a.load=function(e){var r,i=this,s=this.hls.config,l=this.getInternalLoader(e);if(l){var d=l.context;if(d&&d.url===e.url&&d.level===e.level){P.trace("[playlist-loader]: playlist request ongoing");return}P.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}var f;if(e.type===_e.MANIFEST?f=s.manifestLoadPolicy.default:f=X({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(e),ne((r=e.deliveryDirectives)==null?void 0:r.part)){var v;if(e.type===_e.LEVEL&&e.level!==null?v=this.hls.levels[e.level].details:e.type===_e.AUDIO_TRACK&&e.id!==null?v=this.hls.audioTracks[e.id].details:e.type===_e.SUBTITLE_TRACK&&e.id!==null&&(v=this.hls.subtitleTracks[e.id].details),v){var m=v.partTarget,p=v.targetduration;if(m&&p){var y=Math.max(m*3,p*.8)*1e3;f=X({},f,{maxTimeToFirstByteMs:Math.min(y,f.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,f.maxTimeToFirstByteMs)})}}}var _=f.errorRetry||f.timeoutRetry||{},b={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:_.maxNumRetry||0,retryDelay:_.retryDelayMs||0,maxRetryDelay:_.maxRetryDelayMs||0};l.load(e,b,{onSuccess:function(w,I,D,N){var F=i.getInternalLoader(D);i.resetInternalLoader(D.type);var V=w.data;if(V.indexOf("#EXTM3U")!==0){i.handleManifestParsingError(w,D,new Error("no EXTM3U delimiter"),N||null,I);return}I.parsing.start=performance.now(),Ir.isMediaPlaylist(V)?i.handleTrackOrLevelPlaylist(w,I,D,N||null,F):i.handleMasterPlaylist(w,I,D,N)},onError:function(w,I,D,N){i.handleNetworkError(I,D,!1,w,N)},onTimeout:function(w,I,D){i.handleNetworkError(I,D,!0,void 0,w)}})},a.handleMasterPlaylist=function(e,r,i,s){var l=this.hls,d=e.data,f=yr(e,i),v=Ir.parseMasterPlaylist(d,f);if(v.playlistParsingError){this.handleManifestParsingError(e,i,v.playlistParsingError,s,r);return}var m=v.contentSteering,p=v.levels,y=v.sessionData,_=v.sessionKeys,b=v.startTimeOffset,T=v.variableList;this.variableList=T;var w=Ir.parseMasterPlaylistMedia(d,f,v),I=w.AUDIO,D=I===void 0?[]:I,N=w.SUBTITLES,F=w["CLOSED-CAPTIONS"];D.length&&!D.some(function(V){return!V.url})&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(P.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),D.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new te({}),bitrate:0,url:""})),l.trigger(A.MANIFEST_LOADED,{levels:p,audioTracks:D,subtitles:N,captions:F,contentSteering:m,url:f,stats:r,networkDetails:s,sessionData:y,sessionKeys:_,startTimeOffset:b,variableList:T})},a.handleTrackOrLevelPlaylist=function(e,r,i,s,l){var d=this.hls,f=i.id,v=i.level,m=i.type,p=yr(e,i),y=0,_=ne(v)?v:ne(f)?f:0,b=Jt(i),T=Ir.parseLevelPlaylist(e.data,p,_,b,y,this.variableList);if(m===_e.MANIFEST){var w={attrs:new te({}),bitrate:0,details:T,name:"",url:p};d.trigger(A.MANIFEST_LOADED,{levels:[w],audioTracks:[],url:p,stats:r,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}r.parsing.end=performance.now(),i.levelDetails=T,this.handlePlaylistLoaded(T,e,r,i,s,l)},a.handleManifestParsingError=function(e,r,i,s,l){this.hls.trigger(A.ERROR,{type:re.NETWORK_ERROR,details:U.MANIFEST_PARSING_ERROR,fatal:r.type===_e.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:r,networkDetails:s,stats:l})},a.handleNetworkError=function(e,r,i,s,l){i===void 0&&(i=!1);var d="A network "+(i?"timeout":"error"+(s?" (status "+s.code+")":""))+" occurred while loading "+e.type;e.type===_e.LEVEL?d+=": "+e.level+" id: "+e.id:(e.type===_e.AUDIO_TRACK||e.type===_e.SUBTITLE_TRACK)&&(d+=" id: "+e.id+' group-id: "'+e.groupId+'"');var f=new Error(d);P.warn("[playlist-loader]: "+d);var v=U.UNKNOWN,m=!1,p=this.getInternalLoader(e);switch(e.type){case _e.MANIFEST:v=i?U.MANIFEST_LOAD_TIMEOUT:U.MANIFEST_LOAD_ERROR,m=!0;break;case _e.LEVEL:v=i?U.LEVEL_LOAD_TIMEOUT:U.LEVEL_LOAD_ERROR,m=!1;break;case _e.AUDIO_TRACK:v=i?U.AUDIO_TRACK_LOAD_TIMEOUT:U.AUDIO_TRACK_LOAD_ERROR,m=!1;break;case _e.SUBTITLE_TRACK:v=i?U.SUBTITLE_TRACK_LOAD_TIMEOUT:U.SUBTITLE_LOAD_ERROR,m=!1;break}p&&this.resetInternalLoader(e.type);var y={type:re.NETWORK_ERROR,details:v,fatal:m,url:e.url,loader:p,context:e,error:f,networkDetails:r,stats:l};s&&(y.response=R({url:r?.url||e.url,data:void 0},s)),this.hls.trigger(A.ERROR,y)},a.handlePlaylistLoaded=function(e,r,i,s,l,d){var f=this.hls,v=s.type,m=s.level,p=s.id,y=s.groupId,_=s.deliveryDirectives,b=yr(r,s),T=Jt(s),w=typeof s.level=="number"&&T===fe.MAIN?m:void 0;if(!e.fragments.length){var I=new Error("No Segments found in Playlist");f.trigger(A.ERROR,{type:re.NETWORK_ERROR,details:U.LEVEL_EMPTY_ERROR,fatal:!1,url:b,error:I,reason:I.message,response:r,context:s,level:w,parent:T,networkDetails:l,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var D=e.playlistParsingError;if(D){f.trigger(A.ERROR,{type:re.NETWORK_ERROR,details:U.LEVEL_PARSING_ERROR,fatal:!1,url:b,error:D,reason:D.message,response:r,context:s,level:w,parent:T,networkDetails:l,stats:i});return}switch(e.live&&d&&(d.getCacheAge&&(e.ageHeader=d.getCacheAge()||0),(!d.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),v){case _e.MANIFEST:case _e.LEVEL:f.trigger(A.LEVEL_LOADED,{details:e,level:w||0,id:p||0,stats:i,networkDetails:l,deliveryDirectives:_});break;case _e.AUDIO_TRACK:f.trigger(A.AUDIO_TRACK_LOADED,{details:e,id:p||0,groupId:y||"",stats:i,networkDetails:l,deliveryDirectives:_});break;case _e.SUBTITLE_TRACK:f.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,id:p||0,groupId:y||"",stats:i,networkDetails:l,deliveryDirectives:_});break}},o}();function kr(o,a){var n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=o,a.dispatchEvent(n)}function jr(o,a){var n=o.mode;if(n==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(a.id))try{if(o.addCue(a),!o.cues.getCueById(a.id))throw new Error("addCue is failed for: "+a)}catch(r){P.debug("[texttrack-utils]: "+r);try{var e=new self.TextTrackCue(a.startTime,a.endTime,a.text);e.id=a.id,o.addCue(e)}catch(i){P.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+i)}}n==="disabled"&&(o.mode=n)}function wt(o){var a=o.mode;if(a==="disabled"&&(o.mode="hidden"),o.cues)for(var n=o.cues.length;n--;)o.removeCue(o.cues[n]);a==="disabled"&&(o.mode=a)}function Gt(o,a,n,e){var r=o.mode;if(r==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var i=Ji(o.cues,a,n),s=0;s<i.length;s++)(!e||e(i[s]))&&o.removeCue(i[s]);r==="disabled"&&(o.mode=r)}function ri(o,a){if(a<o[0].startTime)return 0;var n=o.length-1;if(a>o[n].endTime)return-1;for(var e=0,r=n;e<=r;){var i=Math.floor((r+e)/2);if(a<o[i].startTime)r=i-1;else if(a>o[i].startTime&&e<n)e=i+1;else return i}return o[e].startTime-a<a-o[r].startTime?e:r}function Ji(o,a,n){var e=[],r=ri(o,a);if(r>-1)for(var i=r,s=o.length;i<s;i++){var l=o[i];if(l.startTime>=a&&l.endTime<=n)e.push(l);else if(l.startTime>n)return e}return e}function ot(o){for(var a=[],n=0;n<o.length;n++){var e=o[n];(e.kind==="subtitles"||e.kind==="captions")&&e.label&&a.push(o[n])}return a}var Ct={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},Wr=.25;function Li(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Ea(o,a,n,e,r){var i=new o(a,n,"");try{i.value=e,r&&(i.type=r)}catch{i=new o(a,n,JSON.stringify(r?R({type:r},e):e))}return i}var Zi=function(){var o=Li();try{o&&new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Dn(o,a){return o.getTime()/1e3-a}function ro(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var io=function(){function o(n){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=n,this._registerListeners()}var a=o.prototype;return a.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},a._registerListeners=function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)},a._unregisterListeners=function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this)},a.onMediaAttached=function(e,r){this.media=r.media},a.onMediaDetaching=function(){this.id3Track&&(wt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},a.onManifestLoading=function(){this.dateRangeCuesAppended={}},a.createTrack=function(e){var r=this.getID3Track(e.textTracks);return r.mode="hidden",r},a.getID3Track=function(e){if(this.media){for(var r=0;r<e.length;r++){var i=e[r];if(i.kind==="metadata"&&i.label==="id3")return kr(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(e,r){if(this.media){var i=this.hls.config,s=i.enableEmsgMetadataCues,l=i.enableID3MetadataCues;if(!(!s&&!l)){var d=r.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var f=Li();if(f)for(var v=0;v<d.length;v++){var m=d[v].type;if(!(m===Ct.emsg&&!s||!l)){var p=Mt(d[v].data);if(p){var y=d[v].pts,_=y+d[v].duration;_>Zi&&(_=Zi),_-y<=0&&(_=y+Wr);for(var b=0;b<p.length;b++){var T=p[b];if(!At(T)){this.updateId3CueEnds(y,m);var w=Ea(f,y,_,T,m);w&&this.id3Track.addCue(w)}}}}}}}},a.updateId3CueEnds=function(e,r){var i,s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(var l=s.length;l--;){var d=s[l];d.type===r&&d.startTime<e&&d.endTime===Zi&&(d.endTime=e)}},a.onBufferFlushing=function(e,r){var i=r.startOffset,s=r.endOffset,l=r.type,d=this.id3Track,f=this.hls;if(f){var v=f.config,m=v.enableEmsgMetadataCues,p=v.enableID3MetadataCues;if(d&&(m||p)){var y;l==="audio"?y=function(b){return b.type===Ct.audioId3&&p}:l==="video"?y=function(b){return b.type===Ct.emsg&&m}:y=function(b){return b.type===Ct.audioId3&&p||b.type===Ct.emsg&&m},Gt(d,i,s,y)}}},a.onLevelUpdated=function(e,r){var i=this,s=r.details;if(!(!this.media||!s.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var l=this.dateRangeCuesAppended,d=this.id3Track,f=s.dateRanges,v=Object.keys(f);if(d)for(var m=Object.keys(l).filter(function(D){return!v.includes(D)}),p=function(){var N=m[y];Object.keys(l[N].cues).forEach(function(F){d.removeCue(l[N].cues[F])}),delete l[N]},y=m.length;y--;)p();var _=s.fragments[s.fragments.length-1];if(!(v.length===0||!ne(_?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var b=_.programDateTime/1e3-_.start,T=Li(),w=function(){var N=v[I],F=f[N],V=Dn(F.startDate,b),G=l[N],B=G?.cues||{},H=G?.durationKnown||!1,Y=Zi,J=F.endDate;if(J)Y=Dn(J,b),H=!0;else if(F.endOnNext&&!H){var j=v.reduce(function(He,ze){if(ze!==F.id){var at=f[ze];if(at.class===F.class&&at.startDate>F.startDate&&(!He||F.startDate<He.startDate))return at}return He},null);j&&(Y=Dn(j.startDate,b),H=!0)}for(var me=Object.keys(F.attr),Re=0;Re<me.length;Re++){var Te=me[Re];if(K(Te)){var Qe=B[Te];if(Qe)H&&!G.durationKnown&&(Qe.endTime=Y);else if(T){var Ue=F.attr[Te];ee(Te)&&(Ue=ro(Ue));var qe=Ea(T,V,Y,{key:Te,data:Ue},Ct.dateRange);qe&&(qe.id=N,i.id3Track.addCue(qe),B[Te]=qe)}}}l[N]={cues:B,dateRange:F,durationKnown:H}},I=0;I<v.length;I++)w()}}},o}(),no=function(){function o(n){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=n,this.config=n.config,this.registerListeners()}var a=o.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},a.registerListeners=function(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.ERROR,this.onError,this)},a.unregisterListeners=function(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(A.ERROR,this.onError,this)},a.onMediaAttached=function(e,r){this.media=r.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},a.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},a.onLevelUpdated=function(e,r){var i=r.details;this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},a.onError=function(e,r){var i;r.details===U.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&P.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},a.timeupdate=function(){var e=this.media,r=this.levelDetails;if(!(!e||!r)){this.currentTime=e.currentTime;var i=this.computeLatency();if(i!==null){this._latency=i;var s=this.config,l=s.lowLatencyMode,d=s.maxLiveSyncPlaybackRate;if(!(!l||d===1||!r.live)){var f=this.targetLatency;if(f!==null){var v=i-f;if(v<Math.min(this.maxLatency,f+r.targetduration)&&v>.05&&this.forwardBufferLength>1){var m=Math.min(2,Math.max(1,d)),p=Math.round(2/(1+Math.exp(-.75*v-this.edgeStalled))*20)/20;e.playbackRate=Math.min(m,Math.max(1,p))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}}}}},a.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},a.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},x(o,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,r=this.levelDetails;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:r?e.liveMaxLatencyDurationCount*r.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null)return null;var r=e.holdBack,i=e.partHoldBack,s=e.targetduration,l=this.config,d=l.liveSyncDuration,f=l.liveSyncDurationCount,v=l.lowLatencyMode,m=this.hls.userConfig,p=v&&i||r;(m.liveSyncDuration||m.liveSyncDurationCount||p===0)&&(p=d!==void 0?d:f*s);var y=s;return p+Math.min(this.stallCount*1,y)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),r=this.targetLatency,i=this.levelDetails;if(e===null||r===null||i===null)return null;var s=i.edge,l=e-r-this.edgeStalled,d=s-i.totalduration,f=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(d,l),f)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var r=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-r,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,r=this.levelDetails;if(!e||!r)return 0;var i=e.buffered.length;return(i?e.buffered.end(i-1):r.edge)-this.currentTime}}]),o}(),On=["NONE","TYPE-0","TYPE-1",null];function ao(o){return On.indexOf(o)>-1}var en=["SDR","PQ","HLG"];function so(o){return!!o&&en.indexOf(o)>-1}var tn={No:"",Yes:"YES",v2:"v2"};function _a(o){var a=o.canSkipUntil,n=o.canSkipDateRanges,e=o.age<a/2;return a&&e?n?tn.v2:tn.Yes:tn.No}var Sa=function(){function o(n,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=e,this.skip=r}var a=o.prototype;return a.addDirectives=function(e){var r=new self.URL(e);return this.msn!==void 0&&r.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&r.searchParams.set("_HLS_part",this.part.toString()),this.skip&&r.searchParams.set("_HLS_skip",this.skip),r.href},o}(),Ri=function(){function o(n){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.frameRate=n.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=n.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(e){return!!e}).map(function(e){return e.substring(0,4)}).join(","),this.addGroupId("audio",n.attrs.AUDIO),this.addGroupId("text",n.attrs.SUBTITLES)}var a=o.prototype;return a.hasAudioGroup=function(e){return Ta(this._audioGroups,e)},a.hasSubtitleGroup=function(e){return Ta(this._subtitleGroups,e)},a.addGroupId=function(e,r){if(r){if(e==="audio"){var i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(r)===-1&&i.push(r)}else if(e==="text"){var s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(r)===-1&&s.push(r)}}},a.addFallback=function(){},x(o,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(e){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var e;return(e=this.audioGroups)==null?void 0:e[0]}},{key:"textGroupId",get:function(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}}]),o}();function Ta(o,a){return!a||!o?!1:o.indexOf(a)!==-1}function Pn(o,a){var n=a.startPTS;if(ne(n)){var e=0,r;a.sn>o.sn?(e=n-o.start,r=o):(e=o.start-n,r=a),r.duration!==e&&(r.duration=e)}else a.sn>o.sn?o.cc===a.cc&&o.minEndPTS?a.start=o.start+(o.minEndPTS-o.start):a.start=o.start+o.duration:a.start=Math.max(o.start-a.duration,0)}function ba(o,a,n,e,r,i){e-n<=0&&(P.warn("Fragment should have a positive duration",a),e=n+a.duration,i=r+a.duration);var s=n,l=e,d=a.startPTS,f=a.endPTS;if(ne(d)){var v=Math.abs(d-n);ne(a.deltaPTS)?a.deltaPTS=Math.max(v,a.deltaPTS):a.deltaPTS=v,s=Math.max(n,d),n=Math.min(n,d),r=Math.min(r,a.startDTS),l=Math.min(e,f),e=Math.max(e,f),i=Math.max(i,a.endDTS)}var m=n-a.start;a.start!==0&&(a.start=n),a.duration=e-a.start,a.startPTS=n,a.maxStartPTS=s,a.startDTS=r,a.endPTS=e,a.minEndPTS=l,a.endDTS=i;var p=a.sn;if(!o||p<o.startSN||p>o.endSN)return 0;var y,_=p-o.startSN,b=o.fragments;for(b[_]=a,y=_;y>0;y--)Pn(b[y],b[y-1]);for(y=_;y<b.length-1;y++)Pn(b[y],b[y+1]);return o.fragmentHint&&Pn(b[b.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,m}function oo(o,a){for(var n=null,e=o.fragments,r=e.length-1;r>=0;r--){var i=e[r].initSegment;if(i){n=i;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;var s=0,l;if(co(o,a,function(y,_){y.relurl&&(s=y.cc-_.cc),ne(y.startPTS)&&ne(y.endPTS)&&(_.start=_.startPTS=y.startPTS,_.startDTS=y.startDTS,_.maxStartPTS=y.maxStartPTS,_.endPTS=y.endPTS,_.endDTS=y.endDTS,_.minEndPTS=y.minEndPTS,_.duration=y.endPTS-y.startPTS,_.duration&&(l=_),a.PTSKnown=a.alignedSliding=!0),_.elementaryStreams=y.elementaryStreams,_.loader=y.loader,_.stats=y.stats,y.initSegment&&(_.initSegment=y.initSegment,n=y.initSegment)}),n&&(a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments).forEach(function(y){var _;y&&(!y.initSegment||y.initSegment.relurl===((_=n)==null?void 0:_.relurl))&&(y.initSegment=n)}),a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(y){return!y}),a.deltaUpdateFailed){P.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var d=a.skippedSegments;d--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=lo(o.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var f=a.fragments;if(s){P.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<f.length;v++)f[v].cc+=s}a.skippedSegments&&(a.startCC=a.fragments[0].cc),uo(o.partList,a.partList,function(y,_){_.elementaryStreams=y.elementaryStreams,_.stats=y.stats}),l?ba(a,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):Aa(o,a),f.length&&(a.totalduration=a.edge-f[0].start),a.driftStartTime=o.driftStartTime,a.driftStart=o.driftStart;var m=a.advancedDateTime;if(a.advanced&&m){var p=a.edge;a.driftStart||(a.driftStartTime=m,a.driftStart=p),a.driftEndTime=m,a.driftEnd=p}else a.driftEndTime=o.driftEndTime,a.driftEnd=o.driftEnd,a.advancedDateTime=o.advancedDateTime}function lo(o,a,n){var e=X({},o);return n&&n.forEach(function(r){delete e[r]}),Object.keys(a).forEach(function(r){var i=new be(a[r].attr,e[r]);i.isValid?e[r]=i:P.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[r].attr)+'"')}),e}function uo(o,a,n){if(o&&a)for(var e=0,r=0,i=o.length;r<=i;r++){var s=o[r],l=a[r+e];s&&l&&s.index===l.index&&s.fragment.sn===l.fragment.sn?n(s,l):e--}}function co(o,a,n){for(var e=a.skippedSegments,r=Math.max(o.startSN,a.startSN)-a.startSN,i=(o.fragmentHint?1:0)+(e?a.endSN:Math.min(o.endSN,a.endSN))-a.startSN,s=a.startSN-o.startSN,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,d=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,f=r;f<=i;f++){var v=d[s+f],m=l[f];e&&!m&&f<e&&(m=a.fragments[f]=v),v&&m&&n(v,m)}}function Aa(o,a){var n=a.startSN+a.skippedSegments-o.startSN,e=o.fragments;n<0||n>=e.length||Mn(a,e[n].start)}function Mn(o,a){if(a){for(var n=o.fragments,e=o.skippedSegments;e<n.length;e++)n[e].start+=a;o.fragmentHint&&(o.fragmentHint.start+=a)}}function fo(o,a){a===void 0&&(a=1/0);var n=1e3*o.targetduration;if(o.updated){var e=o.fragments;if(e.length&&n*4>a){var r=e[e.length-1].duration*1e3;r<n&&(n=r)}}else n/=2;return Math.round(n)}function ho(o,a,n){if(!(o!=null&&o.details))return null;var e=o.details,r=e.fragments[a-e.startSN];return r||(r=e.fragmentHint,r&&r.sn===a)?r:a<e.startSN&&n&&n.sn===a?n:null}function La(o,a,n){var e;return o!=null&&o.details?Ra((e=o.details)==null?void 0:e.partList,a,n):null}function Ra(o,a,n){if(o)for(var e=o.length;e--;){var r=o[e];if(r.index===n&&r.fragment.sn===a)return r}return null}function wa(o){o.forEach(function(a,n){var e=a.details;e!=null&&e.fragments&&e.fragments.forEach(function(r){r.level=n})})}function rn(o){switch(o.details){case U.FRAG_LOAD_TIMEOUT:case U.KEY_LOAD_TIMEOUT:case U.LEVEL_LOAD_TIMEOUT:case U.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ia(o,a){var n=rn(a);return o.default[(n?"timeout":"error")+"Retry"]}function xn(o,a){var n=o.backoff==="linear"?1:Math.pow(2,a);return Math.min(n*o.retryDelayMs,o.maxRetryDelayMs)}function ka(o){return R(R({},o),{errorRetry:null,timeoutRetry:null})}function nn(o,a,n,e){if(!o)return!1;var r=e?.code,i=a<o.maxNumRetry&&(vo(r)||!!n);return o.shouldRetry?o.shouldRetry(o,a,n,e,i):i}function vo(o){return o===0&&navigator.onLine===!1||!!o&&(o<400||o>499)}var Ca={search:function(a,n){for(var e=0,r=a.length-1,i=null,s=null;e<=r;){i=(e+r)/2|0,s=a[i];var l=n(s);if(l>0)e=i+1;else if(l<0)r=i-1;else return s}return null}};function mo(o,a,n){if(a===null||!Array.isArray(o)||!o.length||!ne(a)||a<(o[0].programDateTime||0)||a>=(o[o.length-1].endProgramDateTime||0))return null;n=n||0;for(var e=0;e<o.length;++e){var r=o[e];if(po(a,n,r))return r}return null}function an(o,a,n,e,r){n===void 0&&(n=0),e===void 0&&(e=0),r===void 0&&(r=.005);var i=null;if(o){i=a[o.sn-a[0].sn+1]||null;var s=o.endDTS-n;s>0&&s<15e-7&&(n+=15e-7)}else n===0&&a[0].start===0&&(i=a[0]);if(i&&((!o||o.level===i.level)&&Fn(n,e,i)===0||go(i,o,Math.min(r,e))))return i;var l=Ca.search(a,Fn.bind(null,n,e));return l&&(l!==o||!i)?l:i}function go(o,a,n){if(a&&a.start===0&&a.level<o.level&&(a.endPTS||0)>0){var e=a.tagList.reduce(function(r,i){return i[0]==="INF"&&(r+=parseFloat(i[1])),r},n);return o.start<=e}return!1}function Fn(o,a,n){if(o===void 0&&(o=0),a===void 0&&(a=0),n.start<=o&&n.start+n.duration>o)return 0;var e=Math.min(a,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-e<=o?1:n.start-e>o&&n.start?-1:0}function po(o,a,n){var e=Math.min(a,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3;return(n.endProgramDateTime||0)-e>o}function yo(o,a){return Ca.search(o,function(n){return n.cc<a?1:n.cc>a?-1:0})}var Zt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Cr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},Eo=function(){function o(n){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=n,this.log=P.log.bind(P,"[info]:"),this.warn=P.warn.bind(P,"[warning]:"),this.error=P.error.bind(P,"[error]:"),this.registerListeners()}var a=o.prototype;return a.registerListeners=function(){var e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))},a.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},a.startLoad=function(e){},a.stopLoad=function(){this.playlistError=0},a.getVariantLevelIndex=function(e){return e?.type===fe.MAIN?e.level:this.hls.loadLevel},a.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},a.onLevelUpdated=function(){this.playlistError=0},a.onError=function(e,r){var i,s;if(!r.fatal){var l=this.hls,d=r.context;switch(r.details){case U.FRAG_LOAD_ERROR:case U.FRAG_LOAD_TIMEOUT:case U.KEY_LOAD_ERROR:case U.KEY_LOAD_TIMEOUT:r.errorAction=this.getFragRetryOrSwitchAction(r);return;case U.FRAG_PARSING_ERROR:if((i=r.frag)!=null&&i.gap){r.errorAction={action:Zt.DoNothing,flags:Cr.None};return}case U.FRAG_GAP:case U.FRAG_DECRYPT_ERROR:r.errorAction=this.getFragRetryOrSwitchAction(r),r.errorAction.action=Zt.SendAlternateToPenaltyBox;return;case U.LEVEL_EMPTY_ERROR:case U.LEVEL_PARSING_ERROR:var f,v,m=r.parent===fe.MAIN?r.level:l.loadLevel;r.details===U.LEVEL_EMPTY_ERROR&&((f=r.context)!=null&&(v=f.levelDetails)!=null&&v.live)?r.errorAction=this.getPlaylistRetryOrSwitchAction(r,m):(r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,m));return;case U.LEVEL_LOAD_ERROR:case U.LEVEL_LOAD_TIMEOUT:typeof d?.level=="number"&&(r.errorAction=this.getPlaylistRetryOrSwitchAction(r,d.level));return;case U.AUDIO_TRACK_LOAD_ERROR:case U.AUDIO_TRACK_LOAD_TIMEOUT:case U.SUBTITLE_LOAD_ERROR:case U.SUBTITLE_TRACK_LOAD_TIMEOUT:if(d){var p=l.levels[l.loadLevel];if(p&&(d.type===_e.AUDIO_TRACK&&p.hasAudioGroup(d.groupId)||d.type===_e.SUBTITLE_TRACK&&p.hasSubtitleGroup(d.groupId))){r.errorAction=this.getPlaylistRetryOrSwitchAction(r,l.loadLevel),r.errorAction.action=Zt.SendAlternateToPenaltyBox,r.errorAction.flags=Cr.MoveAllAlternatesMatchingHost;return}}return;case U.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var y=l.levels[l.loadLevel],_=y?.attrs["HDCP-LEVEL"];_?r.errorAction={action:Zt.SendAlternateToPenaltyBox,flags:Cr.MoveAllAlternatesMatchingHDCP,hdcpLevel:_}:this.keySystemError(r);return;case U.BUFFER_ADD_CODEC_ERROR:case U.REMUX_ALLOC_ERROR:case U.BUFFER_APPEND_ERROR:r.errorAction=this.getLevelSwitchAction(r,(s=r.level)!=null?s:l.loadLevel);return;case U.INTERNAL_EXCEPTION:case U.BUFFER_APPENDING_ERROR:case U.BUFFER_FULL_ERROR:case U.LEVEL_SWITCH_ERROR:case U.BUFFER_STALLED_ERROR:case U.BUFFER_SEEK_OVER_HOLE:case U.BUFFER_NUDGE_ON_STALL:r.errorAction={action:Zt.DoNothing,flags:Cr.None};return}r.type===re.KEY_SYSTEM_ERROR&&this.keySystemError(r)}},a.keySystemError=function(e){var r=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,r)},a.getPlaylistRetryOrSwitchAction=function(e,r){var i=this.hls,s=Ia(i.config.playlistLoadPolicy,e),l=this.playlistError++;if(nn(s,l,rn(e),e.response))return{action:Zt.RetryRequest,flags:Cr.None,retryConfig:s,retryCount:l};var d=this.getLevelSwitchAction(e,r);return s&&(d.retryConfig=s,d.retryCount=l),d},a.getFragRetryOrSwitchAction=function(e){var r=this.hls,i=this.getVariantLevelIndex(e.frag),s=r.levels[i],l=r.config,d=l.fragLoadPolicy,f=l.keyLoadPolicy,v=Ia(e.details.startsWith("key")?f:d,e),m=r.levels.reduce(function(y,_){return y+_.fragmentError},0);if(s&&(e.details!==U.FRAG_GAP&&s.fragmentError++,nn(v,m,rn(e),e.response)))return{action:Zt.RetryRequest,flags:Cr.None,retryConfig:v,retryCount:m};var p=this.getLevelSwitchAction(e,i);return v&&(p.retryConfig=v,p.retryCount=m),p},a.getLevelSwitchAction=function(e,r){var i=this.hls;r==null&&(r=i.loadLevel);var s=this.hls.levels[r];if(s){var l,d,f=e.details;s.loadError++,f===U.BUFFER_APPEND_ERROR&&s.fragmentError++;var v=-1,m=i.levels,p=i.loadLevel,y=i.minAutoLevel,_=i.maxAutoLevel;i.autoLevelEnabled||(i.loadLevel=-1);for(var b=(l=e.frag)==null?void 0:l.type,T=(b===fe.AUDIO&&f===U.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===U.BUFFER_ADD_CODEC_ERROR||f===U.BUFFER_APPEND_ERROR))&&m.some(function(B){var H=B.audioCodec;return s.audioCodec!==H}),w=e.sourceBufferName==="video"&&(f===U.BUFFER_ADD_CODEC_ERROR||f===U.BUFFER_APPEND_ERROR)&&m.some(function(B){var H=B.codecSet,Y=B.audioCodec;return s.codecSet!==H&&s.audioCodec===Y}),I=(d=e.context)!=null?d:{},D=I.type,N=I.groupId,F=function(){var H=(G+p)%m.length;if(H!==p&&H>=y&&H<=_&&m[H].loadError===0){var Y,J,j=m[H];if(f===U.FRAG_GAP&&b===fe.MAIN&&e.frag){var me=m[H].details;if(me){var Re=an(e.frag,me.fragments,e.frag.start);if(Re!=null&&Re.gap)return 0}}else{if(D===_e.AUDIO_TRACK&&j.hasAudioGroup(N)||D===_e.SUBTITLE_TRACK&&j.hasSubtitleGroup(N))return 0;if(b===fe.AUDIO&&(Y=s.audioGroups)!=null&&Y.some(function(Te){return j.hasAudioGroup(Te)})||b===fe.SUBTITLE&&(J=s.subtitleGroups)!=null&&J.some(function(Te){return j.hasSubtitleGroup(Te)})||T&&s.audioCodec===j.audioCodec||!T&&s.audioCodec!==j.audioCodec||w&&s.codecSet===j.codecSet)return 0}return v=H,1}},V,G=m.length;G--&&(V=F(),!(V!==0&&V===1)););if(v>-1&&i.loadLevel!==v)return e.levelRetry=!0,this.playlistError=0,{action:Zt.SendAlternateToPenaltyBox,flags:Cr.None,nextAutoLevel:v}}return{action:Zt.SendAlternateToPenaltyBox,flags:Cr.MoveAllAlternatesMatchingHost}},a.onErrorOut=function(e,r){var i;switch((i=r.errorAction)==null?void 0:i.action){case Zt.DoNothing:break;case Zt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(r),!r.errorAction.resolved&&r.details!==U.FRAG_GAP?r.fatal=!0:/MediaSource readyState: ended/.test(r.error.message)&&(this.warn('MediaSource ended after "'+r.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(r.fatal){this.hls.stopLoad();return}},a.sendAlternateToPenaltyBox=function(e){var r=this.hls,i=e.errorAction;if(i){var s=i.flags,l=i.hdcpLevel,d=i.nextAutoLevel;switch(s){case Cr.None:this.switchLevel(e,d);break;case Cr.MoveAllAlternatesMatchingHDCP:l&&(r.maxHdcpLevel=On[On.indexOf(l)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+r.maxHdcpLevel+'" or lower');break}i.resolved||this.switchLevel(e,d)}},a.switchLevel=function(e,r){r!==void 0&&e.errorAction&&(this.warn("switching to level "+r+" after "+e.details),this.hls.nextAutoLevel=r,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},o}(),Nn=function(){function o(n,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=P.log.bind(P,e+":"),this.warn=P.warn.bind(P,e+":"),this.hls=n}var a=o.prototype;return a.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},a.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},a.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},a.stopLoad=function(){this.canLoad=!1,this.clearTimer()},a.switchParams=function(e,r,i){var s=r?.renditionReports;if(s){for(var l=-1,d=0;d<s.length;d++){var f=s[d],v=void 0;try{v=new self.URL(f.URI,r.url).href}catch(T){P.warn("Could not construct new URL for Rendition Report: "+T),v=f.URI||""}if(v===e){l=d;break}else v===e.substring(0,v.length)&&(l=d)}if(l!==-1){var m=s[l],p=parseInt(m["LAST-MSN"])||r?.lastPartSn,y=parseInt(m["LAST-PART"])||r?.lastPartIndex;if(this.hls.config.lowLatencyMode){var _=Math.min(r.age-r.partTarget,r.targetduration);y>=0&&_>r.partTarget&&(y+=1)}var b=i&&_a(i);return new Sa(p,y>=0?y:void 0,b)}}},a.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},a.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},a.shouldReloadPlaylist=function(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)},a.playlistLoaded=function(e,r,i){var s=this,l=r.details,d=r.stats,f=self.performance.now(),v=d.loading.first?Math.max(0,f-d.loading.first):0;if(l.advancedDateTime=Date.now()-v,l.live||i!=null&&i.live){if(l.reloaded(i),i&&this.log("live playlist "+e+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:l.updated?"UPDATED":"MISSED")),i&&l.fragments.length>0&&oo(i,l),!this.canLoad||!l.live)return;var m,p=void 0,y=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var _=this.hls.config.lowLatencyMode,b=l.lastPartSn,T=l.endSN,w=l.lastPartIndex,I=w!==-1,D=b===T,N=_?0:w;I?(p=D?T+1:b,y=D?N:w+1):p=T+1;var F=l.age,V=F+l.ageHeader,G=Math.min(V-l.partTarget,l.targetduration*1.5);if(G>0){if(i&&G>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+G+" with playlist age: "+l.age),G=0;else{var B=Math.floor(G/l.targetduration);if(p+=B,y!==void 0){var H=Math.round(G%l.targetduration/l.partTarget);y+=H}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+F.toFixed(2)+"s goal: "+G+" skip sn "+B+" to part "+y)}l.tuneInGoal=G}if(m=this.getDeliveryDirectives(l,r.deliveryDirectives,p,y),_||!D){this.loadPlaylist(m);return}}else(l.canBlockReload||l.canSkipUntil)&&(m=this.getDeliveryDirectives(l,r.deliveryDirectives,p,y));var Y=this.hls.mainForwardBufferInfo,J=Y?Y.end-Y.len:0,j=fo(l,(l.edge-J)*1e3);l.updated&&f>this.requestScheduled+j&&(this.requestScheduled=d.loading.start),p!==void 0&&l.canBlockReload?this.requestScheduled=d.loading.first+j-(l.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+j<f?this.requestScheduled=f:this.requestScheduled-f<=0&&(this.requestScheduled+=j);var me=this.requestScheduled-f;me=Math.max(0,me),this.log("reload live playlist "+e+" in "+Math.round(me)+" ms"),this.timer=self.setTimeout(function(){return s.loadPlaylist(m)},me)}else this.clearTimer()},a.getDeliveryDirectives=function(e,r,i,s){var l=_a(e);return r!=null&&r.skip&&e.deltaUpdateFailed&&(i=r.msn,s=r.part,l=tn.No),new Sa(i,s,l)},a.checkRetry=function(e){var r=this,i=e.details,s=rn(e),l=e.errorAction,d=l||{},f=d.action,v=d.retryCount,m=v===void 0?0:v,p=d.retryConfig,y=!!l&&!!p&&(f===Zt.RetryRequest||!l.resolved&&f===Zt.SendAlternateToPenaltyBox);if(y){var _;if(this.requestScheduled=-1,m>=p.maxNumRetry)return!1;if(s&&(_=e.context)!=null&&_.deliveryDirectives)this.warn("Retrying playlist loading "+(m+1)+"/"+p.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var b=xn(p,m);this.timer=self.setTimeout(function(){return r.loadPlaylist()},b),this.warn("Retrying playlist loading "+(m+1)+"/"+p.maxNumRetry+' after "'+i+'" in '+b+"ms")}e.levelRetry=!0,l.resolved=!0}return y},o}(),wi=function(){function o(n,e,r){e===void 0&&(e=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=n,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=e,this.totalWeight_=r}var a=o.prototype;return a.sample=function(e,r){var i=Math.pow(this.alpha_,e);this.estimate_=r*(1-i)+i*this.estimate_,this.totalWeight_+=e},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},o}(),_o=function(){function o(n,e,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new wi(n),this.fast_=new wi(e),this.defaultTTFB_=i,this.ttfb_=new wi(n)}var a=o.prototype;return a.update=function(e,r){var i=this.slow_,s=this.fast_,l=this.ttfb_;i.halfLife!==e&&(this.slow_=new wi(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==r&&(this.fast_=new wi(r,s.getEstimate(),s.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new wi(e,l.getEstimate(),l.getTotalWeight()))},a.sample=function(e,r){e=Math.max(e,this.minDelayMs_);var i=8*r,s=e/1e3,l=i/s;this.fast_.sample(s,l),this.slow_.sample(s,l)},a.sampleTTFB=function(e){var r=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(r,2)/2);this.ttfb_.sample(i,Math.max(e,5))},a.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},a.destroy=function(){},o}(),Da={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Oa={};function So(o,a,n,e,r,i){var s=o.audioCodec?o.audioGroups:null,l=i?.audioCodec,d=i?.channels,f=d?parseInt(d):l?1/0:2,v=null;if(s!=null&&s.length)try{s.length===1&&s[0]?v=a.groups[s[0]].channels:v=s.reduce(function(m,p){if(p){var y=a.groups[p];if(!y)throw new Error("Audio track group "+p+" not found");Object.keys(y.channels).forEach(function(_){m[_]=(m[_]||0)+y.channels[_]})}return m},{2:0})}catch{return!0}return o.videoCodec!==void 0&&(o.width>1920&&o.height>1088||o.height>1920&&o.width>1088||o.frameRate>Math.max(e,30)||o.videoRange!=="SDR"&&o.videoRange!==n||o.bitrate>Math.max(r,8e6))||!!v&&ne(f)&&Object.keys(v).some(function(m){return parseInt(m)>f})}function To(o,a,n){var e=o.videoCodec,r=o.audioCodec;if(!e||!r||!n)return Promise.resolve(Da);var i={width:o.width,height:o.height,bitrate:Math.ceil(Math.max(o.bitrate*.9,o.averageBitrate)),framerate:o.frameRate||30},s=o.videoRange;s!=="SDR"&&(i.transferFunction=s.toLowerCase());var l=e.split(",").map(function(d){return{type:"media-source",video:R(R({},i),{},{contentType:de(d,"video")})}});return r&&o.audioGroups&&o.audioGroups.forEach(function(d){var f;d&&((f=a.groups[d])==null||f.tracks.forEach(function(v){if(v.groupId===d){var m=v.channels||"",p=parseFloat(m);ne(p)&&p>2&&l.push.apply(l,r.split(",").map(function(y){return{type:"media-source",audio:{contentType:de(y,"audio"),channels:""+p}}}))}}))}),Promise.all(l.map(function(d){var f=bo(d);return Oa[f]||(Oa[f]=n.decodingInfo(d))})).then(function(d){return{supported:!d.some(function(f){return!f.supported}),configurations:l,decodingInfoResults:d}}).catch(function(d){return{supported:!1,configurations:l,decodingInfoResults:[],error:d}})}function bo(o){var a=o.audio,n=o.video,e=n||a;if(e){var r=e.contentType.split('"')[1];if(n)return"r"+n.height+"x"+n.width+"f"+Math.ceil(n.framerate)+(n.transferFunction||"sd")+"_"+r+"_"+Math.ceil(n.bitrate/1e5);if(a)return"c"+a.channels+(a.spatialRendering?"s":"n")+"_"+r}return""}function Ao(){if(typeof matchMedia=="function"){var o=matchMedia("(dynamic-range: high)"),a=matchMedia("bad query");if(o.media!==a.media)return o.matches===!0}return!1}function Lo(o,a){var n=!1,e=[];return o&&(n=o!=="SDR",e=[o]),a&&(e=a.allowedVideoRanges||en.slice(0),n=a.preferHDR!==void 0?a.preferHDR:Ao(),n?e=e.filter(function(r){return r!=="SDR"}):e=["SDR"]),{preferHDR:n,allowedVideoRanges:e}}function Ro(o,a,n,e,r){for(var i=Object.keys(o),s=e?.channels,l=e?.audioCodec,d=s&&parseInt(s)===2,f=!0,v=!1,m=1/0,p=1/0,y=1/0,_=0,b=[],T=Lo(a,r),w=T.preferHDR,I=T.allowedVideoRanges,D=function(){var B=o[i[N]];f=B.channels[2]>0,m=Math.min(m,B.minHeight),p=Math.min(p,B.minFramerate),y=Math.min(y,B.minBitrate);var H=I.filter(function(Y){return B.videoRanges[Y]>0});H.length>0&&(v=!0,b=H)},N=i.length;N--;)D();m=ne(m)?m:0,p=ne(p)?p:0;var F=Math.max(1080,m),V=Math.max(30,p);return y=ne(y)?y:n,n=Math.max(y,n),v||(a=void 0,b=[]),{codecSet:i.reduce(function(G,B){var H=o[B];if(B===G)return G;if(H.minBitrate>n)return Yr(B,"min bitrate of "+H.minBitrate+" > current estimate of "+n),G;if(!H.hasDefaultAudio)return Yr(B,"no renditions with default or auto-select sound found"),G;if(l&&B.indexOf(l.substring(0,4))%5!==0)return Yr(B,'audio codec preference "'+l+'" not found'),G;if(s&&!d){if(!H.channels[s])return Yr(B,"no renditions with "+s+" channel sound found (channels options: "+Object.keys(H.channels)+")"),G}else if((!l||d)&&f&&H.channels[2]===0)return Yr(B,"no renditions with stereo sound found"),G;return H.minHeight>F?(Yr(B,"min resolution of "+H.minHeight+" > maximum of "+F),G):H.minFramerate>V?(Yr(B,"min framerate of "+H.minFramerate+" > maximum of "+V),G):b.some(function(Y){return H.videoRanges[Y]>0})?H.maxScore<_?(Yr(B,"max score of "+H.maxScore+" < selected max of "+_),G):G&&(lr(B)>=lr(G)||H.fragmentError>o[G].fragmentError)?G:(_=H.maxScore,B):(Yr(B,"no variants with VIDEO-RANGE of "+JSON.stringify(b)+" found"),G)},void 0),videoRanges:b,preferHDR:w,minFramerate:p,minBitrate:y}}function Yr(o,a){P.log('[abr] start candidates with "'+o+'" ignored because '+a)}function wo(o){return o.reduce(function(a,n){var e=a.groups[n.groupId];e||(e=a.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),e.tracks.push(n);var r=n.channels||"2";return e.channels[r]=(e.channels[r]||0)+1,e.hasDefault=e.hasDefault||n.default,e.hasAutoSelect=e.hasAutoSelect||n.autoselect,e.hasDefault&&(a.hasDefaultAudio=!0),e.hasAutoSelect&&(a.hasAutoSelectAudio=!0),a},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Io(o,a,n,e){return o.slice(n,e+1).reduce(function(r,i){if(!i.codecSet)return r;var s=i.audioGroups,l=r[i.codecSet];l||(r[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!s,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);var d=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,d),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,s&&s.forEach(function(f){if(f){var v=a.groups[f];v&&(l.hasDefaultAudio=l.hasDefaultAudio||a.hasDefaultAudio?v.hasDefault:v.hasAutoSelect||!a.hasDefaultAudio&&!a.hasAutoSelectAudio,Object.keys(v.channels).forEach(function(m){l.channels[m]=(l.channels[m]||0)+v.channels[m]}))}}),r},{})}function Ur(o,a,n){if("attrs"in o){var e=a.indexOf(o);if(e!==-1)return e}for(var r=0;r<a.length;r++){var i=a[r];if(Ii(o,i,n))return r}return-1}function Ii(o,a,n){var e=o.groupId,r=o.name,i=o.lang,s=o.assocLang,l=o.characteristics,d=o.default,f=o.forced;return(e===void 0||a.groupId===e)&&(r===void 0||a.name===r)&&(i===void 0||a.lang===i)&&(i===void 0||a.assocLang===s)&&(d===void 0||a.default===d)&&(f===void 0||a.forced===f)&&(l===void 0||ko(l,a.characteristics))&&(n===void 0||n(o,a))}function ko(o,a){a===void 0&&(a="");var n=o.split(","),e=a.split(",");return n.length===e.length&&!n.some(function(r){return e.indexOf(r)===-1})}function ki(o,a){var n=o.audioCodec,e=o.channels;return(n===void 0||(a.audioCodec||"").substring(0,4)===n.substring(0,4))&&(e===void 0||e===(a.channels||"2"))}function Co(o,a,n,e,r){var i=a[e],s=a.reduce(function(m,p,y){var _=p.uri;return(m[_]||(m[_]=[])).push(y),m},{})[i.uri];s.length>1&&(e=Math.max.apply(Math,s));var l=i.videoRange,d=i.frameRate,f=i.codecSet.substring(0,4),v=Pa(a,e,function(m){if(m.videoRange!==l||m.frameRate!==d||m.codecSet.substring(0,4)!==f)return!1;var p=m.audioGroups;return Ur(o,n.filter(function(y){return!p||p.indexOf(y.groupId)!==-1}),r)>-1});return v>-1?v:Pa(a,e,function(m){var p=m.audioGroups;return Ur(o,n.filter(function(y){return!p||p.indexOf(y.groupId)!==-1}),r)>-1})}function Pa(o,a,n){for(var e=a;e;e--)if(n(o[e]))return e;for(var r=a+1;r<o.length;r++)if(n(o[r]))return r;return-1}var Do=function(){function o(n){var e=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var r=e.fragCurrent,i=e.partCurrent,s=e.hls,l=s.autoLevelEnabled,d=s.media;if(!(!r||!d)){var f=performance.now(),v=i?i.stats:r.stats,m=i?i.duration:r.duration,p=f-v.loading.start,y=s.minAutoLevel;if(v.aborted||v.loaded&&v.loaded===v.total||r.level<=y){e.clearTimer(),e._nextAutoLevel=-1;return}if(!(!l||d.paused||!d.playbackRate||!d.readyState)){var _=s.mainForwardBufferInfo;if(_!==null){var b=e.bwEstimator.getEstimateTTFB(),T=Math.abs(d.playbackRate);if(!(p<=Math.max(b,1e3*(m/(T*2))))){var w=_.len/T,I=v.loading.first?v.loading.first-v.loading.start:-1,D=v.loaded&&I>-1,N=e.getBwEstimate(),F=s.levels,V=F[r.level],G=v.total||Math.max(v.loaded,Math.round(m*V.averageBitrate/8)),B=D?p-I:p;B<1&&D&&(B=Math.min(p,v.loaded*8/N));var H=D?v.loaded*1e3/B:0,Y=H?(G-v.loaded)/H:G*8/N+b/1e3;if(!(Y<=w)){var J=H?H*8:N,j=Number.POSITIVE_INFINITY,me;for(me=r.level-1;me>y;me--){var Re=F[me].maxBitrate;if(j=e.getTimeToLoadFrag(b/1e3,J,m*Re,!F[me].details),j<w)break}if(!(j>=Y)&&!(j>m*10)){s.nextLoadLevel=s.nextAutoLevel=me,D?e.bwEstimator.sample(p-Math.min(b,I),v.loaded):e.bwEstimator.sampleTTFB(p);var Te=F[me].maxBitrate;e.getBwEstimate()*e.hls.config.abrBandWidthUpFactor>Te&&e.resetEstimator(Te),e.clearTimer(),P.warn("[abr] Fragment "+r.sn+(i?" part "+i.index:"")+" of level "+r.level+` is loading too slowly;
      Time to underbuffer: `+w.toFixed(3)+` s
      Estimated load time for current fragment: `+Y.toFixed(3)+` s
      Estimated load time for down switch fragment: `+j.toFixed(3)+` s
      TTFB estimate: `+(I|0)+` ms
      Current BW estimate: `+(ne(N)?N|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+me+" @ "+(Te|0)+" bps"),s.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:i,stats:v})}}}}}}},this.hls=n,this.bwEstimator=this.initEstimator(),this.registerListeners()}var a=o.prototype;return a.resetEstimator=function(e){e&&(P.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},a.initEstimator=function(){var e=this.hls.config;return new _o(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},a.registerListeners=function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))},a.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},a.onManifestLoading=function(e,r){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},a.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},a.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},a.onFragLoading=function(e,r){var i=r.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=r.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},a.onLevelSwitching=function(e,r){this.clearTimer()},a.onError=function(e,r){if(!r.fatal)switch(r.details){case U.BUFFER_ADD_CODEC_ERROR:case U.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case U.FRAG_LOAD_TIMEOUT:var i=r.frag,s=this.fragCurrent,l=this.partCurrent;if(i&&s&&i.sn===s.sn&&i.level===s.level){var d=performance.now(),f=l?l.stats:i.stats,v=d-f.loading.start,m=f.loading.first?f.loading.first-f.loading.start:-1;if(f.loaded&&m>-1){var p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(v-Math.min(p,m),f.loaded)}else this.bwEstimator.sampleTTFB(v)}break}},a.getTimeToLoadFrag=function(e,r,i,s){return e+i/r+(s?this.lastLevelLoadSec:0)},a.onLevelLoaded=function(e,r){var i=this.hls.config,s=r.stats.loading,l=s.end-s.start;ne(l)&&(this.lastLevelLoadSec=l/1e3),r.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},a.onFragLoaded=function(e,r){var i=r.frag,s=r.part,l=s?s.stats:i.stats;if(i.type===fe.MAIN&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var d=s?s.duration:i.duration,f=this.hls.levels[i.level],v=(f.loaded?f.loaded.bytes:0)+l.loaded,m=(f.loaded?f.loaded.duration:0)+d;f.loaded={bytes:v,duration:m},f.realBitrate=Math.round(8*v/m)}if(i.bitrateTest){var p={stats:l,frag:i,part:s,id:i.type};this.onFragBuffered(A.FRAG_BUFFERED,p),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},a.onFragBuffered=function(e,r){var i=r.frag,s=r.part,l=s!=null&&s.stats.loaded?s.stats:i.stats;if(!l.aborted&&!this.ignoreFragment(i)){var d=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(d,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},a.ignoreFragment=function(e){return e.type!==fe.MAIN||e.sn==="initSegment"},a.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},a.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},a.getNextABRAutoLevel=function(){var e=this.fragCurrent,r=this.partCurrent,i=this.hls,s=i.maxAutoLevel,l=i.config,d=i.minAutoLevel,f=r?r.duration:e?e.duration:0,v=this.getBwEstimate(),m=this.getStarvationDelay(),p=l.abrBandWidthFactor,y=l.abrBandWidthUpFactor;if(m){var _=this.findBestLevel(v,d,s,m,0,p,y);if(_>=0)return _}var b=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!m){var T=this.bitrateTestDelay;T&&(b=(f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay)-T,P.info("[abr] bitrate test took "+Math.round(1e3*T)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),p=y=1)}var w=this.findBestLevel(v,d,s,m,b,p,y);if(P.info("[abr] "+(m?"rebuffering expected":"buffer is empty")+", optimal quality level "+w),w>-1)return w;var I=i.levels[d],D=i.levels[i.loadLevel];return I?.bitrate<D?.bitrate?d:i.loadLevel},a.getStarvationDelay=function(){var e=this.hls,r=e.media;if(!r)return 1/0;var i=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i},a.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},a.findBestLevel=function(e,r,i,s,l,d,f){var v,m=this,p=s+l,y=this.lastLoadedFragLevel,_=y===-1?this.hls.firstLevel:y,b=this.fragCurrent,T=this.partCurrent,w=this.hls,I=w.levels,D=w.allAudioTracks,N=w.loadLevel,F=w.config;if(I.length===1)return 0;var V=I[_],G=!!(V!=null&&(v=V.details)!=null&&v.live),B=N===-1||y===-1,H,Y="SDR",J=V?.frameRate||0,j=F.audioPreference,me=F.videoPreference,Re=this.audioTracksByGroup||(this.audioTracksByGroup=wo(D));if(B){if(this.firstSelection!==-1)return this.firstSelection;var Te=Ro(this.codecTiers||(this.codecTiers=Io(I,Re,r,i)),Y,e,j,me),Qe=Te.codecSet,Ue=Te.videoRanges,qe=Te.minFramerate,He=Te.minBitrate,ze=Te.preferHDR;H=Qe,Y=ze?Ue[Ue.length-1]:Ue[0],J=qe,e=Math.max(e,He),P.log("[abr] picked start tier "+JSON.stringify(Te))}else H=V?.codecSet,Y=V?.videoRange;for(var at=T?T.duration:b?b.duration:0,qt=this.bwEstimator.getEstimateTTFB()/1e3,Bt=[],tr=function(){var Sr,ut=I[gt],cr=gt>_;if(!ut)return 0;if(F.useMediaCapabilities&&!ut.supportedResult&&!ut.supportedPromise){var Er=navigator.mediaCapabilities;typeof Er?.decodingInfo=="function"&&So(ut,Re,Y,J,e,j)?(ut.supportedPromise=To(ut,Re,Er),ut.supportedPromise.then(function(oi){if(m.hls){ut.supportedResult=oi;var Ki=m.hls.levels,gi=Ki.indexOf(ut);oi.error?P.warn('[abr] MediaCapabilities decodingInfo error: "'+oi.error+'" for level '+gi+" "+JSON.stringify(oi)):oi.supported||(P.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level "+gi+" "+JSON.stringify(oi)),gi>-1&&Ki.length>1&&(P.log("[abr] Removing unsupported level "+gi),m.hls.removeLevel(gi)))}})):ut.supportedResult=Da}if(H&&ut.codecSet!==H||Y&&ut.videoRange!==Y||cr&&J>ut.frameRate||!cr&&J>0&&J<ut.frameRate||ut.supportedResult&&!((Sr=ut.supportedResult.decodingInfoResults)!=null&&Sr[0].smooth))return Bt.push(gt),0;var dr=ut.details,Yt=(T?dr?.partTarget:dr?.averagetargetduration)||at,St;cr?St=f*e:St=d*e;var Jr=at&&s>=at*2&&l===0?I[gt].averageBitrate:I[gt].maxBitrate,Or=m.getTimeToLoadFrag(qt,St,Jr*Yt,dr===void 0);if(St>=Jr&&(gt===y||ut.loadError===0&&ut.fragmentError===0)&&(Or<=qt||!ne(Or)||G&&!m.bitrateTestDelay||Or<p)){var Zr=m.forcedAutoLevel;return gt!==N&&(Zr===-1||Zr!==N)&&(Bt.length&&P.trace("[abr] Skipped level(s) "+Bt.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+I[Bt[0]].codecs+'" '+I[Bt[0]].videoRange+'; not compatible with "'+V.codecs+'" '+Y),P.info("[abr] switch candidate:"+_+"->"+gt+" adjustedbw("+Math.round(St)+")-bitrate="+Math.round(St-Jr)+" ttfb:"+qt.toFixed(1)+" avgDuration:"+Yt.toFixed(1)+" maxFetchDuration:"+p.toFixed(1)+" fetchDuration:"+Or.toFixed(1)+" firstSelection:"+B+" codecSet:"+H+" videoRange:"+Y+" hls.loadLevel:"+N)),B&&(m.firstSelection=gt),{v:gt}}},Ht,gt=i;gt>=r;gt--)if(Ht=tr(),Ht!==0&&Ht)return Ht.v;return-1},x(o,[{key:"firstAutoLevel",get:function(){var e=this.hls,r=e.maxAutoLevel,i=e.minAutoLevel,s=this.getBwEstimate(),l=this.hls.config.maxStarvationDelay,d=this.findBestLevel(s,i,r,0,l,1,1);if(d>-1)return d;var f=this.hls.firstLevel,v=Math.min(Math.max(f,i),r);return P.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+f+" clamped to "+v),v}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var l=this.hls.levels;if(l.length>Math.max(e,s)&&l[e].loadError<=l[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s},set:function(e){var r=this.hls,i=r.maxAutoLevel,s=r.minAutoLevel,l=Math.min(Math.max(e,s),i);this._nextAutoLevel!==l&&(this.nextAutoLevelKey="",this._nextAutoLevel=l)}}]),o}(),Oo=function(){function o(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var a=o.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},a.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},a.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},a.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},o}(),jt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Po=function(){function o(n){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=n,this._registerListeners()}var a=o.prototype;return a._registerListeners=function(){var e=this.hls;e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this)},a._unregisterListeners=function(){var e=this.hls;e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this)},a.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},a.getAppendedFrag=function(e,r){var i=this.activePartLists[r];if(i)for(var s=i.length;s--;){var l=i[s];if(!l)break;var d=l.end;if(l.start<=e&&d!==null&&e<=d)return l}return this.getBufferedFrag(e,r)},a.getBufferedFrag=function(e,r){for(var i=this.fragments,s=Object.keys(i),l=s.length;l--;){var d=i[s[l]];if(d?.body.type===r&&d.buffered){var f=d.body;if(f.start<=e&&e<=f.end)return f}}return null},a.detectEvictedFragments=function(e,r,i,s){var l=this;this.timeRanges&&(this.timeRanges[e]=r);var d=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(f){var v=l.fragments[f];if(v&&!(d>=v.body.sn)){if(!v.buffered&&!v.loaded){v.body.type===i&&l.removeFragment(v.body);return}var m=v.range[e];m&&m.time.some(function(p){var y=!l.isTimeBuffered(p.startPTS,p.endPTS,r);return y&&l.removeFragment(v.body),y})}})},a.detectPartialFragments=function(e){var r=this,i=this.timeRanges,s=e.frag,l=e.part;if(!(!i||s.sn==="initSegment")){var d=Ci(s),f=this.fragments[d];if(!(!f||f.buffered&&s.gap)){var v=!s.relurl;Object.keys(i).forEach(function(m){var p=s.elementaryStreams[m];if(p){var y=i[m],_=v||p.partial===!0;f.range[m]=r.getBufferedTimes(s,l,_,y)}}),f.loaded=null,Object.keys(f.range).length?(f.buffered=!0,(f.body.endList=s.endList||f.body.endList)&&(this.endListFragments[f.body.type]=f),sn(f)||this.removeParts(s.sn-1,s.type)):this.removeFragment(f.body)}}},a.removeParts=function(e,r){var i=this.activePartLists[r];i&&(this.activePartLists[r]=i.filter(function(s){return s.fragment.sn>=e}))},a.fragBuffered=function(e,r){var i=Ci(e),s=this.fragments[i];!s&&r&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)},a.getBufferedTimes=function(e,r,i,s){for(var l={time:[],partial:i},d=e.start,f=e.end,v=e.minEndPTS||f,m=e.maxStartPTS||d,p=0;p<s.length;p++){var y=s.start(p)-this.bufferPadding,_=s.end(p)+this.bufferPadding;if(m>=y&&v<=_){l.time.push({startPTS:Math.max(d,s.start(p)),endPTS:Math.min(f,s.end(p))});break}else if(d<_&&f>y){var b=Math.max(d,s.start(p)),T=Math.min(f,s.end(p));T>b&&(l.partial=!0,l.time.push({startPTS:b,endPTS:T}))}else if(f<=y)break}return l},a.getPartialFragment=function(e){var r=null,i,s,l,d=0,f=this.bufferPadding,v=this.fragments;return Object.keys(v).forEach(function(m){var p=v[m];p&&sn(p)&&(s=p.body.start-f,l=p.body.end+f,e>=s&&e<=l&&(i=Math.min(e-s,l-e),d<=i&&(r=p.body,d=i)))}),r},a.isEndListAppended=function(e){var r=this.endListFragments[e];return r!==void 0&&(r.buffered||sn(r))},a.getState=function(e){var r=Ci(e),i=this.fragments[r];return i?i.buffered?sn(i)?jt.PARTIAL:jt.OK:jt.APPENDING:jt.NOT_LOADED},a.isTimeBuffered=function(e,r,i){for(var s,l,d=0;d<i.length;d++){if(s=i.start(d)-this.bufferPadding,l=i.end(d)+this.bufferPadding,e>=s&&r<=l)return!0;if(r<=s)return!1}return!1},a.onFragLoaded=function(e,r){var i=r.frag,s=r.part;if(!(i.sn==="initSegment"||i.bitrateTest)){var l=s?null:r,d=Ci(i);this.fragments[d]={body:i,appendedPTS:null,loaded:l,buffered:!1,range:Object.create(null)}}},a.onBufferAppended=function(e,r){var i=this,s=r.frag,l=r.part,d=r.timeRanges;if(s.sn!=="initSegment"){var f=s.type;if(l){var v=this.activePartLists[f];v||(this.activePartLists[f]=v=[]),v.push(l)}this.timeRanges=d,Object.keys(d).forEach(function(m){var p=d[m];i.detectEvictedFragments(m,p,f,l)})}},a.onFragBuffered=function(e,r){this.detectPartialFragments(r)},a.hasFragment=function(e){var r=Ci(e);return!!this.fragments[r]},a.hasParts=function(e){var r;return!!((r=this.activePartLists[e])!=null&&r.length)},a.removeFragmentsInRange=function(e,r,i,s,l){var d=this;s&&!this.hasGaps||Object.keys(this.fragments).forEach(function(f){var v=d.fragments[f];if(v){var m=v.body;m.type!==i||s&&!m.gap||m.start<r&&m.end>e&&(v.buffered||l)&&d.removeFragment(m)}})},a.removeFragment=function(e){var r=Ci(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var i=this.activePartLists[e.type];if(i){var s=e.sn;this.activePartLists[e.type]=i.filter(function(l){return l.fragment.sn!==s})}delete this.fragments[r],e.endList&&delete this.endListFragments[e.type]},a.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},o}();function sn(o){var a,n,e;return o.buffered&&(o.body.gap||((a=o.range.video)==null?void 0:a.partial)||((n=o.range.audio)==null?void 0:n.partial)||((e=o.range.audiovideo)==null?void 0:e.partial))}function Ci(o){return o.type+"_"+o.level+"_"+o.sn}var Mo={length:0,start:function(){return 0},end:function(){return 0}},Dt=function(){function o(){}return o.isBuffered=function(n,e){try{if(n){for(var r=o.getBuffered(n),i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}}catch{}return!1},o.bufferInfo=function(n,e,r){try{if(n){var i=o.getBuffered(n),s=[],l;for(l=0;l<i.length;l++)s.push({start:i.start(l),end:i.end(l)});return this.bufferedInfo(s,e,r)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},o.bufferedInfo=function(n,e,r){e=Math.max(0,e),n.sort(function(T,w){var I=T.start-w.start;return I||w.end-T.end});var i=[];if(r)for(var s=0;s<n.length;s++){var l=i.length;if(l){var d=i[l-1].end;n[s].start-d<r?n[s].end>d&&(i[l-1].end=n[s].end):i.push(n[s])}else i.push(n[s])}else i=n;for(var f=0,v,m=e,p=e,y=0;y<i.length;y++){var _=i[y].start,b=i[y].end;if(e+r>=_&&e<b)m=_,p=b,f=p-e;else if(e+r<_){v=_;break}}return{len:f,start:m||0,end:p||0,nextStart:v}},o.getBuffered=function(n){try{return n.buffered}catch(e){return P.log("failed to get media.buffered",e),Mo}},o}(),Bn=function(a,n,e,r,i,s){r===void 0&&(r=0),i===void 0&&(i=-1),s===void 0&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=on(),this.buffering={audio:on(),video:on(),audiovideo:on()},this.level=a,this.sn=n,this.id=e,this.size=r,this.part=i,this.partial=s};function on(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ln(o,a){for(var n=0,e=o.length;n<e;n++){var r;if(((r=o[n])==null?void 0:r.cc)===a)return o[n]}return null}function xo(o,a,n){return!!(a&&(n.endCC>n.startCC||o&&o.cc<n.startCC))}function Fo(o,a){var n=o.fragments,e=a.fragments;if(!e.length||!n.length){P.log("No fragments to align");return}var r=ln(n,e[0].cc);if(!r||r&&!r.startPTS){P.log("No frag in previous level to align on");return}return r}function Ma(o,a){if(o){var n=o.start+a;o.start=o.startPTS=n,o.endPTS=n+o.duration}}function xa(o,a){for(var n=a.fragments,e=0,r=n.length;e<r;e++)Ma(n[e],o);a.fragmentHint&&Ma(a.fragmentHint,o),a.alignedSliding=!0}function No(o,a,n){a&&(Bo(o,n,a),!n.alignedSliding&&a&&un(n,a),!n.alignedSliding&&a&&!n.skippedSegments&&Aa(a,n))}function Bo(o,a,n){if(xo(o,n,a)){var e=Fo(n,a);e&&ne(e.start)&&(P.log("Adjusting PTS using last level due to CC increase within current level "+a.url),xa(e.start,a))}}function un(o,a){if(!(!o.hasProgramDateTime||!a.hasProgramDateTime)){var n=o.fragments,e=a.fragments;if(!(!n.length||!e.length)){var r,i,s=Math.min(a.endCC,o.endCC);a.startCC<s&&o.startCC<s&&(r=ln(e,s),i=ln(n,s)),(!r||!i)&&(r=e[Math.floor(e.length/2)],i=ln(n,r.cc)||n[Math.floor(n.length/2)]);var l=r.programDateTime,d=i.programDateTime;!l||!d||xa((d-l)/1e3-(i.start-r.start),o)}}}var Fa=Math.pow(2,17),Uo=function(){function o(n){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=n}var a=o.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(e,r){var i=this,s=e.url;if(!s)return Promise.reject(new $r({type:re.NETWORK_ERROR,details:U.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(s?"part list":"url")),networkDetails:null}));this.abort();var l=this.config,d=l.fLoader,f=l.loader;return new Promise(function(v,m){if(i.loader&&i.loader.destroy(),e.gap)if(e.tagList.some(function(T){return T[0]==="GAP"})){m(Ba(e));return}else e.gap=!1;var p=i.loader=e.loader=d?new d(l):new f(l),y=Na(e),_=ka(l.fragLoadPolicy.default),b={loadPolicy:_,timeout:_.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Fa};e.stats=p.stats,p.load(y,b,{onSuccess:function(w,I,D,N){i.resetLoader(e,p);var F=w.data;D.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(F.slice(0,16)),F=F.slice(16)),v({frag:e,part:null,payload:F,networkDetails:N})},onError:function(w,I,D,N){i.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:R({url:s,data:void 0},w),error:new Error("HTTP Error "+w.code+" "+w.text),networkDetails:D,stats:N}))},onAbort:function(w,I,D){i.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:D,stats:w}))},onTimeout:function(w,I,D){i.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+b.timeout+"ms"),networkDetails:D,stats:w}))},onProgress:function(w,I,D,N){r&&r({frag:e,part:null,payload:D,networkDetails:N})}})})},a.loadPart=function(e,r,i){var s=this;this.abort();var l=this.config,d=l.fLoader,f=l.loader;return new Promise(function(v,m){if(s.loader&&s.loader.destroy(),e.gap||r.gap){m(Ba(e,r));return}var p=s.loader=e.loader=d?new d(l):new f(l),y=Na(e,r),_=ka(l.fragLoadPolicy.default),b={loadPolicy:_,timeout:_.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Fa};r.stats=p.stats,p.load(y,b,{onSuccess:function(w,I,D,N){s.resetLoader(e,p),s.updateStatsFromPart(e,r);var F={frag:e,part:r,payload:w.data,networkDetails:N};i(F),v(F)},onError:function(w,I,D,N){s.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:r,response:R({url:y.url,data:void 0},w),error:new Error("HTTP Error "+w.code+" "+w.text),networkDetails:D,stats:N}))},onAbort:function(w,I,D){e.stats.aborted=r.stats.aborted,s.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.INTERNAL_ABORTED,fatal:!1,frag:e,part:r,error:new Error("Aborted"),networkDetails:D,stats:w}))},onTimeout:function(w,I,D){s.resetLoader(e,p),m(new $r({type:re.NETWORK_ERROR,details:U.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:r,error:new Error("Timeout after "+b.timeout+"ms"),networkDetails:D,stats:w}))}})})},a.updateStatsFromPart=function(e,r){var i=e.stats,s=r.stats,l=s.total;if(i.loaded+=s.loaded,l){var d=Math.round(e.duration/r.duration),f=Math.min(Math.round(i.loaded/l),d),v=(d-f)*Math.round(i.loaded/f);i.total=i.loaded+v}else i.total=Math.max(i.loaded,i.total);var m=i.loading,p=s.loading;m.start?m.first+=p.first-p.start:(m.start=p.start,m.first=p.first),m.end=p.end},a.resetLoader=function(e,r){e.loader=null,this.loader===r&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),r.destroy()},o}();function Na(o,a){a===void 0&&(a=null);var n=a||o,e={frag:o,part:a,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,i=n.byteRangeEndOffset;if(ne(r)&&ne(i)){var s,l=r,d=i;if(o.sn==="initSegment"&&((s=o.decryptdata)==null?void 0:s.method)==="AES-128"){var f=i-r;f%16&&(d=i+(16-f%16)),r!==0&&(e.resetIV=!0,l=r-16)}e.rangeStart=l,e.rangeEnd=d}return e}function Ba(o,a){var n=new Error("GAP "+(o.gap?"tag":"attribute")+" found"),e={type:re.MEDIA_ERROR,details:U.FRAG_GAP,fatal:!1,frag:o,error:n,networkDetails:null};return a&&(e.part=a),(a||o).stats.aborted=!0,new $r(e)}var $r=function(o){ie(a,o);function a(n){var e=o.call(this,n.error.message)||this;return e.data=void 0,e.data=n,e}return a}(xe(Error)),Vo=function(){function o(n,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=n,this.aesIV=e}var a=o.prototype;return a.decrypt=function(e,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,e)},o}(),Go=function(){function o(n,e){this.subtle=void 0,this.key=void 0,this.subtle=n,this.key=e}var a=o.prototype;return a.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},o}();function qo(o){var a=o.byteLength,n=a&&new DataView(o.buffer).getUint8(a-1);return n?Le(o,0,a-n):o}var Ho=function(){function o(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var a=o.prototype;return a.uint8ArrayToUint32Array_=function(e){for(var r=new DataView(e),i=new Uint32Array(4),s=0;s<4;s++)i[s]=r.getUint32(s*4);return i},a.initTable=function(){var e=this.sBox,r=this.invSBox,i=this.subMix,s=i[0],l=i[1],d=i[2],f=i[3],v=this.invSubMix,m=v[0],p=v[1],y=v[2],_=v[3],b=new Uint32Array(256),T=0,w=0,I=0;for(I=0;I<256;I++)I<128?b[I]=I<<1:b[I]=I<<1^283;for(I=0;I<256;I++){var D=w^w<<1^w<<2^w<<3^w<<4;D=D>>>8^D&255^99,e[T]=D,r[D]=T;var N=b[T],F=b[N],V=b[F],G=b[D]*257^D*16843008;s[T]=G<<24|G>>>8,l[T]=G<<16|G>>>16,d[T]=G<<8|G>>>24,f[T]=G,G=V*16843009^F*65537^N*257^T*16843008,m[D]=G<<24|G>>>8,p[D]=G<<16|G>>>16,y[D]=G<<8|G>>>24,_[D]=G,T?(T=N^b[b[b[V^N]]],w^=b[b[w]]):T=w=1}},a.expandKey=function(e){for(var r=this.uint8ArrayToUint32Array_(e),i=!0,s=0;s<r.length&&i;)i=r[s]===this.key[s],s++;if(!i){this.key=r;var l=this.keySize=r.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);var d=this.ksRows=(l+6+1)*4,f,v,m=this.keySchedule=new Uint32Array(d),p=this.invKeySchedule=new Uint32Array(d),y=this.sBox,_=this.rcon,b=this.invSubMix,T=b[0],w=b[1],I=b[2],D=b[3],N,F;for(f=0;f<d;f++){if(f<l){N=m[f]=r[f];continue}F=N,f%l===0?(F=F<<8|F>>>24,F=y[F>>>24]<<24|y[F>>>16&255]<<16|y[F>>>8&255]<<8|y[F&255],F^=_[f/l|0]<<24):l>6&&f%l===4&&(F=y[F>>>24]<<24|y[F>>>16&255]<<16|y[F>>>8&255]<<8|y[F&255]),m[f]=N=(m[f-l]^F)>>>0}for(v=0;v<d;v++)f=d-v,v&3?F=m[f]:F=m[f-4],v<4||f<=4?p[v]=F:p[v]=T[y[F>>>24]]^w[y[F>>>16&255]]^I[y[F>>>8&255]]^D[y[F&255]],p[v]=p[v]>>>0}},a.networkToHostOrderSwap=function(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24},a.decrypt=function(e,r,i){for(var s=this.keySize+6,l=this.invKeySchedule,d=this.invSBox,f=this.invSubMix,v=f[0],m=f[1],p=f[2],y=f[3],_=this.uint8ArrayToUint32Array_(i),b=_[0],T=_[1],w=_[2],I=_[3],D=new Int32Array(e),N=new Int32Array(D.length),F,V,G,B,H,Y,J,j,me,Re,Te,Qe,Ue,qe,He=this.networkToHostOrderSwap;r<D.length;){for(me=He(D[r]),Re=He(D[r+1]),Te=He(D[r+2]),Qe=He(D[r+3]),H=me^l[0],Y=Qe^l[1],J=Te^l[2],j=Re^l[3],Ue=4,qe=1;qe<s;qe++)F=v[H>>>24]^m[Y>>16&255]^p[J>>8&255]^y[j&255]^l[Ue],V=v[Y>>>24]^m[J>>16&255]^p[j>>8&255]^y[H&255]^l[Ue+1],G=v[J>>>24]^m[j>>16&255]^p[H>>8&255]^y[Y&255]^l[Ue+2],B=v[j>>>24]^m[H>>16&255]^p[Y>>8&255]^y[J&255]^l[Ue+3],H=F,Y=V,J=G,j=B,Ue=Ue+4;F=d[H>>>24]<<24^d[Y>>16&255]<<16^d[J>>8&255]<<8^d[j&255]^l[Ue],V=d[Y>>>24]<<24^d[J>>16&255]<<16^d[j>>8&255]<<8^d[H&255]^l[Ue+1],G=d[J>>>24]<<24^d[j>>16&255]<<16^d[H>>8&255]<<8^d[Y&255]^l[Ue+2],B=d[j>>>24]<<24^d[H>>16&255]<<16^d[Y>>8&255]<<8^d[J&255]^l[Ue+3],N[r]=He(F^b),N[r+1]=He(B^T),N[r+2]=He(G^w),N[r+3]=He(V^I),b=me,T=Re,w=Te,I=Qe,r=r+4}return N.buffer},o}(),zo=16,Un=function(){function o(n,e){var r=(e===void 0?{}:e).removePKCS7Padding,i=r===void 0?!0:r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=n.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var a=o.prototype;return a.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},a.isSync=function(){return this.useSoftware},a.flush=function(){var e=this.currentResult,r=this.remainderData;if(!e||r)return this.reset(),null;var i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?qo(i):i},a.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},a.decrypt=function(e,r,i){var s=this;return this.useSoftware?new Promise(function(l,d){s.softwareDecrypt(new Uint8Array(e),r,i);var f=s.flush();f?l(f.buffer):d(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),r,i)},a.softwareDecrypt=function(e,r,i){var s=this.currentIV,l=this.currentResult,d=this.remainderData;this.logOnce("JS AES decrypt"),d&&(e=Be(d,e),this.remainderData=null);var f=this.getValidChunk(e);if(!f.length)return null;s&&(i=s);var v=this.softwareDecrypter;v||(v=this.softwareDecrypter=new Ho),v.expandKey(r);var m=l;return this.currentResult=v.decrypt(f.buffer,0,i),this.currentIV=Le(f,-16).buffer,m||null},a.webCryptoDecrypt=function(e,r,i){var s=this;if(this.key!==r||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,r,i));this.key=r,this.fastAesKey=new Go(this.subtle,r)}return this.fastAesKey.expandKey().then(function(l){return s.subtle?(s.logOnce("WebCrypto AES decrypt"),new Vo(s.subtle,new Uint8Array(i)).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(l){return P.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),s.onWebCryptoError(e,r,i)})},a.onWebCryptoError=function(e,r,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,r,i);var s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},a.getValidChunk=function(e){var r=e,i=e.length-e.length%zo;return i!==e.length&&(r=Le(e,0,i),this.remainderData=Le(e,i)),r},a.logOnce=function(e){this.logEnabled&&(P.log("[decrypter]: "+e),this.logEnabled=!1)},o}(),Ko={toString:function(a){for(var n="",e=a.length,r=0;r<e;r++)n+="["+a.start(r).toFixed(3)+"-"+a.end(r).toFixed(3)+"]";return n}},Z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Vn=function(o){ie(a,o);function a(e,r,i,s,l){var d=o.call(this)||this;return d.hls=void 0,d.fragPrevious=null,d.fragCurrent=null,d.fragmentTracker=void 0,d.transmuxer=null,d._state=Z.STOPPED,d.playlistType=void 0,d.media=null,d.mediaBuffer=null,d.config=void 0,d.bitrateTest=!1,d.lastCurrentTime=0,d.nextLoadPosition=0,d.startPosition=0,d.startTimeOffset=null,d.loadedmetadata=!1,d.retryDate=0,d.levels=null,d.fragmentLoader=void 0,d.keyLoader=void 0,d.levelLastLoaded=null,d.startFragRequested=!1,d.decrypter=void 0,d.initPTS=[],d.onvseeking=null,d.onvended=null,d.logPrefix="",d.log=void 0,d.warn=void 0,d.playlistType=l,d.logPrefix=s,d.log=P.log.bind(P,s+":"),d.warn=P.warn.bind(P,s+":"),d.hls=e,d.fragmentLoader=new Uo(e.config),d.keyLoader=i,d.fragmentTracker=r,d.config=e.config,d.decrypter=new Un(e.config),e.on(A.MANIFEST_LOADED,d.onManifestLoaded,$e(d)),d}var n=a.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(r){},n.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var r=this.fragCurrent;r!=null&&r.loader&&(r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Z.STOPPED},n._streamEnded=function(r,i){if(i.live||r.nextStart||!r.end||!this.media)return!1;var s=i.partList;if(s!=null&&s.length){var l=s[s.length-1];return Dt.isBuffered(this.media,l.start+l.duration/2)}var d=i.fragments[i.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)},n.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var r;return(r=this.levelLastLoaded)==null?void 0:r.details}},n.onMediaAttached=function(r,i){var s=this.media=this.mediaBuffer=i.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),s.addEventListener("seeking",this.onvseeking),s.addEventListener("ended",this.onvended);var l=this.config;this.levels&&l.autoStartLoad&&this.state===Z.STOPPED&&this.startLoad(l.startPosition)},n.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},n.onMediaSeeking=function(){var r=this.config,i=this.fragCurrent,s=this.media,l=this.mediaBuffer,d=this.state,f=s?s.currentTime:0,v=Dt.bufferInfo(l||s,f,r.maxBufferHole);if(this.log("media seeking to "+(ne(f)?f.toFixed(3):f)+", state: "+d),this.state===Z.ENDED)this.resetLoadingState();else if(i){var m=r.maxFragLookUpTolerance,p=i.start-m,y=i.start+i.duration+m;if(!v.len||y<v.start||p>v.end){var _=f>y;(f<p||_)&&(_&&i.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}s&&(this.fragmentTracker.removeFragmentsInRange(f,1/0,this.playlistType,!0),this.lastCurrentTime=f),!this.loadedmetadata&&!v.len&&(this.nextLoadPosition=this.startPosition=f),this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onManifestLoaded=function(r,i){this.startTimeOffset=i.startTimeOffset,this.initPTS=[]},n.onHandlerDestroying=function(){this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),o.prototype.onHandlerDestroying.call(this),this.hls=null},n.onHandlerDestroyed=function(){this.state=Z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,o.prototype.onHandlerDestroyed.call(this)},n.loadFragment=function(r,i,s){this._loadFragForPlayback(r,i,s)},n._loadFragForPlayback=function(r,i,s){var l=this;this._doFragLoad(r,i,s,function(f){if(l.fragContextChanged(r)){l.warn("Fragment "+r.sn+(f.part?" p: "+f.part.index:"")+" of level "+r.level+" was dropped during download."),l.fragmentTracker.removeFragment(r);return}r.stats.chunkCount++,l._handleFragmentLoadProgress(f)}).then(function(d){if(d){var f=l.state;if(l.fragContextChanged(r)){(f===Z.FRAG_LOADING||!l.fragCurrent&&f===Z.PARSING)&&(l.fragmentTracker.removeFragment(r),l.state=Z.IDLE);return}"payload"in d&&(l.log("Loaded fragment "+r.sn+" of level "+r.level),l.hls.trigger(A.FRAG_LOADED,d)),l._handleFragmentLoadComplete(d)}}).catch(function(d){l.state===Z.STOPPED||l.state===Z.ERROR||(l.warn("Frag error: "+(d?.message||d)),l.resetFragmentLoading(r))})},n.clearTrackerIfNeeded=function(r){var i,s=this.fragmentTracker;if(s.getState(r)===jt.APPENDING){var l=r.type,d=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(r.duration,d?d.len:this.config.maxBufferLength),v=this.backtrackFragment;((v?r.sn-v.sn:0)===1||this.reduceMaxBufferLength(f,r.duration))&&s.removeFragment(r)}else((i=this.mediaBuffer)==null?void 0:i.buffered.length)===0?s.removeAllFragments():s.hasParts(r.type)&&(s.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type}),s.getState(r)===jt.PARTIAL&&s.removeFragment(r))},n.checkLiveUpdate=function(r){if(r.updated&&!r.live){var i=r.fragments[r.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type})}r.fragments[0]||(r.deltaUpdateFailed=!0)},n.flushMainBuffer=function(r,i,s){if(s===void 0&&(s=null),!!(r-i)){var l={startOffset:r,endOffset:i,type:s};this.hls.trigger(A.BUFFER_FLUSHING,l)}},n._loadInitSegment=function(r,i){var s=this;this._doFragLoad(r,i).then(function(l){if(!l||s.fragContextChanged(r)||!s.levels)throw new Error("init load aborted");return l}).then(function(l){var d=s.hls,f=l.payload,v=r.decryptdata;if(f&&f.byteLength>0&&v!=null&&v.key&&v.iv&&v.method==="AES-128"){var m=self.performance.now();return s.decrypter.decrypt(new Uint8Array(f),v.key.buffer,v.iv.buffer).catch(function(p){throw d.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_DECRYPT_ERROR,fatal:!1,error:p,reason:p.message,frag:r}),p}).then(function(p){var y=self.performance.now();return d.trigger(A.FRAG_DECRYPTED,{frag:r,payload:p,stats:{tstart:m,tdecrypt:y}}),l.payload=p,s.completeInitSegmentLoad(l)})}return s.completeInitSegmentLoad(l)}).catch(function(l){s.state===Z.STOPPED||s.state===Z.ERROR||(s.warn(l),s.resetFragmentLoading(r))})},n.completeInitSegmentLoad=function(r){if(!this.levels)throw new Error("init load aborted, missing levels");var i=r.frag.stats;this.state=Z.IDLE,r.frag.data=new Uint8Array(r.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()},n.fragContextChanged=function(r){var i=this.fragCurrent;return!r||!i||r.sn!==i.sn||r.level!==i.level},n.fragBufferedComplete=function(r,i){var s,l,d,f,v=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+r.type+" sn: "+r.sn+(i?" part: "+i.index:"")+" of "+(this.playlistType===fe.MAIN?"level":"track")+" "+r.level+" (frag:["+((s=r.startPTS)!=null?s:NaN).toFixed(3)+"-"+((l=r.endPTS)!=null?l:NaN).toFixed(3)+"] > buffer:"+(v?Ko.toString(Dt.getBuffered(v)):"(detached)")+")"),r.sn!=="initSegment"){var m;if(r.type!==fe.SUBTITLE){var p=r.elementaryStreams;if(!Object.keys(p).some(function(_){return!!p[_]})){this.state=Z.IDLE;return}}var y=(m=this.levels)==null?void 0:m[r.level];y!=null&&y.fragmentError&&(this.log("Resetting level fragment error count of "+y.fragmentError+" on frag buffered"),y.fragmentError=0)}this.state=Z.IDLE,v&&(!this.loadedmetadata&&r.type==fe.MAIN&&v.buffered.length&&((d=this.fragCurrent)==null?void 0:d.sn)===((f=this.fragPrevious)==null?void 0:f.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},n.seekToStartPos=function(){},n._handleFragmentLoadComplete=function(r){var i=this.transmuxer;if(i){var s=r.frag,l=r.part,d=r.partsLoaded,f=!d||d.length===0||d.some(function(m){return!m}),v=new Bn(s.level,s.sn,s.stats.chunkCount+1,0,l?l.index:-1,!f);i.flush(v)}},n._handleFragmentLoadProgress=function(r){},n._doFragLoad=function(r,i,s,l){var d,f=this;s===void 0&&(s=null);var v=i?.details;if(!this.levels||!v)throw new Error("frag load aborted, missing level"+(v?"":" detail")+"s");var m=null;if(r.encrypted&&!((d=r.decryptdata)!=null&&d.key)?(this.log("Loading key for "+r.sn+" of ["+v.startSN+"-"+v.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Z.KEY_LOADING,this.fragCurrent=r,m=this.keyLoader.load(r).then(function(I){if(!f.fragContextChanged(I.frag))return f.hls.trigger(A.KEY_LOADED,I),f.state===Z.KEY_LOADING&&(f.state=Z.IDLE),I}),this.hls.trigger(A.KEY_LOADING,{frag:r}),this.fragCurrent===null&&(m=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!r.encrypted&&v.encryptedFragments.length&&this.keyLoader.loadClear(r,v.encryptedFragments),s=Math.max(r.start,s||0),this.config.lowLatencyMode&&r.sn!=="initSegment"){var p=v.partList;if(p&&l){s>r.end&&v.fragmentHint&&(r=v.fragmentHint);var y=this.getNextPart(p,r,s);if(y>-1){var _=p[y];this.log("Loading part sn: "+r.sn+" p: "+_.index+" cc: "+r.cc+" of playlist ["+v.startSN+"-"+v.endSN+"] parts [0-"+y+"-"+(p.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(s.toFixed(3))),this.nextLoadPosition=_.start+_.duration,this.state=Z.FRAG_LOADING;var b;return m?b=m.then(function(I){return!I||f.fragContextChanged(I.frag)?null:f.doFragPartsLoad(r,_,i,l)}).catch(function(I){return f.handleFragLoadError(I)}):b=this.doFragPartsLoad(r,_,i,l).catch(function(I){return f.handleFragLoadError(I)}),this.hls.trigger(A.FRAG_LOADING,{frag:r,part:_,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):b}else if(!r.url||this.loadedEndOfParts(p,s))return Promise.resolve(null)}}this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(v?"of ["+v.startSN+"-"+v.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(s.toFixed(3))),ne(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=Z.FRAG_LOADING;var T=this.config.progressive,w;return T&&m?w=m.then(function(I){return!I||f.fragContextChanged(I?.frag)?null:f.fragmentLoader.load(r,l)}).catch(function(I){return f.handleFragLoadError(I)}):w=Promise.all([this.fragmentLoader.load(r,T?l:void 0),m]).then(function(I){var D=I[0];return!T&&D&&l&&l(D),D}).catch(function(I){return f.handleFragLoadError(I)}),this.hls.trigger(A.FRAG_LOADING,{frag:r,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):w},n.doFragPartsLoad=function(r,i,s,l){var d=this;return new Promise(function(f,v){var m,p=[],y=(m=s.details)==null?void 0:m.partList;(function _(b){d.fragmentLoader.loadPart(r,b,l).then(function(T){p[b.index]=T;var w=T.part;d.hls.trigger(A.FRAG_LOADED,T);var I=La(s,r.sn,b.index+1)||Ra(y,r.sn,b.index+1);if(I)_(I);else return f({frag:r,part:w,partsLoaded:p})}).catch(v)})(i)})},n.handleFragLoadError=function(r){if("data"in r){var i=r.data;r.data&&i.details===U.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(A.ERROR,i)}else this.hls.trigger(A.ERROR,{type:re.OTHER_ERROR,details:U.INTERNAL_EXCEPTION,err:r,error:r,fatal:!0});return null},n._handleTransmuxerFlush=function(r){var i=this.getCurrentContext(r);if(!i||this.state!==Z.PARSING){!this.fragCurrent&&this.state!==Z.STOPPED&&this.state!==Z.ERROR&&(this.state=Z.IDLE);return}var s=i.frag,l=i.part,d=i.level,f=self.performance.now();s.stats.parsing.end=f,l&&(l.stats.parsing.end=f),this.updateLevelTiming(s,l,d,r.partial)},n.getCurrentContext=function(r){var i=this.levels,s=this.fragCurrent,l=r.level,d=r.sn,f=r.part;if(!(i!=null&&i[l]))return this.warn("Levels object was unset while buffering fragment "+d+" of level "+l+". The current chunk will not be buffered."),null;var v=i[l],m=f>-1?La(v,d,f):null,p=m?m.fragment:ho(v,d,s);return p?(s&&s!==p&&(p.stats=s.stats),{frag:p,part:m,level:v}):null},n.bufferFragmentData=function(r,i,s,l,d){var f;if(!(!r||this.state!==Z.PARSING)){var v=r.data1,m=r.data2,p=v;if(v&&m&&(p=Be(v,m)),!!((f=p)!=null&&f.length)){var y={type:r.type,frag:i,part:s,chunkMeta:l,parent:i.type,data:p};if(this.hls.trigger(A.BUFFER_APPENDING,y),r.dropped&&r.independent&&!s){if(d)return;this.flushBufferGap(i)}}}},n.flushBufferGap=function(r){var i=this.media;if(i){if(!Dt.isBuffered(i,i.currentTime)){this.flushMainBuffer(0,r.start);return}var s=i.currentTime,l=Dt.bufferInfo(i,s,0),d=r.duration,f=Math.min(this.config.maxFragLookUpTolerance*2,d*.25),v=Math.max(Math.min(r.start-f,l.end-f),s+f);r.start-v>f&&this.flushMainBuffer(v,r.start)}},n.getFwdBufferInfo=function(r,i){var s=this.getLoadPosition();return ne(s)?this.getFwdBufferInfoAtPos(r,s,i):null},n.getFwdBufferInfoAtPos=function(r,i,s){var l=this.config.maxBufferHole,d=Dt.bufferInfo(r,i,l);if(d.len===0&&d.nextStart!==void 0){var f=this.fragmentTracker.getBufferedFrag(i,s);if(f&&d.nextStart<f.end)return Dt.bufferInfo(r,i,Math.max(d.nextStart,l))}return d},n.getMaxBufferLength=function(r){var i=this.config,s;return r?s=Math.max(8*i.maxBufferSize/r,i.maxBufferLength):s=i.maxBufferLength,Math.min(s,i.maxMaxBufferLength)},n.reduceMaxBufferLength=function(r,i){var s=this.config,l=Math.max(Math.min(r-i,s.maxBufferLength),i),d=Math.max(r-i*3,s.maxMaxBufferLength/2,l);return d>=l?(s.maxMaxBufferLength=d,this.warn("Reduce max buffer length to "+d+"s"),!0):!1},n.getAppendedFrag=function(r,i){var s=this.fragmentTracker.getAppendedFrag(r,fe.MAIN);return s&&"fragment"in s?s.fragment:s},n.getNextFragment=function(r,i){var s=i.fragments,l=s.length;if(!l)return null;var d=this.config,f=s[0].start,v;if(i.live){var m=d.initialLiveManifestSize;if(l<m)return this.warn("Not enough fragments to start playback (have: "+l+", need: "+m+")"),null;(!i.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||r<f)&&(v=this.getInitialLiveFragment(i,s),this.startPosition=this.nextLoadPosition=v?this.hls.liveSyncPosition||v.start:r)}else r<=f&&(v=s[0]);if(!v){var p=d.lowLatencyMode?i.partEnd:i.fragmentEnd;v=this.getFragmentAtPosition(r,p,i)}return this.mapToInitFragWhenRequired(v)},n.isLoopLoading=function(r,i){var s=this.fragmentTracker.getState(r);return(s===jt.OK||s===jt.PARTIAL&&!!r.gap)&&this.nextLoadPosition>i},n.getNextFragmentLoopLoading=function(r,i,s,l,d){var f=r.gap,v=this.getNextFragment(this.nextLoadPosition,i);if(v===null)return v;if(r=v,f&&r&&!r.gap&&s.nextStart){var m=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,l);if(m!==null&&s.len+m.len>=d)return this.log('buffer full after gaps in "'+l+'" playlist starting at sn: '+r.sn),null}return r},n.mapToInitFragWhenRequired=function(r){return r!=null&&r.initSegment&&!(r!=null&&r.initSegment.data)&&!this.bitrateTest?r.initSegment:r},n.getNextPart=function(r,i,s){for(var l=-1,d=!1,f=!0,v=0,m=r.length;v<m;v++){var p=r[v];if(f=f&&!p.independent,l>-1&&s<p.start)break;var y=p.loaded;y?l=-1:(d||p.independent||f)&&p.fragment===i&&(l=v),d=y}return l},n.loadedEndOfParts=function(r,i){var s=r[r.length-1];return s&&i>s.start&&s.loaded},n.getInitialLiveFragment=function(r,i){var s=this.fragPrevious,l=null;if(s){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+s.programDateTime),l=mo(i,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!l){var d=s.sn+1;if(d>=r.startSN&&d<=r.endSN){var f=i[d-r.startSN];s.cc===f.cc&&(l=f,this.log("Live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=yo(i,s.cc),l&&this.log("Live playlist, switching playlist, load frag with same CC: "+l.sn))}}else{var v=this.hls.liveSyncPosition;v!==null&&(l=this.getFragmentAtPosition(v,this.bitrateTest?r.fragmentEnd:r.edge,r))}return l},n.getFragmentAtPosition=function(r,i,s){var l=this.config,d=this.fragPrevious,f=s.fragments,v=s.endSN,m=s.fragmentHint,p=l.maxFragLookUpTolerance,y=s.partList,_=!!(l.lowLatencyMode&&y!=null&&y.length&&m);_&&m&&!this.bitrateTest&&(f=f.concat(m),v=m.sn);var b;if(r<i){var T=r>i-p?0:p;b=an(d,f,r,T)}else b=f[f.length-1];if(b){var w=b.sn-s.startSN,I=this.fragmentTracker.getState(b);if((I===jt.OK||I===jt.PARTIAL&&b.gap)&&(d=b),d&&b.sn===d.sn&&(!_||y[0].fragment.sn>b.sn)&&d&&b.level===d.level){var D=f[w+1];b.sn<v&&this.fragmentTracker.getState(D)!==jt.OK?b=D:b=null}}return b},n.synchronizeToLiveEdge=function(r){var i=this.config,s=this.media;if(s){var l=this.hls.liveSyncPosition,d=s.currentTime,f=r.fragments[0].start,v=r.edge,m=d>=f-i.maxFragLookUpTolerance&&d<=v;if(l!==null&&s.duration>l&&(d<l||!m)){var p=i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*r.targetduration;(!m&&s.readyState<4||d<v-p)&&(this.loadedmetadata||(this.nextLoadPosition=l),s.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+v+", reset currentTime to : "+l.toFixed(3)),s.currentTime=l))}}},n.alignPlaylists=function(r,i,s){var l=r.fragments.length;if(!l)return this.warn("No fragments in live playlist"),0;var d=r.fragments[0].start,f=!i,v=r.alignedSliding&&ne(d);if(f||!v&&!d){var m=this.fragPrevious;No(m,s,r);var p=r.fragments[0].start;return this.log("Live playlist sliding: "+p.toFixed(2)+" start-sn: "+(i?i.startSN:"na")+"->"+r.startSN+" prev-sn: "+(m?m.sn:"na")+" fragments: "+l),p}return d},n.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,r.partTarget*3)},n.setStartPosition=function(r,i){var s=this.startPosition;if(s<i&&(s=-1),s===-1||this.lastCurrentTime===-1){var l=this.startTimeOffset!==null,d=l?this.startTimeOffset:r.startTimeOffset;d!==null&&ne(d)?(s=i+d,d<0&&(s+=r.totalduration),s=Math.min(Math.max(i,s),i+r.totalduration),this.log("Start time offset "+d+" found in "+(l?"multivariant":"media")+" playlist, adjust startPosition to "+s),this.startPosition=s):r.live?s=this.hls.liveSyncPosition||i:this.startPosition=s=0,this.lastCurrentTime=s}this.nextLoadPosition=s},n.getLoadPosition=function(){var r=this.media,i=0;return this.loadedmetadata&&r?i=r.currentTime:this.nextLoadPosition&&(i=this.nextLoadPosition),i},n.handleFragLoadAborted=function(r,i){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(i?" part "+i.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},n.resetFragmentLoading=function(r){(!this.fragCurrent||!this.fragContextChanged(r)&&this.state!==Z.FRAG_LOADING_WAITING_RETRY)&&(this.state=Z.IDLE)},n.onFragmentOrKeyLoadError=function(r,i){if(i.chunkMeta&&!i.frag){var s=this.getCurrentContext(i.chunkMeta);s&&(i.frag=s.frag)}var l=i.frag;if(!(!l||l.type!==r||!this.levels)){if(this.fragContextChanged(l)){var d;this.warn("Frag load error must match current frag to retry "+l.url+" > "+((d=this.fragCurrent)==null?void 0:d.url));return}var f=i.details===U.FRAG_GAP;f&&this.fragmentTracker.fragBuffered(l,!0);var v=i.errorAction,m=v||{},p=m.action,y=m.retryCount,_=y===void 0?0:y,b=m.retryConfig;if(v&&p===Zt.RetryRequest&&b){this.resetStartWhenNotLoaded(this.levelLastLoaded);var T=xn(b,_);this.warn("Fragment "+l.sn+" of "+r+" "+l.level+" errored with "+i.details+", retrying loading "+(_+1)+"/"+b.maxNumRetry+" in "+T+"ms"),v.resolved=!0,this.retryDate=self.performance.now()+T,this.state=Z.FRAG_LOADING_WAITING_RETRY}else if(b&&v)if(this.resetFragmentErrors(r),_<b.maxNumRetry)!f&&p!==Zt.RemoveAlternatePermanently&&(v.resolved=!0);else{P.warn(i.details+" reached or exceeded max retry ("+_+")");return}else v?.action===Zt.SendAlternateToPenaltyBox?this.state=Z.WAITING_LEVEL:this.state=Z.ERROR;this.tickImmediate()}},n.reduceLengthAndFlushBuffer=function(r){if(this.state===Z.PARSING||this.state===Z.PARSED){var i=r.frag,s=r.parent,l=this.getFwdBufferInfo(this.mediaBuffer,s),d=l&&l.len>.5;d&&this.reduceMaxBufferLength(l.len,i?.duration||10);var f=!d;return f&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+s+" buffer"),i&&(this.fragmentTracker.removeFragment(i),this.nextLoadPosition=i.start),this.resetLoadingState(),f}return!1},n.resetFragmentErrors=function(r){r===fe.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Z.STOPPED&&(this.state=Z.IDLE)},n.afterBufferFlushed=function(r,i,s){if(r){var l=Dt.getBuffered(r);this.fragmentTracker.detectEvictedFragments(i,l,s),this.state===Z.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Z.IDLE},n.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var i=r?r.details:null;i!=null&&i.live?(this.startPosition=-1,this.setStartPosition(i,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.resetWhenMissingContext=function(r){this.warn("The loading context changed while buffering fragment "+r.sn+" of level "+r.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},n.removeUnbufferedFrags=function(r){r===void 0&&(r=0),this.fragmentTracker.removeFragmentsInRange(r,1/0,this.playlistType,!1,!0)},n.updateLevelTiming=function(r,i,s,l){var d=this,f,v=s.details;if(!v){this.warn("level.details undefined");return}if(!Object.keys(r.elementaryStreams).reduce(function(p,y){var _=r.elementaryStreams[y];if(_){var b=_.endPTS-_.startPTS;if(b<=0)return d.warn("Could not parse fragment "+r.sn+" "+y+" duration reliably ("+b+")"),p||!1;var T=l?0:ba(v,r,_.startPTS,_.endPTS,_.startDTS,_.endDTS);return d.hls.trigger(A.LEVEL_PTS_UPDATED,{details:v,level:s,drift:T,type:y,frag:r,start:_.startPTS,end:_.endPTS}),!0}return p},!1)&&((f=this.transmuxer)==null?void 0:f.error)===null){var m=new Error("Found no media in fragment "+r.sn+" of level "+r.level+" resetting transmuxer to fallback to playlist timing");if(s.fragmentError===0&&(s.fragmentError++,r.gap=!0,this.fragmentTracker.removeFragment(r),this.fragmentTracker.fragBuffered(r,!0)),this.warn(m.message),this.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,fatal:!1,error:m,frag:r,reason:"Found no media in msn "+r.sn+' of level "'+s.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Z.PARSED,this.hls.trigger(A.FRAG_PARSED,{frag:r,part:i})},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n.recoverWorkerError=function(r){r.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},x(a,[{key:"state",get:function(){return this._state},set:function(r){var i=this._state;i!==r&&(this._state=r,this.log(i+"->"+r))}}]),a}(Oo),Ua=function(){function o(){this.chunks=[],this.dataLength=0}var a=o.prototype;return a.push=function(e){this.chunks.push(e),this.dataLength+=e.length},a.flush=function(){var e=this.chunks,r=this.dataLength,i;if(e.length)e.length===1?i=e[0]:i=jo(e,r);else return new Uint8Array(0);return this.reset(),i},a.reset=function(){this.chunks.length=0,this.dataLength=0},o}();function jo(o,a){for(var n=new Uint8Array(a),e=0,r=0;r<o.length;r++){var i=o[r];n.set(i,e),e+=i.length}return n}function Vr(o,a){return o===void 0&&(o=""),a===void 0&&(a=9e4),{type:o,id:-1,pid:-1,inputTimeScale:a,sequenceNumber:-1,samples:[],dropped:0}}var Gn=function(){function o(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var a=o.prototype;return a.resetInitSegment=function(e,r,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},a.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},a.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},a.canParse=function(e,r){return!1},a.appendFrame=function(e,r,i){},a.demux=function(e,r){this.cachedData&&(e=Be(this.cachedData,e),this.cachedData=null);var i=Xe(e,0),s=i?i.length:0,l,d=this._audioTrack,f=this._id3Track,v=i?lt(i):void 0,m=e.length;for((this.basePTS===null||this.frameIndex===0&&ne(v))&&(this.basePTS=Wo(v,r,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ct.audioId3,duration:Number.POSITIVE_INFINITY});s<m;){if(this.canParse(e,s)){var p=this.appendFrame(d,e,s);p?(this.frameIndex++,this.lastPTS=p.sample.pts,s+=p.length,l=s):s=m}else Ke(e,s)?(i=Xe(e,s),f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ct.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,l=s):s++;if(s===m&&l!==m){var y=Le(e,l);this.cachedData?this.cachedData=Be(this.cachedData,y):this.cachedData=y}}return{audioTrack:d,videoTrack:Vr(),id3Track:f,textTrack:Vr()}},a.demuxSampleAes=function(e,r,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},a.flush=function(e){var r=this.cachedData;return r&&(this.cachedData=null,this.demux(r,0)),{audioTrack:this._audioTrack,videoTrack:Vr(),id3Track:this._id3Track,textTrack:Vr()}},a.destroy=function(){},o}(),Wo=function(a,n,e){if(ne(a))return a*90;var r=e?e.baseTime*9e4/e.timescale:0;return n*9e4+r};function Yo(o,a,n,e){var r,i,s,l,d=navigator.userAgent.toLowerCase(),f=e,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((a[n+2]&192)>>>6)+1;var m=(a[n+2]&60)>>>2;if(m>v.length-1){var p=new Error("invalid ADTS sampling index:"+m);o.emit(A.ERROR,A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}return s=(a[n+2]&1)<<2,s|=(a[n+3]&192)>>>6,P.log("manifest codec:"+e+", ADTS type:"+r+", samplingIndex:"+m),/firefox/i.test(d)?m>=6?(r=5,l=new Array(4),i=m-3):(r=2,l=new Array(2),i=m):d.indexOf("android")!==-1?(r=2,l=new Array(2),i=m):(r=5,l=new Array(4),e&&(e.indexOf("mp4a.40.29")!==-1||e.indexOf("mp4a.40.5")!==-1)||!e&&m>=6?i=m-3:((e&&e.indexOf("mp4a.40.2")!==-1&&(m>=6&&s===1||/vivaldi/i.test(d))||!e&&s===1)&&(r=2,l=new Array(2)),i=m)),l[0]=r<<3,l[0]|=(m&14)>>1,l[1]|=(m&1)<<7,l[1]|=s<<3,r===5&&(l[1]|=(i&14)>>1,l[2]=(i&1)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:v[m],channelCount:s,codec:"mp4a.40."+r,manifestCodec:f}}function Va(o,a){return o[a]===255&&(o[a+1]&246)===240}function Ga(o,a){return o[a+1]&1?7:9}function qn(o,a){return(o[a+3]&3)<<11|o[a+4]<<3|(o[a+5]&224)>>>5}function $o(o,a){return a+5<o.length}function dn(o,a){return a+1<o.length&&Va(o,a)}function Xo(o,a){return $o(o,a)&&Va(o,a)&&qn(o,a)<=o.length-a}function Qo(o,a){if(dn(o,a)){var n=Ga(o,a);if(a+n>=o.length)return!1;var e=qn(o,a);if(e<=n)return!1;var r=a+e;return r===o.length||dn(o,r)}return!1}function qa(o,a,n,e,r){if(!o.samplerate){var i=Yo(a,n,e,r);if(!i)return;o.config=i.config,o.samplerate=i.samplerate,o.channelCount=i.channelCount,o.codec=i.codec,o.manifestCodec=i.manifestCodec,P.log("parsed codec:"+o.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function Ha(o){return 1024*9e4/o}function Jo(o,a){var n=Ga(o,a);if(a+n<=o.length){var e=qn(o,a)-n;if(e>0)return{headerLength:n,frameLength:e}}}function za(o,a,n,e,r){var i=e+r*Ha(o.samplerate),s=Jo(a,n),l;if(s){var d=s.frameLength,f=s.headerLength,v=f+d,m=Math.max(0,n+v-a.length);m?(l=new Uint8Array(v-f),l.set(a.subarray(n+f,a.length),0)):l=a.subarray(n+f,n+v);var p={unit:l,pts:i};return m||o.samples.push(p),{sample:p,length:v,missing:m}}var y=a.length-n;return l=new Uint8Array(y),l.set(a.subarray(n,a.length),0),{sample:{unit:l,pts:i},length:y,missing:-1}}var fn=null,Zo=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],el=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],tl=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],rl=[0,1,1,4];function Ka(o,a,n,e,r){if(!(n+24>a.length)){var i=ja(a,n);if(i&&n+i.frameLength<=a.length){var s=e+r*(i.samplesPerFrame*9e4/i.sampleRate),l={unit:a.subarray(n,n+i.frameLength),pts:s,dts:s};return o.config=[],o.channelCount=i.channelCount,o.samplerate=i.sampleRate,o.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}}function ja(o,a){var n=o[a+1]>>3&3,e=o[a+1]>>1&3,r=o[a+2]>>4&15,i=o[a+2]>>2&3;if(n!==1&&r!==0&&r!==15&&i!==3){var s=o[a+2]>>1&1,l=o[a+3]>>6,d=Zo[(n===3?3-e:e===3?3:4)*14+r-1]*1e3,f=el[(n===3?0:n===2?1:2)*3+i],v=l===3?1:2,m=tl[n][e],p=rl[e],y=m*8*p,_=Math.floor(m*d/f+s)*p;if(fn===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fn=b?parseInt(b[1]):0}return fn&&fn<=87&&e===2&&d>=224e3&&l===0&&(o[a+3]=o[a+3]|128),{sampleRate:f,channelCount:v,frameLength:_,samplesPerFrame:y}}}function Hn(o,a){return o[a]===255&&(o[a+1]&224)===224&&(o[a+1]&6)!==0}function Wa(o,a){return a+1<o.length&&Hn(o,a)}function il(o,a){return Hn(o,a)&&4<=o.length-a}function Ya(o,a){if(a+1<o.length&&Hn(o,a)){var n=4,e=ja(o,a),r=n;e!=null&&e.frameLength&&(r=e.frameLength);var i=a+r;return i===o.length||Wa(o,i)}return!1}var nl=function(o){ie(a,o);function a(e,r){var i=o.call(this)||this;return i.observer=void 0,i.config=void 0,i.observer=e,i.config=r,i}var n=a.prototype;return n.resetInitSegment=function(r,i,s,l){o.prototype.resetInitSegment.call(this,r,i,s,l),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:l,inputTimeScale:9e4,dropped:0}},a.probe=function(r){if(!r)return!1;var i=Xe(r,0),s=i?.length||0;if(Ya(r,s))return!1;for(var l=r.length;s<l;s++)if(Qo(r,s))return P.log("ADTS sync word found !"),!0;return!1},n.canParse=function(r,i){return Xo(r,i)},n.appendFrame=function(r,i,s){qa(r,this.observer,i,s,r.manifestCodec);var l=za(r,i,s,this.basePTS,this.frameIndex);if(l&&l.missing===0)return l},a}(Gn),al=/\/emsg[-/]ID3/i,sl=function(){function o(n,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var a=o.prototype;return a.resetTimeStamp=function(){},a.resetInitSegment=function(e,r,i,s){var l=this.videoTrack=Vr("video",1),d=this.audioTrack=Vr("audio",1),f=this.txtTrack=Vr("text",1);if(this.id3Track=Vr("id3",1),this.timeOffset=0,!!(e!=null&&e.byteLength)){var v=Xt(e);if(v.video){var m=v.video,p=m.id,y=m.timescale,_=m.codec;l.id=p,l.timescale=f.timescale=y,l.codec=_}if(v.audio){var b=v.audio,T=b.id,w=b.timescale,I=b.codec;d.id=T,d.timescale=w,d.codec=I}f.id=W.text,l.sampleDuration=0,l.duration=d.duration=s}},a.resetContiguity=function(){this.remainderData=null},o.probe=function(e){return Fe(e)},a.demux=function(e,r){this.timeOffset=r;var i=e,s=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Be(this.remainderData,e));var d=Kt(i);this.remainderData=d.remainder,s.samples=d.valid||new Uint8Array}else s.samples=i;var f=this.extractID3Track(s,r);return l.samples=_t(r,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:f,textTrack:this.txtTrack}},a.flush=function(){var e=this.timeOffset,r=this.videoTrack,i=this.txtTrack;r.samples=this.remainderData||new Uint8Array,this.remainderData=null;var s=this.extractID3Track(r,this.timeOffset);return i.samples=_t(e,r),{videoTrack:r,audioTrack:Vr(),id3Track:s,textTrack:Vr()}},a.extractID3Track=function(e,r){var i=this.id3Track;if(e.samples.length){var s=he(e.samples,["emsg"]);s&&s.forEach(function(l){var d=br(l);if(al.test(d.schemeIdUri)){var f=ne(d.presentationTime)?d.presentationTime/d.timeScale:r+d.presentationTimeDelta/d.timeScale,v=d.eventDuration===4294967295?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale;v<=.001&&(v=Number.POSITIVE_INFINITY);var m=d.payload;i.samples.push({data:m,len:m.byteLength,dts:f,pts:f,type:Ct.emsg,duration:v})}})}return i},a.demuxSampleAes=function(e,r,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},a.destroy=function(){},o}(),$a=function(a,n){var e=0,r=5;n+=r;for(var i=new Uint32Array(1),s=new Uint32Array(1),l=new Uint8Array(1);r>0;){l[0]=a[n];var d=Math.min(r,8),f=8-d;s[0]=4278190080>>>24+f<<f,i[0]=(l[0]&s[0])>>f,e=e?e<<d|i[0]:i[0],n+=1,r-=d}return e},ol=function(o){ie(a,o);function a(e){var r=o.call(this)||this;return r.observer=void 0,r.observer=e,r}var n=a.prototype;return n.resetInitSegment=function(r,i,s,l){o.prototype.resetInitSegment.call(this,r,i,s,l),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:i,duration:l,inputTimeScale:9e4,dropped:0}},n.canParse=function(r,i){return i+64<r.length},n.appendFrame=function(r,i,s){var l=Xa(r,i,s,this.basePTS,this.frameIndex);if(l!==-1)return{sample:r.samples[r.samples.length-1],length:l,missing:0}},a.probe=function(r){if(!r)return!1;var i=Xe(r,0);if(!i)return!1;var s=i.length;return r[s]===11&&r[s+1]===119&&lt(i)!==void 0&&$a(r,s)<16},a}(Gn);function Xa(o,a,n,e,r){if(n+8>a.length||a[n]!==11||a[n+1]!==119)return-1;var i=a[n+4]>>6;if(i>=3)return-1;var s=[48e3,44100,32e3][i],l=a[n+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(n+d>a.length)return-1;var f=a[n+6]>>5,v=0;f===2?v+=2:(f&1&&f!==1&&(v+=2),f&4&&(v+=2));var m=(a[n+6]<<8|a[n+7])>>12-v&1,p=[2,1,2,3,3,4,4,5][f]+m,y=a[n+5]>>3,_=a[n+5]&7,b=new Uint8Array([i<<6|y<<1|_>>2,(_&3)<<6|f<<3|m<<2|l>>4,l<<4&224]),T=e+r*(1536/s*9e4),w=a.subarray(n,n+d);return o.config=b,o.channelCount=p,o.samplerate=s,o.samples.push({unit:w,pts:T}),d}var ll=function(){function o(){this.VideoSample=null}var a=o.prototype;return a.createVideoSample=function(e,r,i,s){return{key:e,frame:!1,pts:r,dts:i,units:[],debug:s,length:0}},a.getLastNalUnit=function(e){var r,i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(r=i)!=null&&r.units){var l=i.units;s=l[l.length-1]}return s},a.pushAccessUnit=function(e,r){if(e.units.length&&e.frame){if(e.pts===void 0){var i=r.samples,s=i.length;if(s){var l=i[s-1];e.pts=l.pts,e.dts=l.dts}else{r.dropped++;return}}r.samples.push(e)}e.debug.length&&P.log(e.pts+"/"+e.dts+":"+e.debug)},o}(),Qa=function(){function o(n){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=n,this.bytesAvailable=n.byteLength,this.word=0,this.bitsAvailable=0}var a=o.prototype;return a.loadWord=function(){var e=this.data,r=this.bytesAvailable,i=e.byteLength-r,s=new Uint8Array(4),l=Math.min(4,r);if(l===0)throw new Error("no bytes available");s.set(e.subarray(i,i+l)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l},a.skipBits=function(e){var r;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,r=e>>3,e-=r<<3,this.bytesAvailable-=r,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},a.readBits=function(e){var r=Math.min(this.bitsAvailable,e),i=this.word>>>32-r;if(e>32&&P.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0)this.word<<=r;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return r=e-r,r>0&&this.bitsAvailable?i<<r|this.readBits(r):i},a.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},a.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.skipEG=function(){this.skipBits(1+this.skipLZ())},a.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},a.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},a.readBoolean=function(){return this.readBits(1)===1},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},a.skipScalingList=function(e){for(var r=8,i=8,s,l=0;l<e;l++)i!==0&&(s=this.readEG(),i=(r+s+256)%256),r=i===0?r:i},a.readSPS=function(){var e=0,r=0,i=0,s=0,l,d,f,v=this.readUByte.bind(this),m=this.readBits.bind(this),p=this.readUEG.bind(this),y=this.readBoolean.bind(this),_=this.skipBits.bind(this),b=this.skipEG.bind(this),T=this.skipUEG.bind(this),w=this.skipScalingList.bind(this);v();var I=v();if(m(5),_(3),v(),T(),I===100||I===110||I===122||I===244||I===44||I===83||I===86||I===118||I===128){var D=p();if(D===3&&_(1),T(),T(),_(1),y())for(d=D!==3?8:12,f=0;f<d;f++)y()&&(f<6?w(16):w(64))}T();var N=p();if(N===0)p();else if(N===1)for(_(1),b(),b(),l=p(),f=0;f<l;f++)b();T(),_(1);var F=p(),V=p(),G=m(1);G===0&&_(1),_(1),y()&&(e=p(),r=p(),i=p(),s=p());var B=[1,1];if(y()&&y())switch(v()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:B=[v()<<8|v(),v()<<8|v()];break}return{width:Math.ceil((F+1)*16-e*2-r*2),height:(2-G)*(V+1)*16-(G?2:4)*(i+s),pixelRatio:B}},a.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},o}(),ul=function(o){ie(a,o);function a(){return o.apply(this,arguments)||this}var n=a.prototype;return n.parseAVCPES=function(r,i,s,l,d){var f=this,v=this.parseAVCNALu(r,s.data),m=this.VideoSample,p,y=!1;s.data=null,m&&v.length&&!r.audFound&&(this.pushAccessUnit(m,r),m=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts,"")),v.forEach(function(_){var b;switch(_.type){case 1:var T=!1;p=!0;var w=_.data;if(y&&w.length>4){var I=new Qa(w).readSliceType();(I===2||I===4||I===7||I===9)&&(T=!0)}if(T){var D;(D=m)!=null&&D.frame&&!m.key&&(f.pushAccessUnit(m,r),m=f.VideoSample=null)}m||(m=f.VideoSample=f.createVideoSample(!0,s.pts,s.dts,"")),m.frame=!0,m.key=T;break;case 5:p=!0,(b=m)!=null&&b.frame&&!m.key&&(f.pushAccessUnit(m,r),m=f.VideoSample=null),m||(m=f.VideoSample=f.createVideoSample(!0,s.pts,s.dts,"")),m.key=!0,m.frame=!0;break;case 6:p=!0,vr(_.data,1,s.pts,i.samples);break;case 7:var N,F;p=!0,y=!0;var V=_.data,G=new Qa(V).readSPS();if(!r.sps||r.width!==G.width||r.height!==G.height||((N=r.pixelRatio)==null?void 0:N[0])!==G.pixelRatio[0]||((F=r.pixelRatio)==null?void 0:F[1])!==G.pixelRatio[1]){r.width=G.width,r.height=G.height,r.pixelRatio=G.pixelRatio,r.sps=[V],r.duration=d;for(var B=V.subarray(1,4),H="avc1.",Y=0;Y<3;Y++){var J=B[Y].toString(16);J.length<2&&(J="0"+J),H+=J}r.codec=H}break;case 8:p=!0,r.pps=[_.data];break;case 9:p=!0,r.audFound=!0,m&&f.pushAccessUnit(m,r),m=f.VideoSample=f.createVideoSample(!1,s.pts,s.dts,"");break;case 12:p=!0;break;default:p=!1,m&&(m.debug+="unknown NAL "+_.type+" ");break}m&&p&&m.units.push(_)}),l&&m&&(this.pushAccessUnit(m,r),this.VideoSample=null)},n.parseAVCNALu=function(r,i){var s=i.byteLength,l=r.naluState||0,d=l,f=[],v=0,m,p,y,_=-1,b=0;for(l===-1&&(_=0,b=i[0]&31,l=0,v=1);v<s;){if(m=i[v++],!l){l=m?0:1;continue}if(l===1){l=m?0:2;continue}if(!m)l=3;else if(m===1){if(p=v-l-1,_>=0){var T={data:i.subarray(_,p),type:b};f.push(T)}else{var w=this.getLastNalUnit(r.samples);w&&(d&&v<=4-d&&w.state&&(w.data=w.data.subarray(0,w.data.byteLength-d)),p>0&&(w.data=Be(w.data,i.subarray(0,p)),w.state=0))}v<s?(y=i[v]&31,_=v,b=y,l=0):l=-1}else l=0}if(_>=0&&l>=0){var I={data:i.subarray(_,s),type:b,state:l};f.push(I)}if(f.length===0){var D=this.getLastNalUnit(r.samples);D&&(D.data=Be(D.data,i))}return r.naluState=l,f},a}(ll),cl=function(){function o(n,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Un(e,{removePKCS7Padding:!1})}var a=o.prototype;return a.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},a.decryptAacSample=function(e,r,i){var s=this,l=e[r].unit;if(!(l.length<=16)){var d=l.subarray(16,l.length-l.length%16),f=d.buffer.slice(d.byteOffset,d.byteOffset+d.length);this.decryptBuffer(f).then(function(v){var m=new Uint8Array(v);l.set(m,16),s.decrypter.isSync()||s.decryptAacSamples(e,r+1,i)})}},a.decryptAacSamples=function(e,r,i){for(;;r++){if(r>=e.length){i();return}if(!(e[r].unit.length<32)&&(this.decryptAacSample(e,r,i),!this.decrypter.isSync()))return}},a.getAvcEncryptedData=function(e){for(var r=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(r),s=0,l=32;l<e.length-16;l+=160,s+=16)i.set(e.subarray(l,l+16),s);return i},a.getAvcDecryptedUnit=function(e,r){for(var i=new Uint8Array(r),s=0,l=32;l<e.length-16;l+=160,s+=16)e.set(i.subarray(s,s+16),l);return e},a.decryptAvcSample=function(e,r,i,s,l){var d=this,f=ei(l.data),v=this.getAvcEncryptedData(f);this.decryptBuffer(v.buffer).then(function(m){l.data=d.getAvcDecryptedUnit(f,m),d.decrypter.isSync()||d.decryptAvcSamples(e,r,i+1,s)})},a.decryptAvcSamples=function(e,r,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;r++,i=0){if(r>=e.length){s();return}for(var l=e[r].units;!(i>=l.length);i++){var d=l[i];if(!(d.data.length<=48||d.type!==1&&d.type!==5)&&(this.decryptAvcSample(e,r,i,s,d),!this.decrypter.isSync()))return}}},o}(),Wt=188,dl=function(){function o(n,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=n,this.config=e,this.typeSupported=r,this.videoParser=new ul}o.probe=function(e){var r=o.syncOffset(e);return r>0&&P.warn("MPEG2-TS detected but first sync word found @ offset "+r),r!==-1},o.syncOffset=function(e){for(var r=e.length,i=Math.min(Wt*5,r-Wt)+1,s=0;s<i;){for(var l=!1,d=-1,f=0,v=s;v<r;v+=Wt)if(e[v]===71&&(r-v===Wt||e[v+Wt]===71)){if(f++,d===-1&&(d=v,d!==0&&(i=Math.min(d+Wt*99,e.length-Wt)+1)),l||(l=zn(e,v)===0),l&&f>1&&(d===0&&f>2||v+Wt>i))return d}else{if(f)return-1;break}s++}return-1},o.createTrack=function(e,r){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:W[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?r:void 0}};var a=o.prototype;return a.resetInitSegment=function(e,r,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=o.createTrack("video"),this._audioTrack=o.createTrack("audio",s),this._id3Track=o.createTrack("id3"),this._txtTrack=o.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=i,this._duration=s},a.resetTimeStamp=function(){},a.resetContiguity=function(){var e=this._audioTrack,r=this._videoTrack,i=this._id3Track;e&&(e.pesData=null),r&&(r.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null},a.demux=function(e,r,i,s){i===void 0&&(i=!1),s===void 0&&(s=!1),i||(this.sampleAes=null);var l,d=this._videoTrack,f=this._audioTrack,v=this._id3Track,m=this._txtTrack,p=d.pid,y=d.pesData,_=f.pid,b=v.pid,T=f.pesData,w=v.pesData,I=null,D=this.pmtParsed,N=this._pmtId,F=e.length;if(this.remainderData&&(e=Be(this.remainderData,e),F=e.length,this.remainderData=null),F<Wt&&!s)return this.remainderData=e,{audioTrack:f,videoTrack:d,id3Track:v,textTrack:m};var V=Math.max(0,o.syncOffset(e));F-=(F-V)%Wt,F<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,F,e.buffer.byteLength-F));for(var G=0,B=V;B<F;B+=Wt)if(e[B]===71){var H=!!(e[B+1]&64),Y=zn(e,B),J=(e[B+3]&48)>>4,j=void 0;if(J>1){if(j=B+5+e[B+4],j===B+Wt)continue}else j=B+4;switch(Y){case p:H&&(y&&(l=Di(y))&&this.videoParser.parseAVCPES(d,m,l,!1,this._duration),y={data:[],size:0}),y&&(y.data.push(e.subarray(j,B+Wt)),y.size+=B+Wt-j);break;case _:if(H){if(T&&(l=Di(T)))switch(f.segmentCodec){case"aac":this.parseAACPES(f,l);break;case"mp3":this.parseMPEGPES(f,l);break;case"ac3":this.parseAC3PES(f,l);break}T={data:[],size:0}}T&&(T.data.push(e.subarray(j,B+Wt)),T.size+=B+Wt-j);break;case b:H&&(w&&(l=Di(w))&&this.parseID3PES(v,l),w={data:[],size:0}),w&&(w.data.push(e.subarray(j,B+Wt)),w.size+=B+Wt-j);break;case 0:H&&(j+=e[j]+1),N=this._pmtId=fl(e,j);break;case N:H&&(j+=e[j]+1);var me=hl(e,j,this.typeSupported,i,this.observer);p=me.videoPid,p>0&&(d.pid=p,d.segmentCodec=me.segmentVideoCodec),_=me.audioPid,_>0&&(f.pid=_,f.segmentCodec=me.segmentAudioCodec),b=me.id3Pid,b>0&&(v.pid=b),I!==null&&!D&&(P.warn("MPEG-TS PMT found at "+B+" after unknown PID '"+I+"'. Backtracking to sync byte @"+V+" to parse all TS packets."),I=null,B=V-188),D=this.pmtParsed=!0;break;case 17:case 8191:break;default:I=Y;break}}else G++;G>0&&hn(this.observer,new Error("Found "+G+" TS packet/s that do not start with 0x47")),d.pesData=y,f.pesData=T,v.pesData=w;var Re={audioTrack:f,videoTrack:d,id3Track:v,textTrack:m};return s&&this.extractRemainingSamples(Re),Re},a.flush=function(){var e=this.remainderData;this.remainderData=null;var r;return e?r=this.demux(e,-1,!1,!0):r={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(r),this.sampleAes?this.decrypt(r,this.sampleAes):r},a.extractRemainingSamples=function(e){var r=e.audioTrack,i=e.videoTrack,s=e.id3Track,l=e.textTrack,d=i.pesData,f=r.pesData,v=s.pesData,m;if(d&&(m=Di(d))?(this.videoParser.parseAVCPES(i,l,m,!0,this._duration),i.pesData=null):i.pesData=d,f&&(m=Di(f))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,m);break;case"mp3":this.parseMPEGPES(r,m);break;case"ac3":this.parseAC3PES(r,m);break}r.pesData=null}else f!=null&&f.size&&P.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=f;v&&(m=Di(v))?(this.parseID3PES(s,m),s.pesData=null):s.pesData=v},a.demuxSampleAes=function(e,r,i){var s=this.demux(e,i,!0,!this.config.progressive),l=this.sampleAes=new cl(this.observer,this.config,r);return this.decrypt(s,l)},a.decrypt=function(e,r){return new Promise(function(i){var s=e.audioTrack,l=e.videoTrack;s.samples&&s.segmentCodec==="aac"?r.decryptAacSamples(s.samples,0,function(){l.samples?r.decryptAvcSamples(l.samples,0,0,function(){i(e)}):i(e)}):l.samples&&r.decryptAvcSamples(l.samples,0,0,function(){i(e)})})},a.destroy=function(){this._duration=0},a.parseAACPES=function(e,r){var i=0,s=this.aacOverFlow,l=r.data;if(s){this.aacOverFlow=null;var d=s.missing,f=s.sample.unit.byteLength;if(d===-1)l=Be(s.sample.unit,l);else{var v=f-d;s.sample.unit.set(l.subarray(0,d),v),e.samples.push(s.sample),i=s.missing}}var m,p;for(m=i,p=l.length;m<p-1&&!dn(l,m);m++);if(m!==i){var y,_=m<p-1;if(_?y="AAC PES did not start with ADTS header,offset:"+m:y="No ADTS header found in AAC PES",hn(this.observer,new Error(y),_),!_)return}qa(e,this.observer,l,m,this.audioCodec);var b;if(r.pts!==void 0)b=r.pts;else if(s){var T=Ha(e.samplerate);b=s.sample.pts+T}else{P.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0,I;m<p;)if(I=za(e,l,m,b,w),m+=I.length,I.missing){this.aacOverFlow=I;break}else for(w++;m<p-1&&!dn(l,m);m++);},a.parseMPEGPES=function(e,r){var i=r.data,s=i.length,l=0,d=0,f=r.pts;if(f===void 0){P.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;d<s;)if(Wa(i,d)){var v=Ka(e,i,d,f,l);if(v)d+=v.length,l++;else break}else d++},a.parseAC3PES=function(e,r){var i=r.data,s=r.pts;if(s===void 0){P.warn("[tsdemuxer]: AC3 PES unknown PTS");return}for(var l=i.length,d=0,f=0,v;f<l&&(v=Xa(e,i,f,s,d++))>0;)f+=v},a.parseID3PES=function(e,r){if(r.pts===void 0){P.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var i=X({},r,{type:this._videoTrack?Ct.emsg:Ct.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)},o}();function zn(o,a){return((o[a+1]&31)<<8)+o[a+2]}function fl(o,a){return(o[a+10]&31)<<8|o[a+11]}function hl(o,a,n,e,r){var i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(o[a+1]&15)<<8|o[a+2],l=a+3+s-4,d=(o[a+10]&15)<<8|o[a+11];for(a+=12+d;a<l;){var f=zn(o,a),v=(o[a+3]&15)<<8|o[a+4];switch(o[a]){case 207:if(!e){Kn("ADTS AAC");break}case 15:i.audioPid===-1&&(i.audioPid=f);break;case 21:i.id3Pid===-1&&(i.id3Pid=f);break;case 219:if(!e){Kn("H.264");break}case 27:i.videoPid===-1&&(i.videoPid=f,i.segmentVideoCodec="avc");break;case 3:case 4:!n.mpeg&&!n.mp3?P.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="mp3");break;case 193:if(!e){Kn("AC-3");break}case 129:n.ac3?i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="ac3"):P.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&v>0)for(var m=a+5,p=v;p>2;){switch(o[m]){case 106:n.ac3!==!0?P.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=f,i.segmentAudioCodec="ac3");break}var y=o[m+1]+2;m+=y,p-=y}break;case 194:case 135:return hn(r,new Error("Unsupported EC-3 in M2TS found")),i;case 36:return hn(r,new Error("Unsupported HEVC in M2TS found")),i}a+=v+5}return i}function hn(o,a,n){P.warn("parsing error: "+a.message),o.emit(A.ERROR,A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:a,reason:a.message})}function Kn(o){P.log(o+" with AES-128-CBC encryption found in unencrypted stream")}function Di(o){var a=0,n,e,r,i,s,l=o.data;if(!o||o.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Be(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(e=(n[4]<<8)+n[5],e&&e>o.size-6)return null;var d=n[7];d&192&&(i=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,d&64?(s=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,i-s>60*9e4&&(P.warn(Math.round((i-s)/9e4)+"s delta between PTS and DTS, align them"),i=s)):s=i),r=n[8];var f=r+9;if(o.size<=f)return null;o.size-=f;for(var v=new Uint8Array(o.size),m=0,p=l.length;m<p;m++){n=l[m];var y=n.byteLength;if(f)if(f>y){f-=y;continue}else n=n.subarray(f),y-=f,f=0;v.set(n,a),a+=y}return e&&(e-=r+3),{data:v,pts:i,dts:s,len:e}}return null}var vl=function(o){ie(a,o);function a(){return o.apply(this,arguments)||this}var n=a.prototype;return n.resetInitSegment=function(r,i,s,l){o.prototype.resetInitSegment.call(this,r,i,s,l),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:l,inputTimeScale:9e4,dropped:0}},a.probe=function(r){if(!r)return!1;var i=Xe(r,0),s=i?.length||0;if(i&&r[s]===11&&r[s+1]===119&&lt(i)!==void 0&&$a(r,s)<=16)return!1;for(var l=r.length;s<l;s++)if(Ya(r,s))return P.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(r,i){return il(r,i)},n.appendFrame=function(r,i,s){if(this.basePTS!==null)return Ka(r,i,s,this.basePTS,this.frameIndex)},a}(Gn),Ja=function(){function o(){}return o.getSilentFrame=function(n,e){switch(n){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},o}(),ii=Math.pow(2,32)-1,er=function(){function o(){}return o.init=function(){o.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var n;for(n in o.types)o.types.hasOwnProperty(n)&&(o.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);o.HDLR_TYPES={video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);o.STTS=o.STSC=o.STCO=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),o.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),o.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),i=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);o.FTYP=o.box(o.types.ftyp,r,s,r,i),o.DINF=o.box(o.types.dinf,o.box(o.types.dref,e))},o.box=function(n){for(var e=8,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(var l=i.length,d=l;l--;)e+=i[l].byteLength;var f=new Uint8Array(e);for(f[0]=e>>24&255,f[1]=e>>16&255,f[2]=e>>8&255,f[3]=e&255,f.set(n,4),l=0,e=8;l<d;l++)f.set(i[l],e),e+=i[l].byteLength;return f},o.hdlr=function(n){return o.box(o.types.hdlr,o.HDLR_TYPES[n])},o.mdat=function(n){return o.box(o.types.mdat,n)},o.mdhd=function(n,e){e*=n;var r=Math.floor(e/(ii+1)),i=Math.floor(e%(ii+1));return o.box(o.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))},o.mdia=function(n){return o.box(o.types.mdia,o.mdhd(n.timescale,n.duration),o.hdlr(n.type),o.minf(n))},o.mfhd=function(n){return o.box(o.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255]))},o.minf=function(n){return n.type==="audio"?o.box(o.types.minf,o.box(o.types.smhd,o.SMHD),o.DINF,o.stbl(n)):o.box(o.types.minf,o.box(o.types.vmhd,o.VMHD),o.DINF,o.stbl(n))},o.moof=function(n,e,r){return o.box(o.types.moof,o.mfhd(n),o.traf(r,e))},o.moov=function(n){for(var e=n.length,r=[];e--;)r[e]=o.trak(n[e]);return o.box.apply(null,[o.types.moov,o.mvhd(n[0].timescale,n[0].duration)].concat(r).concat(o.mvex(n)))},o.mvex=function(n){for(var e=n.length,r=[];e--;)r[e]=o.trex(n[e]);return o.box.apply(null,[o.types.mvex].concat(r))},o.mvhd=function(n,e){e*=n;var r=Math.floor(e/(ii+1)),i=Math.floor(e%(ii+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o.box(o.types.mvhd,s)},o.sdtp=function(n){var e=n.samples||[],r=new Uint8Array(4+e.length),i,s;for(i=0;i<e.length;i++)s=e[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return o.box(o.types.sdtp,r)},o.stbl=function(n){return o.box(o.types.stbl,o.stsd(n),o.box(o.types.stts,o.STTS),o.box(o.types.stsc,o.STSC),o.box(o.types.stsz,o.STSZ),o.box(o.types.stco,o.STCO))},o.avc1=function(n){var e=[],r=[],i,s,l;for(i=0;i<n.sps.length;i++)s=n.sps[i],l=s.byteLength,e.push(l>>>8&255),e.push(l&255),e=e.concat(Array.prototype.slice.call(s));for(i=0;i<n.pps.length;i++)s=n.pps[i],l=s.byteLength,r.push(l>>>8&255),r.push(l&255),r=r.concat(Array.prototype.slice.call(s));var d=o.box(o.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|n.sps.length].concat(e).concat([n.pps.length]).concat(r))),f=n.width,v=n.height,m=n.pixelRatio[0],p=n.pixelRatio[1];return o.box(o.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,v>>8&255,v&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,o.box(o.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),o.box(o.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,p>>24,p>>16&255,p>>8&255,p&255])))},o.esds=function(n){var e=n.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(n.config).concat([6,1,2]))},o.audioStsd=function(n){var e=n.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0])},o.mp4a=function(n){return o.box(o.types.mp4a,o.audioStsd(n),o.box(o.types.esds,o.esds(n)))},o.mp3=function(n){return o.box(o.types[".mp3"],o.audioStsd(n))},o.ac3=function(n){return o.box(o.types["ac-3"],o.audioStsd(n),o.box(o.types.dac3,n.config))},o.stsd=function(n){return n.type==="audio"?n.segmentCodec==="mp3"&&n.codec==="mp3"?o.box(o.types.stsd,o.STSD,o.mp3(n)):n.segmentCodec==="ac3"?o.box(o.types.stsd,o.STSD,o.ac3(n)):o.box(o.types.stsd,o.STSD,o.mp4a(n)):o.box(o.types.stsd,o.STSD,o.avc1(n))},o.tkhd=function(n){var e=n.id,r=n.duration*n.timescale,i=n.width,s=n.height,l=Math.floor(r/(ii+1)),d=Math.floor(r%(ii+1));return o.box(o.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))},o.traf=function(n,e){var r=o.sdtp(n),i=n.id,s=Math.floor(e/(ii+1)),l=Math.floor(e%(ii+1));return o.box(o.types.traf,o.box(o.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),o.box(o.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,l>>24,l>>16&255,l>>8&255,l&255])),o.trun(n,r.length+16+20+8+16+8+8),r)},o.trak=function(n){return n.duration=n.duration||4294967295,o.box(o.types.trak,o.tkhd(n),o.mdia(n))},o.trex=function(n){var e=n.id;return o.box(o.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},o.trun=function(n,e){var r=n.samples||[],i=r.length,s=12+16*i,l=new Uint8Array(s),d,f,v,m,p,y;for(e+=8+s,l.set([n.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),d=0;d<i;d++)f=r[d],v=f.duration,m=f.size,p=f.flags,y=f.cts,l.set([v>>>24&255,v>>>16&255,v>>>8&255,v&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*d);return o.box(o.types.trun,l)},o.initSegment=function(n){o.types||o.init();var e=o.moov(n);return Be(o.FTYP,e)},o}();er.types=void 0,er.HDLR_TYPES=void 0,er.STTS=void 0,er.STSC=void 0,er.STCO=void 0,er.STSZ=void 0,er.VMHD=void 0,er.SMHD=void 0,er.STSD=void 0,er.FTYP=void 0,er.DINF=void 0;var Za=9e4;function jn(o,a,n,e){n===void 0&&(n=1),e===void 0&&(e=!1);var r=o*a*n;return e?Math.round(r):r}function ml(o,a,n,e){return n===void 0&&(n=1),e===void 0&&(e=!1),jn(o,a,1/n,e)}function zi(o,a){return a===void 0&&(a=!1),jn(o,1e3,1/Za,a)}function gl(o,a){return a===void 0&&(a=1),jn(o,Za,1/a)}var yl=10*1e3,es=1024,El=1152,_l=1536,Oi=null,Wn=null,vn=function(){function o(n,e,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=n,this.config=e,this.typeSupported=r,this.ISGenerated=!1,Oi===null){var s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Oi=s?parseInt(s[1]):0}if(Wn===null){var l=navigator.userAgent.match(/Safari\/(\d+)/i);Wn=l?parseInt(l[1]):0}}var a=o.prototype;return a.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},a.resetTimeStamp=function(e){P.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},a.resetNextTimestamp=function(){P.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){P.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},a.getVideoStartPts=function(e){var r=!1,i=e.reduce(function(s,l){var d=l.pts-s;return d<-4294967296?(r=!0,Ar(s,l.pts)):d>0?s:l.pts},e[0].pts);return r&&P.debug("PTS rollover detected"),i},a.remux=function(e,r,i,s,l,d,f,v){var m,p,y,_,b,T,w=l,I=l,D=e.pid>-1,N=r.pid>-1,F=r.samples.length,V=e.samples.length>0,G=f&&F>0||F>1;if((!D||V)&&(!N||G)||this.ISGenerated||f){if(this.ISGenerated){var B,H,Y,J,j=this.videoTrackConfig;j&&(r.width!==j.width||r.height!==j.height||((B=r.pixelRatio)==null?void 0:B[0])!==((H=j.pixelRatio)==null?void 0:H[0])||((Y=r.pixelRatio)==null?void 0:Y[1])!==((J=j.pixelRatio)==null?void 0:J[1]))&&this.resetInitSegment()}else y=this.generateIS(e,r,l,d);var me=this.isVideoContiguous,Re=-1,Te;if(G&&(Re=Sl(r.samples),!me&&this.config.forceKeyFrameOnDiscontinuity))if(T=!0,Re>0){P.warn("[mp4-remuxer]: Dropped "+Re+" out of "+F+" video samples due to a missing keyframe");var Qe=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(Re),r.dropped+=Re,I+=(r.samples[0].pts-Qe)/r.inputTimeScale,Te=I}else Re===-1&&(P.warn("[mp4-remuxer]: No keyframe found out of "+F+" video samples"),T=!1);if(this.ISGenerated){if(V&&G){var Ue=this.getVideoStartPts(r.samples),qe=(Ar(e.samples[0].pts,Ue)-Ue)/r.inputTimeScale;w+=Math.max(0,qe),I+=Math.max(0,-qe)}if(V){if(e.samplerate||(P.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),y=this.generateIS(e,r,l,d)),p=this.remuxAudio(e,w,this.isAudioContiguous,d,N||G||v===fe.AUDIO?I:void 0),G){var He=p?p.endPTS-p.startPTS:0;r.inputTimeScale||(P.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),y=this.generateIS(e,r,l,d)),m=this.remuxVideo(r,I,me,He)}}else G&&(m=this.remuxVideo(r,I,me,0));m&&(m.firstKeyFrame=Re,m.independent=Re!==-1,m.firstKeyFramePTS=Te)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(b=ts(i,l,this._initPTS,this._initDTS)),s.samples.length&&(_=rs(s,l,this._initPTS))),{audio:p,video:m,initSegment:y,independent:T,text:_,id3:b}},a.generateIS=function(e,r,i,s){var l=e.samples,d=r.samples,f=this.typeSupported,v={},m=this._initPTS,p=!m||s,y="audio/mp4",_,b,T;if(p&&(_=b=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":f.mpeg?(y="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}v.audio={id:"audio",container:y,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):er.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(T=e.inputTimeScale,!m||T!==m.timescale?_=b=l[0].pts-Math.round(T*i):p=!1)}if(r.sps&&r.pps&&d.length){if(r.timescale=r.inputTimeScale,v.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:er.initSegment([r]),metadata:{width:r.width,height:r.height}},p)if(T=r.inputTimeScale,!m||T!==m.timescale){var w=this.getVideoStartPts(d),I=Math.round(T*i);b=Math.min(b,Ar(d[0].dts,w)-I),_=Math.min(_,w-I)}else p=!1;this.videoTrackConfig={width:r.width,height:r.height,pixelRatio:r.pixelRatio}}if(Object.keys(v).length)return this.ISGenerated=!0,p?(this._initPTS={baseTime:_,timescale:T},this._initDTS={baseTime:b,timescale:T}):_=T=void 0,{tracks:v,initPTS:_,timescale:T}},a.remuxVideo=function(e,r,i,s){var l=e.inputTimeScale,d=e.samples,f=[],v=d.length,m=this._initPTS,p=this.nextAvcDts,y=8,_=this.videoSampleDuration,b,T,w=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,D=!1;if(!i||p===null){var N=r*l,F=d[0].pts-Ar(d[0].dts,d[0].pts);Oi&&p!==null&&Math.abs(N-F-p)<15e3?i=!0:p=N-F}for(var V=m.baseTime*l/m.timescale,G=0;G<v;G++){var B=d[G];B.pts=Ar(B.pts-V,p),B.dts=Ar(B.dts-V,p),B.dts<d[G>0?G-1:G].dts&&(D=!0)}D&&d.sort(function(Rn,to){var kc=Rn.dts-to.dts,Cc=Rn.pts-to.pts;return kc||Cc}),b=d[0].dts,T=d[d.length-1].dts;var H=T-b,Y=H?Math.round(H/(v-1)):_||e.inputTimeScale/30;if(i){var J=b-p,j=J>Y,me=J<-1;if((j||me)&&(j?P.warn("AVC: "+zi(J,!0)+" ms ("+J+"dts) hole between fragments detected at "+r.toFixed(3)):P.warn("AVC: "+zi(-J,!0)+" ms ("+J+"dts) overlapping between fragments detected at "+r.toFixed(3)),!me||p>=d[0].pts||Oi)){b=p;var Re=d[0].pts-J;if(j)d[0].dts=b,d[0].pts=Re;else for(var Te=0;Te<d.length&&!(d[Te].dts>Re);Te++)d[Te].dts-=J,d[Te].pts-=J;P.log("Video: Initial PTS/DTS adjusted: "+zi(Re,!0)+"/"+zi(b,!0)+", delta: "+zi(J,!0)+" ms")}}b=Math.max(0,b);for(var Qe=0,Ue=0,qe=b,He=0;He<v;He++){for(var ze=d[He],at=ze.units,qt=at.length,Bt=0,tr=0;tr<qt;tr++)Bt+=at[tr].data.length;Ue+=Bt,Qe+=qt,ze.length=Bt,ze.dts<qe?(ze.dts=qe,qe+=Y/4|0||1):qe=ze.dts,w=Math.min(ze.pts,w),I=Math.max(ze.pts,I)}T=d[v-1].dts;var Ht=Ue+4*Qe+8,gt;try{gt=new Uint8Array(Ht)}catch(Rn){this.observer.emit(A.ERROR,A.ERROR,{type:re.MUX_ERROR,details:U.REMUX_ALLOC_ERROR,fatal:!1,error:Rn,bytes:Ht,reason:"fail allocating video mdat "+Ht});return}var ur=new DataView(gt.buffer);ur.setUint32(0,Ht),gt.set(er.types.mdat,4);for(var Sr=!1,ut=Number.POSITIVE_INFINITY,cr=Number.POSITIVE_INFINITY,Er=Number.NEGATIVE_INFINITY,dr=Number.NEGATIVE_INFINITY,Yt=0;Yt<v;Yt++){for(var St=d[Yt],Jr=St.units,Or=0,Zr=0,oi=Jr.length;Zr<oi;Zr++){var Ki=Jr[Zr],gi=Ki.data,ma=Ki.data.byteLength;ur.setUint32(y,ma),y+=4,gt.set(gi,y),y+=ma,Or+=4+ma}var An=void 0;if(Yt<v-1)_=d[Yt+1].dts-St.dts,An=d[Yt+1].pts-St.pts;else{var Qs=this.config,Ln=Yt>0?St.dts-d[Yt-1].dts:Y;if(An=Yt>0?St.pts-d[Yt-1].pts:Y,Qs.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ac=Math.floor(Qs.maxBufferHole*l),ga=(s?w+s*l:this.nextAudioPts)-St.pts;ga>Ac?(_=ga-Ln,_<0?_=Ln:Sr=!0,P.log("[mp4-remuxer]: It is approximately "+ga/90+" ms to the next segment; using duration "+_/90+" ms for the last video frame.")):_=Ln}else _=Ln}var Lc=Math.round(St.pts-St.dts);ut=Math.min(ut,_),Er=Math.max(Er,_),cr=Math.min(cr,An),dr=Math.max(dr,An),f.push(new is(St.key,_,Or,Lc))}if(f.length){if(Oi){if(Oi<70){var Js=f[0].flags;Js.dependsOn=2,Js.isNonSync=0}}else if(Wn&&dr-cr<Er-ut&&Y/Er<.025&&f[0].cts===0){P.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var pa=b,Pr=0,Zs=f.length;Pr<Zs;Pr++){var eo=pa+f[Pr].duration,Rc=pa+f[Pr].cts;if(Pr<Zs-1){var wc=eo+f[Pr+1].cts;f[Pr].duration=wc-Rc}else f[Pr].duration=Pr?f[Pr-1].duration:Y;f[Pr].cts=0,pa=eo}}}_=Sr||!_?Y:_,this.nextAvcDts=p=T+_,this.videoSampleDuration=_,this.isVideoContiguous=!0;var Ic={data1:er.moof(e.sequenceNumber++,b,X({},e,{samples:f})),data2:gt,startPTS:w/l,endPTS:(I+_)/l,startDTS:b/l,endDTS:p/l,type:"video",hasAudio:!1,hasVideo:!0,nb:f.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Ic},a.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return El;case"ac3":return _l;default:return es}},a.remuxAudio=function(e,r,i,s,l){var d=e.inputTimeScale,f=d/(e.samplerate?e.samplerate:d),v=this.getSamplesPerFrame(e),m=v*f,p=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,_=[],b=l!==void 0,T=e.samples,w=y?0:8,I=this.nextAudioPts||-1,D=r*d,N=p.baseTime*d/p.timescale;if(this.isAudioContiguous=i=i||T.length&&I>0&&(s&&Math.abs(D-I)<9e3||Math.abs(Ar(T[0].pts-N,D)-I)<20*m),T.forEach(function(St){St.pts=Ar(St.pts-N,D)}),!i||I<0){if(T=T.filter(function(St){return St.pts>=0}),!T.length)return;l===0?I=0:s&&!b?I=Math.max(0,D):I=T[0].pts}if(e.segmentCodec==="aac")for(var F=this.config.maxAudioFramesDrift,V=0,G=I;V<T.length;V++){var B=T[V],H=B.pts,Y=H-G,J=Math.abs(1e3*Y/d);if(Y<=-F*m&&b)V===0&&(P.warn("Audio frame @ "+(H/d).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Y/d)+" ms."),this.nextAudioPts=I=G=H);else if(Y>=F*m&&J<yl&&b){var j=Math.round(Y/m);G=H-j*m,G<0&&(j--,G+=m),V===0&&(this.nextAudioPts=I=G),P.warn("[mp4-remuxer]: Injecting "+j+" audio frame @ "+(G/d).toFixed(3)+"s due to "+Math.round(1e3*Y/d)+" ms gap.");for(var me=0;me<j;me++){var Re=Math.max(G,0),Te=Ja.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Te||(P.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=B.unit.subarray()),T.splice(V,0,{unit:Te,pts:Re}),G+=m,V++}}B.pts=G,G+=m}for(var Qe=null,Ue=null,qe,He=0,ze=T.length;ze--;)He+=T[ze].unit.byteLength;for(var at=0,qt=T.length;at<qt;at++){var Bt=T[at],tr=Bt.unit,Ht=Bt.pts;if(Ue!==null){var gt=_[at-1];gt.duration=Math.round((Ht-Ue)/f)}else if(i&&e.segmentCodec==="aac"&&(Ht=I),Qe=Ht,He>0){He+=w;try{qe=new Uint8Array(He)}catch(St){this.observer.emit(A.ERROR,A.ERROR,{type:re.MUX_ERROR,details:U.REMUX_ALLOC_ERROR,fatal:!1,error:St,bytes:He,reason:"fail allocating audio mdat "+He});return}y||(new DataView(qe.buffer).setUint32(0,He),qe.set(er.types.mdat,4))}else return;qe.set(tr,w);var ur=tr.byteLength;w+=ur,_.push(new is(!0,v,ur,0)),Ue=Ht}var Sr=_.length;if(Sr){var ut=_[_.length-1];this.nextAudioPts=I=Ue+f*ut.duration;var cr=y?new Uint8Array(0):er.moof(e.sequenceNumber++,Qe/f,X({},e,{samples:_}));e.samples=[];var Er=Qe/d,dr=I/d,Yt={data1:cr,data2:qe,startPTS:Er,endPTS:dr,startDTS:Er,endDTS:dr,type:"audio",hasAudio:!0,hasVideo:!1,nb:Sr};return this.isAudioContiguous=!0,Yt}},a.remuxEmptyAudio=function(e,r,i,s){var l=e.inputTimeScale,d=l/(e.samplerate?e.samplerate:l),f=this.nextAudioPts,v=this._initDTS,m=v.baseTime*9e4/v.timescale,p=(f!==null?f:s.startDTS*l)+m,y=s.endDTS*l+m,_=d*es,b=Math.ceil((y-p)/_),T=Ja.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(P.warn("[mp4-remuxer]: remux empty Audio"),!T){P.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],I=0;I<b;I++){var D=p+I*_;w.push({unit:T,pts:D,dts:D})}return e.samples=w,this.remuxAudio(e,r,i,!1)},o}();function Ar(o,a){var n;if(a===null)return o;for(a<o?n=-8589934592:n=8589934592;Math.abs(o-a)>4294967296;)o+=n;return o}function Sl(o){for(var a=0;a<o.length;a++)if(o[a].key)return a;return-1}function ts(o,a,n,e){var r=o.samples.length;if(r){for(var i=o.inputTimeScale,s=0;s<r;s++){var l=o.samples[s];l.pts=Ar(l.pts-n.baseTime*i/n.timescale,a*i)/i,l.dts=Ar(l.dts-e.baseTime*i/e.timescale,a*i)/i}var d=o.samples;return o.samples=[],{samples:d}}}function rs(o,a,n){var e=o.samples.length;if(e){for(var r=o.inputTimeScale,i=0;i<e;i++){var s=o.samples[i];s.pts=Ar(s.pts-n.baseTime*r/n.timescale,a*r)/r}o.samples.sort(function(d,f){return d.pts-f.pts});var l=o.samples;return o.samples=[],{samples:l}}}var is=function(a,n,e,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=e,this.cts=r,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}},Tl=function(){function o(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var a=o.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},a.resetNextTimestamp=function(){this.lastEndTime=null},a.resetInitSegment=function(e,r,i,s){this.audioCodec=r,this.videoCodec=i,this.generateInitSegment(mt(e,s)),this.emitInitSegment=!0},a.generateInitSegment=function(e){var r=this.audioCodec,i=this.videoCodec;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var s=this.initData=Xt(e);s.audio&&(r=ns(s.audio,Ce.AUDIO)),s.video&&(i=ns(s.video,Ce.VIDEO));var l={};s.audio&&s.video?l.audiovideo={container:"video/mp4",codec:r+","+i,initSegment:e,id:"main"}:s.audio?l.audio={container:"audio/mp4",codec:r,initSegment:e,id:"audio"}:s.video?l.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:P.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=l},a.remux=function(e,r,i,s,l,d){var f,v,m=this.initPTS,p=this.lastEndTime,y={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};ne(p)||(p=this.lastEndTime=l||0);var _=r.samples;if(!(_!=null&&_.length))return y;var b={initPTS:void 0,timescale:1},T=this.initData;if((f=T)!=null&&f.length||(this.generateInitSegment(_),T=this.initData),!((v=T)!=null&&v.length))return P.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),y;this.emitInitSegment&&(b.tracks=this.initTracks,this.emitInitSegment=!1);var w=kt(_,T),I=tt(T,_),D=I===null?l:I;(bl(m,D,l,w)||b.timescale!==m.timescale&&d)&&(b.initPTS=D-l,m&&m.timescale===1&&P.warn("Adjusting initPTS by "+(b.initPTS-m.baseTime)),this.initPTS=m={baseTime:b.initPTS,timescale:1});var N=e?D-m.baseTime/m.timescale:p,F=N+w;Tt(T,_,m.baseTime/m.timescale),w>0?this.lastEndTime=F:(P.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var V=!!T.audio,G=!!T.video,B="";V&&(B+="audio"),G&&(B+="video");var H={data1:_,startPTS:N,startDTS:N,endPTS:F,endDTS:F,type:B,hasAudio:V,hasVideo:G,nb:1,dropped:0};return y.audio=H.type==="audio"?H:void 0,y.video=H.type!=="audio"?H:void 0,y.initSegment=b,y.id3=ts(i,l,m,m),s.samples.length&&(y.text=rs(s,l,m)),y},o}();function bl(o,a,n,e){if(o===null)return!0;var r=Math.max(e,1),i=a-o.baseTime/o.timescale;return Math.abs(i-n)>r}function ns(o,a){var n=o?.codec;if(n&&n.length>4)return n;if(a===Ce.AUDIO){if(n==="ec-3"||n==="ac-3"||n==="alac")return n;if(n==="fLaC"||n==="Opus")return mr(n,!1);var e="mp4a.40.5";return P.info('Parsed audio codec "'+n+'" or audio object type not handled. Using "'+e+'"'),e}return P.warn('Unhandled video codec "'+n+'"'),n==="hvc1"||n==="hev1"?"hvc1.1.6.L120.90":n==="av01"?"av01.0.04M.08":"avc1.42e01e"}var Xr;try{Xr=self.performance.now.bind(self.performance)}catch{P.debug("Unable to use Performance API on this environment"),Xr=Hr?.Date.now}var mn=[{demux:sl,remux:Tl},{demux:dl,remux:vn},{demux:nl,remux:vn},{demux:vl,remux:vn}];mn.splice(2,0,{demux:ol,remux:vn});var Yn=function(){function o(n,e,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=n,this.typeSupported=e,this.config=r,this.vendor=i,this.id=s}var a=o.prototype;return a.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},a.push=function(e,r,i,s){var l=this,d=i.transmuxing;d.executeStart=Xr();var f=new Uint8Array(e),v=this.currentTransmuxState,m=this.transmuxConfig;s&&(this.currentTransmuxState=s);var p=s||v,y=p.contiguous,_=p.discontinuity,b=p.trackSwitch,T=p.accurateTimeOffset,w=p.timeOffset,I=p.initSegmentChange,D=m.audioCodec,N=m.videoCodec,F=m.defaultInitPts,V=m.duration,G=m.initSegmentData,B=Al(f,r);if(B&&B.method==="AES-128"){var H=this.getDecrypter();if(H.isSync()){var Y=H.softwareDecrypt(f,B.key.buffer,B.iv.buffer);if(i.part>-1&&(Y=H.flush()),!Y)return d.executeEnd=Xr(),$n(i);f=new Uint8Array(Y)}else return this.decryptionPromise=H.webCryptoDecrypt(f,B.key.buffer,B.iv.buffer).then(function(Te){var Qe=l.push(Te,null,i);return l.decryptionPromise=null,Qe}),this.decryptionPromise}var J=this.needsProbing(_,b);if(J){var j=this.configureTransmuxer(f);if(j)return P.warn("[transmuxer] "+j.message),this.observer.emit(A.ERROR,A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,fatal:!1,error:j,reason:j.message}),d.executeEnd=Xr(),$n(i)}(_||b||I||J)&&this.resetInitSegment(G,D,N,V,r),(_||I||J)&&this.resetInitialTimestamp(F),y||this.resetContiguity();var me=this.transmux(f,B,w,T,i),Re=this.currentTransmuxState;return Re.contiguous=!0,Re.discontinuity=!1,Re.trackSwitch=!1,d.executeEnd=Xr(),me},a.flush=function(e){var r=this,i=e.transmuxing;i.executeStart=Xr();var s=this.decrypter,l=this.currentTransmuxState,d=this.decryptionPromise;if(d)return d.then(function(){return r.flush(e)});var f=[],v=l.timeOffset;if(s){var m=s.flush();m&&f.push(this.push(m,null,e))}var p=this.demuxer,y=this.remuxer;if(!p||!y)return i.executeEnd=Xr(),[$n(e)];var _=p.flush(v);return hi(_)?_.then(function(b){return r.flushRemux(f,b,e),f}):(this.flushRemux(f,_,e),f)},a.flushRemux=function(e,r,i){var s=r.audioTrack,l=r.videoTrack,d=r.id3Track,f=r.textTrack,v=this.currentTransmuxState,m=v.accurateTimeOffset,p=v.timeOffset;P.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var y=this.remuxer.remux(s,l,d,f,p,m,!0,this.id);e.push({remuxResult:y,chunkMeta:i}),i.transmuxing.executeEnd=Xr()},a.resetInitialTimestamp=function(e){var r=this.demuxer,i=this.remuxer;!r||!i||(r.resetTimeStamp(e),i.resetTimeStamp(e))},a.resetContiguity=function(){var e=this.demuxer,r=this.remuxer;!e||!r||(e.resetContiguity(),r.resetNextTimestamp())},a.resetInitSegment=function(e,r,i,s,l){var d=this.demuxer,f=this.remuxer;!d||!f||(d.resetInitSegment(e,r,i,s),f.resetInitSegment(e,r,i,l))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(e,r,i,s,l){var d;return r&&r.method==="SAMPLE-AES"?d=this.transmuxSampleAes(e,r,i,s,l):d=this.transmuxUnencrypted(e,i,s,l),d},a.transmuxUnencrypted=function(e,r,i,s){var l=this.demuxer.demux(e,r,!1,!this.config.progressive),d=l.audioTrack,f=l.videoTrack,v=l.id3Track,m=l.textTrack;return{remuxResult:this.remuxer.remux(d,f,v,m,r,i,!1,this.id),chunkMeta:s}},a.transmuxSampleAes=function(e,r,i,s,l){var d=this;return this.demuxer.demuxSampleAes(e,r,i).then(function(f){return{remuxResult:d.remuxer.remux(f.audioTrack,f.videoTrack,f.id3Track,f.textTrack,i,s,!1,d.id),chunkMeta:l}})},a.configureTransmuxer=function(e){for(var r=this.config,i=this.observer,s=this.typeSupported,l=this.vendor,d,f=0,v=mn.length;f<v;f++){var m;if((m=mn[f].demux)!=null&&m.probe(e)){d=mn[f];break}}if(!d)return new Error("Failed to find demuxer by probing fragment data");var p=this.demuxer,y=this.remuxer,_=d.remux,b=d.demux;(!y||!(y instanceof _))&&(this.remuxer=new _(i,r,s,l)),(!p||!(p instanceof b))&&(this.demuxer=new b(i,r,s),this.probe=b.probe)},a.needsProbing=function(e,r){return!this.demuxer||!this.remuxer||e||r},a.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new Un(this.config)),e},o}();function Al(o,a){var n=null;return o.byteLength>0&&a?.key!=null&&a.iv!==null&&a.method!=null&&(n=a),n}var $n=function(a){return{remuxResult:{},chunkMeta:a}};function hi(o){return"then"in o&&o.then instanceof Function}var Ll=function(a,n,e,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=n,this.initSegmentData=e,this.duration=r,this.defaultInitPts=i||null},Rl=function(a,n,e,r,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=a,this.contiguous=n,this.accurateTimeOffset=e,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=s},ss={exports:{}};(function(o){var a=Object.prototype.hasOwnProperty,n="~";function e(){}Object.create&&(e.prototype=Object.create(null),new e().__proto__||(n=!1));function r(d,f,v){this.fn=d,this.context=f,this.once=v||!1}function i(d,f,v,m,p){if(typeof v!="function")throw new TypeError("The listener must be a function");var y=new r(v,m||d,p),_=n?n+f:f;return d._events[_]?d._events[_].fn?d._events[_]=[d._events[_],y]:d._events[_].push(y):(d._events[_]=y,d._eventsCount++),d}function s(d,f){--d._eventsCount===0?d._events=new e:delete d._events[f]}function l(){this._events=new e,this._eventsCount=0}l.prototype.eventNames=function(){var f=[],v,m;if(this._eventsCount===0)return f;for(m in v=this._events)a.call(v,m)&&f.push(n?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(v)):f},l.prototype.listeners=function(f){var v=n?n+f:f,m=this._events[v];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,y=m.length,_=new Array(y);p<y;p++)_[p]=m[p].fn;return _},l.prototype.listenerCount=function(f){var v=n?n+f:f,m=this._events[v];return m?m.fn?1:m.length:0},l.prototype.emit=function(f,v,m,p,y,_){var b=n?n+f:f;if(!this._events[b])return!1;var T=this._events[b],w=arguments.length,I,D;if(T.fn){switch(T.once&&this.removeListener(f,T.fn,void 0,!0),w){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,v),!0;case 3:return T.fn.call(T.context,v,m),!0;case 4:return T.fn.call(T.context,v,m,p),!0;case 5:return T.fn.call(T.context,v,m,p,y),!0;case 6:return T.fn.call(T.context,v,m,p,y,_),!0}for(D=1,I=new Array(w-1);D<w;D++)I[D-1]=arguments[D];T.fn.apply(T.context,I)}else{var N=T.length,F;for(D=0;D<N;D++)switch(T[D].once&&this.removeListener(f,T[D].fn,void 0,!0),w){case 1:T[D].fn.call(T[D].context);break;case 2:T[D].fn.call(T[D].context,v);break;case 3:T[D].fn.call(T[D].context,v,m);break;case 4:T[D].fn.call(T[D].context,v,m,p);break;default:if(!I)for(F=1,I=new Array(w-1);F<w;F++)I[F-1]=arguments[F];T[D].fn.apply(T[D].context,I)}}return!0},l.prototype.on=function(f,v,m){return i(this,f,v,m,!1)},l.prototype.once=function(f,v,m){return i(this,f,v,m,!0)},l.prototype.removeListener=function(f,v,m,p){var y=n?n+f:f;if(!this._events[y])return this;if(!v)return s(this,y),this;var _=this._events[y];if(_.fn)_.fn===v&&(!p||_.once)&&(!m||_.context===m)&&s(this,y);else{for(var b=0,T=[],w=_.length;b<w;b++)(_[b].fn!==v||p&&!_[b].once||m&&_[b].context!==m)&&T.push(_[b]);T.length?this._events[y]=T.length===1?T[0]:T:s(this,y)}return this},l.prototype.removeAllListeners=function(f){var v;return f?(v=n?n+f:f,this._events[v]&&s(this,v)):(this._events=new e,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,o.exports=l})(ss);var wl=ss.exports,gn=Pe(wl);typeof E<"u"&&E&&Il(self);function Il(o){var a=new gn,n=function(i,s){o.postMessage({event:i,data:s})};a.on(A.FRAG_DECRYPTED,n),a.on(A.ERROR,n);var e=function(){var i=function(d){P[d]=function(v){n("workerLog",{logType:d,message:v})}};for(var s in P)i(s)};o.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var s=JSON.parse(i.config);o.transmuxer=new Yn(a,i.typeSupported,s,"",i.id),z(s.debug,i.id),e(),n("init",null);break;case"configure":o.transmuxer.configure(i.config);break;case"demux":var l=o.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);hi(l)?(o.transmuxer.async=!0,l.then(function(v){Xn(o,v)}).catch(function(v){n(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:v,err:v,reason:"transmuxer-worker push error"})})):(o.transmuxer.async=!1,Xn(o,l));break;case"flush":var d=i.chunkMeta,f=o.transmuxer.flush(d);hi(f)||o.transmuxer.async?(hi(f)||(f=Promise.resolve(f)),f.then(function(v){ls(o,v,d)}).catch(function(v){n(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:v,err:v,reason:"transmuxer-worker flush error"})})):ls(o,f,d);break}})}function Xn(o,a){if(kl(a.remuxResult))return!1;var n=[],e=a.remuxResult,r=e.audio,i=e.video;return r&&os(n,r),i&&os(n,i),o.postMessage({event:"transmuxComplete",data:a},n),!0}function os(o,a){a.data1&&o.push(a.data1.buffer),a.data2&&o.push(a.data2.buffer)}function ls(o,a,n){a.reduce(function(e,r){return Xn(o,r)||e},!1)||o.postMessage({event:"transmuxComplete",data:a[0]}),o.postMessage({event:"flush",data:n})}function kl(o){return!o.audio&&!o.video&&!o.text&&!o.id3&&!o.initSegment}function Cl(){return typeof g=="function"}function Dl(){var o=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+g.toString()+")(true);"],{type:"text/javascript"}),a=self.URL.createObjectURL(o);return{worker:new self.Worker(a),objectURL:a}}function Ol(o){var a=new self.URL(o,self.location.href).href;return{worker:new self.Worker(a),scriptURL:a}}var us=function(){function o(n,e,r,i){var s=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var l=n.config;this.hls=n,this.id=e,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var d=function(y,_){_=_||{},_.frag=s.frag,_.id=s.id,y===A.ERROR&&(s.error=_.error),s.hls.trigger(y,_)};this.observer=new gn,this.observer.on(A.FRAG_DECRYPTED,d),this.observer.on(A.ERROR,d);var f=wr(l.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},v={mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:f.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(l.workerPath||Cl())){try{l.workerPath?(P.log("loading Web Worker "+l.workerPath+' for "'+e+'"'),this.workerContext=Ol(l.workerPath)):(P.log('injecting Web Worker for "'+e+'"'),this.workerContext=Dl()),this.onwmsg=function(p){return s.onWorkerMessage(p)};var m=this.workerContext.worker;m.addEventListener("message",this.onwmsg),m.onerror=function(p){var y=new Error(p.message+"  ("+p.filename+":"+p.lineno+")");l.enableWorker=!1,P.warn('Error in "'+e+'" Web Worker, fallback to inline'),s.hls.trigger(A.ERROR,{type:re.OTHER_ERROR,details:U.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:y})},m.postMessage({cmd:"init",typeSupported:v,vendor:"",id:e,config:JSON.stringify(l)})}catch(p){P.warn('Error setting up "'+e+'" Web Worker, fallback to inline',p),this.resetWorker(),this.error=null,this.transmuxer=new Yn(this.observer,v,l,"",e)}return}this.transmuxer=new Yn(this.observer,v,l,"",e)}var a=o.prototype;return a.resetWorker=function(){if(this.workerContext){var e=this.workerContext,r=e.worker,i=e.objectURL;i&&self.URL.revokeObjectURL(i),r.removeEventListener("message",this.onwmsg),r.onerror=null,r.terminate(),this.workerContext=null}},a.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},a.push=function(e,r,i,s,l,d,f,v,m,p){var y,_,b=this;m.transmuxing.start=self.performance.now();var T=this.transmuxer,w=d?d.start:l.start,I=l.decryptdata,D=this.frag,N=!(D&&l.cc===D.cc),F=!(D&&m.level===D.level),V=D?m.sn-D.sn:-1,G=this.part?m.part-this.part.index:-1,B=V===0&&m.id>1&&m.id===D?.stats.chunkCount,H=!F&&(V===1||V===0&&(G===1||B&&G<=0)),Y=self.performance.now();(F||V||l.stats.parsing.start===0)&&(l.stats.parsing.start=Y),d&&(G||!H)&&(d.stats.parsing.start=Y);var J=!(D&&((y=l.initSegment)==null?void 0:y.url)===((_=D.initSegment)==null?void 0:_.url)),j=new Rl(N,H,v,F,w,J);if(!H||N||J){P.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+m.sn+" p: "+m.part+" level: "+m.level+" id: "+m.id+`
        discontinuity: `+N+`
        trackSwitch: `+F+`
        contiguous: `+H+`
        accurateTimeOffset: `+v+`
        timeOffset: `+w+`
        initSegmentChange: `+J);var me=new Ll(i,s,r,f,p);this.configureTransmuxer(me)}if(this.frag=l,this.part=d,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:I,chunkMeta:m,state:j},e instanceof ArrayBuffer?[e]:[]);else if(T){var Re=T.push(e,I,m,j);hi(Re)?(T.async=!0,Re.then(function(Te){b.handleTransmuxComplete(Te)}).catch(function(Te){b.transmuxerError(Te,m,"transmuxer-interface push error")})):(T.async=!1,this.handleTransmuxComplete(Re))}},a.flush=function(e){var r=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(i){var s=i.flush(e);hi(s)||i.async?(hi(s)||(s=Promise.resolve(s)),s.then(function(l){r.handleFlushResult(l,e)}).catch(function(l){r.transmuxerError(l,e,"transmuxer-interface flush error")})):this.handleFlushResult(s,e)}},a.transmuxerError=function(e,r,i){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_PARSING_ERROR,chunkMeta:r,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:i}))},a.handleFlushResult=function(e,r){var i=this;e.forEach(function(s){i.handleTransmuxComplete(s)}),this.onFlush(r)},a.onWorkerMessage=function(e){var r=e.data;if(!(r!=null&&r.event)){P.warn("worker message received with no "+(r?"event name":"data"));return}var i=this.hls;if(this.hls)switch(r.event){case"init":var s,l=(s=this.workerContext)==null?void 0:s.objectURL;l&&self.URL.revokeObjectURL(l);break;case"transmuxComplete":this.handleTransmuxComplete(r.data);break;case"flush":this.onFlush(r.data);break;case"workerLog":P[r.data.logType]&&P[r.data.logType](r.data.message);break;default:r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,i.trigger(r.event,r.data);break}},a.configureTransmuxer=function(e){var r=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):r&&r.configure(e)},a.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},o}();function ds(o,a){if(o.length!==a.length)return!1;for(var n=0;n<o.length;n++)if(!Pi(o[n].attrs,a[n].attrs))return!1;return!0}function Pi(o,a,n){var e=o["STABLE-RENDITION-ID"];return e&&!n?e===a["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(r){return o[r]!==a[r]})}function Qn(o,a){return a.label.toLowerCase()===o.name.toLowerCase()&&(!a.language||a.language.toLowerCase()===(o.lang||"").toLowerCase())}var fs=100,Pl=function(o){ie(a,o);function a(e,r,i){var s=o.call(this,e,r,i,"[audio-stream-controller]",fe.AUDIO)||this;return s.videoBuffer=null,s.videoTrackCC=-1,s.waitingVideoCC=-1,s.bufferedTrack=null,s.switchingTrack=null,s.trackId=-1,s.waitingData=null,s.mainDetails=null,s.flushing=!1,s.bufferFlushed=!1,s.cachedTrackLoadedData=null,s._registerListeners(),s}var n=a.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),o.prototype.onHandlerDestroying.call(this),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},n._registerListeners=function(){var r=this.hls;r.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(A.ERROR,this.onError,this),r.on(A.BUFFER_RESET,this.onBufferReset,this),r.on(A.BUFFER_CREATED,this.onBufferCreated,this),r.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(A.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var r=this.hls;r.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(A.ERROR,this.onError,this),r.off(A.BUFFER_RESET,this.onBufferReset,this),r.off(A.BUFFER_CREATED,this.onBufferCreated,this),r.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(A.FRAG_BUFFERED,this.onFragBuffered,this)},n.onInitPtsFound=function(r,i){var s=i.frag,l=i.id,d=i.initPTS,f=i.timescale;if(l==="main"){var v=s.cc;this.initPTS[s.cc]={baseTime:d,timescale:f},this.log("InitPTS for cc: "+v+" found from main: "+d),this.videoTrackCC=v,this.state===Z.WAITING_INIT_PTS&&this.tick()}},n.startLoad=function(r){if(!this.levels){this.startPosition=r,this.state=Z.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(fs),i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),r=i,this.state=Z.IDLE):(this.loadedmetadata=!1,this.state=Z.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},n.doTick=function(){switch(this.state){case Z.IDLE:this.doTickIdle();break;case Z.WAITING_TRACK:var r,i=this.levels,s=this.trackId,l=i==null||(r=i[s])==null?void 0:r.details;if(l){if(this.waitForCdnTuneIn(l))break;this.state=Z.WAITING_INIT_PTS}break;case Z.FRAG_LOADING_WAITING_RETRY:var d,f=performance.now(),v=this.retryDate;if(!v||f>=v||(d=this.media)!=null&&d.seeking){var m=this.levels,p=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(m?.[p]||null),this.state=Z.IDLE}break;case Z.WAITING_INIT_PTS:var y=this.waitingData;if(y){var _=y.frag,b=y.part,T=y.cache,w=y.complete;if(this.initPTS[_.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Z.FRAG_LOADING;var I={frag:_,part:b,payload:T.flush(),networkDetails:null};this._handleFragmentLoadProgress(I),w&&o.prototype._handleFragmentLoadComplete.call(this,I)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+_.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var D=this.getLoadPosition(),N=Dt.bufferInfo(this.mediaBuffer,D,this.config.maxBufferHole);Fn(N.end,this.config.maxFragLookUpTolerance,_)<0&&(this.log("Waiting fragment cc ("+_.cc+") @ "+_.start+" cancelled because another fragment at "+N.end+" is needed"),this.clearWaitingFragment())}}else this.state=Z.IDLE}this.onTickEnd()},n.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Z.IDLE)},n.resetLoadingState=function(){this.clearWaitingFragment(),o.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var r=this.media;r!=null&&r.readyState&&(this.lastCurrentTime=r.currentTime)},n.doTickIdle=function(){var r=this.hls,i=this.levels,s=this.media,l=this.trackId,d=r.config;if(!(!s&&(this.startFragRequested||!d.startFragPrefetch)||!(i!=null&&i[l]))){var f=i[l],v=f.details;if(!v||v.live&&this.levelLastLoaded!==f||this.waitForCdnTuneIn(v)){this.state=Z.WAITING_TRACK;return}var m=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&m&&(this.bufferFlushed=!1,this.afterBufferFlushed(m,Ce.AUDIO,fe.AUDIO));var p=this.getFwdBufferInfo(m,fe.AUDIO);if(p!==null){var y=this.bufferedTrack,_=this.switchingTrack;if(!_&&this._streamEnded(p,v)){r.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=Z.ENDED;return}var b=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,fe.MAIN),T=p.len,w=this.getMaxBufferLength(b?.len),I=v.fragments,D=I[0].start,N=this.flushing?this.getLoadPosition():p.end;if(_&&s){var F=this.getLoadPosition();y&&!Pi(_.attrs,y.attrs)&&(N=F),v.PTSKnown&&F<D&&(p.end>D||p.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=D+.05)}if(!(T>=w&&!_&&N<I[I.length-1].start)){var V=this.getNextFragment(N,v),G=!1;if(V&&this.isLoopLoading(V,N)&&(G=!!V.gap,V=this.getNextFragmentLoopLoading(V,v,p,fe.MAIN,w)),!V){this.bufferFlushed=!0;return}var B=b&&V.start>b.end+v.targetduration;if(B||!(b!=null&&b.len)&&p.len){var H=this.getAppendedFrag(V.start,fe.MAIN);if(H===null||(G||(G=!!H.gap||!!B&&b.len===0),B&&!G||G&&p.nextStart&&p.nextStart<H.end))return}this.loadFragment(V,f,N)}}}},n.getMaxBufferLength=function(r){var i=o.prototype.getMaxBufferLength.call(this);return r?Math.min(Math.max(i,r),this.config.maxMaxBufferLength):i},n.onMediaDetaching=function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,o.prototype.onMediaDetaching.call(this)},n.onAudioTracksUpdated=function(r,i){var s=i.audioTracks;this.resetTransmuxer(),this.levels=s.map(function(l){return new Ri(l)})},n.onAudioTrackSwitching=function(r,i){var s=!!i.url;this.trackId=i.id;var l=this.fragCurrent;l&&(l.abortRequests(),this.removeUnbufferedFrags(l.start)),this.resetLoadingState(),s?this.setInterval(fs):this.resetTransmuxer(),s?(this.switchingTrack=i,this.state=Z.IDLE,this.flushAudioIfNeeded(i)):(this.switchingTrack=null,this.bufferedTrack=i,this.state=Z.STOPPED),this.tick()},n.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},n.onLevelLoaded=function(r,i){this.mainDetails=i.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(A.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},n.onAudioTrackLoaded=function(r,i){var s;if(this.mainDetails==null){this.cachedTrackLoadedData=i;return}var l=this.levels,d=i.details,f=i.id;if(!l){this.warn("Audio tracks were reset while loading level "+f);return}this.log("Audio track "+f+" loaded ["+d.startSN+","+d.endSN+"]"+(d.lastPartSn?"[part-"+d.lastPartSn+"-"+d.lastPartIndex+"]":"")+",duration:"+d.totalduration);var v=l[f],m=0;if(d.live||(s=v.details)!=null&&s.live){this.checkLiveUpdate(d);var p=this.mainDetails;if(d.deltaUpdateFailed||!p)return;if(!v.details&&d.hasProgramDateTime&&p.hasProgramDateTime)un(d,p),m=d.fragments[0].start;else{var y;m=this.alignPlaylists(d,v.details,(y=this.levelLastLoaded)==null?void 0:y.details)}}v.details=d,this.levelLastLoaded=v,!this.startFragRequested&&(this.mainDetails||!d.live)&&this.setStartPosition(this.mainDetails||d,m),this.state===Z.WAITING_TRACK&&!this.waitForCdnTuneIn(d)&&(this.state=Z.IDLE),this.tick()},n._handleFragmentLoadProgress=function(r){var i,s=r.frag,l=r.part,d=r.payload,f=this.config,v=this.trackId,m=this.levels;if(!m){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var p=m[v];if(!p){this.warn("Audio track is undefined on fragment load progress");return}var y=p.details;if(!y){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}var _=f.defaultAudioCodec||p.audioCodec||"mp4a.40.2",b=this.transmuxer;b||(b=this.transmuxer=new us(this.hls,fe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var T=this.initPTS[s.cc],w=(i=s.initSegment)==null?void 0:i.data;if(T!==void 0){var I=!1,D=l?l.index:-1,N=D!==-1,F=new Bn(s.level,s.sn,s.stats.chunkCount,d.byteLength,D,N);b.push(d,w,_,"",s,l,y.totalduration,I,F,T)}else this.log("Unknown video PTS for cc "+s.cc+", waiting for video PTS before demuxing audio frag "+s.sn+" of ["+y.startSN+" ,"+y.endSN+"],track "+v),(this.waitingData=this.waitingData||{frag:s,part:l,cache:new Ua,complete:!1}).cache.push(new Uint8Array(d)),this.waitingVideoCC=this.videoTrackCC,this.state=Z.WAITING_INIT_PTS},n._handleFragmentLoadComplete=function(r){if(this.waitingData){this.waitingData.complete=!0;return}o.prototype._handleFragmentLoadComplete.call(this,r)},n.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.onBufferCreated=function(r,i){var s=i.tracks.audio;s&&(this.mediaBuffer=s.buffer||null),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer||null)},n.onFragBuffered=function(r,i){var s=i.frag,l=i.part;if(s.type!==fe.AUDIO){if(!this.loadedmetadata&&s.type===fe.MAIN){var d=this.videoBuffer||this.media;d&&Dt.getBuffered(d).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(l?" p: "+l.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));return}if(s.sn!=="initSegment"){this.fragPrevious=s;var f=this.switchingTrack;f&&(this.bufferedTrack=f,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,R({},f)))}this.fragBufferedComplete(s,l)},n.onError=function(r,i){var s;if(i.fatal){this.state=Z.ERROR;return}switch(i.details){case U.FRAG_GAP:case U.FRAG_PARSING_ERROR:case U.FRAG_DECRYPT_ERROR:case U.FRAG_LOAD_ERROR:case U.FRAG_LOAD_TIMEOUT:case U.KEY_LOAD_ERROR:case U.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(fe.AUDIO,i);break;case U.AUDIO_TRACK_LOAD_ERROR:case U.AUDIO_TRACK_LOAD_TIMEOUT:case U.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===Z.WAITING_TRACK&&((s=i.context)==null?void 0:s.type)===_e.AUDIO_TRACK&&(this.state=Z.IDLE);break;case U.BUFFER_APPEND_ERROR:case U.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="audio")return;if(i.details===U.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(i)&&(this.bufferedTrack=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case U.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}},n.onBufferFlushing=function(r,i){i.type!==Ce.VIDEO&&(this.flushing=!0)},n.onBufferFlushed=function(r,i){var s=i.type;if(s!==Ce.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Z.ENDED&&(this.state=Z.IDLE);var l=this.mediaBuffer||this.media;l&&(this.afterBufferFlushed(l,s,fe.AUDIO),this.tick())}},n._handleTransmuxComplete=function(r){var i,s="audio",l=this.hls,d=r.remuxResult,f=r.chunkMeta,v=this.getCurrentContext(f);if(!v){this.resetWhenMissingContext(f);return}var m=v.frag,p=v.part,y=v.level,_=y.details,b=d.audio,T=d.text,w=d.id3,I=d.initSegment;if(this.fragContextChanged(m)||!_){this.fragmentTracker.removeFragment(m);return}if(this.state=Z.PARSING,this.switchingTrack&&b&&this.completeAudioSwitch(this.switchingTrack),I!=null&&I.tracks){var D=m.initSegment||m;this._bufferInitSegment(y,I.tracks,D,f),l.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:s,tracks:I.tracks})}if(b){var N=b.startPTS,F=b.endPTS,V=b.startDTS,G=b.endDTS;p&&(p.elementaryStreams[Ce.AUDIO]={startPTS:N,endPTS:F,startDTS:V,endDTS:G}),m.setElementaryStreamInfo(Ce.AUDIO,N,F,V,G),this.bufferFragmentData(b,m,p,f)}if(w!=null&&(i=w.samples)!=null&&i.length){var B=X({id:s,frag:m,details:_},w);l.trigger(A.FRAG_PARSING_METADATA,B)}if(T){var H=X({id:s,frag:m,details:_},T);l.trigger(A.FRAG_PARSING_USERDATA,H)}},n._bufferInitSegment=function(r,i,s,l){if(this.state===Z.PARSING){i.video&&delete i.video;var d=i.audio;if(d){d.id="audio";var f=r.audioCodec;this.log("Init audio buffer, container:"+d.container+", codecs[level/parsed]=["+f+"/"+d.codec+"]"),f&&f.split(",").length===1&&(d.levelCodec=f),this.hls.trigger(A.BUFFER_CODECS,i);var v=d.initSegment;if(v!=null&&v.byteLength){var m={type:"audio",frag:s,part:null,chunkMeta:l,parent:s.type,data:v};this.hls.trigger(A.BUFFER_APPENDING,m)}this.tickImmediate()}}},n.loadFragment=function(r,i,s){var l=this.fragmentTracker.getState(r);if(this.fragCurrent=r,this.switchingTrack||l===jt.NOT_LOADED||l===jt.PARTIAL){var d;if(r.sn==="initSegment")this._loadInitSegment(r,i);else if((d=i.details)!=null&&d.live&&!this.initPTS[r.cc]){this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=Z.WAITING_INIT_PTS;var f=this.mainDetails;f&&f.fragments[0].start!==i.details.fragments[0].start&&un(i.details,f)}else this.startFragRequested=!0,o.prototype.loadFragment.call(this,r,i,s)}else this.clearTrackerIfNeeded(r)},n.flushAudioIfNeeded=function(r){var i=this.media,s=this.bufferedTrack,l=s?.attrs,d=r.attrs;i&&l&&(l.CHANNELS!==d.CHANNELS||s.name!==r.name||s.lang!==r.lang)&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)},n.completeAudioSwitch=function(r){var i=this.hls;this.flushAudioIfNeeded(r),this.bufferedTrack=r,this.switchingTrack=null,i.trigger(A.AUDIO_TRACK_SWITCHED,R({},r))},a}(Vn),Ml=function(o){ie(a,o);function a(e){var r=o.call(this,e,"[audio-track-controller]")||this;return r.tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}var n=a.prototype;return n.registerListeners=function(){var r=this.hls;r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.MANIFEST_PARSED,this.onManifestParsed,this),r.on(A.LEVEL_LOADING,this.onLevelLoading,this),r.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(A.ERROR,this.onError,this)},n.unregisterListeners=function(){var r=this.hls;r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.MANIFEST_PARSED,this.onManifestParsed,this),r.off(A.LEVEL_LOADING,this.onLevelLoading,this),r.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(A.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,o.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(r,i){this.tracks=i.audioTracks||[]},n.onAudioTrackLoaded=function(r,i){var s=i.id,l=i.groupId,d=i.details,f=this.tracksInGroup[s];if(!f||f.groupId!==l){this.warn("Audio track with id:"+s+" and group:"+l+" not found in active group "+f?.groupId);return}var v=f.details;f.details=i.details,this.log("Audio track "+s+' "'+f.name+'" lang:'+f.lang+" group:"+l+" loaded ["+d.startSN+"-"+d.endSN+"]"),s===this.trackId&&this.playlistLoaded(s,i,v)},n.onLevelLoading=function(r,i){this.switchLevel(i.level)},n.onLevelSwitching=function(r,i){this.switchLevel(i.level)},n.switchLevel=function(r){var i=this.hls.levels[r];if(i){var s=i.audioGroups||null,l=this.groupIds,d=this.currentTrack;if(!s||l?.length!==s?.length||s!=null&&s.some(function(I){return l?.indexOf(I)===-1})){this.groupIds=s,this.trackId=-1,this.currentTrack=null;var f=this.tracks.filter(function(I){return!s||s.indexOf(I.groupId)!==-1});if(f.length)this.selectDefaultTrack&&!f.some(function(I){return I.default})&&(this.selectDefaultTrack=!1),f.forEach(function(I,D){I.id=D});else if(!d&&!this.tracksInGroup.length)return;this.tracksInGroup=f;var v=this.hls.config.audioPreference;if(!d&&v){var m=Ur(v,f,ki);if(m>-1)d=f[m];else{var p=Ur(v,this.tracks);d=this.tracks[p]}}var y=this.findTrackId(d);y===-1&&d&&(y=this.findTrackId(null));var _={audioTracks:f};this.log("Updating audio tracks, "+f.length+" track(s) found in group(s): "+s?.join(",")),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,_);var b=this.trackId;if(y!==-1&&b===-1)this.setAudioTrack(y);else if(f.length&&b===-1){var T,w=new Error("No audio track selected for current audio group-ID(s): "+((T=this.groupIds)==null?void 0:T.join(","))+" track count: "+f.length);this.warn(w.message),this.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:w})}}else this.shouldReloadPlaylist(d)&&this.setAudioTrack(this.trackId)}},n.onError=function(r,i){i.fatal||!i.context||i.context.type===_e.AUDIO_TRACK&&i.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(i.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(i))},n.setAudioOption=function(r){var i=this.hls;if(i.config.audioPreference=r,r){var s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){var l=this.currentTrack;if(l&&Ii(r,l,ki))return l;var d=Ur(r,this.tracksInGroup,ki);if(d>-1){var f=this.tracksInGroup[d];return this.setAudioTrack(d),f}else if(l){var v=i.loadLevel;v===-1&&(v=i.firstAutoLevel);var m=Co(r,i.levels,s,v,ki);if(m===-1)return null;i.nextLoadLevel=m}if(r.channels||r.audioCodec){var p=Ur(r,s);if(p>-1)return s[p]}}}return null},n.setAudioTrack=function(r){var i=this.tracksInGroup;if(r<0||r>=i.length){this.warn("Invalid audio track id: "+r);return}this.clearTimer(),this.selectDefaultTrack=!1;var s=this.currentTrack,l=i[r],d=l.details&&!l.details.live;if(!(r===this.trackId&&l===s&&d)&&(this.log("Switching to audio-track "+r+' "'+l.name+'" lang:'+l.lang+" group:"+l.groupId+" channels:"+l.channels),this.trackId=r,this.currentTrack=l,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,R({},l)),!d)){var f=this.switchParams(l.url,s?.details,l.details);this.loadPlaylist(f)}},n.findTrackId=function(r){for(var i=this.tracksInGroup,s=0;s<i.length;s++){var l=i[s];if(!(this.selectDefaultTrack&&!l.default)&&(!r||Ii(r,l,ki)))return s}if(r){for(var d=r.name,f=r.lang,v=r.assocLang,m=r.characteristics,p=r.audioCodec,y=r.channels,_=0;_<i.length;_++){var b=i[_];if(Ii({name:d,lang:f,assocLang:v,characteristics:m,audioCodec:p,channels:y},b,ki))return _}for(var T=0;T<i.length;T++){var w=i[T];if(Pi(r.attrs,w.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return T}for(var I=0;I<i.length;I++){var D=i[I];if(Pi(r.attrs,D.attrs,["LANGUAGE"]))return I}}return-1},n.loadPlaylist=function(r){var i=this.currentTrack;if(this.shouldLoadPlaylist(i)&&i){o.prototype.loadPlaylist.call(this);var s=i.id,l=i.groupId,d=i.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("loading audio-track playlist "+s+' "'+i.name+'" lang:'+i.lang+" group:"+l),this.clearTimer(),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:d,id:s,groupId:l,deliveryDirectives:r||null})}},x(a,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}]),a}(Nn),hs=500,xl=function(o){ie(a,o);function a(e,r,i){var s=o.call(this,e,r,i,"[subtitle-stream-controller]",fe.SUBTITLE)||this;return s.currentTrackId=-1,s.tracksBuffered=[],s.mainDetails=null,s._registerListeners(),s}var n=a.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),o.prototype.onHandlerDestroying.call(this),this.mainDetails=null},n._registerListeners=function(){var r=this.hls;r.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.ERROR,this.onError,this),r.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(A.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var r=this.hls;r.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.ERROR,this.onError,this),r.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(A.FRAG_BUFFERED,this.onFragBuffered,this)},n.startLoad=function(r){this.stopLoad(),this.state=Z.IDLE,this.setInterval(hs),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},n.onMediaDetaching=function(){this.tracksBuffered=[],o.prototype.onMediaDetaching.call(this)},n.onLevelLoaded=function(r,i){this.mainDetails=i.details},n.onSubtitleFragProcessed=function(r,i){var s=i.frag,l=i.success;if(this.fragPrevious=s,this.state=Z.IDLE,!!l){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var f,v=s.start,m=0;m<d.length;m++)if(v>=d[m].start&&v<=d[m].end){f=d[m];break}var p=s.start+s.duration;f?f.end=p:(f={start:v,end:p},d.push(f)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null)}}},n.onBufferFlushing=function(r,i){var s=i.startOffset,l=i.endOffset;if(s===0&&l!==Number.POSITIVE_INFINITY){var d=l-1;if(d<=0)return;i.endOffsetSubtitles=Math.max(0,d),this.tracksBuffered.forEach(function(f){for(var v=0;v<f.length;){if(f[v].end<=d){f.shift();continue}else if(f[v].start<d)f[v].start=d;else break;v++}}),this.fragmentTracker.removeFragmentsInRange(s,d,fe.SUBTITLE)}},n.onFragBuffered=function(r,i){if(!this.loadedmetadata&&i.frag.type===fe.MAIN){var s;(s=this.media)!=null&&s.buffered.length&&(this.loadedmetadata=!0)}},n.onError=function(r,i){var s=i.frag;s?.type===fe.SUBTITLE&&(i.details===U.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Z.STOPPED&&(this.state=Z.IDLE))},n.onSubtitleTracksUpdated=function(r,i){var s=this,l=i.subtitleTracks;if(this.levels&&ds(this.levels,l)){this.levels=l.map(function(d){return new Ri(d)});return}this.tracksBuffered=[],this.levels=l.map(function(d){var f=new Ri(d);return s.tracksBuffered[f.id]=[],f}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,fe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(r,i){var s;if(this.currentTrackId=i.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}var l=this.levels[this.currentTrackId];l!=null&&l.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,l&&this.setInterval(hs)},n.onSubtitleTrackLoaded=function(r,i){var s,l=this.currentTrackId,d=this.levels,f=i.details,v=i.id;if(!d){this.warn("Subtitle tracks were reset while loading level "+v);return}var m=d[v];if(!(v>=d.length||!m)){this.log("Subtitle track "+v+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+",duration:"+f.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var p=0;if(f.live||(s=m.details)!=null&&s.live){var y=this.mainDetails;if(f.deltaUpdateFailed||!y)return;var _=y.fragments[0];if(!m.details)f.hasProgramDateTime&&y.hasProgramDateTime?(un(f,y),p=f.fragments[0].start):_&&(p=_.start,Mn(f,p));else{var b;p=this.alignPlaylists(f,m.details,(b=this.levelLastLoaded)==null?void 0:b.details),p===0&&_&&(p=_.start,Mn(f,p))}}m.details=f,this.levelLastLoaded=m,v===l&&(!this.startFragRequested&&(this.mainDetails||!f.live)&&this.setStartPosition(this.mainDetails||f,p),this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===Z.IDLE&&(an(null,f.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),m.details=void 0)))}},n._handleFragmentLoadComplete=function(r){var i=this,s=r.frag,l=r.payload,d=s.decryptdata,f=this.hls;if(!this.fragContextChanged(s)&&l&&l.byteLength>0&&d!=null&&d.key&&d.iv&&d.method==="AES-128"){var v=performance.now();this.decrypter.decrypt(new Uint8Array(l),d.key.buffer,d.iv.buffer).catch(function(m){throw f.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.FRAG_DECRYPT_ERROR,fatal:!1,error:m,reason:m.message,frag:s}),m}).then(function(m){var p=performance.now();f.trigger(A.FRAG_DECRYPTED,{frag:s,payload:m,stats:{tstart:v,tdecrypt:p}})}).catch(function(m){i.warn(m.name+": "+m.message),i.state=Z.IDLE})}},n.doTick=function(){if(!this.media){this.state=Z.IDLE;return}if(this.state===Z.IDLE){var r=this.currentTrackId,i=this.levels,s=i?.[r];if(!s||!i.length||!s.details)return;var l=this.config,d=this.getLoadPosition(),f=Dt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],d,l.maxBufferHole),v=f.end,m=f.len,p=this.getFwdBufferInfo(this.media,fe.MAIN),y=s.details;if(m>this.getMaxBufferLength(p?.len)+y.levelTargetDuration)return;var _=y.fragments,b=_.length,T=y.edge,w=null,I=this.fragPrevious;if(v<T){var D=l.maxFragLookUpTolerance,N=v>T-D?0:D;w=an(I,_,Math.max(_[0].start,v),N),!w&&I&&I.start<_[0].start&&(w=_[0])}else w=_[b-1];if(!w)return;if(w=this.mapToInitFragWhenRequired(w),w.sn!=="initSegment"){var F=_[w.sn-y.startSN-1];F&&F.cc===w.cc&&this.fragmentTracker.getState(F)===jt.NOT_LOADED&&(w=F)}this.fragmentTracker.getState(w)===jt.NOT_LOADED&&this.loadFragment(w,s,v)}},n.getMaxBufferLength=function(r){var i=o.prototype.getMaxBufferLength.call(this);return r?Math.max(i,r):i},n.loadFragment=function(r,i,s){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r,i):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,r,i,s))},x(a,[{key:"mediaBufferTimeRanges",get:function(){return new Fl(this.tracksBuffered[this.currentTrackId]||[])}}]),a}(Vn),Fl=function(a){this.buffered=void 0;var n=function(r,i,s){if(i=i>>>0,i>s-1)throw new DOMException("Failed to execute '"+r+"' on 'TimeRanges': The index provided ("+i+") is greater than the maximum bound ("+s+")");return a[i][r]};this.buffered={get length(){return a.length},end:function(r){return n("end",r,a.length)},start:function(r){return n("start",r,a.length)}}},Nl=function(o){ie(a,o);function a(e){var r=o.call(this,e,"[subtitle-track-controller]")||this;return r.media=null,r.tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.onTextTracksChanged=function(){if(r.useTextTrackPolling||self.clearInterval(r.subtitlePollingInterval),!(!r.media||!r.hls.config.renderTextTracksNatively)){for(var i=null,s=ot(r.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")i=s[l];else if(s[l].mode==="showing"){i=s[l];break}var d=r.findTrackForTextTrack(i);r.subtitleTrack!==d&&r.setSubtitleTrack(d)}},r.registerListeners(),r}var n=a.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,o.prototype.destroy.call(this)},n.registerListeners=function(){var r=this.hls;r.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.MANIFEST_PARSED,this.onManifestParsed,this),r.on(A.LEVEL_LOADING,this.onLevelLoading,this),r.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(A.ERROR,this.onError,this)},n.unregisterListeners=function(){var r=this.hls;r.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.MANIFEST_PARSED,this.onManifestParsed,this),r.off(A.LEVEL_LOADING,this.onLevelLoading,this),r.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(A.ERROR,this.onError,this)},n.onMediaAttached=function(r,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,r)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ot(this.media.textTracks).forEach(function(r){wt(r)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},n.onManifestParsed=function(r,i){this.tracks=i.subtitleTracks},n.onSubtitleTrackLoaded=function(r,i){var s=i.id,l=i.groupId,d=i.details,f=this.tracksInGroup[s];if(!f||f.groupId!==l){this.warn("Subtitle track with id:"+s+" and group:"+l+" not found in active group "+f?.groupId);return}var v=f.details;f.details=i.details,this.log("Subtitle track "+s+' "'+f.name+'" lang:'+f.lang+" group:"+l+" loaded ["+d.startSN+"-"+d.endSN+"]"),s===this.trackId&&this.playlistLoaded(s,i,v)},n.onLevelLoading=function(r,i){this.switchLevel(i.level)},n.onLevelSwitching=function(r,i){this.switchLevel(i.level)},n.switchLevel=function(r){var i=this.hls.levels[r];if(i){var s=i.subtitleGroups||null,l=this.groupIds,d=this.currentTrack;if(!s||l?.length!==s?.length||s!=null&&s.some(function(b){return l?.indexOf(b)===-1})){this.groupIds=s,this.trackId=-1,this.currentTrack=null;var f=this.tracks.filter(function(b){return!s||s.indexOf(b.groupId)!==-1});if(f.length)this.selectDefaultTrack&&!f.some(function(b){return b.default})&&(this.selectDefaultTrack=!1),f.forEach(function(b,T){b.id=T});else if(!d&&!this.tracksInGroup.length)return;this.tracksInGroup=f;var v=this.hls.config.subtitlePreference;if(!d&&v){this.selectDefaultTrack=!1;var m=Ur(v,f);if(m>-1)d=f[m];else{var p=Ur(v,this.tracks);d=this.tracks[p]}}var y=this.findTrackId(d);y===-1&&d&&(y=this.findTrackId(null));var _={subtitleTracks:f};this.log("Updating subtitle tracks, "+f.length+' track(s) found in "'+s?.join(",")+'" group-id'),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,_),y!==-1&&this.trackId===-1&&this.setSubtitleTrack(y)}else this.shouldReloadPlaylist(d)&&this.setSubtitleTrack(this.trackId)}},n.findTrackId=function(r){for(var i=this.tracksInGroup,s=this.selectDefaultTrack,l=0;l<i.length;l++){var d=i[l];if(!(s&&!d.default||!s&&!r)&&(!r||Ii(d,r)))return l}if(r){for(var f=0;f<i.length;f++){var v=i[f];if(Pi(r.attrs,v.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(var m=0;m<i.length;m++){var p=i[m];if(Pi(r.attrs,p.attrs,["LANGUAGE"]))return m}}return-1},n.findTrackForTextTrack=function(r){if(r)for(var i=this.tracksInGroup,s=0;s<i.length;s++){var l=i[s];if(Qn(l,r))return s}return-1},n.onError=function(r,i){i.fatal||!i.context||i.context.type===_e.SUBTITLE_TRACK&&i.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(i.context.groupId)!==-1)&&this.checkRetry(i)},n.setSubtitleOption=function(r){if(this.hls.config.subtitlePreference=r,r){var i=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,i.length){var s=this.currentTrack;if(s&&Ii(r,s))return s;var l=Ur(r,this.tracksInGroup);if(l>-1){var d=this.tracksInGroup[l];return this.setSubtitleTrack(l),d}else{if(s)return null;var f=Ur(r,i);if(f>-1)return i[f]}}}return null},n.loadPlaylist=function(r){o.prototype.loadPlaylist.call(this);var i=this.currentTrack;if(this.shouldLoadPlaylist(i)&&i){var s=i.id,l=i.groupId,d=i.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+s),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:d,id:s,groupId:l,deliveryDirectives:r||null})}},n.toggleTrackModes=function(){var r=this.media;if(r){var i=ot(r.textTracks),s=this.currentTrack,l;if(s&&(l=i.filter(function(f){return Qn(s,f)})[0],l||this.warn('Unable to find subtitle TextTrack with name "'+s.name+'" and language "'+s.lang+'"')),[].slice.call(i).forEach(function(f){f.mode!=="disabled"&&f!==l&&(f.mode="disabled")}),l){var d=this.subtitleDisplay?"showing":"hidden";l.mode!==d&&(l.mode=d)}}},n.setSubtitleTrack=function(r){var i=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(r<-1||r>=i.length||!ne(r)){this.warn("Invalid subtitle track id: "+r);return}this.clearTimer(),this.selectDefaultTrack=!1;var s=this.currentTrack,l=i[r]||null;if(this.trackId=r,this.currentTrack=l,this.toggleTrackModes(),!l){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:r});return}var d=!!l.details&&!l.details.live;if(!(r===this.trackId&&l===s&&d)){this.log("Switching to subtitle-track "+r+(l?' "'+l.name+'" lang:'+l.lang+" group:"+l.groupId:""));var f=l.id,v=l.groupId,m=v===void 0?"":v,p=l.name,y=l.type,_=l.url;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:f,groupId:m,name:p,type:y,url:_});var b=this.switchParams(l.url,s?.details,l.details);this.loadPlaylist(b)}},x(a,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setSubtitleTrack(r)}}]),a}(Nn),Bl=function(){function o(n){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=n}var a=o.prototype;return a.append=function(e,r,i){var s=this.queues[r];s.push(e),s.length===1&&!i&&this.executeNext(r)},a.insertAbort=function(e,r){this.queues[r].unshift(e),this.executeNext(r)},a.appendBlocker=function(e){var r,i=new Promise(function(l){r=l}),s={execute:r,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(s,e),i},a.executeNext=function(e){var r=this.queues[e];if(r.length){var i=r[0];try{i.execute()}catch(l){P.warn('[buffer-operation-queue]: Exception executing "'+e+'" SourceBuffer operation: '+l),i.onError(l);var s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}},a.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},a.current=function(e){return this.queues[e][0]},o}(),vs=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ul=function(){function o(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(i){e.hls&&e.hls.pauseBuffering()},this._onStartStreaming=function(i){e.hls&&e.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var i=e.media,s=e.mediaSource;e.log("Media source opened"),i&&(i.removeEventListener("emptied",e._onMediaEmptied),e.updateMediaElementDuration(),e.hls.trigger(A.MEDIA_ATTACHED,{media:i,mediaSource:s})),s&&s.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){e.log("Media source closed")},this._onMediaSourceEnded=function(){e.log("Media source ended")},this._onMediaEmptied=function(){var i=e.mediaSrc,s=e._objectUrl;i!==s&&P.error("Media element src was set while attaching MediaSource ("+s+" > "+i+")")},this.hls=n;var r="[buffer-controller]";this.appendSource=zr(wr(n.config.preferManagedMediaSource)),this.log=P.log.bind(P,r),this.warn=P.warn.bind(P,r),this.error=P.error.bind(P,r),this._initSourceBuffer(),this.registerListeners()}var a=o.prototype;return a.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},a.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},a.registerListeners=function(){var e=this.hls;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this)},a.unregisterListeners=function(){var e=this.hls;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this)},a._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Bl(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},a.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},a.onManifestParsed=function(e,r){var i=2;(r.audio&&!r.video||!r.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.onMediaAttaching=function(e,r){var i=this.media=r.media,s=wr(this.appendSource);if(i&&s){var l,d=this.mediaSource=new s;this.log("created media source: "+((l=d.constructor)==null?void 0:l.name)),d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(d.addEventListener("startstreaming",this._onStartStreaming),d.addEventListener("endstreaming",this._onEndStreaming));var f=this._objectUrl=self.URL.createObjectURL(d);if(this.appendSource)try{i.removeAttribute("src");var v=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||v&&d instanceof v,ms(i),Vl(i,f),i.load()}catch{i.src=f}else i.src=f;i.addEventListener("emptied",this._onMediaEmptied)}},a.onMediaDetaching=function(){var e=this.media,r=this.mediaSource,i=this._objectUrl;if(r){if(this.log("media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(s){this.warn("onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(e.removeAttribute("src"),this.appendSource&&ms(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.MEDIA_DETACHED,void 0)},a.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(r){e.resetBuffer(r)}),this._initSourceBuffer()},a.resetBuffer=function(e){var r=this.sourceBuffer[e];try{if(r){var i;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}}catch(s){this.warn("onBufferReset "+e,s)}},a.onBufferCodecs=function(e,r){var i=this,s=this.getSourceBufferTypes().length,l=Object.keys(r);if(l.forEach(function(f){if(s){var v=i.tracks[f];if(v&&typeof v.buffer.changeType=="function"){var m,p=r[f],y=p.id,_=p.codec,b=p.levelCodec,T=p.container,w=p.metadata,I=Fr(v.codec,v.levelCodec),D=I?.replace(vs,"$1"),N=Fr(_,b),F=(m=N)==null?void 0:m.replace(vs,"$1");if(N&&D!==F){f.slice(0,5)==="audio"&&(N=mr(N,i.appendSource));var V=T+";codecs="+N;i.appendChangeType(f,V),i.log("switching codec "+I+" to "+N),i.tracks[f]={buffer:v.buffer,codec:_,container:T,levelCodec:b,metadata:w,id:y}}}}else i.pendingTracks[f]=r[f]}),!s){var d=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==d&&(this.log(d+" bufferCodec event(s) expected "+l.join(",")),this.bufferCodecEventsExpected=d),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}},a.appendChangeType=function(e,r){var i=this,s=this.operationQueue;s.append({execute:function(){var d=i.sourceBuffer[e];d&&(i.log("changing "+e+" sourceBuffer type to "+r),d.changeType(r)),s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){i.warn("Failed to change "+e+" SourceBuffer type",d)}},e,!!this.pendingTracks[e])},a.onBufferAppending=function(e,r){var i=this,s=this.hls,l=this.operationQueue,d=this.tracks,f=r.data,v=r.type,m=r.frag,p=r.part,y=r.chunkMeta,_=y.buffering[v],b=self.performance.now();_.start=b;var T=m.stats.buffering,w=p?p.stats.buffering:null;T.start===0&&(T.start=b),w&&w.start===0&&(w.start=b);var I=d.audio,D=!1;v==="audio"&&I?.container==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||y.id===1||this.lastMpegAudioChunk.sn!==y.sn,this.lastMpegAudioChunk=y);var N=m.start;l.append({execute:function(){if(_.executeStart=self.performance.now(),D){var V=i.sourceBuffer[v];if(V){var G=N-V.timestampOffset;Math.abs(G)>=.1&&(i.log("Updating audio SourceBuffer timestampOffset to "+N+" (delta: "+G+") sn: "+m.sn+")"),V.timestampOffset=N)}}i.appendExecutor(f,v)},onStart:function(){},onComplete:function(){var V=self.performance.now();_.executeEnd=_.end=V,T.first===0&&(T.first=V),w&&w.first===0&&(w.first=V);var G=i.sourceBuffer,B={};for(var H in G)B[H]=Dt.getBuffered(G[H]);i.appendErrors[v]=0,v==="audio"||v==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(A.BUFFER_APPENDED,{type:v,frag:m,part:p,chunkMeta:y,parent:m.type,timeRanges:B})},onError:function(V){var G={type:re.MEDIA_ERROR,parent:m.type,details:U.BUFFER_APPEND_ERROR,sourceBufferName:v,frag:m,part:p,chunkMeta:y,error:V,err:V,fatal:!1};if(V.code===DOMException.QUOTA_EXCEEDED_ERR)G.details=U.BUFFER_FULL_ERROR;else{var B=++i.appendErrors[v];G.details=U.BUFFER_APPEND_ERROR,i.warn("Failed "+B+"/"+s.config.appendErrorMaxRetry+' times to append segment in "'+v+'" sourceBuffer'),B>=s.config.appendErrorMaxRetry&&(G.fatal=!0)}s.trigger(A.ERROR,G)}},v,!!this.pendingTracks[v])},a.onBufferFlushing=function(e,r){var i=this,s=this.operationQueue,l=function(f){return{execute:i.removeExecutor.bind(i,f,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(A.BUFFER_FLUSHED,{type:f})},onError:function(m){i.warn("Failed to remove from "+f+" SourceBuffer",m)}}};r.type?s.append(l(r.type),r.type):this.getSourceBufferTypes().forEach(function(d){s.append(l(d),d)})},a.onFragParsed=function(e,r){var i=this,s=r.frag,l=r.part,d=[],f=l?l.elementaryStreams:s.elementaryStreams;f[Ce.AUDIOVIDEO]?d.push("audiovideo"):(f[Ce.AUDIO]&&d.push("audio"),f[Ce.VIDEO]&&d.push("video"));var v=function(){var p=self.performance.now();s.stats.buffering.end=p,l&&(l.stats.buffering.end=p);var y=l?l.stats:s.stats;i.hls.trigger(A.FRAG_BUFFERED,{frag:s,part:l,stats:y,id:s.type})};d.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(v,d)},a.onFragChanged=function(e,r){this.trimBuffers()},a.onBufferEos=function(e,r){var i=this;this.getSourceBufferTypes().reduce(function(s,l){var d=i.sourceBuffer[l];return d&&(!r.type||r.type===l)&&(d.ending=!0,d.ended||(d.ended=!0,i.log(l+" sourceBuffer now EOS"))),s&&!!(!d||d.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){i.getSourceBufferTypes().forEach(function(l){var d=i.sourceBuffer[l];d&&(d.ending=!1)});var s=i.mediaSource;if(!s||s.readyState!=="open"){s&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+s.readyState);return}i.log("Calling mediaSource.endOfStream()"),s.endOfStream()}))},a.onLevelUpdated=function(e,r){var i=r.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},a.trimBuffers=function(){var e=this.hls,r=this.details,i=this.media;if(!(!i||r===null)&&this.getSourceBufferTypes().length){var s=e.config,l=i.currentTime,d=r.levelTargetDuration,f=r.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(ne(f)&&f>0){var v=Math.max(f,d),m=Math.floor(l/d)*d-v;this.flushBackBuffer(l,d,m)}if(ne(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){var p=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),y=Math.max(p,d),_=Math.floor(l/d)*d+y;this.flushFrontBuffer(l,d,_)}}},a.flushBackBuffer=function(e,r,i){var s=this,l=this.details,d=this.sourceBuffer;this.getSourceBufferTypes().forEach(function(f){var v=d[f];if(v){var m=Dt.getBuffered(v);if(m.length>0&&i>m.start(0)){if(s.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:i}),l!=null&&l.live)s.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(v.ended&&m.end(m.length-1)-e<r*2){s.log("Cannot flush "+f+" back buffer while SourceBuffer is in ended state");return}s.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:f})}}})},a.flushFrontBuffer=function(e,r,i){var s=this,l=this.sourceBuffer;this.getSourceBufferTypes().forEach(function(d){var f=l[d];if(f){var v=Dt.getBuffered(f),m=v.length;if(m<2)return;var p=v.start(m-1),y=v.end(m-1);if(i>p||e>=p&&e<=y)return;if(f.ended&&e-y<2*r){s.log("Cannot flush "+d+" front buffer while SourceBuffer is in ended state");return}s.hls.trigger(A.BUFFER_FLUSHING,{startOffset:p,endOffset:1/0,type:d})}})},a.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,r=this.hls,i=this.media,s=this.mediaSource,l=e.fragments[0].start+e.totalduration,d=i.duration,f=ne(s.duration)?s.duration:0;e.live&&r.config.liveDurationInfinity?(s.duration=1/0,this.updateSeekableRange(e)):(l>f&&l>d||!ne(d))&&(this.log("Updating Media Source duration to "+l.toFixed(3)),s.duration=l)}},a.updateSeekableRange=function(e){var r=this.mediaSource,i=e.fragments;if(i.length&&e.live&&r!=null&&r.setLiveSeekableRange){var s=Math.max(0,i[0].start),l=Math.max(s,s+e.totalduration);this.log("Media Source duration is set to "+r.duration+". Setting seekable range to "+s+"-"+l+"."),r.setLiveSeekableRange(s,l)}},a.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,r=this.operationQueue,i=this.pendingTracks,s=Object.keys(i).length;if(s&&(!e||s===2||"audiovideo"in i)){this.createSourceBuffers(i),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length)this.hls.trigger(A.BUFFER_CREATED,{tracks:this.tracks}),l.forEach(function(f){r.executeNext(f)});else{var d=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:d,reason:d.message})}}},a.createSourceBuffers=function(e){var r=this,i=this.sourceBuffer,s=this.mediaSource;if(!s)throw Error("createSourceBuffers called when mediaSource was null");var l=function(v){if(!i[v]){var m,p=e[v];if(!p)throw Error("source buffer exists for track "+v+", however track does not");var y=((m=p.levelCodec)==null?void 0:m.indexOf(","))===-1?p.levelCodec:p.codec;y&&v.slice(0,5)==="audio"&&(y=mr(y,r.appendSource));var _=p.container+";codecs="+y;r.log("creating sourceBuffer("+_+")");try{var b=i[v]=s.addSourceBuffer(_),T=v;r.addBufferListener(T,"updatestart",r._onSBUpdateStart),r.addBufferListener(T,"updateend",r._onSBUpdateEnd),r.addBufferListener(T,"error",r._onSBUpdateError),r.appendSource&&r.addBufferListener(T,"bufferedchange",function(w,I){var D=I.removedRanges;D!=null&&D.length&&r.hls.trigger(A.BUFFER_FLUSHED,{type:v})}),r.tracks[v]={buffer:b,codec:y,container:p.container,levelCodec:p.levelCodec,metadata:p.metadata,id:p.id}}catch(w){r.error("error while trying to add sourceBuffer: "+w.message),r.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:w,sourceBufferName:v,mimeType:_})}}};for(var d in e)l(d)},a._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},a._onSBUpdateEnd=function(e){var r;if(((r=this.mediaSource)==null?void 0:r.readyState)==="closed"){this.resetBuffer(e);return}var i=this.operationQueue;i.current(e).onComplete(),i.shiftAndExecuteNext(e)},a._onSBUpdateError=function(e,r){var i,s=new Error(e+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+s,r),this.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});var l=this.operationQueue.current(e);l&&l.onError(s)},a.removeExecutor=function(e,r,i){var s=this.media,l=this.mediaSource,d=this.operationQueue,f=this.sourceBuffer[e];if(!s||!l||!f){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),d.shiftAndExecuteNext(e);return}var v=ne(s.duration)?s.duration:1/0,m=ne(l.duration)?l.duration:1/0,p=Math.max(0,r),y=Math.min(i,v,m);y>p&&(!f.ending||f.ended)?(f.ended=!1,this.log("Removing ["+p+","+y+"] from the "+e+" SourceBuffer"),f.remove(p,y)):d.shiftAndExecuteNext(e)},a.appendExecutor=function(e,r){var i=this.sourceBuffer[r];if(!i){if(!this.pendingTracks[r])throw new Error("Attempting to append to the "+r+" SourceBuffer, but it does not exist");return}i.ended=!1,i.appendBuffer(e)},a.blockBuffers=function(e,r){var i=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var s=this.operationQueue,l=r.map(function(d){return s.appendBlocker(d)});Promise.all(l).then(function(){e(),r.forEach(function(d){var f=i.sourceBuffer[d];f!=null&&f.updating||s.shiftAndExecuteNext(d)})})},a.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},a.addBufferListener=function(e,r,i){var s=this.sourceBuffer[e];if(s){var l=i.bind(this,e);this.listeners[e].push({event:r,listener:l}),s.addEventListener(r,l)}},a.removeBufferListeners=function(e){var r=this.sourceBuffer[e];r&&this.listeners[e].forEach(function(i){r.removeEventListener(i.event,i.listener)})},x(o,[{key:"mediaSrc",get:function(){var e,r=((e=this.media)==null?void 0:e.firstChild)||this.media;return r?.src}}]),o}();function ms(o){var a=o.querySelectorAll("source");[].slice.call(a).forEach(function(n){o.removeChild(n)})}function Vl(o,a){var n=self.document.createElement("source");n.type="video/mp4",n.src=a,o.appendChild(n)}var Gl={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},gs=function(a){return String.fromCharCode(Gl[a]||a)},Dr=15,Qr=100,ql={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Hl={17:2,18:4,21:6,22:8,23:10,19:13,20:15},zl={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Kl={25:2,26:4,29:6,30:8,31:10,27:13,28:15},jl=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Wl=function(){function o(){this.time=null,this.verboseLevel=0}var a=o.prototype;return a.log=function(e,r){if(this.verboseLevel>=e){var i=typeof r=="function"?r():r;P.log(this.time+" ["+e+"] "+i)}},o}(),vi=function(a){for(var n=[],e=0;e<a.length;e++)n.push(a[e].toString(16));return n},ys=function(){function o(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var a=o.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(e){for(var r=["foreground","underline","italics","background","flash"],i=0;i<r.length;i++){var s=r[i];e.hasOwnProperty(s)&&(this[s]=e[s])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},a.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),Yl=function(){function o(){this.uchar=" ",this.penState=new ys}var a=o.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(e,r){this.uchar=e,this.penState.copy(r)},a.setPenState=function(e){this.penState.copy(e)},a.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},a.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),$l=function(){function o(n){this.chars=[],this.pos=0,this.currPenState=new ys,this.cueStartTime=null,this.logger=void 0;for(var e=0;e<Qr;e++)this.chars.push(new Yl);this.logger=n}var a=o.prototype;return a.equals=function(e){for(var r=0;r<Qr;r++)if(!this.chars[r].equals(e.chars[r]))return!1;return!0},a.copy=function(e){for(var r=0;r<Qr;r++)this.chars[r].copy(e.chars[r])},a.isEmpty=function(){for(var e=!0,r=0;r<Qr;r++)if(!this.chars[r].isEmpty()){e=!1;break}return e},a.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Qr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Qr)},a.moveCursor=function(e){var r=this.pos+e;if(e>1)for(var i=this.pos+1;i<r+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(r)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(e){var r=this;e>=144&&this.backSpace();var i=gs(e);if(this.pos>=Qr){this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+i+") at position "+r.pos+". Skipping it!"});return}this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(e){var r;for(r=e;r<Qr;r++)this.chars[r].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var e=[],r=!0,i=0;i<Qr;i++){var s=this.chars[i].uchar;s!==" "&&(r=!1),e.push(s)}return r?"":e.join("")},a.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},o}(),Jn=function(){function o(n){this.rows=[],this.currRow=Dr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var e=0;e<Dr;e++)this.rows.push(new $l(n));this.logger=n}var a=o.prototype;return a.reset=function(){for(var e=0;e<Dr;e++)this.rows[e].clear();this.currRow=Dr-1},a.equals=function(e){for(var r=!0,i=0;i<Dr;i++)if(!this.rows[i].equals(e.rows[i])){r=!1;break}return r},a.copy=function(e){for(var r=0;r<Dr;r++)this.rows[r].copy(e.rows[r])},a.isEmpty=function(){for(var e=!0,r=0;r<Dr;r++)if(!this.rows[r].isEmpty()){e=!1;break}return e},a.backSpace=function(){this.rows[this.currRow].backSpace()},a.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.insertChar=function(e){this.rows[this.currRow].insertChar(e)},a.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},a.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},a.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},a.setPAC=function(e){this.logger.log(2,function(){return"pacData = "+JSON.stringify(e)});var r=e.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<Dr;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){var d=l.rows[s].cueStartTime,f=this.logger.time;if(d!==null&&f!==null&&d<f)for(var v=0;v<this.nrRollUpRows;v++)this.rows[r-this.nrRollUpRows+v+1].copy(l.rows[s+v])}}this.currRow=r;var m=this.rows[this.currRow];if(e.indent!==null){var p=e.indent,y=Math.max(p-1,0);m.setCursor(e.indent),e.color=m.chars[y].penState.foreground}var _={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(_)},a.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},a.setRollUpRows=function(e){this.nrRollUpRows=e},a.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,function(){return e.getDisplayText()});var r=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(r,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(2,"Rolling up")},a.getDisplayText=function(e){e=e||!1;for(var r=[],i="",s=-1,l=0;l<Dr;l++){var d=this.rows[l].getTextString();d&&(s=l+1,e?r.push("Row "+s+": '"+d+"'"):r.push(d.trim()))}return r.length>0&&(e?i="["+r.join(" | ")+"]":i=r.join(`
`)),i},a.getTextAndFormat=function(){return this.rows},o}(),Es=function(){function o(n,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Jn(r),this.nonDisplayedMemory=new Jn(r),this.lastOutputScreen=new Jn(r),this.currRollUpRow=this.displayedMemory.rows[Dr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var a=o.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Dr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(e){this.outputFilter=e},a.setPAC=function(e){this.writeScreen.setPAC(e)},a.setBkgData=function(e){this.writeScreen.setBkgData(e)},a.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},a.insertChars=function(e){for(var r=this,i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);var s=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return s+": "+r.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,function(){return"DISPLAYED: "+r.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},a.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},a.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},a.ccMIDROW=function(e){var r={flash:!1};r.underline=e%2===1,r.italics=e>=46,r.italics?r.foreground="white":r.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(e/2)-16],this.logger.log(2,"MIDROW: "+JSON.stringify(r)),this.writeScreen.setPen(r)},a.outputDataUpdate=function(e){e===void 0&&(e=!1);var r=this.logger.time;r!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=r:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,r,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:r),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},o}(),_s=function(){function o(n,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Ql(),this.logger=void 0;var i=this.logger=new Wl;this.channels=[null,new Es(n,e,i),new Es(n+1,r,i)]}var a=o.prototype;return a.getHandler=function(e){return this.channels[e].getHandler()},a.setHandler=function(e,r){this.channels[e].setHandler(r)},a.addData=function(e,r){var i=this;this.logger.time=e;for(var s=function(v){var m=r[v]&127,p=r[v+1]&127,y=!1,_=null;if(m===0&&p===0)return 0;i.logger.log(3,function(){return"["+vi([r[v],r[v+1]])+"] -> ("+vi([m,p])+")"});var b=i.cmdHistory;if(m>=16&&m<=31){if(Xl(m,p,b))return pn(null,null,b),i.logger.log(3,function(){return"Repeated command ("+vi([m,p])+") is dropped"}),0;pn(m,p,i.cmdHistory),y=i.parseCmd(m,p),y||(y=i.parseMidrow(m,p)),y||(y=i.parsePAC(m,p)),y||(y=i.parseBackgroundAttributes(m,p))}else pn(null,null,b);if(!y&&(_=i.parseChars(m,p),_)){var T=i.currentChannel;T&&T>0?i.channels[T].insertChars(_):i.logger.log(2,"No channel found yet. TEXT-MODE?")}!y&&!_&&i.logger.log(2,function(){return"Couldn't parse cleaned data "+vi([m,p])+" orig: "+vi([r[v],r[v+1]])})},l,d=0;d<r.length;d+=2)l=s(d)},a.parseCmd=function(e,r){if(!((e===20||e===28||e===21||e===29)&&r>=32&&r<=47||(e===23||e===31)&&r>=33&&r<=35))return!1;var i=e===20||e===21||e===23?1:2,s=this.channels[i];return e===20||e===21||e===28||e===29?r===32?s.ccRCL():r===33?s.ccBS():r===34?s.ccAOF():r===35?s.ccAON():r===36?s.ccDER():r===37?s.ccRU(2):r===38?s.ccRU(3):r===39?s.ccRU(4):r===40?s.ccFON():r===41?s.ccRDC():r===42?s.ccTR():r===43?s.ccRTD():r===44?s.ccEDM():r===45?s.ccCR():r===46?s.ccENM():r===47&&s.ccEOC():s.ccTO(r-32),this.currentChannel=i,!0},a.parseMidrow=function(e,r){var i=0;if((e===17||e===25)&&r>=32&&r<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var s=this.channels[i];return s?(s.ccMIDROW(r),this.logger.log(3,function(){return"MIDROW ("+vi([e,r])+")"}),!0):!1}return!1},a.parsePAC=function(e,r){var i;if(!((e>=17&&e<=23||e>=25&&e<=31)&&r>=64&&r<=127||(e===16||e===24)&&r>=64&&r<=95))return!1;var s=e<=23?1:2;r>=64&&r<=95?i=s===1?ql[e]:zl[e]:i=s===1?Hl[e]:Kl[e];var l=this.channels[s];return l?(l.setPAC(this.interpretPAC(i,r)),this.currentChannel=s,!0):!1},a.interpretPAC=function(e,r){var i,s={color:null,italics:!1,indent:null,underline:!1,row:e};return r>95?i=r-96:i=r-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s},a.parseChars=function(e,r){var i,s=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19){var d;l===17?d=r+80:l===18?d=r+112:d=r+144,this.logger.log(2,function(){return"Special char '"+gs(d)+"' in channel "+i}),s=[d]}else e>=32&&e<=127&&(s=r===0?[e]:[e,r]);return s&&this.logger.log(3,function(){return"Char codes =  "+vi(s).join(",")}),s},a.parseBackgroundAttributes=function(e,r){if(!((e===16||e===24)&&r>=32&&r<=47||(e===23||e===31)&&r>=45&&r<=47))return!1;var i,s={};e===16||e===24?(i=Math.floor((r-32)/2),s.background=jl[i],r%2===1&&(s.background=s.background+"_semi")):r===45?s.background="transparent":(s.foreground="black",r===47&&(s.underline=!0));var l=e<=23?1:2;return this.channels[l].setBkgData(s),!0},a.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var r=this.channels[e];r&&r.reset()}pn(null,null,this.cmdHistory)},a.cueSplitAtTime=function(e){for(var r=0;r<this.channels.length;r++){var i=this.channels[r];i&&i.cueSplitAtTime(e)}},o}();function pn(o,a,n){n.a=o,n.b=a}function Xl(o,a,n){return n.a===o&&n.b===a}function Ql(){return{a:null,b:null}}var yn=function(){function o(n,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=e}var a=o.prototype;return a.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(e,r,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=r,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[],this.startTime=null},o}(),Zn=function(){if(Hr!=null&&Hr.VTTCue)return self.VTTCue;var o=["","lr","rl"],a=["start","middle","end","left","right"];function n(l,d){if(typeof d!="string"||!Array.isArray(l))return!1;var f=d.toLowerCase();return~l.indexOf(f)?f:!1}function e(l){return n(o,l)}function r(l){return n(a,l)}function i(l){for(var d=arguments.length,f=new Array(d>1?d-1:0),v=1;v<d;v++)f[v-1]=arguments[v];for(var m=1;m<arguments.length;m++){var p=arguments[m];for(var y in p)l[y]=p[y]}return l}function s(l,d,f){var v=this,m={enumerable:!0};v.hasBeenReset=!1;var p="",y=!1,_=l,b=d,T=f,w=null,I="",D=!0,N="auto",F="start",V=50,G="middle",B=50,H="middle";Object.defineProperty(v,"id",i({},m,{get:function(){return p},set:function(J){p=""+J}})),Object.defineProperty(v,"pauseOnExit",i({},m,{get:function(){return y},set:function(J){y=!!J}})),Object.defineProperty(v,"startTime",i({},m,{get:function(){return _},set:function(J){if(typeof J!="number")throw new TypeError("Start time must be set to a number.");_=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"endTime",i({},m,{get:function(){return b},set:function(J){if(typeof J!="number")throw new TypeError("End time must be set to a number.");b=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"text",i({},m,{get:function(){return T},set:function(J){T=""+J,this.hasBeenReset=!0}})),Object.defineProperty(v,"region",i({},m,{get:function(){return w},set:function(J){w=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"vertical",i({},m,{get:function(){return I},set:function(J){var j=e(J);if(j===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=j,this.hasBeenReset=!0}})),Object.defineProperty(v,"snapToLines",i({},m,{get:function(){return D},set:function(J){D=!!J,this.hasBeenReset=!0}})),Object.defineProperty(v,"line",i({},m,{get:function(){return N},set:function(J){if(typeof J!="number"&&J!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");N=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"lineAlign",i({},m,{get:function(){return F},set:function(J){var j=r(J);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");F=j,this.hasBeenReset=!0}})),Object.defineProperty(v,"position",i({},m,{get:function(){return V},set:function(J){if(J<0||J>100)throw new Error("Position must be between 0 and 100.");V=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"positionAlign",i({},m,{get:function(){return G},set:function(J){var j=r(J);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");G=j,this.hasBeenReset=!0}})),Object.defineProperty(v,"size",i({},m,{get:function(){return B},set:function(J){if(J<0||J>100)throw new Error("Size must be between 0 and 100.");B=J,this.hasBeenReset=!0}})),Object.defineProperty(v,"align",i({},m,{get:function(){return H},set:function(J){var j=r(J);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");H=j,this.hasBeenReset=!0}})),v.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}(),Jl=function(){function o(){}var a=o.prototype;return a.decode=function(e,r){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},o}();function Ss(o){function a(e,r,i,s){return(e|0)*3600+(r|0)*60+(i|0)+parseFloat(s||0)}var n=o.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?a(n[2],n[3],0,n[4]):a(n[1],n[2],n[3],n[4]):null}var Zl=function(){function o(){this.values=Object.create(null)}var a=o.prototype;return a.set=function(e,r){!this.get(e)&&r!==""&&(this.values[e]=r)},a.get=function(e,r,i){return i?this.has(e)?this.values[e]:r[i]:this.has(e)?this.values[e]:r},a.has=function(e){return e in this.values},a.alt=function(e,r,i){for(var s=0;s<i.length;++s)if(r===i[s]){this.set(e,r);break}},a.integer=function(e,r){/^-?\d+$/.test(r)&&this.set(e,parseInt(r,10))},a.percent=function(e,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){var i=parseFloat(r);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},o}();function Ts(o,a,n,e){var r=e?o.split(e):[o];for(var i in r)if(typeof r[i]=="string"){var s=r[i].split(n);if(s.length===2){var l=s[0],d=s[1];a(l,d)}}}var ea=new Zn(0,0,""),En=ea.align==="middle"?"middle":"center";function eu(o,a,n){var e=o;function r(){var l=Ss(o);if(l===null)throw new Error("Malformed timestamp: "+e);return o=o.replace(/^[^\sa-zA-Z-]+/,""),l}function i(l,d){var f=new Zl;Ts(l,function(p,y){var _;switch(p){case"region":for(var b=n.length-1;b>=0;b--)if(n[b].id===y){f.set(p,n[b].region);break}break;case"vertical":f.alt(p,y,["rl","lr"]);break;case"line":_=y.split(","),f.integer(p,_[0]),f.percent(p,_[0])&&f.set("snapToLines",!1),f.alt(p,_[0],["auto"]),_.length===2&&f.alt("lineAlign",_[1],["start",En,"end"]);break;case"position":_=y.split(","),f.percent(p,_[0]),_.length===2&&f.alt("positionAlign",_[1],["start",En,"end","line-left","line-right","auto"]);break;case"size":f.percent(p,y);break;case"align":f.alt(p,y,["start",En,"end","left","right"]);break}},/:/,/\s/),d.region=f.get("region",null),d.vertical=f.get("vertical","");var v=f.get("line","auto");v==="auto"&&ea.line===-1&&(v=-1),d.line=v,d.lineAlign=f.get("lineAlign","start"),d.snapToLines=f.get("snapToLines",!0),d.size=f.get("size",100),d.align=f.get("align",En);var m=f.get("position","auto");m==="auto"&&ea.position===50&&(m=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=m}function s(){o=o.replace(/^\s+/,"")}if(s(),a.startTime=r(),s(),o.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);o=o.slice(3),s(),a.endTime=r(),s(),i(o,a)}function bs(o){return o.replace(/<br(?: \/)?>/gi,`
`)}var tu=function(){function o(){this.state="INITIAL",this.buffer="",this.decoder=new Jl,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var a=o.prototype;return a.parse=function(e){var r=this;e&&(r.buffer+=r.decoder.decode(e,{stream:!0}));function i(){var m=r.buffer,p=0;for(m=bs(m);p<m.length&&m[p]!=="\r"&&m[p]!==`
`;)++p;var y=m.slice(0,p);return m[p]==="\r"&&++p,m[p]===`
`&&++p,r.buffer=m.slice(p),y}function s(m){Ts(m,function(p,y){},/:/)}try{var l="";if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer))return this;l=i();var d=l.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(d!=null&&d[0]))throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var f=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(f?f=!1:l=i(),r.state){case"HEADER":/:/.test(l)?s(l):l||(r.state="ID");continue;case"NOTE":l||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){r.state="NOTE";break}if(!l)continue;if(r.cue=new Zn(0,0,""),r.state="CUE",l.indexOf("-->")===-1){r.cue.id=l;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{eu(l,r.cue,r.regionList)}catch{r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var v=l.indexOf("-->")!==-1;if(!l||v&&(f=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(r.cue===null)continue;r.cue.text&&(r.cue.text+=`
`),r.cue.text+=l;continue;case"BADCUE":l||(r.state="ID")}}}catch{r.state==="CUETEXT"&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},a.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(r){e.onparsingerror&&e.onparsingerror(r)}return e.onflush&&e.onflush(),this},o}(),ru=/\r\n|\n\r|\n|\r/g,ta=function(a,n,e){return e===void 0&&(e=0),a.slice(e,e+n.length)===n},iu=function(a){var n=parseInt(a.slice(-3)),e=parseInt(a.slice(-6,-4)),r=parseInt(a.slice(-9,-7)),i=a.length>9?parseInt(a.substring(0,a.indexOf(":"))):0;if(!ne(n)||!ne(e)||!ne(r)||!ne(i))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return n+=1e3*e,n+=60*1e3*r,n+=3600*1e3*i,n},ra=function(a){for(var n=5381,e=a.length;e;)n=n*33^a.charCodeAt(--e);return(n>>>0).toString()};function ia(o,a,n){return ra(o.toString())+ra(a.toString())+ra(n)}var nu=function(a,n,e){var r=a[n],i=a[r.prevCC];if(!i||!i.new&&r.new){a.ccOffset=a.presentationOffset=r.start,r.new=!1;return}for(;(s=i)!=null&&s.new;){var s;a.ccOffset+=r.start-i.start,r.new=!1,r=i,i=a[r.prevCC]}a.presentationOffset=e};function au(o,a,n,e,r,i,s){var l=new tu,d=Ot(new Uint8Array(o)).trim().replace(ru,`
`).split(`
`),f=[],v=a?gl(a.baseTime,a.timescale):0,m="00:00.000",p=0,y=0,_,b=!0;l.oncue=function(T){var w=n[e],I=n.ccOffset,D=(p-v)/9e4;if(w!=null&&w.new&&(y!==void 0?I=n.ccOffset=w.start:nu(n,e,D)),D){if(!a){_=new Error("Missing initPTS for VTT MPEGTS");return}I=D-n.presentationOffset}var N=T.endTime-T.startTime,F=Ar((T.startTime+I-y)*9e4,r*9e4)/9e4;T.startTime=Math.max(F,0),T.endTime=Math.max(F+N,0);var V=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(V)),T.id||(T.id=ia(T.startTime,T.endTime,V)),T.endTime>0&&f.push(T)},l.onparsingerror=function(T){_=T},l.onflush=function(){if(_){s(_);return}i(f)},d.forEach(function(T){if(b)if(ta(T,"X-TIMESTAMP-MAP=")){b=!1,T.slice(16).split(",").forEach(function(w){ta(w,"LOCAL:")?m=w.slice(6):ta(w,"MPEGTS:")&&(p=parseInt(w.slice(7)))});try{y=iu(m)/1e3}catch(w){_=w}return}else T===""&&(b=!1);l.parse(T+`
`)}),l.flush()}var na="stpp.ttml.im1t",As=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ls=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,su={left:"start",center:"center",right:"end",start:"start",end:"end"};function Rs(o,a,n,e){var r=he(new Uint8Array(o),["mdat"]);if(r.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var i=r.map(function(l){return Ot(l)}),s=ml(a.baseTime,1,a.timescale);try{i.forEach(function(l){return n(ou(l,s))})}catch(l){e(l)}}function ou(o,a){var n=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var e={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(e).reduce(function(f,v){return f[v]=n.getAttribute("ttp:"+v)||e[v],f},{}),i=n.getAttribute("xml:space")!=="preserve",s=ws(aa(n,"styling","style")),l=ws(aa(n,"layout","region")),d=aa(n,"body","[begin]");return[].map.call(d,function(f){var v=Is(f,i);if(!v||!f.hasAttribute("begin"))return null;var m=oa(f.getAttribute("begin"),r),p=oa(f.getAttribute("dur"),r),y=oa(f.getAttribute("end"),r);if(m===null)throw ks(f);if(y===null){if(p===null)throw ks(f);y=m+p}var _=new Zn(m-a,y-a,v);_.id=ia(_.startTime,_.endTime,_.text);var b=l[f.getAttribute("region")],T=s[f.getAttribute("style")],w=lu(b,T,s),I=w.textAlign;if(I){var D=su[I];D&&(_.lineAlign=D),_.align=I}return X(_,w),_}).filter(function(f){return f!==null})}function aa(o,a,n){var e=o.getElementsByTagName(a)[0];return e?[].slice.call(e.querySelectorAll(n)):[]}function ws(o){return o.reduce(function(a,n){var e=n.getAttribute("xml:id");return e&&(a[e]=n),a},{})}function Is(o,a){return[].slice.call(o.childNodes).reduce(function(n,e,r){var i;return e.nodeName==="br"&&r?n+`
`:(i=e.childNodes)!=null&&i.length?Is(e,a):a?n+e.textContent.trim().replace(/\s+/g," "):n+e.textContent},"")}function lu(o,a,n){var e="http://www.w3.org/ns/ttml#styling",r=null,i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],s=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return s&&n.hasOwnProperty(s)&&(r=n[s]),i.reduce(function(l,d){var f=sa(a,e,d)||sa(o,e,d)||sa(r,e,d);return f&&(l[d]=f),l},{})}function sa(o,a,n){return o&&o.hasAttributeNS(a,n)?o.getAttributeNS(a,n):null}function ks(o){return new Error("Could not parse ttml timestamp "+o)}function oa(o,a){if(!o)return null;var n=Ss(o);return n===null&&(As.test(o)?n=uu(o,a):Ls.test(o)&&(n=cu(o,a))),n}function uu(o,a){var n=As.exec(o),e=(n[4]|0)+(n[5]|0)/a.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+e/a.frameRate}function cu(o,a){var n=Ls.exec(o),e=Number(n[1]);switch(n[2]){case"h":return e*3600;case"m":return e*60;case"ms":return e*1e3;case"f":return e/a.frameRate;case"t":return e/a.tickRate}return e}var du=function(){function o(n){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Os(),this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},n.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(A.MANIFEST_LOADING,this.onManifestLoading,this),n.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(A.FRAG_LOADING,this.onFragLoading,this),n.on(A.FRAG_LOADED,this.onFragLoaded,this),n.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=o.prototype;return a.destroy=function(){var e=this.hls;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0},a.initCea608Parsers=function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var e=new yn(this,"textTrack1"),r=new yn(this,"textTrack2"),i=new yn(this,"textTrack3"),s=new yn(this,"textTrack4");this.cea608Parser1=new _s(1,e,r),this.cea608Parser2=new _s(3,i,s)}},a.addCues=function(e,r,i,s,l){for(var d=!1,f=l.length;f--;){var v=l[f],m=fu(v[0],v[1],r,i);if(m>=0&&(v[0]=Math.min(v[0],r),v[1]=Math.max(v[1],i),d=!0,m/(i-r)>.5))return}if(d||l.push([r,i]),this.config.renderTextTracksNatively){var p=this.captionsTracks[e];this.Cues.newCue(p,r,i,s)}else{var y=this.Cues.newCue(null,r,i,s);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:y,track:e})}},a.onInitPtsFound=function(e,r){var i=this,s=r.frag,l=r.id,d=r.initPTS,f=r.timescale,v=this.unparsedVttFrags;l==="main"&&(this.initPTS[s.cc]={baseTime:d,timescale:f}),v.length&&(this.unparsedVttFrags=[],v.forEach(function(m){i.onFragLoaded(A.FRAG_LOADED,m)}))},a.getExistingTrack=function(e,r){var i=this.media;if(i)for(var s=0;s<i.textTracks.length;s++){var l=i.textTracks[s];if(Ds(l,{name:e,lang:r,attrs:{}}))return l}return null},a.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},a.createNativeTrack=function(e){if(!this.captionsTracks[e]){var r=this.captionsProperties,i=this.captionsTracks,s=this.media,l=r[e],d=l.label,f=l.languageCode,v=this.getExistingTrack(d,f);if(v)i[e]=v,wt(i[e]),kr(i[e],s);else{var m=this.createTextTrack("captions",d,f);m&&(m[e]=!0,i[e]=m)}}},a.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var r=this.captionsProperties[e];if(r){var i={_id:e,label:r.label,kind:"captions",default:r.media?!!r.media.default:!1,closedCaptions:r.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},a.createTextTrack=function(e,r,i){var s=this.media;if(s)return s.addTextTrack(e,r,i)},a.onMediaAttaching=function(e,r){this.media=r.media,this._cleanTracks()},a.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(r){wt(e[r]),delete e[r]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Os(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var e=this.media;if(e){var r=e.textTracks;if(r)for(var i=0;i<r.length;i++)wt(r[i])}},a.onSubtitleTracksUpdated=function(e,r){var i=this,s=r.subtitleTracks||[],l=s.some(function(p){return p.textCodec===na});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){if(ds(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){var d=this.media,f=d?ot(d.textTracks):null;if(this.tracks.forEach(function(p,y){var _;if(f){for(var b=null,T=0;T<f.length;T++)if(f[T]&&Ds(f[T],p)){b=f[T],f[T]=null;break}b&&(_=b)}if(_)wt(_);else{var w=Cs(p);_=i.createTextTrack(w,p.name,p.lang),_&&(_.mode="disabled")}_&&i.textTracks.push(_)}),f!=null&&f.length){var v=f.filter(function(p){return p!==null}).map(function(p){return p.label});v.length&&P.warn("Media element contains unused subtitle tracks: "+v.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var m=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},a.onManifestLoaded=function(e,r){var i=this;this.config.enableCEA708Captions&&r.captions&&r.captions.forEach(function(s){var l=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(l){var d="textTrack"+l[1],f=i.captionsProperties[d];f&&(f.label=s.name,s.lang&&(f.languageCode=s.lang),f.media=s)}})},a.closedCaptionsForLevel=function(e){var r=this.hls.levels[e.level];return r?.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(e,r){if(this.enabled&&r.frag.type===fe.MAIN){var i,s,l=this.cea608Parser1,d=this.cea608Parser2,f=this.lastSn,v=r.frag,m=v.cc,p=v.sn,y=(i=(s=r.part)==null?void 0:s.index)!=null?i:-1;l&&d&&(p!==f+1||p===f&&y!==this.lastPartIndex+1||m!==this.lastCc)&&(l.reset(),d.reset()),this.lastCc=m,this.lastSn=p,this.lastPartIndex=y}},a.onFragLoaded=function(e,r){var i=r.frag,s=r.payload;if(i.type===fe.SUBTITLE)if(s.byteLength){var l=i.decryptdata,d="stats"in r;if(l==null||!l.encrypted||d){var f=this.tracks[i.level],v=this.vttCCs;v[i.cc]||(v[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),f&&f.textCodec===na?this._parseIMSC1(i,s):this._parseVTTs(r)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(e,r){var i=this,s=this.hls;Rs(r,this.initPTS[e.cc],function(l){i._appendCues(l,e.level),s.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){P.log("Failed to parse IMSC1: "+l),s.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},a._parseVTTs=function(e){var r,i=this,s=e.frag,l=e.payload,d=this.initPTS,f=this.unparsedVttFrags,v=d.length-1;if(!d[s.cc]&&v===-1){f.push(e);return}var m=this.hls;au((r=s.initSegment)!=null&&r.data?Be(s.initSegment.data,new Uint8Array(l)):l,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,function(p){i._appendCues(p,s.level),m.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},function(p){var y=p.message==="Missing initPTS for VTT MPEGTS";y?f.push(e):i._fallbackToIMSC1(s,l),P.log("Failed to parse VTT cue: "+p),!(y&&v>s.cc)&&m.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:p})})},a._fallbackToIMSC1=function(e,r){var i=this,s=this.tracks[e.level];s.textCodec||Rs(r,this.initPTS[e.cc],function(){s.textCodec=na,i._parseIMSC1(e,r)},function(){s.textCodec="wvtt"})},a._appendCues=function(e,r){var i=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[r];if(!s||s.mode==="disabled")return;e.forEach(function(f){return jr(s,f)})}else{var l=this.tracks[r];if(!l)return;var d=l.default?"default":"subtitles"+r;i.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:d})}},a.onFragDecrypted=function(e,r){r.frag.type===fe.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,r)},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(e,r){this.initCea608Parsers();var i=this.cea608Parser1,s=this.cea608Parser2;if(!(!this.enabled||!i||!s)){var l=r.frag,d=r.samples;if(!(l.type===fe.MAIN&&this.closedCaptionsForLevel(l)==="NONE"))for(var f=0;f<d.length;f++){var v=d[f].bytes;if(v){var m=this.extractCea608Data(v);i.addData(d[f].pts,m[0]),s.addData(d[f].pts,m[1])}}}},a.onBufferFlushing=function(e,r){var i=r.startOffset,s=r.endOffset,l=r.endOffsetSubtitles,d=r.type,f=this.media;if(!(!f||f.currentTime<s)){if(!d||d==="video"){var v=this.captionsTracks;Object.keys(v).forEach(function(p){return Gt(v[p],i,s)})}if(this.config.renderTextTracksNatively&&i===0&&l!==void 0){var m=this.textTracks;Object.keys(m).forEach(function(p){return Gt(m[p],i,l)})}}},a.extractCea608Data=function(e){for(var r=[[],[]],i=e[0]&31,s=2,l=0;l<i;l++){var d=e[s++],f=127&e[s++],v=127&e[s++];if(!(f===0&&v===0)&&4&d){var m=3&d;(m===0||m===1)&&(r[m].push(f),r[m].push(v))}}return r},o}();function Cs(o){return o.characteristics&&/transcribes-spoken-dialog/gi.test(o.characteristics)&&/describes-music-and-sound/gi.test(o.characteristics)?"captions":"subtitles"}function Ds(o,a){return!!o&&o.kind===Cs(a)&&Qn(a,o)}function fu(o,a,n,e){return Math.min(a,e)-Math.max(o,n)}function Os(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var hu=function(){function o(n){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=n,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var a=o.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(e,r){var i=this.hls.levels[r.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})},a.onMediaAttaching=function(e,r){this.media=r.media instanceof HTMLVideoElement?r.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},a.onManifestParsed=function(e,r){var i=this.hls;this.restrictedLevels=[],this.firstLevel=r.firstLevel,i.config.capLevelToPlayerSize&&r.video&&this.startCapping()},a.onLevelsUpdated=function(e,r){this.timer&&ne(this.autoLevelCapping)&&this.detectPlayerSize()},a.onBufferCodecs=function(e,r){this.hls.config.capLevelToPlayerSize&&r.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var e=this.hls.levels;if(e.length){var r=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&P.log("Setting autoLevelCapping to "+i+": "+e[i].height+"p@"+e[i].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),r.autoLevelCapping=i,r.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}},a.getMaxLevel=function(e){var r=this,i=this.hls.levels;if(!i.length)return-1;var s=i.filter(function(l,d){return r.isLevelAllowed(l)&&d<=e});return this.clientRect=null,o.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,r={width:0,height:0};if(e){var i=e.getBoundingClientRect();r.width=i.width,r.height=i.height,!r.width&&!r.height&&(r.width=i.right-i.left||e.width||0,r.height=i.bottom-i.top||e.height||0)}return this.clientRect=r,r},a.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(r){return e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height})},o.getMaxLevelByMediaSize=function(e,r,i){if(!(e!=null&&e.length))return-1;for(var s=function(p,y){return y?p.width!==y.width||p.height!==y.height:!0},l=e.length-1,d=Math.max(r,i),f=0;f<e.length;f+=1){var v=e[f];if((v.width>=d||v.height>=d)&&s(v,e[f+1])){l=f;break}}return l},x(o,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}}]),o}(),vu=function(){function o(n){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=n,this.registerListeners()}var a=o.prototype;return a.setStreamController=function(e){this.streamController=e},a.registerListeners=function(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.unregisterListeners=function(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},a.onMediaAttaching=function(e,r){var i=this.hls.config;if(i.capLevelOnFPSDrop){var s=r.media instanceof self.HTMLVideoElement?r.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},a.checkFPS=function(e,r,i){var s=performance.now();if(r){if(this.lastTime){var l=s-this.lastTime,d=i-this.lastDroppedFrames,f=r-this.lastDecodedFrames,v=1e3*d/l,m=this.hls;if(m.trigger(A.FPS_DROP,{currentDropped:d,currentDecoded:f,totalDroppedFrames:i}),v>0&&d>m.config.fpsDroppedMonitoringThreshold*f){var p=m.currentLevel;P.warn("drop FPS ratio greater than max allowed value for currentLevel: "+p),p>0&&(m.autoLevelCapping===-1||m.autoLevelCapping>=p)&&(p=p-1,m.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:p,droppedLevel:m.currentLevel}),m.autoLevelCapping=p,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=r}},a.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var r=e.getVideoPlaybackQuality();this.checkFPS(e,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},o}(),_n="[eme]",Ps=function(){function o(n){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=P.debug.bind(P,_n),this.log=P.log.bind(P,_n),this.warn=P.warn.bind(P,_n),this.error=P.error.bind(P,_n),this.hls=n,this.config=n.config,this.registerListeners()}var a=o.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},a.registerListeners=function(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this)},a.unregisterListeners=function(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this)},a.getLicenseServerUrl=function(e){var r=this.config,i=r.drmSystems,s=r.widevineLicenseUrl,l=i[e];if(l)return l.licenseUrl;if(e===pt.WIDEVINE&&s)return s;throw new Error('no license server URL configured for key-system "'+e+'"')},a.getServerCertificateUrl=function(e){var r=this.config.drmSystems[e];if(r)return r.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},a.attemptKeySystemAccess=function(e){var r=this,i=this.hls.levels,s=function(v,m,p){return!!v&&p.indexOf(v)===m},l=i.map(function(f){return f.audioCodec}).filter(s),d=i.map(function(f){return f.videoCodec}).filter(s);return l.length+d.length===0&&d.push("avc1.42e01e"),new Promise(function(f,v){(function m(p){var y=p.shift();r.getMediaKeysPromise(y,l,d).then(function(_){return f({keySystem:y,mediaKeys:_})}).catch(function(_){p.length?m(p):_ instanceof Lr?v(_):v(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_NO_ACCESS,error:_,fatal:!0},_.message))})})(e)})},a.requestMediaKeySystemAccess=function(e,r){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var s="Configured requestMediaKeySystemAccess is not a function "+i;return le===null&&self.location.protocol==="http:"&&(s="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(s))}return i(e,r)},a.getMediaKeysPromise=function(e,r,i){var s=this,l=ye(e,r,i,this.config.drmSystemOptions),d=this.keySystemAccessPromises[e],f=d?.keySystemAccess;if(!f){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(l)),f=this.requestMediaKeySystemAccess(e,l);var v=this.keySystemAccessPromises[e]={keySystemAccess:f};return f.catch(function(m){s.log('Failed to obtain access to key-system "'+e+'": '+m)}),f.then(function(m){s.log('Access for key-system "'+m.keySystem+'" obtained');var p=s.fetchServerCertificate(e);return s.log('Create media-keys for "'+e+'"'),v.mediaKeys=m.createMediaKeys().then(function(y){return s.log('Media-keys created for "'+e+'"'),p.then(function(_){return _?s.setMediaKeysServerCertificate(y,e,_):y})}),v.mediaKeys.catch(function(y){s.error('Failed to create media-keys for "'+e+'"}: '+y)}),v.mediaKeys})}return f.then(function(){return d.mediaKeys})},a.createMediaKeySessionContext=function(e){var r=e.decryptdata,i=e.keySystem,s=e.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+yt.hexDump(r.keyId||[]));var l={decryptdata:r,keySystem:i,mediaKeys:s,mediaKeysSession:s.createSession(),keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l},a.renewKeySession=function(e){var r=e.decryptdata;if(r.pssh){var i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(r),l="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,l,r.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},a.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return yt.hexDump(e.keyId)},a.updateKeySession=function(e,r){var i,s=e.mediaKeysSession;return this.log('Updating key-session "'+s.sessionId+'" for keyID '+yt.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])+`
      } (data length: `+(r&&r.byteLength)+")"),s.update(r)},a.selectKeySystemFormat=function(e){var r=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+r.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise},a.getKeyFormatPromise=function(e){var r=this;return new Promise(function(i,s){var l=Q(r.config),d=e.map(ji).filter(function(f){return!!f&&l.indexOf(f)!==-1});return r.getKeySystemSelectionPromise(d).then(function(f){var v=f.keySystem,m=O(v);m?i(m):s(new Error('Unable to find format for key-system "'+v+'"'))}).catch(s)})},a.loadKey=function(e){var r=this,i=e.keyInfo.decryptdata,s=this.getKeyIdString(i),l="(keyId: "+s+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+l);var d=this.keyIdToKeySessionPromise[s];return d||(d=this.keyIdToKeySessionPromise[s]=this.getKeySystemForKeyPromise(i).then(function(f){var v=f.keySystem,m=f.mediaKeys;return r.throwIfDestroyed(),r.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+l),r.attemptSetMediaKeys(v,m).then(function(){r.throwIfDestroyed();var p=r.createMediaKeySessionContext({keySystem:v,mediaKeys:m,decryptdata:i});return r.generateRequestWithPreferredKeySession(p,"cenc",i.pssh,"playlist-key")})}),d.catch(function(f){return r.handleError(f)})),d},a.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},a.handleError=function(e){this.hls&&(this.error(e.message),e instanceof Lr?this.hls.trigger(A.ERROR,e.data):this.hls.trigger(A.ERROR,{type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},a.getKeySystemForKeyPromise=function(e){var r=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[r];if(!i){var s=ji(e.keyFormat),l=s?[s]:Q(this.config);return this.attemptKeySystemAccess(l)}return i},a.getKeySystemSelectionPromise=function(e){if(e.length||(e=Q(this.config)),e.length===0)throw new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},a._onMediaEncrypted=function(e){var r=this,i=e.initDataType,s=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+i+'"'),s!==null){var l,d;if(i==="sinf"&&this.config.drmSystems[pt.FAIRPLAY]){var f=je(new Uint8Array(s));try{var v=Fi(JSON.parse(f).sinf),m=We(new Uint8Array(v));if(!m)return;l=m.subarray(8,24),d=pt.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var p=Mr(s);if(p===null)return;p.version===0&&p.systemId===Ni.WIDEVINE&&p.data&&(l=p.data.subarray(8,24)),d=hr(p.systemId)}if(!(!d||!l)){for(var y=yt.hexDump(l),_=this.keyIdToKeySessionPromise,b=this.mediaKeySessions,T=_[y],w=function(){var F=b[D],V=F.decryptdata;if(V.pssh||!V.keyId)return 0;var G=yt.hexDump(V.keyId);if(y===G||V.uri.replace(/-/g,"").indexOf(y)!==-1)return T=_[G],delete _[G],V.pssh=new Uint8Array(s),V.keyId=l,T=_[y]=T.then(function(){return r.generateRequestWithPreferredKeySession(F,i,s,"encrypted-event-key-match")}),1},I,D=0;D<b.length&&(I=w(),!(I!==0&&I===1));D++);T||(T=_[y]=this.getKeySystemSelectionPromise([d]).then(function(N){var F,V=N.keySystem,G=N.mediaKeys;r.throwIfDestroyed();var B=new Ui("ISO-23001-7",y,(F=O(V))!=null?F:"");return B.pssh=new Uint8Array(s),B.keyId=l,r.attemptSetMediaKeys(V,G).then(function(){r.throwIfDestroyed();var H=r.createMediaKeySessionContext({decryptdata:B,keySystem:V,mediaKeys:G});return r.generateRequestWithPreferredKeySession(H,i,s,"encrypted-event-no-match")})})),T.catch(function(N){return r.handleError(N)})}}},a._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},a.attemptSetMediaKeys=function(e,r){var i=this,s=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var l=Promise.all(s).then(function(){if(!i.media)throw new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(l),l.then(function(){i.log('Media-keys set for "'+e+'"'),s.push(l),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(d){return s.indexOf(d)===-1})})},a.generateRequestWithPreferredKeySession=function(e,r,i,s){var l,d,f=this,v=(l=this.config.drmSystems)==null||(d=l[e.keySystem])==null?void 0:d.generateRequest;if(v)try{var m=v.call(this.hls,r,i,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");r=m.initDataType,i=e.decryptdata.pssh=m.initData?new Uint8Array(m.initData):null}catch(I){var p;if(this.warn(I.message),(p=this.hls)!=null&&p.config.debug)throw I}if(i===null)return this.log('Skipping key-session request for "'+s+'" (no initData)'),Promise.resolve(e);var y=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+s+'": '+y+" (init data type: "+r+" length: "+(i?i.byteLength:null)+")");var _=new gn,b=e._onmessage=function(I){var D=e.mediaKeysSession;if(!D){_.emit("error",new Error("invalid state"));return}var N=I.messageType,F=I.message;f.log('"'+N+'" message event for session "'+D.sessionId+'" message size: '+F.byteLength),N==="license-request"||N==="license-renewal"?f.renewLicense(e,F).catch(function(V){f.handleError(V),_.emit("error",V)}):N==="license-release"?e.keySystem===pt.FAIRPLAY&&(f.updateKeySession(e,rr("acknowledged")),f.removeSession(e)):f.warn('unhandled media key message type "'+N+'"')},T=e._onkeystatuseschange=function(I){if(!e.mediaKeysSession){_.emit("error",new Error("invalid state"));return}f.onKeyStatusChange(e);var D=e.keyStatus;_.emit("keyStatus",D),D==="expired"&&(f.warn(e.keySystem+" expired for key "+y),f.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",b),e.mediaKeysSession.addEventListener("keystatuseschange",T);var w=new Promise(function(I,D){_.on("error",D),_.on("keyStatus",function(N){N.startsWith("usable")?I():N==="output-restricted"?D(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):N==="internal-error"?D(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+N+'"')):N==="expired"?D(new Error("key expired while generating request")):f.warn('unhandled key status change "'+N+'"')})});return e.mediaKeysSession.generateRequest(r,i).then(function(){var I;f.log('Request generated for key-session "'+((I=e.mediaKeysSession)==null?void 0:I.sessionId)+'" keyId: '+y)}).catch(function(I){throw new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_NO_SESSION,error:I,fatal:!1},"Error generating key-session request: "+I)}).then(function(){return w}).catch(function(I){throw _.removeAllListeners(),f.removeSession(e),I}).then(function(){return _.removeAllListeners(),e})},a.onKeyStatusChange=function(e){var r=this;e.mediaKeysSession.keyStatuses.forEach(function(i,s){r.log('key status change "'+i+'" for keyStatuses keyId: '+yt.hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))+" session keyId: "+yt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=i})},a.fetchServerCertificate=function(e){var r=this.config,i=r.loader,s=new i(r),l=this.getServerCertificateUrl(e);return l?(this.log('Fetching server certificate for "'+e+'"'),new Promise(function(d,f){var v={responseType:"arraybuffer",url:l},m=r.certLoadPolicy.default,p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};s.load(v,p,{onSuccess:function(_,b,T,w){d(_.data)},onError:function(_,b,T,w){f(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:R({url:v.url,data:void 0},_)},'"'+e+'" certificate request failed ('+l+"). Status: "+_.code+" ("+_.text+")"))},onTimeout:function(_,b,T){f(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:{url:v.url,data:void 0}},'"'+e+'" certificate request timed out ('+l+")"))},onAbort:function(_,b,T){f(new Error("aborted"))}})})):Promise.resolve()},a.setMediaKeysServerCertificate=function(e,r,i){var s=this;return new Promise(function(l,d){e.setServerCertificate(i).then(function(f){s.log("setServerCertificate "+(f?"success":"not supported by CDM")+" ("+i?.byteLength+') on "'+r+'"'),l(e)}).catch(function(f){d(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:f,fatal:!0},f.message))})})},a.renewLicense=function(e,r){var i=this;return this.requestLicense(e,new Uint8Array(r)).then(function(s){return i.updateKeySession(e,new Uint8Array(s)).catch(function(l){throw new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:l,fatal:!0},l.message)})})},a.unpackPlayReadyKeyMessage=function(e,r){var i=String.fromCharCode.apply(null,new Uint16Array(r.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),r;var s=new DOMParser().parseFromString(i,"application/xml"),l=s.querySelectorAll("HttpHeader");if(l.length>0)for(var d,f=0,v=l.length;f<v;f++){var m,p;d=l[f];var y=(m=d.querySelector("name"))==null?void 0:m.textContent,_=(p=d.querySelector("value"))==null?void 0:p.textContent;y&&_&&e.setRequestHeader(y,_)}var b=s.querySelector("Challenge"),T=b?.textContent;if(!T)throw new Error("Cannot find <Challenge> in key message");return rr(atob(T))},a.setupLicenseXHR=function(e,r,i,s){var l=this,d=this.config.licenseXhrSetup;return d?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return d.call(l.hls,e,r,i,s)}).catch(function(f){if(!i.decryptdata)throw f;return e.open("POST",r,!0),d.call(l.hls,e,r,i,s)}).then(function(f){return e.readyState||e.open("POST",r,!0),{xhr:e,licenseChallenge:f||s}}):(e.open("POST",r,!0),Promise.resolve({xhr:e,licenseChallenge:s}))},a.requestLicense=function(e,r){var i=this,s=this.config.keyLoadPolicy.default;return new Promise(function(l,d){var f=i.getLicenseServerUrl(e.keySystem);i.log("Sending license request to URL: "+f);var v=new XMLHttpRequest;v.responseType="arraybuffer",v.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return d(new Error("invalid state"));if(v.readyState===4)if(v.status===200){i._requestLicenseFailureCount=0;var m=v.response;i.log("License received "+(m instanceof ArrayBuffer?m.byteLength:m));var p=i.config.licenseResponseCallback;if(p)try{m=p.call(i.hls,v,f,e)}catch(T){i.error(T)}l(m)}else{var y=s.errorRetry,_=y?y.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>_||v.status>=400&&v.status<500)d(new Lr({type:re.KEY_SYSTEM_ERROR,details:U.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:f,data:void 0,code:v.status,text:v.statusText}},"License Request XHR failed ("+f+"). Status: "+v.status+" ("+v.statusText+")"));else{var b=_-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+b+" attempts left"),i.requestLicense(e,r).then(l,d)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=v,i.setupLicenseXHR(v,f,e,r).then(function(m){var p=m.xhr,y=m.licenseChallenge;e.keySystem==pt.PLAYREADY&&(y=i.unpackPlayReadyKeyMessage(p,y)),p.send(y)})})},a.onMediaAttached=function(e,r){if(this.config.emeEnabled){var i=r.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}},a.onMediaDetached=function(){var e=this,r=this.media,i=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ui.clearKeyUriToKeyIdMap();var s=i.length;o.CDMCleanupPromise=Promise.all(i.map(function(l){return e.removeSession(l)}).concat(r?.setMediaKeys(null).catch(function(l){e.log("Could not clear media keys: "+l)}))).then(function(){s&&(e.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(function(l){e.log("Could not close sessions and clear media keys: "+l)})},a.onManifestLoading=function(){this.keyFormatPromise=null},a.onManifestLoaded=function(e,r){var i=r.sessionKeys;if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){var s=i.reduce(function(l,d){return l.indexOf(d.keyFormat)===-1&&l.push(d.keyFormat),l},[]);this.log("Selecting key-system from session-keys "+s.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(s)}},a.removeSession=function(e){var r=this,i=e.mediaKeysSession,s=e.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var l=this.mediaKeySessions.indexOf(e);return l>-1&&this.mediaKeySessions.splice(l,1),i.remove().catch(function(d){r.log("Could not remove session: "+d)}).then(function(){return i.close()}).catch(function(d){r.log("Could not close session: "+d)})}},o}();Ps.CDMCleanupPromise=void 0;var Lr=function(o){ie(a,o);function a(n,e){var r=o.call(this,e)||this;return r.data=void 0,n.error||(n.error=new Error(e)),r.data=n,n.err=n.error,r}return a}(xe(Error)),ar;(function(o){o.MANIFEST="m",o.AUDIO="a",o.VIDEO="v",o.MUXED="av",o.INIT="i",o.CAPTION="c",o.TIMED_TEXT="tt",o.KEY="k",o.OTHER="o"})(ar||(ar={}));var la;(function(o){o.DASH="d",o.HLS="h",o.SMOOTH="s",o.OTHER="o"})(la||(la={}));var mi;(function(o){o.OBJECT="CMCD-Object",o.REQUEST="CMCD-Request",o.SESSION="CMCD-Session",o.STATUS="CMCD-Status"})(mi||(mi={}));var Mi,mu=(Mi={},Mi[mi.OBJECT]=["br","d","ot","tb"],Mi[mi.REQUEST]=["bl","dl","mtp","nor","nrr","su"],Mi[mi.SESSION]=["cid","pr","sf","sid","st","v"],Mi[mi.STATUS]=["bs","rtp"],Mi),ua=function o(a,n){this.value=void 0,this.params=void 0,Array.isArray(a)&&(a=a.map(function(e){return e instanceof o?e:new o(e)})),this.value=a,this.params=n},Ms=function(a){this.description=void 0,this.description=a},gu="Dict";function pu(o){return Array.isArray(o)?JSON.stringify(o):o instanceof Map?"Map{}":o instanceof Set?"Set{}":typeof o=="object"?JSON.stringify(o):String(o)}function yu(o,a,n,e){return new Error("failed to "+o+' "'+pu(a)+'" as '+n,{cause:e})}var xs="Bare Item",Eu="Boolean",_u="Byte Sequence",Su="Decimal",Tu="Integer";function bu(o){return o<-999999999999999||999999999999999<o}var Au=/[\x00-\x1f\x7f]+/,Lu="Token",Ru="Key";function Gr(o,a,n){return yu("serialize",o,a,n)}function wu(o){if(typeof o!="boolean")throw Gr(o,Eu);return o?"?1":"?0"}function Iu(o){return btoa(String.fromCharCode.apply(String,o))}function ku(o){if(ArrayBuffer.isView(o)===!1)throw Gr(o,_u);return":"+Iu(o)+":"}function Fs(o){if(bu(o))throw Gr(o,Tu);return o.toString()}function Cu(o){return"@"+Fs(o.getTime()/1e3)}function Ns(o,a){if(o<0)return-Ns(-o,a);var n=Math.pow(10,a);if(Math.abs(o*n%1-.5)<Number.EPSILON){var e=Math.floor(o*n);return(e%2===0?e:e+1)/n}else return Math.round(o*n)/n}function Du(o){var a=Ns(o,3);if(Math.floor(Math.abs(a)).toString().length>12)throw Gr(o,Su);var n=a.toString();return n.includes(".")?n:n+".0"}var Ou="String";function Pu(o){if(Au.test(o))throw Gr(o,Ou);return'"'+o.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Mu(o){return o.description||o.toString().slice(7,-1)}function Bs(o){var a=Mu(o);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(a)===!1)throw Gr(a,Lu);return a}function ca(o){switch(typeof o){case"number":if(!ne(o))throw Gr(o,xs);return Number.isInteger(o)?Fs(o):Du(o);case"string":return Pu(o);case"symbol":return Bs(o);case"boolean":return wu(o);case"object":if(o instanceof Date)return Cu(o);if(o instanceof Uint8Array)return ku(o);if(o instanceof Ms)return Bs(o);default:throw Gr(o,xs)}}function da(o){if(/^[a-z*][a-z0-9\-_.*]*$/.test(o)===!1)throw Gr(o,Ru);return o}function fa(o){return o==null?"":Object.entries(o).map(function(a){var n=a[0],e=a[1];return e===!0?";"+da(n):";"+da(n)+"="+ca(e)}).join("")}function Us(o){return o instanceof ua?""+ca(o.value)+fa(o.params):ca(o)}function xu(o){return"("+o.value.map(Us).join(" ")+")"+fa(o.params)}function Fu(o,a){var n;if(a===void 0&&(a={whitespace:!0}),typeof o!="object")throw Gr(o,gu);var e=o instanceof Map?o.entries():Object.entries(o),r=(n=a)!=null&&n.whitespace?" ":"";return Array.from(e).map(function(i){var s=i[0],l=i[1];l instanceof ua||(l=new ua(l));var d=da(s);return l.value===!0?d+=fa(l.params):(d+="=",Array.isArray(l.value)?d+=xu(l):d+=Us(l)),d}).join(","+r)}function Nu(o,a){return Fu(o,a)}var Bu=function(a){return a==="ot"||a==="sf"||a==="st"},Uu=function(a){return typeof a=="number"?ne(a):a!=null&&a!==""&&a!==!1};function Vu(o,a){var n=new URL(o),e=new URL(a);if(n.origin!==e.origin)return o;for(var r=n.pathname.split("/").slice(1),i=e.pathname.split("/").slice(1,-1);r[0]===i[0];)r.shift(),i.shift();for(;i.length;)i.shift(),r.unshift("..");return r.join("/")}function Gu(){try{return crypto.randomUUID()}catch{try{var o=URL.createObjectURL(new Blob),a=o.toString();return URL.revokeObjectURL(o),a.slice(a.lastIndexOf("/")+1)}catch{var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(i=="x"?s:s&3|8).toString(16)})}}}var Sn=function(a){return Math.round(a)},qu=function(a,n){return n!=null&&n.baseUrl&&(a=Vu(a,n.baseUrl)),encodeURIComponent(a)},Tn=function(a){return Sn(a/100)*100},Hu={br:Sn,d:Sn,bl:Tn,dl:Tn,mtp:Tn,nor:qu,rtp:Tn,tb:Sn};function zu(o,a){var n={};if(o==null||typeof o!="object")return n;var e=Object.keys(o).sort(),r=X({},Hu,a?.formatters),i=a?.filter;return e.forEach(function(s){if(!(i!=null&&i(s))){var l=o[s],d=r[s];d&&(l=d(l,a)),!(s==="v"&&l===1)&&(s=="pr"&&l===1||Uu(l)&&(Bu(s)&&typeof l=="string"&&(l=new Ms(l)),n[s]=l))}}),n}function Vs(o,a){return a===void 0&&(a={}),o?Nu(zu(o,a),X({whitespace:!1},a)):""}function Ku(o,a){var n;if(a===void 0&&(a={}),!o)return{};var e=Object.entries(o),r=Object.entries(mu).concat(Object.entries(((n=a)==null?void 0:n.customHeaderMap)||{})),i=e.reduce(function(s,l){var d,f=l[0],v=l[1],m=((d=r.find(function(p){return p[1].includes(f)}))==null?void 0:d[0])||mi.REQUEST;return s[m]??(s[m]={}),s[m][f]=v,s},{});return Object.entries(i).reduce(function(s,l){var d=l[0],f=l[1];return s[d]=Vs(f,a),s},{})}function ju(o,a,n){return X(o,Ku(a,n))}var Wu="CMCD";function Yu(o,a){if(a===void 0&&(a={}),!o)return"";var n=Vs(o,a);return Wu+"="+encodeURIComponent(n)}var Gs=/CMCD=[^&#]+/;function $u(o,a,n){var e=Yu(a,n);if(!e)return o;if(Gs.test(o))return o.replace(Gs,e);var r=o.includes("?")?"&":"?";return""+o+r+e}var Xu=function(){function o(n){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(s){try{e.apply(s,{ot:ar.MANIFEST,su:!e.initialized})}catch(l){P.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=function(s){try{var l=s.frag,d=e.hls.levels[l.level],f=e.getObjectType(l),v={d:l.duration*1e3,ot:f};(f===ar.VIDEO||f===ar.AUDIO||f==ar.MUXED)&&(v.br=d.bitrate/1e3,v.tb=e.getTopBandwidth(f)/1e3,v.bl=e.getBufferLength(f)),e.apply(s,v)}catch(m){P.warn("Could not generate segment CMCD data.",m)}},this.hls=n;var r=this.config=n.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Gu(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}var a=o.prototype;return a.registerListeners=function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)},a.unregisterListeners=function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)},a.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null},a.onMediaAttached=function(e,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},a.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},a.onBufferCreated=function(e,r){var i,s;this.audioBuffer=(i=r.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=r.tracks.video)==null?void 0:s.buffer},a.createData=function(){var e;return{v:1,sf:la.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},a.apply=function(e,r){r===void 0&&(r={}),X(r,this.createData());var i=r.ot===ar.INIT||r.ot===ar.VIDEO||r.ot===ar.MUXED;this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering);var s=this.includeKeys;s&&(r=Object.keys(r).reduce(function(l,d){return s.includes(d)&&(l[d]=r[d]),l},{})),this.useHeaders?(e.headers||(e.headers={}),ju(e.headers,r)):e.url=$u(e.url,r)},a.getObjectType=function(e){var r=e.type;if(r==="subtitle")return ar.TIMED_TEXT;if(e.sn==="initSegment")return ar.INIT;if(r==="audio")return ar.AUDIO;if(r==="main")return this.hls.audioTracks.length?ar.VIDEO:ar.MUXED},a.getTopBandwidth=function(e){var r=0,i,s=this.hls;if(e===ar.AUDIO)i=s.audioTracks;else{var l=s.maxAutoLevel,d=l>-1?l+1:s.levels.length;i=s.levels.slice(0,d)}for(var f=ht(i),v;!(v=f()).done;){var m=v.value;m.bitrate>r&&(r=m.bitrate)}return r>0?r:NaN},a.getBufferLength=function(e){var r=this.hls.media,i=e===ar.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!r?NaN:Dt.bufferInfo(i,r.currentTime,this.config.maxBufferHole).len*1e3},a.createPlaylistLoader=function(){var e=this.config.pLoader,r=this.applyPlaylistData,i=e||this.config.loader;return function(){function s(d){this.loader=void 0,this.loader=new i(d)}var l=s.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(f,v,m){r(f),this.loader.load(f,v,m)},x(s,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),s}()},a.createFragmentLoader=function(){var e=this.config.fLoader,r=this.applyFragmentData,i=e||this.config.loader;return function(){function s(d){this.loader=void 0,this.loader=new i(d)}var l=s.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(f,v,m){r(f),this.loader.load(f,v,m)},x(s,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),s}()},o}(),Qu=3e5,Ju=function(){function o(n){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=n,this.log=P.log.bind(P,"[content-steering]:"),this.registerListeners()}var a=o.prototype;return a.registerListeners=function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))},a.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},a.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},a.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},a.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},a.removeLevel=function(e){var r=this.levels;r&&(this.levels=r.filter(function(i){return i!==e}))},a.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},a.onManifestLoaded=function(e,r){var i=r.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},a.onManifestParsed=function(e,r){this.audioTracks=r.audioTracks,this.subtitleTracks=r.subtitleTracks},a.onError=function(e,r){var i=r.errorAction;if(i?.action===Zt.SendAlternateToPenaltyBox&&i.flags===Cr.MoveAllAlternatesMatchingHost){var s=this.levels,l=this.pathwayPriority,d=this.pathwayId;if(r.context){var f=r.context,v=f.groupId,m=f.pathwayId,p=f.type;v&&s?d=this.getPathwayForGroupId(v,p,d):m&&(d=m)}d in this.penalizedPathways||(this.penalizedPathways[d]=performance.now()),!l&&s&&(l=s.reduce(function(y,_){return y.indexOf(_.pathwayId)===-1&&y.push(_.pathwayId),y},[])),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==d),i.resolved||P.warn("Could not resolve "+r.details+' ("'+r.error.message+'") with content-steering for Pathway: '+d+" levels: "+(s&&s.length)+" priorities: "+JSON.stringify(l)+" penalized: "+JSON.stringify(this.penalizedPathways))}},a.filterParsedLevels=function(e){this.levels=e;var r=this.getLevelsForPathway(this.pathwayId);if(r.length===0){var i=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),r=this.getLevelsForPathway(i),this.pathwayId=i}return r.length!==e.length?(this.log("Found "+r.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),r):e},a.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(r){return e===r.pathwayId})},a.updatePathwayPriority=function(e){this.pathwayPriority=e;var r,i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(function(p){s-i[p]>Qu&&delete i[p]});for(var l=0;l<e.length;l++){var d=e[l];if(!(d in i)){if(d===this.pathwayId)return;var f=this.hls.nextLoadLevel,v=this.hls.levels[f];if(r=this.getLevelsForPathway(d),r.length>0){this.log('Setting Pathway to "'+d+'"'),this.pathwayId=d,wa(r),this.hls.trigger(A.LEVELS_UPDATED,{levels:r});var m=this.hls.levels[f];v&&m&&this.levels&&(m.attrs["STABLE-VARIANT-ID"]!==v.attrs["STABLE-VARIANT-ID"]&&m.bitrate!==v.bitrate&&this.log("Unstable Pathways change from bitrate "+v.bitrate+" to "+m.bitrate),this.hls.nextLoadLevel=f);break}}}},a.getPathwayForGroupId=function(e,r,i){for(var s=this.getLevelsForPathway(i).concat(this.levels||[]),l=0;l<s.length;l++)if(r===_e.AUDIO_TRACK&&s[l].hasAudioGroup(e)||r===_e.SUBTITLE_TRACK&&s[l].hasSubtitleGroup(e))return s[l].pathwayId;return i},a.clonePathways=function(e){var r=this,i=this.levels;if(i){var s={},l={};e.forEach(function(d){var f=d.ID,v=d["BASE-ID"],m=d["URI-REPLACEMENT"];if(!i.some(function(y){return y.pathwayId===f})){var p=r.getLevelsForPathway(v).map(function(y){var _=new te(y.attrs);_["PATHWAY-ID"]=f;var b=_.AUDIO&&_.AUDIO+"_clone_"+f,T=_.SUBTITLES&&_.SUBTITLES+"_clone_"+f;b&&(s[_.AUDIO]=b,_.AUDIO=b),T&&(l[_.SUBTITLES]=T,_.SUBTITLES=T);var w=Hs(y.uri,_["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",m),I=new Ri({attrs:_,audioCodec:y.audioCodec,bitrate:y.bitrate,height:y.height,name:y.name,url:w,videoCodec:y.videoCodec,width:y.width});if(y.audioGroups)for(var D=1;D<y.audioGroups.length;D++)I.addGroupId("audio",y.audioGroups[D]+"_clone_"+f);if(y.subtitleGroups)for(var N=1;N<y.subtitleGroups.length;N++)I.addGroupId("text",y.subtitleGroups[N]+"_clone_"+f);return I});i.push.apply(i,p),qs(r.audioTracks,s,m,f),qs(r.subtitleTracks,l,m,f)}})}},a.loadSteeringManifest=function(e){var r=this,i=this.hls.config,s=i.loader;this.loader&&this.loader.destroy(),this.loader=new s(i);var l;try{l=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(l.protocol!=="data:"){var d=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+d)}var f={responseType:"json",url:l.href},v=i.steeringManifestLoadPolicy.default,m=v.errorRetry||v.timeoutRetry||{},p={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:m.maxNumRetry||0,retryDelay:m.retryDelayMs||0,maxRetryDelay:m.maxRetryDelayMs||0},y={onSuccess:function(b,T,w,I){r.log('Loaded steering manifest: "'+l+'"');var D=b.data;if(D.VERSION!==1){r.log("Steering VERSION "+D.VERSION+" not supported!");return}r.updated=performance.now(),r.timeToLoad=D.TTL;var N=D["RELOAD-URI"],F=D["PATHWAY-CLONES"],V=D["PATHWAY-PRIORITY"];if(N)try{r.uri=new self.URL(N,l).href}catch{r.enabled=!1,r.log("Failed to parse Steering Manifest RELOAD-URI: "+N);return}r.scheduleRefresh(r.uri||w.url),F&&r.clonePathways(F);var G={steeringManifest:D,url:l.toString()};r.hls.trigger(A.STEERING_MANIFEST_LOADED,G),V&&r.updatePathwayPriority(V)},onError:function(b,T,w,I){if(r.log("Error loading steering manifest: "+b.code+" "+b.text+" ("+T.url+")"),r.stopLoad(),b.code===410){r.enabled=!1,r.log("Steering manifest "+T.url+" no longer available");return}var D=r.timeToLoad*1e3;if(b.code===429){var N=r.loader;if(typeof N?.getResponseHeader=="function"){var F=N.getResponseHeader("Retry-After");F&&(D=parseFloat(F)*1e3)}r.log("Steering manifest "+T.url+" rate limited");return}r.scheduleRefresh(r.uri||T.url,D)},onTimeout:function(b,T,w){r.log("Timeout loading steering manifest ("+T.url+")"),r.scheduleRefresh(r.uri||T.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(f,p,y)},a.scheduleRefresh=function(e,r){var i=this;r===void 0&&(r=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var s,l=(s=i.hls)==null?void 0:s.media;if(l&&!l.ended){i.loadSteeringManifest(e);return}i.scheduleRefresh(e,i.timeToLoad*1e3)},r)},o}();function qs(o,a,n,e){o&&Object.keys(a).forEach(function(r){var i=o.filter(function(s){return s.groupId===r}).map(function(s){var l=X({},s);return l.details=void 0,l.attrs=new te(l.attrs),l.url=l.attrs.URI=Hs(s.url,s.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),l.groupId=l.attrs["GROUP-ID"]=a[r],l.attrs["PATHWAY-ID"]=e,l});o.push.apply(o,i)})}function Hs(o,a,n,e){var r=e.HOST,i=e.PARAMS,s=e[n],l;a&&(l=s?.[a],l&&(o=l));var d=new self.URL(o);return r&&!l&&(d.host=r),i&&Object.keys(i).sort().forEach(function(f){f&&d.searchParams.set(f,i[f])}),d.href}var Zu=/^age:\s*[\d.]+\s*$/im,zs=function(){function o(n){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=n&&n.xhrSetup||null,this.stats=new pe,this.retryDelay=0}var a=o.prototype;return a.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},a.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},a.load=function(e,r,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=r,this.callbacks=i,this.loadInternal()},a.loadInternal=function(){var e=this,r=this.config,i=this.context;if(!(!r||!i)){var s=this.loader=new self.XMLHttpRequest,l=this.stats;l.loading.first=0,l.loaded=0,l.aborted=!1;var d=this.xhrSetup;d?Promise.resolve().then(function(){if(!(e.loader!==s||e.stats.aborted))return d(s,i.url)}).catch(function(f){if(!(e.loader!==s||e.stats.aborted))return s.open("GET",i.url,!0),d(s,i.url)}).then(function(){e.loader!==s||e.stats.aborted||e.openAndSendXhr(s,i,r)}).catch(function(f){e.callbacks.onError({code:s.status,text:f.message},i,s,l)}):this.openAndSendXhr(s,i,r)}},a.openAndSendXhr=function(e,r,i){e.readyState||e.open("GET",r.url,!0);var s=r.headers,l=i.loadPolicy,d=l.maxTimeToFirstByteMs,f=l.maxLoadTimeMs;if(s)for(var v in s)e.setRequestHeader(v,s[v]);r.rangeEnd&&e.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=r.responseType,self.clearTimeout(this.requestTimeout),i.timeout=d&&ne(d)?d:f,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()},a.readystatechange=function(){var e=this.context,r=this.loader,i=this.stats;if(!(!e||!r)){var s=r.readyState,l=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),r.onreadystatechange=null,r.onprogress=null;var d=r.status,f=r.responseType!=="text";if(d>=200&&d<300&&(f&&r.response||r.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);var v=f?r.response:r.responseText;if(i.loaded=i.total=r.responseType==="arraybuffer"?v.byteLength:v.length,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;var m=this.callbacks.onProgress;if(m&&m(i,e,v,r),!this.callbacks)return;var p={url:r.responseURL,data:v,code:d};this.callbacks.onSuccess(p,i,e,r)}else{var y=l.loadPolicy.errorRetry,_=i.retry;nn(y,_,!1,{url:e.url,data:void 0,code:d})?this.retry(y):(P.error(d+" while loading "+e.url),this.callbacks.onError({code:d,text:r.statusText},e,r,i))}}}},a.loadtimeout=function(){if(this.config){var e=this.config.loadPolicy.timeoutRetry,r=this.stats.retry;if(nn(e,r,!0))this.retry(e);else{var i;P.warn("timeout while loading "+((i=this.context)==null?void 0:i.url));var s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}},a.retry=function(e){var r=this.context,i=this.stats;this.retryDelay=xn(e,i.retry),i.retry++,P.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+r?.url+", retrying "+i.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},a.loadprogress=function(e){var r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total)},a.getCacheAge=function(){var e=null;if(this.loader&&Zu.test(this.loader.getAllResponseHeaders())){var r=this.loader.getResponseHeader("age");e=r?parseFloat(r):null}return e},a.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},o}();function ec(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var tc=/(\d+)-(\d+)\/(\d+)/,Ks=function(){function o(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||ac,this.controller=new self.AbortController,this.stats=new pe}var a=o.prototype;return a.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},a.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(e,r,i){var s=this,l=this.stats;if(l.loading.start)throw new Error("Loader can only be used once.");l.loading.start=self.performance.now();var d=rc(e,this.controller.signal),f=i.onProgress,v=e.responseType==="arraybuffer",m=v?"byteLength":"length",p=r.loadPolicy,y=p.maxTimeToFirstByteMs,_=p.maxLoadTimeMs;this.context=e,this.config=r,this.callbacks=i,this.request=this.fetchSetup(e,d),self.clearTimeout(this.requestTimeout),r.timeout=y&&ne(y)?y:_,this.requestTimeout=self.setTimeout(function(){s.abortInternal(),i.onTimeout(l,e,s.response)},r.timeout),self.fetch(this.request).then(function(b){s.response=s.loader=b;var T=Math.max(self.performance.now(),l.loading.start);if(self.clearTimeout(s.requestTimeout),r.timeout=_,s.requestTimeout=self.setTimeout(function(){s.abortInternal(),i.onTimeout(l,e,s.response)},_-(T-l.loading.start)),!b.ok){var w=b.status,I=b.statusText;throw new sc(I||"fetch, bad network response",w,b)}return l.loading.first=T,l.total=nc(b.headers)||l.total,f&&ne(r.highWaterMark)?s.loadProgressively(b,l,e,r.highWaterMark,f):v?b.arrayBuffer():e.responseType==="json"?b.json():b.text()}).then(function(b){var T=s.response;if(!T)throw new Error("loader destroyed");self.clearTimeout(s.requestTimeout),l.loading.end=Math.max(self.performance.now(),l.loading.first);var w=b[m];w&&(l.loaded=l.total=w);var I={url:T.url,data:b,code:T.status};f&&!ne(r.highWaterMark)&&f(l,e,b,T),i.onSuccess(I,l,e,T)}).catch(function(b){if(self.clearTimeout(s.requestTimeout),!l.aborted){var T=b&&b.code||0,w=b?b.message:null;i.onError({code:T,text:w},e,b?b.details:null,l)}})},a.getCacheAge=function(){var e=null;if(this.response){var r=this.response.headers.get("age");e=r?parseFloat(r):null}return e},a.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},a.loadProgressively=function(e,r,i,s,l){s===void 0&&(s=0);var d=new Ua,f=e.body.getReader();return function v(){return f.read().then(function(m){if(m.done)return d.dataLength&&l(r,i,d.flush(),e),Promise.resolve(new ArrayBuffer(0));var p=m.value,y=p.length;return r.loaded+=y,y<s||d.dataLength?(d.push(p),d.dataLength>=s&&l(r,i,d.flush(),e)):l(r,i,p,e),v()}).catch(function(){return Promise.reject()})}()},o}();function rc(o,a){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:a,headers:new self.Headers(X({},o.headers))};return o.rangeEnd&&n.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),n}function ic(o){var a=tc.exec(o);if(a)return parseInt(a[2])-parseInt(a[1])+1}function nc(o){var a=o.get("Content-Range");if(a){var n=ic(a);if(ne(n))return n}var e=o.get("Content-Length");if(e)return parseInt(e)}function ac(o,a){return new self.Request(o.url,a)}var sc=function(o){ie(a,o);function a(n,e,r){var i=o.call(this,n)||this;return i.code=void 0,i.details=void 0,i.code=e,i.details=r,i}return a}(xe(Error)),oc=/\s/,lc={newCue:function(a,n,e,r){for(var i=[],s,l,d,f,v,m=self.VTTCue||self.TextTrackCue,p=0;p<r.rows.length;p++)if(s=r.rows[p],d=!0,f=0,v="",!s.isEmpty()){for(var y,_=0;_<s.chars.length;_++)oc.test(s.chars[_].uchar)&&d?f++:(v+=s.chars[_].uchar,d=!1);s.cueStartTime=n,n===e&&(e+=1e-4),f>=16?f--:f++;var b=bs(v.trim()),T=ia(n,e,b);a!=null&&(y=a.cues)!=null&&y.getCueById(T)||(l=new m(n,e,b),l.id=T,l.line=p+1,l.align="left",l.position=10+Math.min(80,Math.floor(f*8/32)*10),i.push(l))}return a&&i.length&&(i.sort(function(w,I){return w.line==="auto"||I.line==="auto"?0:w.line>8&&I.line>8?I.line-w.line:w.line-I.line}),i.forEach(function(w){return jr(a,w)})),i}},js=R(R({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:zs,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Do,bufferController:Ul,capLevelController:hu,errorController:Eo,fpsController:vu,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:le,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},uc()),{},{subtitleStreamController:xl,subtitleTrackController:Nl,timelineController:du,audioStreamController:Pl,audioTrackController:Ml,emeController:Ps,cmcdController:Xu,contentSteeringController:Ju});function uc(){return{cueHandler:lc,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function cc(o,a){if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(a.liveMaxLatencyDurationCount!==void 0&&(a.liveSyncDurationCount===void 0||a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(a.liveMaxLatencyDuration!==void 0&&(a.liveSyncDuration===void 0||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var n=ha(o),e=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(i){var s=(i==="level"?"playlist":i)+"LoadPolicy",l=a[s]===void 0,d=[];r.forEach(function(f){var v=i+"Loading"+f,m=a[v];if(m!==void 0&&l){d.push(v);var p=n[s].default;switch(a[s]={default:p},f){case"TimeOut":p.maxLoadTimeMs=m,p.maxTimeToFirstByteMs=m;break;case"MaxRetry":p.errorRetry.maxNumRetry=m,p.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":p.errorRetry.retryDelayMs=m,p.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=m,p.timeoutRetry.maxRetryDelayMs=m;break}}}),d.length&&P.warn('hls.js config: "'+d.join('", "')+'" setting(s) are deprecated, use "'+s+'": '+JSON.stringify(a[s]))}),R(R({},n),a)}function ha(o){return o&&typeof o=="object"?Array.isArray(o)?o.map(ha):Object.keys(o).reduce(function(a,n){return a[n]=ha(o[n]),a},{}):o}function dc(o){var a=o.loader;a!==Ks&&a!==zs?(P.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1):ec()&&(o.loader=Ks,o.progressive=!0,o.enableSoftwareAES=!0,P.log("[config]: Progressive streaming enabled, using FetchLoader"))}var va,fc=function(o){ie(a,o);function a(e,r){var i=o.call(this,e,"[level-controller]")||this;return i._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}var n=a.prototype;return n._registerListeners=function(){var r=this.hls;r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(A.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(A.FRAG_BUFFERED,this.onFragBuffered,this),r.on(A.ERROR,this.onError,this)},n._unregisterListeners=function(){var r=this.hls;r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(A.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(A.FRAG_BUFFERED,this.onFragBuffered,this),r.off(A.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),o.prototype.destroy.call(this)},n.stopLoad=function(){this._levels.forEach(function(r){r.loadError=0,r.fragmentError=0}),o.prototype.stopLoad.call(this)},n.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},n.onManifestLoading=function(r,i){this.resetLevels()},n.onManifestLoaded=function(r,i){var s=this.hls.config.preferManagedMediaSource,l=[],d={},f={},v=!1,m=!1,p=!1;i.levels.forEach(function(y){var _,b,T=y.attrs,w=y.audioCodec,I=y.videoCodec;((_=w)==null?void 0:_.indexOf("mp4a.40.34"))!==-1&&(va||(va=/chrome|firefox/i.test(navigator.userAgent)),va&&(y.audioCodec=w=void 0)),w&&(y.audioCodec=w=mr(w,s)),((b=I)==null?void 0:b.indexOf("avc1"))===0&&(I=y.videoCodec=Kr(I));var D=y.width,N=y.height,F=y.unknownCodecs;if(v||(v=!!(D&&N)),m||(m=!!I),p||(p=!!w),!(F!=null&&F.length||w&&!_i(w,"audio",s)||I&&!_i(I,"video",s))){var V=T.CODECS,G=T["FRAME-RATE"],B=T["HDCP-LEVEL"],H=T["PATHWAY-ID"],Y=T.RESOLUTION,J=T["VIDEO-RANGE"],j=(H||".")+"-"+y.bitrate+"-"+Y+"-"+G+"-"+V+"-"+J+"-"+B;if(d[j])if(d[j].uri!==y.url&&!y.attrs["PATHWAY-ID"]){var Re=f[j]+=1;y.attrs["PATHWAY-ID"]=new Array(Re+1).join(".");var Te=new Ri(y);d[j]=Te,l.push(Te)}else d[j].addGroupId("audio",T.AUDIO),d[j].addGroupId("text",T.SUBTITLES);else{var me=new Ri(y);d[j]=me,f[j]=1,l.push(me)}}}),this.filterAndSortMediaOptions(l,i,v,m,p)},n.filterAndSortMediaOptions=function(r,i,s,l,d){var f=this,v=[],m=[],p=r;if((s||l)&&d&&(p=p.filter(function(B){var H=B.videoCodec,Y=B.videoRange,J=B.width,j=B.height;return(!!H||!!(J&&j))&&so(Y)})),p.length===0){Promise.resolve().then(function(){if(f.hls){i.levels.length&&f.warn("One or more CODECS in variant not supported: "+JSON.stringify(i.levels[0].attrs));var B=new Error("no level with compatible codecs found in manifest");f.hls.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,error:B,reason:B.message})}});return}if(i.audioTracks){var y=this.hls.config.preferManagedMediaSource;v=i.audioTracks.filter(function(B){return!B.audioCodec||_i(B.audioCodec,"audio",y)}),Ws(v)}i.subtitles&&(m=i.subtitles,Ws(m));var _=p.slice(0);p.sort(function(B,H){if(B.attrs["HDCP-LEVEL"]!==H.attrs["HDCP-LEVEL"])return(B.attrs["HDCP-LEVEL"]||"")>(H.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&B.height!==H.height)return B.height-H.height;if(B.frameRate!==H.frameRate)return B.frameRate-H.frameRate;if(B.videoRange!==H.videoRange)return en.indexOf(B.videoRange)-en.indexOf(H.videoRange);if(B.videoCodec!==H.videoCodec){var Y=Ye(B.videoCodec),J=Ye(H.videoCodec);if(Y!==J)return J-Y}if(B.uri===H.uri&&B.codecSet!==H.codecSet){var j=lr(B.codecSet),me=lr(H.codecSet);if(j!==me)return me-j}return B.averageBitrate!==H.averageBitrate?B.averageBitrate-H.averageBitrate:0});var b=_[0];if(this.steering&&(p=this.steering.filterParsedLevels(p),p.length!==_.length)){for(var T=0;T<_.length;T++)if(_[T].pathwayId===p[0].pathwayId){b=_[T];break}}this._levels=p;for(var w=0;w<p.length;w++)if(p[w]===b){var I;this._firstLevel=w;var D=b.bitrate,N=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+p.length+" level(s) found, first bitrate: "+D),((I=this.hls.userConfig)==null?void 0:I.abrEwmaDefaultEstimate)===void 0){var F=Math.min(D,this.hls.config.abrEwmaDefaultEstimateMax);F>N&&N===js.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=F)}break}var V=d&&!l,G={levels:p,audioTracks:v,subtitleTracks:m,sessionData:i.sessionData,sessionKeys:i.sessionKeys,firstLevel:this._firstLevel,stats:i.stats,audio:d,video:l,altAudio:!V&&v.some(function(B){return!!B.url})};this.hls.trigger(A.MANIFEST_PARSED,G),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)},n.onError=function(r,i){i.fatal||!i.context||i.context.type===_e.LEVEL&&i.context.level===this.level&&this.checkRetry(i)},n.onFragBuffered=function(r,i){var s=i.frag;if(s!==void 0&&s.type===fe.MAIN){var l=s.elementaryStreams;if(!Object.keys(l).some(function(f){return!!l[f]}))return;var d=this._levels[s.level];d!=null&&d.loadError&&(this.log("Resetting level error count of "+d.loadError+" on frag buffered"),d.loadError=0)}},n.onLevelLoaded=function(r,i){var s,l=i.level,d=i.details,f=this._levels[l];if(!f){var v;this.warn("Invalid level index "+l),(v=i.deliveryDirectives)!=null&&v.skip&&(d.deltaUpdateFailed=!0);return}l===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0),this.playlistLoaded(l,i,f.details)):(s=i.deliveryDirectives)!=null&&s.skip&&(d.deltaUpdateFailed=!0)},n.loadPlaylist=function(r){o.prototype.loadPlaylist.call(this);var i=this.currentLevelIndex,s=this.currentLevel;if(s&&this.shouldLoadPlaylist(s)){var l=s.uri;if(r)try{l=r.addDirectives(l)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}var d=s.attrs["PATHWAY-ID"];this.log("Loading level index "+i+(r?.msn!==void 0?" at sn "+r.msn+" part "+r.part:"")+" with"+(d?" Pathway "+d:"")+" "+l),this.clearTimer(),this.hls.trigger(A.LEVEL_LOADING,{url:l,level:i,pathwayId:s.attrs["PATHWAY-ID"],id:0,deliveryDirectives:r||null})}},n.removeLevel=function(r){var i=this,s,l=this._levels.filter(function(d,f){return f!==r?!0:(i.steering&&i.steering.removeLevel(d),d===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,d.details&&d.details.fragments.forEach(function(v){return v.level=-1})),!1)});wa(l),this._levels=l,this.currentLevelIndex>-1&&(s=this.currentLevel)!=null&&s.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(A.LEVELS_UPDATED,{levels:l})},n.onLevelsUpdated=function(r,i){this._levels=i.levels},n.checkMaxAutoUpdated=function(){var r=this.hls,i=r.autoLevelCapping,s=r.maxAutoLevel,l=r.maxHdcpLevel;this._maxAutoLevel!==s&&(this._maxAutoLevel=s,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:i,levels:this.levels,maxAutoLevel:s,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:l}))},x(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var i=this._levels;if(i.length!==0){if(r<0||r>=i.length){var s=new Error("invalid level idx"),l=r<0;if(this.hls.trigger(A.ERROR,{type:re.OTHER_ERROR,details:U.LEVEL_SWITCH_ERROR,level:r,fatal:l,error:s,reason:s.message}),l)return;r=Math.min(r,i.length-1)}var d=this.currentLevelIndex,f=this.currentLevel,v=f?f.attrs["PATHWAY-ID"]:void 0,m=i[r],p=m.attrs["PATHWAY-ID"];if(this.currentLevelIndex=r,this.currentLevel=m,!(d===r&&m.details&&f&&v===p)){this.log("Switching to level "+r+" ("+(m.height?m.height+"p ":"")+(m.videoRange?m.videoRange+" ":"")+(m.codecSet?m.codecSet+" ":"")+"@"+m.bitrate+")"+(p?" with Pathway "+p:"")+" from level "+d+(v?" with Pathway "+v:""));var y={level:r,attrs:m.attrs,details:m.details,bitrate:m.bitrate,averageBitrate:m.averageBitrate,maxBitrate:m.maxBitrate,realBitrate:m.realBitrate,width:m.width,height:m.height,codecSet:m.codecSet,audioCodec:m.audioCodec,videoCodec:m.videoCodec,audioGroups:m.audioGroups,subtitleGroups:m.subtitleGroups,loaded:m.loaded,loadError:m.loadError,fragmentError:m.fragmentError,name:m.name,id:m.id,uri:m.uri,url:m.url,urlId:0,audioGroupIds:m.audioGroupIds,textGroupIds:m.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,y);var _=m.details;if(!_||_.live){var b=this.switchParams(m.uri,f?.details,_);this.loadPlaylist(b)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this.hls.firstAutoLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}]),a}(Nn);function Ws(o){var a={};o.forEach(function(n){var e=n.groupId||"";n.id=a[e]=a[e]||0,a[e]++})}var hc=function(){function o(n){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=n}var a=o.prototype;return a.abort=function(e){for(var r in this.keyUriToKeyInfo){var i=this.keyUriToKeyInfo[r].loader;if(i){var s;if(e&&e!==((s=i.context)==null?void 0:s.frag.type))return;i.abort()}}},a.detach=function(){for(var e in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[e];(r.mediaKeySessionContext||r.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},a.destroy=function(){this.detach();for(var e in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[e].loader;r&&r.destroy()}this.keyUriToKeyInfo={}},a.createKeyLoadError=function(e,r,i,s,l){return r===void 0&&(r=U.KEY_LOAD_ERROR),new $r({type:re.NETWORK_ERROR,details:r,fatal:!1,frag:e,response:l,error:i,networkDetails:s})},a.loadClear=function(e,r){var i=this;if(this.emeController&&this.config.emeEnabled)for(var s=e.sn,l=e.cc,d=function(){var m=r[f];if(l<=m.cc&&(s==="initSegment"||m.sn==="initSegment"||s<m.sn))return i.emeController.selectKeySystemFormat(m).then(function(p){m.setKeyFormat(p)}),1},f=0;f<r.length&&!d();f++);},a.load=function(e){var r=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(i){return r.loadInternal(e,i)}):this.loadInternal(e)},a.loadInternal=function(e,r){var i,s;r&&e.setKeyFormat(r);var l=e.decryptdata;if(!l){var d=new Error(r?"Expected frag.decryptdata to be defined after setting format "+r:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,U.KEY_LOAD_ERROR,d))}var f=l.uri;if(!f)return Promise.reject(this.createKeyLoadError(e,U.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+f+'"')));var v=this.keyUriToKeyInfo[f];if((i=v)!=null&&i.decryptdata.key)return l.key=v.decryptdata.key,Promise.resolve({frag:e,keyInfo:v});if((s=v)!=null&&s.keyLoadPromise){var m;switch((m=v.mediaKeySessionContext)==null?void 0:m.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return v.keyLoadPromise.then(function(p){return l.key=p.keyInfo.decryptdata.key,{frag:e,keyInfo:v}})}}switch(v=this.keyUriToKeyInfo[f]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(v,e):this.loadKeyEME(v,e);case"AES-128":return this.loadKeyHTTP(v,e);default:return Promise.reject(this.createKeyLoadError(e,U.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+l.method+'"')))}},a.loadKeyEME=function(e,r){var i={frag:r,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(function(l){return e.mediaKeySessionContext=l,i})).catch(function(l){throw e.keyLoadPromise=null,l})}return Promise.resolve(i)},a.loadKeyHTTP=function(e,r){var i=this,s=this.config,l=s.loader,d=new l(s);return r.keyLoader=e.loader=d,e.keyLoadPromise=new Promise(function(f,v){var m={keyInfo:e,frag:r,responseType:"arraybuffer",url:e.decryptdata.uri},p=s.keyLoadPolicy.default,y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};d.load(m,y,{onSuccess:function(b,T,w,I){var D=w.frag,N=w.keyInfo,F=w.url;if(!D.decryptdata||N!==i.keyUriToKeyInfo[F])return v(i.createKeyLoadError(D,U.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),I));N.decryptdata.key=D.decryptdata.key=new Uint8Array(b.data),D.keyLoader=null,N.loader=null,f({frag:D,keyInfo:N})},onError:function(b,T,w,I){i.resetLoader(T),v(i.createKeyLoadError(r,U.KEY_LOAD_ERROR,new Error("HTTP Error "+b.code+" loading key "+b.text),w,R({url:m.url,data:void 0},b)))},onTimeout:function(b,T,w){i.resetLoader(T),v(i.createKeyLoadError(r,U.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),w))},onAbort:function(b,T,w){i.resetLoader(T),v(i.createKeyLoadError(r,U.INTERNAL_ABORTED,new Error("key loading aborted"),w))}})})},a.resetLoader=function(e){var r=e.frag,i=e.keyInfo,s=e.url,l=i.loader;r.keyLoader===l&&(r.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],l&&l.destroy()},o}();function Ys(){return self.SourceBuffer||self.WebKitSourceBuffer}function $s(){if(!wr())return!1;var o=Ys();return!o||o.prototype&&typeof o.prototype.appendBuffer=="function"&&typeof o.prototype.remove=="function"}function gc(){if(!$s())return!1;var o=wr();return typeof o?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(a){return o.isTypeSupported(de(a,"video"))})||["mp4a.40.2","fLaC"].some(function(a){return o.isTypeSupported(de(a,"audio"))}))}function pc(){var o,a=Ys();return typeof(a==null||(o=a.prototype)==null?void 0:o.changeType)=="function"}var yc=250,bn=2,Ec=.1,_c=.05,Sc=function(){function o(n,e,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=n,this.media=e,this.fragmentTracker=r,this.hls=i}var a=o.prototype;return a.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},a.poll=function(e,r){var i=this.config,s=this.media,l=this.stalled;if(s!==null){var d=s.currentTime,f=s.seeking,v=this.seeking&&!f,m=!this.seeking&&f;if(this.seeking=f,d!==e){if(this.moved=!0,f||(this.nudgeRetry=0),l!==null){if(this.stallReported){var p=self.performance.now()-l;P.warn("playback not stuck anymore @"+d+", after "+Math.round(p)+"ms"),this.stallReported=!1}this.stalled=null}return}if(m||v){this.stalled=null;return}if(s.paused&&!f||s.ended||s.playbackRate===0||!Dt.getBuffered(s).length){this.nudgeRetry=0;return}var y=Dt.bufferInfo(s,d,0),_=y.nextStart||0;if(f){var b=y.len>bn,T=!_||r&&r.start<=d||_-d>bn&&!this.fragmentTracker.getPartialFragment(d);if(b||T)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var w;if(!(y.len>0)&&!_)return;var I=Math.max(_,y.start||0)-d,D=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,N=!(D==null||(w=D.details)==null)&&w.live?D.details.targetduration*2:bn,F=this.fragmentTracker.getPartialFragment(d);if(I>0&&(I<=N||F)){s.paused||this._trySkipBufferHole(F);return}}var V=self.performance.now();if(l===null){this.stalled=V;return}var G=V-l;if(!(!f&&G>=yc&&(this._reportStall(y),!this.media))){var B=Dt.bufferInfo(s,d,i.maxBufferHole);this._tryFixBufferStall(B,G)}}},a._tryFixBufferStall=function(e,r){var i=this.config,s=this.fragmentTracker,l=this.media;if(l!==null){var d=l.currentTime,f=s.getPartialFragment(d);f&&(this._trySkipBufferHole(f)||!this.media)||(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-d<i.maxBufferHole)&&r>i.highBufferWatchdogPeriod*1e3&&(P.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},a._reportStall=function(e){var r=this.hls,i=this.media;if(!this.stallReported&&i){this.stallReported=!0;var s=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")");P.warn(s.message),r.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}},a._trySkipBufferHole=function(e){var r=this.config,i=this.hls,s=this.media;if(s===null)return 0;var l=s.currentTime,d=Dt.bufferInfo(s,l,0),f=l<d.start?d.start:d.nextStart;if(f){var v=d.len<=r.maxBufferHole,m=d.len>0&&d.len<1&&s.readyState<3,p=f-l;if(p>0&&(v||m)){if(p>r.maxBufferHole){var y=this.fragmentTracker,_=!1;if(l===0){var b=y.getAppendedFrag(0,fe.MAIN);b&&f<b.end&&(_=!0)}if(!_){var T=e||y.getAppendedFrag(l,fe.MAIN);if(T){for(var w=!1,I=T.end;I<f;){var D=y.getPartialFragment(I);if(D)I+=D.duration;else{w=!0;break}}if(w)return 0}}}var N=Math.max(f+_c,l+Ec);if(P.warn("skipping hole, adjusting currentTime from "+l+" to "+N),this.moved=!0,this.stalled=null,s.currentTime=N,e&&!e.gap){var F=new Error("fragment loaded with buffer holes, seeking from "+l+" to "+N);i.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:F,reason:F.message,frag:e})}return N}}return 0},a._tryNudgeBuffer=function(){var e=this.config,r=this.hls,i=this.media,s=this.nudgeRetry;if(i!==null){var l=i.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){var d=l+(s+1)*e.nudgeOffset,f=new Error("Nudging 'currentTime' from "+l+" to "+d);P.warn(f.message),i.currentTime=d,r.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1})}else{var v=new Error("Playhead still not moving while enough data buffered @"+l+" after "+e.nudgeMaxRetry+" nudges");P.error(v.message),r.trigger(A.ERROR,{type:re.MEDIA_ERROR,details:U.BUFFER_STALLED_ERROR,error:v,fatal:!0})}}},o}(),Tc=100,bc=function(o){ie(a,o);function a(e,r,i){var s=o.call(this,e,r,i,"[stream-controller]",fe.MAIN)||this;return s.audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}var n=a.prototype;return n._registerListeners=function(){var r=this.hls;r.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.MANIFEST_PARSED,this.onManifestParsed,this),r.on(A.LEVEL_LOADING,this.onLevelLoading,this),r.on(A.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(A.ERROR,this.onError,this),r.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(A.BUFFER_CREATED,this.onBufferCreated,this),r.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(A.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var r=this.hls;r.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.MANIFEST_PARSED,this.onManifestParsed,this),r.off(A.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(A.ERROR,this.onError,this),r.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(A.BUFFER_CREATED,this.onBufferCreated,this),r.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(A.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this._unregisterListeners(),o.prototype.onHandlerDestroying.call(this)},n.startLoad=function(r){if(this.levels){var i=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(Tc),this.level=-1,!this.startFragRequested){var l=s.startLevel;l===-1&&(s.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=s.firstAutoLevel),s.nextLoadLevel=l,this.level=s.loadLevel,this.loadedmetadata=!1}i>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),r=i),this.state=Z.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=Z.STOPPED},n.stopLoad=function(){this._forceStartLoad=!1,o.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case Z.WAITING_LEVEL:var r=this.levels,i=this.level,s=r?.[i],l=s?.details;if(l&&(!l.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(l))break;this.state=Z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Z.IDLE;break}break;case Z.FRAG_LOADING_WAITING_RETRY:var d,f=self.performance.now(),v=this.retryDate;if(!v||f>=v||(d=this.media)!=null&&d.seeking){var m=this.levels,p=this.level,y=m?.[p];this.resetStartWhenNotLoaded(y||null),this.state=Z.IDLE}break}this.state===Z.IDLE&&this.doTickIdle(),this.onTickEnd()},n.onTickEnd=function(){o.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},n.doTickIdle=function(){var r=this.hls,i=this.levelLastLoaded,s=this.levels,l=this.media;if(!(i===null||!l&&(this.startFragRequested||!r.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var d=r.nextLoadLevel;if(s!=null&&s[d]){var f=s[d],v=this.getMainFwdBufferInfo();if(v!==null){var m=this.getLevelDetails();if(m&&this._streamEnded(v,m)){var p={};this.altAudio&&(p.type="video"),this.hls.trigger(A.BUFFER_EOS,p),this.state=Z.ENDED;return}r.loadLevel!==d&&r.manualLevel===-1&&this.log("Adapting to level "+d+" from level "+this.level),this.level=r.nextLoadLevel=d;var y=f.details;if(!y||this.state===Z.WAITING_LEVEL||y.live&&this.levelLastLoaded!==f){this.level=d,this.state=Z.WAITING_LEVEL;return}var _=v.len,b=this.getMaxBufferLength(f.maxBitrate);if(!(_>=b)){this.backtrackFragment&&this.backtrackFragment.start>v.end&&(this.backtrackFragment=null);var T=this.backtrackFragment?this.backtrackFragment.start:v.end,w=this.getNextFragment(T,y);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"&&this.fragmentTracker.getState(w)!==jt.OK){var I,D=((I=this.backtrackFragment)!=null?I:w).sn-y.startSN,N=y.fragments[D-1];N&&w.cc===N.cc&&(w=N,this.fragmentTracker.removeFragment(N))}else this.backtrackFragment&&v.len&&(this.backtrackFragment=null);if(w&&this.isLoopLoading(w,T)){if(!w.gap){var F=this.audioOnly&&!this.altAudio?Ce.AUDIO:Ce.VIDEO,V=(F===Ce.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;V&&this.afterBufferFlushed(V,F,fe.MAIN)}w=this.getNextFragmentLoopLoading(w,y,v,fe.MAIN,b)}w&&(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),this.loadFragment(w,f,T))}}}}},n.loadFragment=function(r,i,s){var l=this.fragmentTracker.getState(r);this.fragCurrent=r,l===jt.NOT_LOADED||l===jt.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r,i):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r,i)):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,r,i,s)):this.clearTrackerIfNeeded(r)},n.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,fe.MAIN)},n.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var r=this.levels,i=this.media;if(i!=null&&i.readyState){var s,l=this.getAppendedFrag(i.currentTime);l&&l.start>1&&this.flushMainBuffer(0,l.start-1);var d=this.getLevelDetails();if(d!=null&&d.live){var f=this.getMainFwdBufferInfo();if(!f||f.len<d.targetduration*2)return}if(!i.paused&&r){var v=r[this.hls.nextLoadLevel],m=this.fragLastKbps;m&&this.fragCurrent?s=this.fragCurrent.duration*v.maxBitrate/(1e3*m)+1:s=0}else s=0;var p=this.getBufferedFrag(i.currentTime+s);if(p){var y=this.followingBufferedFrag(p);if(y){this.abortCurrentFrag();var _=y.maxStartPTS?y.maxStartPTS:y.start,b=y.duration,T=Math.max(p.end,_+Math.min(Math.max(b-this.config.maxFragLookUpTolerance,b*(this.couldBacktrack?.5:.125)),b*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(T,Number.POSITIVE_INFINITY)}}}},n.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r&&(r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.state){case Z.KEY_LOADING:case Z.FRAG_LOADING:case Z.FRAG_LOADING_WAITING_RETRY:case Z.PARSING:case Z.PARSED:this.state=Z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},n.flushMainBuffer=function(r,i){o.prototype.flushMainBuffer.call(this,r,i,this.altAudio?"video":null)},n.onMediaAttached=function(r,i){o.prototype.onMediaAttached.call(this,r,i);var s=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),s.addEventListener("playing",this.onvplaying),s.addEventListener("seeked",this.onvseeked),this.gapController=new Sc(this.config,s,this.fragmentTracker,this.hls)},n.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),o.prototype.onMediaDetaching.call(this)},n.onMediaPlaying=function(){this.tick()},n.onMediaSeeked=function(){var r=this.media,i=r?r.currentTime:null;ne(i)&&this.log("Media seeked to "+i.toFixed(3));var s=this.getMainFwdBufferInfo();if(s===null||s.len===0){this.warn('Main forward buffer length on "seeked" event '+(s?s.len:"empty")+")");return}this.tick()},n.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},n.onManifestParsed=function(r,i){var s=!1,l=!1;i.levels.forEach(function(d){var f=d.audioCodec;f&&(s=s||f.indexOf("mp4a.40.2")!==-1,l=l||f.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=s&&l&&!pc(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},n.onLevelLoading=function(r,i){var s=this.levels;if(!(!s||this.state!==Z.IDLE)){var l=s[i.level];(!l.details||l.details.live&&this.levelLastLoaded!==l||this.waitForCdnTuneIn(l.details))&&(this.state=Z.WAITING_LEVEL)}},n.onLevelLoaded=function(r,i){var s,l=this.levels,d=i.level,f=i.details,v=f.totalduration;if(!l){this.warn("Levels were reset while loading level "+d);return}this.log("Level "+d+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+", cc ["+f.startCC+", "+f.endCC+"] duration:"+v);var m=l[d],p=this.fragCurrent;p&&(this.state===Z.FRAG_LOADING||this.state===Z.FRAG_LOADING_WAITING_RETRY)&&p.level!==i.level&&p.loader&&this.abortCurrentFrag();var y=0;if(f.live||(s=m.details)!=null&&s.live){var _;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;y=this.alignPlaylists(f,m.details,(_=this.levelLastLoaded)==null?void 0:_.details)}if(m.details=f,this.levelLastLoaded=m,this.hls.trigger(A.LEVEL_UPDATED,{details:f,level:d}),this.state===Z.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=Z.IDLE}this.startFragRequested?f.live&&this.synchronizeToLiveEdge(f):this.setStartPosition(f,y),this.tick()},n._handleFragmentLoadProgress=function(r){var i,s=r.frag,l=r.part,d=r.payload,f=this.levels;if(!f){this.warn("Levels were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var v=f[s.level],m=v.details;if(!m){this.warn("Dropping fragment "+s.sn+" of level "+s.level+" after level details were reset"),this.fragmentTracker.removeFragment(s);return}var p=v.videoCodec,y=m.PTSKnown||!m.live,_=(i=s.initSegment)==null?void 0:i.data,b=this._getAudioCodec(v),T=this.transmuxer=this.transmuxer||new us(this.hls,fe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),w=l?l.index:-1,I=w!==-1,D=new Bn(s.level,s.sn,s.stats.chunkCount,d.byteLength,w,I),N=this.initPTS[s.cc];T.push(d,_,b,p,s,l,m.totalduration,y,D,N)},n.onAudioTrackSwitching=function(r,i){var s=this.altAudio;if(!i.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var d=this.hls;s&&(d.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),d.trigger(A.AUDIO_TRACK_SWITCHED,i)}},n.onAudioTrackSwitched=function(r,i){var s=i.id,l=!!this.hls.audioTracks[s].url;if(l){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=l,this.tick()},n.onBufferCreated=function(r,i){var s=i.tracks,l,d,f=!1;for(var v in s){var m=s[v];if(m.id==="main"){if(d=v,l=m,v==="video"){var p=s[v];p&&(this.videoBuffer=p.buffer)}}else f=!0}f&&l?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=l.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(r,i){var s=i.frag,l=i.part;if(!(s&&s.type!==fe.MAIN)){if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(l?" p: "+l.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state),this.state===Z.PARSED&&(this.state=Z.IDLE);return}var d=l?l.stats:s.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),s.sn!=="initSegment"&&(this.fragPrevious=s),this.fragBufferedComplete(s,l)}},n.onError=function(r,i){var s;if(i.fatal){this.state=Z.ERROR;return}switch(i.details){case U.FRAG_GAP:case U.FRAG_PARSING_ERROR:case U.FRAG_DECRYPT_ERROR:case U.FRAG_LOAD_ERROR:case U.FRAG_LOAD_TIMEOUT:case U.KEY_LOAD_ERROR:case U.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(fe.MAIN,i);break;case U.LEVEL_LOAD_ERROR:case U.LEVEL_LOAD_TIMEOUT:case U.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===Z.WAITING_LEVEL&&((s=i.context)==null?void 0:s.type)===_e.LEVEL&&(this.state=Z.IDLE);break;case U.BUFFER_APPEND_ERROR:case U.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="main")return;if(i.details===U.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(i)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case U.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}},n.checkBuffer=function(){var r=this.media,i=this.gapController;if(!(!r||!i||!r.readyState)){if(this.loadedmetadata||!Dt.getBuffered(r).length){var s=this.state!==Z.IDLE?this.fragCurrent:null;i.poll(this.lastCurrentTime,s)}this.lastCurrentTime=r.currentTime}},n.onFragLoadEmergencyAborted=function(){this.state=Z.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},n.onBufferFlushed=function(r,i){var s=i.type;if(s!==Ce.AUDIO||this.audioOnly&&!this.altAudio){var l=(s===Ce.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(l,s,fe.MAIN),this.tick()}},n.onLevelsUpdated=function(r,i){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=i.levels},n.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.seekToStartPos=function(){var r=this.media;if(r){var i=r.currentTime,s=this.startPosition;if(s>=0&&i<s){if(r.seeking){this.log("could not seek to "+s+", already seeking at "+i);return}var l=Dt.getBuffered(r),d=(l.length?l.start(0):0)-s;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),s+=d,this.startPosition=s),this.log("seek to target start position "+s+" from current time "+i),r.currentTime=s}}},n._getAudioCodec=function(r){var i=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i.indexOf("mp4a.40.5")!==-1?i="mp4a.40.2":i="mp4a.40.5"),i},n._loadBitrateTestFrag=function(r,i){var s=this;r.bitrateTest=!0,this._doFragLoad(r,i).then(function(l){var d=s.hls;if(!(!l||s.fragContextChanged(r))){i.fragmentError=0,s.state=Z.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var f=r.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),d.trigger(A.FRAG_LOADED,l),r.bitrateTest=!1}})},n._handleTransmuxComplete=function(r){var i,s="main",l=this.hls,d=r.remuxResult,f=r.chunkMeta,v=this.getCurrentContext(f);if(!v){this.resetWhenMissingContext(f);return}var m=v.frag,p=v.part,y=v.level,_=d.video,b=d.text,T=d.id3,w=d.initSegment,I=y.details,D=this.altAudio?void 0:d.audio;if(this.fragContextChanged(m)){this.fragmentTracker.removeFragment(m);return}if(this.state=Z.PARSING,w){if(w!=null&&w.tracks){var N=m.initSegment||m;this._bufferInitSegment(y,w.tracks,N,f),l.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:s,tracks:w.tracks})}var F=w.initPTS,V=w.timescale;ne(F)&&(this.initPTS[m.cc]={baseTime:F,timescale:V},l.trigger(A.INIT_PTS_FOUND,{frag:m,id:s,initPTS:F,timescale:V}))}if(_&&I&&m.sn!=="initSegment"){var G=I.fragments[m.sn-1-I.startSN],B=m.sn===I.startSN,H=!G||m.cc>G.cc;if(d.independent!==!1){var Y=_.startPTS,J=_.endPTS,j=_.startDTS,me=_.endDTS;if(p)p.elementaryStreams[_.type]={startPTS:Y,endPTS:J,startDTS:j,endDTS:me};else if(_.firstKeyFrame&&_.independent&&f.id===1&&!H&&(this.couldBacktrack=!0),_.dropped&&_.independent){var Re=this.getMainFwdBufferInfo(),Te=(Re?Re.end:this.getLoadPosition())+this.config.maxBufferHole,Qe=_.firstKeyFramePTS?_.firstKeyFramePTS:Y;if(!B&&Te<Qe-this.config.maxBufferHole&&!H){this.backtrack(m);return}else H&&(m.gap=!0);m.setElementaryStreamInfo(_.type,m.start,J,m.start,me,!0)}else B&&Y>bn&&(m.gap=!0);m.setElementaryStreamInfo(_.type,Y,J,j,me),this.backtrackFragment&&(this.backtrackFragment=m),this.bufferFragmentData(_,m,p,f,B||H)}else if(B||H)m.gap=!0;else{this.backtrack(m);return}}if(D){var Ue=D.startPTS,qe=D.endPTS,He=D.startDTS,ze=D.endDTS;p&&(p.elementaryStreams[Ce.AUDIO]={startPTS:Ue,endPTS:qe,startDTS:He,endDTS:ze}),m.setElementaryStreamInfo(Ce.AUDIO,Ue,qe,He,ze),this.bufferFragmentData(D,m,p,f)}if(I&&T!=null&&(i=T.samples)!=null&&i.length){var at={id:s,frag:m,details:I,samples:T.samples};l.trigger(A.FRAG_PARSING_METADATA,at)}if(I&&b){var qt={id:s,frag:m,details:I,samples:b.samples};l.trigger(A.FRAG_PARSING_USERDATA,qt)}},n._bufferInitSegment=function(r,i,s,l){var d=this;if(this.state===Z.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var f=i.audio,v=i.video,m=i.audiovideo;if(f){var p=r.audioCodec,y=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){p&&(p.indexOf("mp4a.40.5")!==-1?p="mp4a.40.2":p="mp4a.40.5");var _=f.metadata;_&&"channelCount"in _&&(_.channelCount||1)!==1&&y.indexOf("firefox")===-1&&(p="mp4a.40.5")}p&&p.indexOf("mp4a.40.5")!==-1&&y.indexOf("android")!==-1&&f.container!=="audio/mpeg"&&(p="mp4a.40.2",this.log("Android: force audio codec to "+p)),r.audioCodec&&r.audioCodec!==p&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+p+'"'),f.levelCodec=p,f.id="main",this.log("Init audio buffer, container:"+f.container+", codecs[selected/level/parsed]=["+(p||"")+"/"+(r.audioCodec||"")+"/"+f.codec+"]")}v&&(v.levelCodec=r.videoCodec,v.id="main",this.log("Init video buffer, container:"+v.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+v.codec+"]")),m&&this.log("Init audiovideo buffer, container:"+m.container+", codecs[level/parsed]=["+r.codecs+"/"+m.codec+"]"),this.hls.trigger(A.BUFFER_CODECS,i),Object.keys(i).forEach(function(b){var T=i[b].initSegment;T!=null&&T.byteLength&&d.hls.trigger(A.BUFFER_APPENDING,{type:b,data:T,frag:s,part:null,chunkMeta:l,parent:s.type})}),this.tickImmediate()}},n.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,fe.MAIN)},n.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=Z.IDLE},n.checkFragmentChanged=function(){var r=this.media,i=null;if(r&&r.readyState>1&&r.seeking===!1){var s=r.currentTime;if(Dt.isBuffered(r,s)?i=this.getAppendedFrag(s):Dt.isBuffered(r,s+.1)&&(i=this.getAppendedFrag(s+.1)),i){this.backtrackFragment=null;var l=this.fragPlaying,d=i.level;(!l||i.sn!==l.sn||l.level!==d)&&(this.fragPlaying=i,this.hls.trigger(A.FRAG_CHANGED,{frag:i}),(!l||l.level!==d)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:d}))}}},x(a,[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var i=r.currentTime,s=this.currentFrag;if(s&&ne(i)&&ne(s.programDateTime)){var l=s.programDateTime+(i-s.start)*1e3;return new Date(l)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(Vn),Xs=function(){o.isMSESupported=function(){return $s()},o.isSupported=function(){return gc()},o.getMediaSource=function(){return wr()};function o(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new gn,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,z(n.debug||!1,"Hls instance");var e=this.config=cc(o.DefaultConfig,n);this.userConfig=n,e.progressive&&dc(e);var r=e.abrController,i=e.bufferController,s=e.capLevelController,l=e.errorController,d=e.fpsController,f=new l(this),v=this.abrController=new r(this),m=this.bufferController=new i(this),p=this.capLevelController=new s(this),y=new d(this),_=new Br(this),b=new io(this),T=e.contentSteeringController,w=T?new T(this):null,I=this.levelController=new fc(this,w),D=new Po(this),N=new hc(this.config),F=this.streamController=new bc(this,D,N);p.setStreamController(F),y.setStreamController(F);var V=[_,I,F];w&&V.splice(1,0,w),this.networkControllers=V;var G=[v,m,p,y,b,D];this.audioTrackController=this.createController(e.audioTrackController,V);var B=e.audioStreamController;B&&V.push(new B(this,D,N)),this.subtitleTrackController=this.createController(e.subtitleTrackController,V);var H=e.subtitleStreamController;H&&V.push(new H(this,D,N)),this.createController(e.timelineController,G),N.emeController=this.emeController=this.createController(e.emeController,G),this.cmcdController=this.createController(e.cmcdController,G),this.latencyController=this.createController(no,G),this.coreComponents=G,V.push(f);var Y=f.onErrorOut;typeof Y=="function"&&this.on(A.ERROR,Y,f)}var a=o.prototype;return a.createController=function(e,r){if(e){var i=new e(this);return r&&r.push(i),i}return null},a.on=function(e,r,i){i===void 0&&(i=this),this._emitter.on(e,r,i)},a.once=function(e,r,i){i===void 0&&(i=this),this._emitter.once(e,r,i)},a.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},a.off=function(e,r,i,s){i===void 0&&(i=this),this._emitter.off(e,r,i,s)},a.listeners=function(e){return this._emitter.listeners(e)},a.emit=function(e,r,i){return this._emitter.emit(e,r,i)},a.trigger=function(e,r){if(this.config.debug)return this.emit(e,e,r);try{return this.emit(e,e,r)}catch(s){if(P.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;var i=e===A.ERROR;this.trigger(A.ERROR,{type:re.OTHER_ERROR,details:U.INTERNAL_EXCEPTION,fatal:i,event:e,error:s}),this.triggeringException=!1}}return!1},a.listenerCount=function(e){return this._emitter.listenerCount(e)},a.destroy=function(){P.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},a.attachMedia=function(e){P.log("attachMedia"),this._media=e,this.trigger(A.MEDIA_ATTACHING,{media:e})},a.detachMedia=function(){P.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(e){this.stopLoad();var r=this.media,i=this.url,s=this.url=Ne.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,P.log("loadSource:"+s),r&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(A.MANIFEST_LOADING,{url:e})},a.startLoad=function(e){e===void 0&&(e=-1),P.log("startLoad("+e+")"),this.started=!0,this.networkControllers.forEach(function(r){r.startLoad(e)})},a.stopLoad=function(){P.log("stopLoad"),this.started=!1,this.networkControllers.forEach(function(e){e.stopLoad()})},a.resumeBuffering=function(){this.started&&this.networkControllers.forEach(function(e){"fragmentLoader"in e&&e.startLoad(-1)})},a.pauseBuffering=function(){this.networkControllers.forEach(function(e){"fragmentLoader"in e&&e.stopLoad()})},a.swapAudioCodec=function(){P.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){P.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},a.removeLevel=function(e){this.levelController.removeLevel(e)},a.setAudioOption=function(e){var r;return(r=this.audioTrackController)==null?void 0:r.setAudioOption(e)},a.setSubtitleOption=function(e){var r;return(r=this.subtitleTrackController)==null||r.setSubtitleOption(e),null},x(o,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){P.log("set currentLevel:"+e),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){P.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){P.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){P.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){var e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e},set:function(e){P.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var r=!!e;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(P.log("set autoLevelCapping:"+e),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN},set:function(e){this.abrController.resetEstimator(e)}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){ao(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,r=this.config.minAutoBitrate;if(!e)return 0;for(var i=e.length,s=0;s<i;s++)if(e[s].maxBitrate>=r)return s;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel,s;if(r===-1&&e!=null&&e.length?s=e.length-1:s=r,i)for(var l=s;l--;){var d=e[l].attrs["HDCP-LEVEL"];if(d&&d<=i)return l}return s}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(e){this.abrController.nextAutoLevel=e}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var e=this.audioTrackController;return e?e.allAudioTracks:[]}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var r=this.audioTrackController;r&&(r.audioTrack=e)}},{key:"allSubtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var r=this.subtitleTrackController;r&&(r.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var r=this.subtitleTrackController;r&&(r.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.13"}},{key:"Events",get:function(){return A}},{key:"ErrorTypes",get:function(){return re}},{key:"ErrorDetails",get:function(){return U}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:js},set:function(e){o.defaultConfig=e}}]),o}();return Xs.defaultConfig=void 0,Xs})})(!1)}),require_state=__commonJSMin(c=>{Object.defineProperty(c,"__esModule",{value:!0}),c.VolumeState=c.PlayerState=void 0;var h;(function(E){E.PLAYING="PLAYING",E.PAUSED="PAUSED",E.STOPPED="STOPPED",E.ENDED="ENDED",E.LOADING="LOADING",E.ERROR="ERROR",E.IDLE="IDLE",E.BUFFERING="BUFFERING"})(h||(c.PlayerState=h={}));var g;(function(E){E.MUTED="MUTED",E.UNMUTED="UNMUTED"})(g||(c.VolumeState=g={}))}),require_dist$1=__commonJSMin(c=>{(function(h,g){if(typeof define=="function"&&define.amd)define("AudioMotionAnalyzer",["exports"],g);else if(typeof c<"u")g(c);else{var E={exports:{}};g(E.exports),h.AudioMotionAnalyzer=E.exports.default}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:c,function(h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=h.AudioMotionAnalyzer=void 0;const g="4.5.0",E=Math.PI,S=2*E,R=E/2,L=8.17579892,k="dual-combined",C="dual-horizontal",x="single",q="dual-vertical",X="bar-index",ie="bar-level",se="gradient",ue=60,ge="click",ae="fullscreenchange",Se="resize",xe="#111",$e="",nt="A",we="B",ht="C",Pe="D",Ee="468",Ne="sans-serif",ne="#0f0",It="#7f7f7f22",Je=10,A="create",re="fschange",U="lores",bt=Se,Rr="user",qr="#000c",li="#fff",M="#4f4",z="#888",P="#555",ce="bark",oe="linear",te="log",K="mel",ee=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],be=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:ee}],["rainbow",{dir:"h",colorStops:["#817",...ee,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],pe={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:x,colorMode:se,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:te,gradient:be[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:$e,width:void 0},Ce=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],Pt=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],sr=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],fr=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],xi=["ERR_INVALID_MODE","Invalid mode"],wn=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],Fi=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],In=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],kn=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],Cn=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class rr extends Error{constructor(O,Q){const[le,ye]=O;super(ye+(Q!==void 0?`: ${Q}`:"")),this.name="AudioMotionError",this.code=le}}const Hr=(hr,O)=>console.warn(`${hr} is deprecated. Use ${O} instead.`),pt=hr=>{for(const O in hr)return!1;return!0},Ut=(hr,O,Q="toLowerCase")=>O[Math.max(0,O.indexOf((""+hr)[Q]()))],ji=(hr,O,Q,le,ye)=>O+(le-O)*(ye-hr)/(Q-hr);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(hr){let O=this.length;for(;O-- >0;)if(hr(this[O]))return O;return-1});class Ni{constructor(O,Q={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],O instanceof Element||(pt(Q)&&!pt(O)&&(Q=O),O=null),this._ownCanvas=!(Q.canvas instanceof HTMLCanvasElement);const le=this._ownCanvas?document.createElement("canvas"):Q.canvas;le.style="max-width: 100%;",this._ctx=le.getContext("2d");for(const[Ke,lt]of be)this.registerGradient(Ke,lt);this._container=O||!this._ownCanvas&&le.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let ye;if(!(Q.source&&(ye=Q.source.context))){if(!(ye=Q.audioCtx))try{ye=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new rr(Ce)}}if(!ye.createGain)throw new rr(Pt);const Ie=this._analyzer=[ye.createAnalyser(),ye.createAnalyser()],Le=this._splitter=ye.createChannelSplitter(2),Ae=this._merger=ye.createChannelMerger(2);this._input=ye.createGain(),this._output=ye.createGain(),Q.source&&this.connectInput(Q.source);for(const Ke of[0,1])Le.connect(Ie[Ke],Ke);Ae.connect(this._output),Q.connectSpeakers!==!1&&this.connectOutput();for(const Ke of["_scaleX","_scaleR"])this[Ke]=document.createElement("canvas").getContext("2d");this._fsEl=Q.fsElement||le;const De=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(bt),this._fsTimeout=0)},ue))};window.ResizeObserver&&(this._observer=new ResizeObserver(De),this._observer.observe(this._container)),this._controller=new AbortController;const Xe=this._controller.signal;window.addEventListener(Se,De,{signal:Xe}),le.addEventListener(ae,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(re),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},ue)},{signal:Xe});const Ve=()=>{ye.state=="suspended"&&ye.resume(),window.removeEventListener(ge,Ve)};window.addEventListener(ge,Ve),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:Xe}),this._setProps(Q,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(le),this._ready=!0,this._setCanvas(A)}get alphaBars(){return this._alphaBars}set alphaBars(O){this._alphaBars=!!O,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(O){this._ansiBands=!!O,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(O){this._barSpace=+O||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(O){this._chLayout=Ut(O,[x,C,q,k]),this._input.disconnect(),this._input.connect(this._chLayout!=x?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=x?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(O){this._colorMode=Ut(O,[se,X,ie])}get fadePeaks(){return this._fadePeaks}set fadePeaks(O){this._fadePeaks=!!O}get fftSize(){return this._analyzer[0].fftSize}set fftSize(O){for(const le of[0,1])this._analyzer[le].fftSize=O;const Q=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(Q),new Float32Array(Q)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(O){this._frequencyScale=Ut(O,[te,ce,K,oe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(O){this._setGradient(O)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(O){this._setGradient(O,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(O){this._setGradient(O,1)}get gravity(){return this._gravity}set gravity(O){this._gravity=O>0?+O:this._gravity||pe.gravity}get height(){return this._height}set height(O){this._height=O,this._setCanvas(Rr)}get ledBars(){return this._showLeds}set ledBars(O){this._showLeds=!!O,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(O){this._linearAmplitude=!!O}get linearBoost(){return this._linearBoost}set linearBoost(O){this._linearBoost=O>=1?+O:1}get lineWidth(){return this._lineWidth}set lineWidth(O){this._lineWidth=+O||0}get loRes(){return this._loRes}set loRes(O){this._loRes=!!O,this._setCanvas(U)}get lumiBars(){return this._lumiBars}set lumiBars(O){this._lumiBars=!!O,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(O){for(const Q of[0,1])this._analyzer[Q].maxDecibels=O}get maxFPS(){return this._maxFPS}set maxFPS(O){this._maxFPS=O<0?0:+O||0}get maxFreq(){return this._maxFreq}set maxFreq(O){if(O<1)throw new rr(fr);this._maxFreq=Math.min(O,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(O){for(const Q of[0,1])this._analyzer[Q].minDecibels=O}get minFreq(){return this._minFreq}set minFreq(O){if(O<1)throw new rr(fr);this._minFreq=+O,this._calcBars()}get mirror(){return this._mirror}set mirror(O){this._mirror=Math.sign(O)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(O){const Q=O|0;if(Q>=0&&Q<=10&&Q!=9)this._mode=Q,this._calcBars(),this._makeGrad();else throw new rr(xi,O)}get noteLabels(){return this._noteLabels}set noteLabels(O){this._noteLabels=!!O,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(O){this._outlineBars=!!O,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(O){this._peakFadeTime=O>=0?+O:this._peakFadeTime||pe.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(O){this._peakHoldTime=+O||0}get peakLine(){return this._peakLine}set peakLine(O){this._peakLine=!!O}get radial(){return this._radial}set radial(O){this._radial=!!O,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(O){this._radialInvert=!!O,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(O){this._radius=+O||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(O){if(O=+O||0,O<0||O>=1)throw new rr(wn);this._reflexRatio=O,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(O){this._roundBars=!!O,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(O){for(const Q of[0,1])this._analyzer[Q].smoothingTimeConstant=O}get spinSpeed(){return this._spinSpeed}set spinSpeed(O){O=+O||0,(this._spinSpeed===void 0||O==0)&&(this._spinAngle=-R),this._spinSpeed=O}get splitGradient(){return this._splitGradient}set splitGradient(O){this._splitGradient=!!O,this._makeGrad()}get stereo(){return Hr("stereo","channelLayout"),this._chLayout!=x}set stereo(O){Hr("stereo","channelLayout"),this.channelLayout=O?q:x}get trueLeds(){return this._trueLeds}set trueLeds(O){this._trueLeds=!!O}get volume(){return this._output.gain.value}set volume(O){this._output.gain.value=O}get weightingFilter(){return this._weightingFilter}set weightingFilter(O){this._weightingFilter=Ut(O,[$e,nt,we,ht,Pe,Ee],"toUpperCase")}get width(){return this._width}set width(O){this._width=O,this._setCanvas(Rr)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return g}connectInput(O){const Q=O instanceof HTMLMediaElement;if(!(Q||O.connect))throw new rr(Fi);const le=Q?this.audioCtx.createMediaElementSource(O):O;return this._sources.includes(le)||(le.connect(this._input),this._sources.push(le)),le}connectOutput(O=this.audioCtx.destination){if(!this._outNodes.includes(O)&&(this._output.connect(O),this._outNodes.push(O),this._outNodes.length==1))for(const Q of[0,1])this._analyzer[Q].connect(this._chLayout==x&&!Q?this._output:this._merger,0,Q)}destroy(){if(!this._ready)return;const{audioCtx:O,canvas:Q,_controller:le,_input:ye,_merger:Ie,_observer:Le,_ownCanvas:Ae,_ownContext:De,_splitter:Xe}=this;this._destroyed=!0,this._ready=!1,this.stop(),le.abort(),Le&&Le.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),ye.disconnect(),Xe.disconnect(),Ie.disconnect(),De&&O.close(),Ae&&Q.remove(),this._calcBars()}disconnectInput(O,Q){O?Array.isArray(O)||(O=[O]):O=Array.from(this._sources);for(const le of O){const ye=this._sources.indexOf(le);if(Q&&le.mediaStream)for(const Ie of le.mediaStream.getAudioTracks())Ie.stop();ye>=0&&(le.disconnect(this._input),this._sources.splice(ye,1))}}disconnectOutput(O){if(!(O&&!this._outNodes.includes(O))&&(this._output.disconnect(O),this._outNodes=O?this._outNodes.filter(Q=>Q!==O):[],this._outNodes.length==0))for(const Q of[0,1])this._analyzer[Q].disconnect()}getBars(){return Array.from(this._bars,({posX:O,freq:Q,freqLo:le,freqHi:ye,hold:Ie,peak:Le,value:Ae})=>({posX:O,freq:Q,freqLo:le,freqHi:ye,hold:Ie,peak:Le,value:Ae}))}getEnergy(O,Q){if(O===void 0)return this._energy.val;if(O!=+O){if(O=="peak")return this._energy.peak;const Ae={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!Ae[O])return null;[O,Q]=Ae[O]}const le=this._freqToBin(O),ye=Q?this._freqToBin(Q):le,Ie=this._chLayout==x?1:2;let Le=0;for(let Ae=0;Ae<Ie;Ae++)for(let De=le;De<=ye;De++)Le+=this._normalizedB(this._fftData[Ae][De]);return Le/(ye-le+1)/Ie}getOptions(O){Array.isArray(O)||(O=[O]);let Q={};for(const le of Object.keys(pe))O.includes(le)||(le=="gradient"&&this.gradientLeft!=this.gradientRight?(Q.gradientLeft=this.gradientLeft,Q.gradientRight=this.gradientRight):le!="start"&&(Q[le]=this[le]));return Q}registerGradient(O,Q){if(typeof O!="string"||O.trim().length==0)throw new rr(In);if(typeof Q!="object")throw new rr(kn);const{colorStops:le}=Q;if(!Array.isArray(le)||!le.length)throw new rr(Cn);const ye=le.length,Ie=Le=>+Le!=Le||Le<0||Le>1;le.forEach((Le,Ae)=>{const De=Ae/Math.max(1,ye-1);typeof Le!="object"?le[Ae]={pos:De,color:Le}:Ie(Le.pos)&&(Le.pos=De),Ie(Le.level)&&(le[Ae].level=1-Ae/ye)}),le.sort((Le,Ae)=>Le.level<Ae.level?1:Le.level>Ae.level?-1:0),le[0].level=1,this._gradients[O]={bgColor:Q.bgColor||xe,dir:Q.dir,colorStops:le},this._selectedGrads.includes(O)&&this._makeGrad()}setCanvasSize(O,Q){this._width=O,this._height=Q,this._setCanvas(Rr)}setFreqRange(O,Q){if(O<1||Q<1)throw new rr(fr);this._minFreq=Math.min(O,Q),this.maxFreq=Math.max(O,Q)}setLedParams(O){let Q,le,ye;O&&(Q=O.maxLeds|0,le=+O.spaceV,ye=+O.spaceH),this._ledParams=Q>0&&le>0&&ye>=0?[Q,le,ye]:void 0,this._calcBars()}setOptions(O){this._setProps(O)}setSensitivity(O,Q){for(const le of[0,1])this._analyzer[le].minDecibels=Math.min(O,Q),this._analyzer[le].maxDecibels=Math.max(O,Q)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(O){const Q=this.isOn;return O===void 0&&(O=!Q),Q&&!O?(cancelAnimationFrame(this._runId),this._runId=0):!Q&&O&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(le=>this._draw(le))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const O=this._fsEl;if(!O)return;O.requestFullscreen?O.requestFullscreen():O.webkitRequestFullscreen&&O.webkitRequestFullscreen()}}_binToFreq(O){return O*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const O=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:Q,_barSpace:le,canvas:ye,_chLayout:Ie,_maxFreq:Le,_minFreq:Ae,_mirror:De,_mode:Xe,_radial:Ve,_radialInvert:Ke,_reflexRatio:lt}=this,At=ye.width>>1,zt=ye.height>>1,Mt=Ie==q&&!Ve,Nt=Ie==C,Lt=Xe%10!=0,or=Lt&&this._frequencyScale==te,rt=this._showLeds&&Lt&&!Ve,Rt=this._lumiBars&&Lt&&!Ve,Ot=this._alphaBars&&!Rt&&Xe!=Je,Vt=this._outlineBars&&Lt&&!Rt&&!rt,it=this._roundBars&&Lt&&!Rt&&!rt,yt=Ie!=q||lt>0&&!Rt,Et=ye.height-(Mt&&!rt?.5:0)>>Mt,$t=Et*(Rt||Ve?1:1-lt)|0,W=ye.width-At*(Nt||De!=0),je=Mt?ye.height-Et*2:0,_r=At*(De==-1&&!Nt&&!Ve);let ve=Math.min(ye.width,ye.height)*.375*(Ie==q?1:this._radius)|0,vt=Math.min(At,zt);Ke&&Ie!=q&&([ve,vt]=[vt,ve]);const dt=Ge=>O.push({...Ge,peak:[0,0],hold:[0],alpha:[0],value:[0]}),Ze=Ge=>{const mt=this._freqToBin(Ge,"floor"),We=this._binToFreq(mt),tt=this._binToFreq(mt+1);return[mt,Math.log2(Ge/We)/Math.log2(tt/We)]};let Fe,he,ft;if(or){const Ge=(Be,_t,st)=>+Be.toPrecision(st?Math.max(_t,1+Math.log10(Be)|0):_t),mt=Be=>{const _t=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],st=Math.log10(Be)|0,Tr=Be/10**st;let vr=1;for(;vr<_t.length&&Tr>_t[vr];)vr++;return Tr-_t[vr-1]<_t[vr]-Tr&&vr--,(_t[vr]*10**(st+5)|0)/1e5},We=[0,24,12,8,6,4,3,2,1][Xe],tt=Q?10**(3/(We*10)):2**(1/We),kt=tt**.5;let Qt=Q?7.94328235/(We%2?1:kt):L;do{let Be=Qt;const _t=Ge(Be/kt,4,!0),st=Ge(Be*kt,4,!0),[Tr,vr]=Ze(_t),[ei,br]=Ze(st);Q?Be=We<4?mt(Be):Ge(Be,Be.toString()[0]<5?3:2):Be=Ge(Be,4,!0),Be>=Ae&&dt({posX:0,freq:Be,freqLo:_t,freqHi:st,binLo:Tr,binHi:ei,ratioLo:vr,ratioHi:br}),Qt*=tt}while(Qt<=Le);Fe=W/O.length,O.forEach((Be,_t)=>Be.posX=_r+_t*Fe);const Tt=O[0],Kt=O[O.length-1];he=this._freqScaling(Tt.freqLo),ft=W/(this._freqScaling(Kt.freqHi)-he),Tt.freqLo<Ae&&(Tt.freqLo=Ae,[Tt.binLo,Tt.ratioLo]=Ze(Ae)),Kt.freqHi>Le&&(Kt.freqHi=Le,[Kt.binHi,Kt.ratioHi]=Ze(Le))}else if(Lt){const Ge=[0,24,12,8,6,4,3,2,1][Xe]*10,mt=We=>{switch(this._frequencyScale){case ce:return 1960/(26.81/(We+.53)-1);case K:return 700*(2**We-1);case oe:return We}};Fe=W/Ge,he=this._freqScaling(Ae),ft=W/(this._freqScaling(Le)-he);for(let We=0,tt=0;We<Ge;We++,tt+=Fe){const kt=mt(he+tt/ft),Qt=mt(he+(tt+Fe/2)/ft),Tt=mt(he+(tt+Fe)/ft),[Kt,Be]=Ze(kt),[_t,st]=Ze(Tt);dt({posX:_r+tt,freq:Qt,freqLo:kt,freqHi:Tt,binLo:Kt,binHi:_t,ratioLo:Be,ratioHi:st})}}else{Fe=1,he=this._freqScaling(Ae),ft=W/(this._freqScaling(Le)-he);const Ge=this._freqToBin(Ae,"floor"),mt=this._freqToBin(Le);let We=-999;for(let tt=Ge;tt<=mt;tt++){const kt=this._binToFreq(tt),Qt=_r+Math.round(ft*(this._freqScaling(kt)-he));if(Qt>We)dt({posX:Qt,freq:kt,freqLo:kt,freqHi:kt,binLo:tt,binHi:tt,ratioLo:0,ratioHi:0}),We=Qt;else if(O.length){const Tt=O[O.length-1];Tt.binHi=tt,Tt.freqHi=kt,Tt.freq=(Tt.freqLo*kt)**.5}}}let Xt=0,xt=0;if(rt){const Ge=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),mt=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],We=this._ledParams,[tt,kt,Qt]=We||mt[Xe];let Tt,Kt=$t;if(We){const Be=2*Ge;let _t;Tt=tt+1;do Tt--,_t=Kt/Tt/(1+kt),xt=_t*kt;while((_t<Be||xt<Be)&&Tt>1)}else{const Be=540/kt;xt=Math.min(kt*Ge,Math.max(2,Kt/Be+.1|0))}yt&&(Kt+=xt),We||(Tt=Math.min(tt,Kt/(xt*2)|0)),Xt=Qt>=1?Qt:Fe*Qt,this._leds=[Tt,Xt,xt,Kt/Tt-xt]}const et=Math.min(Fe-1,le*(le>0&&le<1?Fe:1));Lt&&(Fe-=Math.max(rt?Xt:0,et)),O.forEach((Ge,mt)=>{let We=Ge.posX,tt=Fe;Lt&&(le==0&&!rt?(We|=0,tt|=0,mt>0&&We>O[mt-1].posX+O[mt-1].width&&(We--,tt++)):We+=Math.max(rt?Xt:0,et)/2,Ge.posX=We),Ge.barCenter=We+(Fe==1?0:tt/2),Ge.width=tt});const ir=[];for(const Ge of[0,1]){const mt=Ie==q?(Et+je)*Ge:0,We=mt+Et,tt=mt+$t-(!rt||yt?0:xt);ir.push({channelTop:mt,channelBottom:We,analyzerBottom:tt})}this._aux={analyzerHeight:$t,analyzerWidth:W,centerX:At,centerY:zt,channelCoords:ir,channelHeight:Et,channelGap:je,initialX:_r,innerRadius:ve,outerRadius:vt,scaleMin:he,unitWidth:ft},this._flg={isAlpha:Ot,isBands:Lt,isLeds:rt,isLumi:Rt,isOctaves:or,isOutline:Vt,isRound:it,noLedGap:yt},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:O,initialX:Q,innerRadius:le,scaleMin:ye,unitWidth:Ie}=this._aux,{canvas:Le,_frequencyScale:Ae,_mirror:De,_noteLabels:Xe,_radial:Ve,_scaleX:Ke,_scaleR:lt}=this,At=Ke.canvas,zt=lt.canvas,Mt=[],Nt=this._chLayout==C,Lt=this._chLayout==q,or=Math.min(Le.width,Le.height),rt=["C",,"D",,"E","F",,"G",,"A",,"B"],Rt=or/34|0,Ot=At.height>>1,Vt=Rt>>1,it=Ot*(Xe?.7:1.5),yt=Vt*(Xe?1:2),Et=2**(1/12);if(!Xe&&(this._ansiBands||Ae!=te))Mt.push(16,31.5,63,125,250,500,1e3,2e3,4e3),Ae==oe?Mt.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):Mt.push(8e3,16e3);else{let vt=L;for(let dt=-1;dt<11;dt++)for(let Ze=0;Ze<12;Ze++){if(vt>=this._minFreq&&vt<=this._maxFreq){const Fe=rt[Ze],he=Fe=="C";(Fe&&Xe&&!De&&!Nt||he)&&Mt.push(Xe?[vt,Fe+(he?dt:"")]:vt)}vt*=Et}}zt.width=zt.height=Math.max(or*.15,(le<<1)+Lt*Rt);const $t=zt.width>>1,W=$t-Rt*.7,je=(vt,dt)=>{const Ze=S*(vt/Le.width),Fe=Ze-R,he=W*Math.cos(Fe),ft=W*Math.sin(Fe);lt.save(),lt.translate($t+he,$t+ft),lt.rotate(Ze),lt.fillText(dt,0,0),lt.restore()};At.width|=0,Ke.fillStyle=lt.strokeStyle=qr,Ke.fillRect(0,0,At.width,At.height),lt.arc($t,$t,$t-Rt/2,0,S),lt.lineWidth=Rt,lt.stroke(),Ke.fillStyle=lt.fillStyle=li,Ke.font=`${Ot}px ${Ne}`,lt.font=`${Vt}px ${Ne}`,Ke.textAlign=lt.textAlign="center";let _r=-it/4,ve=-yt;for(const vt of Mt){const[dt,Ze]=Array.isArray(vt)?vt:[vt,vt<1e3?vt|0:`${(vt/100|0)/10}k`],Fe=Ie*(this._freqScaling(dt)-ye),he=At.height*.75,ft=Ze[0]=="C",Xt=Ot*(Xe&&!De&&!Nt?ft?1.2:.6:3);if(Ke.fillStyle=lt.fillStyle=ft&&!De&&!Nt?M:li,Xe){const xt=Ae==te,et=Ae==oe;let ir=["C"];if((xt||dt>2e3||!et&&dt>250||(!Ve||Lt)&&(!et&&dt>125||dt>1e3))&&ir.push("G"),(xt||dt>4e3||!et&&dt>500||(!Ve||Lt)&&(!et&&dt>250||dt>2e3))&&ir.push("E"),(et&&dt>4e3||(!Ve||Lt)&&(xt||dt>2e3||!et&&dt>500))&&ir.push("D","F","A","B"),!ir.includes(Ze[0]))continue}Fe>=_r+it/2&&Fe<=O&&(Ke.fillText(Ze,Nt&&De==-1?O-Fe:Q+Fe,he,Xt),(Nt||De&&(Fe>it||De==1))&&Ke.fillText(Ze,Nt&&De!=1?O+Fe:(Q||Le.width)-Fe,he,Xt),_r=Fe+Math.min(Xt,Ke.measureText(Ze).width)/2),Fe>=ve+yt&&Fe<O-yt&&(je(Nt&&De==1?O-Fe:Fe,Ze),(Nt||De&&(Fe>yt||De==1))&&je(Nt&&De!=-1?O+Fe:-Fe,Ze),ve=Fe)}}_draw(O){this._runId=requestAnimationFrame(de=>this._draw(de));const Q=O-this._time,le=O-this._last,ye=this._maxFPS?975/this._maxFPS:0;if(le<ye)return;this._last=O-(ye?le%ye:0),this._frames++,Q>=1e3&&(this._fps=this._frames/Q*1e3,this._frames=0,this._time=O);const{isAlpha:Ie,isBands:Le,isLeds:Ae,isLumi:De,isOctaves:Xe,isOutline:Ve,isRound:Ke,noLedGap:lt}=this._flg,{analyzerHeight:At,centerX:zt,centerY:Mt,channelCoords:Nt,channelHeight:Lt,channelGap:or,initialX:rt,innerRadius:Rt,outerRadius:Ot}=this._aux,{_bars:Vt,canvas:it,_canvasGradients:yt,_chLayout:Et,_colorMode:$t,_ctx:W,_energy:je,_fadePeaks:_r,fillAlpha:ve,_fps:vt,_linearAmplitude:dt,_lineWidth:Ze,maxDecibels:Fe,minDecibels:he,_mirror:ft,_mode:Xt,overlay:xt,_radial:et,showBgColor:ir,showPeaks:Ge,useCanvas:mt,_weightingFilter:We}=this,tt=this._scaleX.canvas,kt=this._scaleR.canvas,Qt=vt*this._peakFadeTime/1e3,Tt=vt**2,Kt=this._gravity*1e3,Be=vt*this._peakHoldTime/1e3,_t=Et==k,st=Et==C,Tr=Et==q,vr=Et==x,ei=Ae&&this._trueLeds&&$t==se,br=et?it.width:this._aux.analyzerWidth,Bi=rt+br,ui=Ge&&this._peakLine&&Xt==Je,Mr=et?Ot-Rt:At,pi=Mr/this._pixelRatio;Fe-he;const[Ui,ya,ti,yi]=this._leds||[];je.val>0&&vt>0&&(this._spinAngle+=this._spinSpeed*S/60/vt);const nr=de=>{if(this._reflexRatio>0&&!De&&!et){let Ye,lr;this.reflexFit||Tr?(Ye=Tr&&de==0?Lt+or:0,lr=Lt-At):(Ye=it.height-At*2,lr=At),W.save(),W.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(W.filter=`brightness(${this.reflexBright})`),W.setTransform(1,0,0,-1,0,it.height),W.drawImage(it,0,Nt[de].channelTop,it.width,At,0,Ye,it.width,lr),W.restore()}},Vi=()=>{this.showScaleX&&(et?(W.save(),W.translate(zt,Mt),this._spinSpeed&&W.rotate(this._spinAngle+R),W.drawImage(kt,-kt.width>>1,-kt.width>>1),W.restore()):W.drawImage(tt,0,it.height-tt.height))},Wi=de=>{const Ye=de**2,lr=424.36,Ft=11599.29,Si=25122.25,xr=544496.41,mr=148693636,Fr=Kr=>20*Math.log10(Kr);switch(We){case nt:return 2+Fr(mr*Ye**2/((Ye+lr)*Math.sqrt((Ye+Ft)*(Ye+xr))*(Ye+mr)));case we:return .17+Fr(mr*Ye*de/((Ye+lr)*Math.sqrt(Ye+Si)*(Ye+mr)));case ht:return .06+Fr(mr*Ye/((Ye+lr)*(Ye+mr)));case Pe:const Kr=((103791848e-2-Ye)**2+108076816e-2*Ye)/((9837328-Ye)**2+11723776*Ye);return Fr(de/68966888496476e-18*Math.sqrt(Kr/((Ye+79919.29)*(Ye+1345600))));case Ee:const Nr=-4737338981378384e-39*de**6+2043828333606125e-30*de**4-1363894795463638e-22*Ye+1,Ti=1306612257412824e-34*de**5-2118150887518656e-26*de**3+.0005559488023498642*de;return 18.2+Fr(.0001246332637532143*de/Math.hypot(Nr,Ti))}return 0},Gi=(de,Ye,lr)=>{W.beginPath(),W.moveTo(de,Ye),W.lineTo(de,lr),W.stroke()},wr=de=>{if(de&&Ze){const Ye=W.globalAlpha;W.globalAlpha=1,W.stroke(),W.globalAlpha=Ye}},zr=de=>Math.max(0,(de*Ui|0)*(yi+ti)-ti),Ei=de=>{je.val=de,je.peak>0&&(je.hold--,je.hold<0&&(je.peak+=je.hold*Kt/Tt/it.height*this._pixelRatio)),de>=je.peak&&(je.peak=de,je.hold=Be)};xt&&W.clearRect(0,0,it.width,it.height);let Yi=0;const _i=Vt.length,qi=vr?1:2;for(let de=0;de<qi;de++){const{channelTop:Ye,channelBottom:lr,analyzerBottom:Ft}=Nt[de],Si=this._gradients[this._selectedGrads[de]],xr=Si.colorStops,mr=xr.length,Fr=!ir||Ae&&!xt?"#000":Si.bgColor,Kr=Tr&&et&&de?-1:1,Nr=!de&&ft==-1||de&&ft==1,Ti=!st||de&&ft!=1?0:br>>(de||!Nr),$i=st&&Nr?-1:1,Xi=()=>{const ke=tt.height,Oe=ke>>1,Me=dt?100:Fe,_e=dt?0:he,fe=dt?20:5,Jt=At/(Me-_e),yr=ft!=-1&&(!st||de==0||ft==1),Br=ft!=1&&(!st||de!=ft);W.save(),W.fillStyle=z,W.font=`${Oe}px ${Ne}`,W.textAlign="right",W.lineWidth=1;for(let kr=Me;kr>_e;kr-=fe){const jr=Ye+(Me-kr)*Jt,wt=kr%2==0|0;if(wt){const Gt=jr+Oe*(jr==Ye?.8:.35);yr&&W.fillText(kr,ke*.85,Gt),Br&&W.fillText(kr,(st?br:it.width)-ke*.1,Gt),W.strokeStyle=z,W.setLineDash([2,4]),W.lineDashOffset=0}else W.strokeStyle=P,W.setLineDash([2,8]),W.lineDashOffset=1;W.beginPath(),W.moveTo(rt+ke*wt*yr,~~jr+.5),W.lineTo(Bi-ke*wt*Br,~~jr+.5),W.stroke()}W.restore()},Qi=(ke,Oe)=>{const Me=pr[ke]+(ke<pr.length-1?(pr[ke+1]-pr[ke])*Oe:0);return isNaN(Me)?-1/0:Me},Ir=(ke,Oe=$i)=>Oe*S*((ke+Ti)/it.width)+this._spinAngle,gr=(ke,Oe,Me)=>{const _e=Rt+Oe*Kr,fe=Ir(ke,Me);return[zt+_e*Math.cos(fe),Mt+_e*Math.sin(fe)]},Ai=(ke,Oe,Me,_e,fe)=>{W.beginPath();for(const Jt of ft&&!st?[1,-1]:[$i]){const[yr,Br]=Ke?[Ir(ke,Jt),Ir(ke+Me,Jt)]:[];W.moveTo(...gr(ke,Oe,Jt)),W.lineTo(...gr(ke,Oe+_e,Jt)),Ke?W.arc(zt,Mt,Rt+(Oe+_e)*Kr,yr,Br,Jt!=1):W.lineTo(...gr(ke+Me,Oe+_e,Jt)),W.lineTo(...gr(ke+Me,Oe,Jt)),Ke&&!fe&&W.arc(zt,Mt,Rt+Oe*Kr,Br,yr,Jt==1)}wr(fe),W.fill()},Hi=(ke=0,Oe=0)=>{let Me;$t==se&&!ei||Xt==Je?Me=yt[de]:Me=xr[$t==X?Oe%mr:xr.findLastIndex(_e=>Ae?zr(ke)<=zr(_e.level):ke<=_e.level)].color,W.fillStyle=W.strokeStyle=Me};if(mt){if(st&&!et){const ke=br*(de+Nr),Oe=Nr?-1:1;W.setTransform(Oe,0,0,1,ke,0)}if((!xt||ir)&&(xt&&(W.globalAlpha=this.bgAlpha),W.fillStyle=Fr,(de==0||!et&&!_t)&&W.fillRect(rt,Ye-or,br,(xt&&this.reflexAlpha==1?At:Lt)+or),W.globalAlpha=1),this.showScaleY&&!De&&!et&&(de==0||!_t)&&Xi(),Ae?(W.setLineDash([yi,ti]),W.lineWidth=Vt[0].width):W.lineWidth=Ve?Math.min(Ze,Vt[0].width/2):Ze,W.save(),!et){const ke=new Path2D;ke.rect(0,Ye,it.width,At),W.clip(ke)}}let pr=this._fftData[de];this._analyzer[de].getFloatFrequencyData(pr),We&&(pr=pr.map((ke,Oe)=>ke+Wi(this._binToFreq(Oe)))),W.beginPath();let fi=[];for(let ke=0;ke<_i;ke++){const Oe=Vt[ke],{posX:Me,barCenter:_e,width:fe,freq:Jt,binLo:yr,binHi:Br,ratioLo:kr,ratioHi:jr}=Oe;let wt=Math.max(Qi(yr,kr),Qi(Br,jr));for(let ot=yr+1;ot<Br;ot++)pr[ot]>wt&&(wt=pr[ot]);if(wt=this._normalizedB(wt),Oe.value[de]=wt,Yi+=wt,Oe.peak[de]>0&&Oe.alpha[de]>0&&(Oe.hold[de]--,Oe.hold[de]<0)){if(_r&&!ui){const ot=!Ie||Ve&&Ze>0?1:Ie?Oe.peak[de]:ve;Oe.alpha[de]=ot*(1+Oe.hold[de]/Qt)}else Oe.peak[de]+=Oe.hold[de]*Kt/Tt/pi;Oe.alpha[de]<=0&&(Oe.peak[de]=0)}if(wt>=Oe.peak[de]&&(Oe.peak[de]=wt,Oe.hold[de]=Be,Oe.alpha[de]=!Ie||Ve&&Ze>0?1:Ie?wt:ve),!mt)continue;W.globalAlpha=De||Ie?wt:Ve?ve:1,Hi(wt,ke);const Gt=De?Mr:Ae?zr(wt):wt*Mr|0;if(Xt==Je){const ot=ke?0:(this._normalizedB(pr[Vt[1].binLo])*Mr+Gt)/2;if(et){if(ke==0&&(st&&W.moveTo(...gr(0,0)),W.lineTo(...gr(0,Me<0?ot:Gt))),Me>=0){const Ct=[Me,Gt];W.lineTo(...gr(...Ct)),fi.push(Ct)}}else{if(ke==0)if(ft==-1&&!st)W.moveTo(rt,Ft-(Me<rt?ot:Gt));else{const Ct=yr?this._normalizedB(pr[yr-1])*Mr:Gt;W.moveTo(rt-Ze,Ft-Ct)}(st||ft!=-1||Me>=rt)&&W.lineTo(Me,Ft-Gt)}}else if(Ae){if(ir&&!xt&&(de==0||!_t)){const ot=W.globalAlpha;W.strokeStyle=It,W.globalAlpha=1,Gi(_e,Ye,Ft),W.strokeStyle=W.fillStyle,W.globalAlpha=ot}if(ei){const ot=De?0:xr.findLastIndex(Wr=>zr(wt)<=zr(Wr.level));let Ct=Ft;for(let Wr=mr-1;Wr>=ot;Wr--){W.strokeStyle=xr[Wr].color;let Li=Ft-(Wr==ot?Gt:zr(xr[Wr].level));Gi(_e,Ct,Li),Ct=Li-ti}}else Gi(_e,Ft,Ft-Gt)}else if(Me>=rt)if(et)Ai(Me,0,fe,Gt,Ve);else if(Ke){const ot=fe/2,Ct=Ft+ot;W.beginPath(),W.moveTo(Me,Ct),W.lineTo(Me,Ct-Gt),W.arc(_e,Ct-Gt,ot,E,S),W.lineTo(Me+fe,Ct),wr(Ve),W.fill()}else{const ot=Ve?W.lineWidth:0;W.beginPath(),W.rect(Me,Ft+ot,fe,-Gt-ot),wr(Ve),W.fill()}const ri=Oe.peak[de],Ji=Oe.alpha[de];if(ri>0&&Ji>0&&Ge&&!ui&&!De&&Me>=rt&&Me<Bi){if(_r?W.globalAlpha=Ji:Ve&&Ze>0?W.globalAlpha=1:Ie&&(W.globalAlpha=ri),($t==ie||ei)&&Hi(ri),Ae){const ot=zr(ri);ot>=ti&&W.fillRect(Me,Ft-ot,fe,yi)}else if(!et)W.fillRect(Me,Ft-ri*Mr,fe,2);else if(Xt!=Je){const ot=ri*Mr;Ai(Me,ot,fe,!this._radialInvert||Tr||ot+Rt>=2?-2:2)}}}if(mt){if(W.globalAlpha=1,Xt==Je){if(Hi(),et&&!st){if(ft){let ke;for(;ke=fi.pop();)W.lineTo(...gr(...ke,-1))}W.closePath()}if(Ze>0&&W.stroke(),ve>0){if(et){const ke=st?Ir(br>>1):0,Oe=st?Ir(br):S;W.moveTo(...gr(st?br>>1:0,0)),W.arc(zt,Mt,Rt,ke,Oe,st?!Nr:!0)}else W.lineTo(Bi,Ft),W.lineTo(rt,Ft);W.globalAlpha=ve,W.fill(),W.globalAlpha=1}if((ui||et&&Ge)&&(fi=[],W.beginPath(),Vt.forEach((ke,Oe)=>{let Me=ke.posX,_e=ke.peak[de],fe=Oe?"lineTo":"moveTo";if(et&&Me<0){const Jt=Vt[Oe+1];_e=ji(Me,_e,Jt.posX,Jt.peak[de],0),Me=0}_e*=Mr,ui?(W[fe](...et?gr(Me,_e):[Me,Ft-_e]),et&&ft&&!st&&fi.push([Me,_e])):_e>0&&Ai(Me,_e,1,-2)}),ui)){let ke;for(;ke=fi.pop();)W.lineTo(...gr(...ke,-1));W.lineWidth=1,W.stroke()}}W.restore(),st&&!et&&W.setTransform(1,0,0,1,0,0),(!st&&!_t||de)&&nr(de)}}if(Ei(Yi/(_i<<qi-1)),mt&&(ft&&!et&&!st&&(W.setTransform(-1,0,0,1,it.width-rt,0),W.drawImage(it,rt,0,zt,it.height,0,0,zt,it.height),W.setTransform(1,0,0,1,0,0)),W.setLineDash([]),Vi()),this.showFPS){const de=tt.height;W.font=`bold ${de}px ${Ne}`,W.fillStyle=ne,W.textAlign="right",W.fillText(Math.round(vt),it.width-de,de*2)}this.onCanvasDraw&&(W.save(),W.fillStyle=W.strokeStyle=yt[0],this.onCanvasDraw(this,{timestamp:O,canvasGradients:yt}),W.restore())}_freqScaling(O){switch(this._frequencyScale){case te:return Math.log2(O);case ce:return 26.81*O/(1960+O)-.53;case K:return Math.log2(1+O/700);case oe:return O}}_freqToBin(O,Q="round"){const le=this._analyzer[0].frequencyBinCount-1,ye=Math[Q](O*this.fftSize/this.audioCtx.sampleRate);return ye<le?ye:le}_makeGrad(){if(!this._ready)return;const{canvas:O,_ctx:Q,_radial:le,_reflexRatio:ye}=this,{analyzerWidth:Ie,centerX:Le,centerY:Ae,initialX:De,innerRadius:Xe,outerRadius:Ve}=this._aux,{isLumi:Ke}=this._flg,lt=this._chLayout==q,At=1-ye,zt=Ke?O.height:O.height*(1-ye*!lt)|0;for(const Mt of[0,1]){const Nt=this._gradients[this._selectedGrads[Mt]],Lt=Nt.colorStops,or=Nt.dir=="h";let rt;if(le?rt=Q.createRadialGradient(Le,Ae,Ve,Le,Ae,Xe-(Ve-Xe)*lt):rt=Q.createLinearGradient(...or?[De,0,De+Ie,0]:[0,0,0,zt]),Lt){const Rt=lt&&!this._splitGradient&&(!or||le);for(let Ot=0;Ot<1+Rt;Ot++){const Vt=Lt.length-1;Lt.forEach((it,yt)=>{let Et=it.pos;Rt&&(Et/=2),lt&&!Ke&&!le&&!or&&(Et*=At,!Rt&&Et>.5*At&&(Et+=.5*ye)),Ot==1&&(le||Ke?(it=Lt[Vt-yt],Et=1-it.pos/2):(yt==0&&Et>0&&rt.addColorStop(.5,it.color),Et+=.5)),rt.addColorStop(Et,it.color),lt&&yt==Vt&&Et<.5&&rt.addColorStop(.5,it.color)})}}this._canvasGradients[Mt]=rt}}_normalizedB(O){const Q=this._linearAmplitude,le=Q?1/this._linearBoost:1,ye=(De,Xe,Ve)=>De<=Xe?Xe:De>=Ve?Ve:De,Ie=De=>10**(De/20);let Le=this.maxDecibels,Ae=this.minDecibels;return Q&&(Le=Ie(Le),Ae=Ie(Ae),O=Ie(O)**le),ye((O-Ae)/(Le-Ae)**le,0,1)}_setCanvas(O){if(!this._ready)return;const{canvas:Q,_ctx:le}=this,ye=this._scaleX.canvas,Ie=window.devicePixelRatio/(this._loRes+1);let Le=window.screen.width*Ie,Ae=window.screen.height*Ie;Math.abs(window.orientation)==90&&Le<Ae&&([Le,Ae]=[Ae,Le]);const De=this.isFullscreen,Xe=De&&this._fsEl==Q,Ve=Xe?Le:(this._width||this._container.clientWidth||this._defaultWidth)*Ie|0,Ke=Xe?Ae:(this._height||this._container.clientHeight||this._defaultHeight)*Ie|0;this._pixelRatio=Ie,this._fsWidth=Le,this._fsHeight=Ae,!(O!=A&&Q.width==Ve&&Q.height==Ke)&&(Q.width=Ve,Q.height=Ke,this.overlay||(le.fillStyle="#000",le.fillRect(0,0,Ve,Ke)),le.lineJoin="bevel",ye.width=Ve,ye.height=Math.max(20*Ie,Math.min(Ve,Ke)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==De&&(O=re),this._fsStatus=De,this.onCanvasResize&&this.onCanvasResize(O,this))}_setGradient(O,Q){if(!this._gradients.hasOwnProperty(O))throw new rr(sr,O);[0,1].includes(Q)||(this._selectedGrads[1]=O,Q=0),this._selectedGrads[Q]=O,this._makeGrad()}_setProps(O,Q){const le=["onCanvasDraw","onCanvasResize"],ye=Object.keys(pe).filter(Ie=>Ie!="start").concat(le,["gradientLeft","gradientRight","stereo"]);(Q||O===void 0)&&(O={...pe,...O});for(const Ie of Object.keys(O))le.includes(Ie)&&typeof O[Ie]!="function"?this[Ie]=void 0:ye.includes(Ie)&&(this[Ie]=O[Ie]);O.start!==void 0&&this.toggleAnalyzer(O.start)}}h.AudioMotionAnalyzer=Ni,h.default=Ni})}),require_spectrumAnalyzer=__commonJSMin(c=>{var h=c&&c.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(c,"__esModule",{value:!0}),c.spectrumAnalyser=c.AudioMotionAnalyzer=void 0;var g=h(require_dist$1());c.AudioMotionAnalyzer=g.default;var E=(S,R)=>new g.default({source:S,...R});c.spectrumAnalyser=E}),require_audioNode=__commonJSMin(c=>{var h=c&&c.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(c,"__esModule",{value:!0});var g=(init_dist$1(),__toCommonJS(dist_exports)),E=h(require_hls()),S=require_state(),R=require_spectrumAnalyzer(),L=class{constructor(k,C){this._audioElement={},this.state=S.PlayerState.STOPPED,this.duration=0,this.currentTime=0,this.volume=100,this.isFading=!1,this.context=null,this.motion=null,this.options={},this.motionColors=["#ff0000","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000"],this.fadeDuration=3,this.prefetchLeeway=10,this.crossFadeSteps=20,this.fadeOutVolume=0,this.fadeInVolume=100,this.hasNextQueued=!1,this.repeat="off",this._disableAutoPlayback=!1,this.isTv=window.matchMedia("(width: 960px) and (height: 540px)").matches,this.bands=[],this._preGain=null,this._filters=[],this._panner=null,this.options=k,this.parent=C,this.prefetchLeeway=k.prefetchLeeway??10,this.fadeDuration=k.fadeDuration??3,this.bands=k.bands,this.motionConfig=k.motionConfig,this.motionColors=k.motionColors,this._initialize()}dispose(){this._removeEvents(),this._audioElement.remove()}setAccessToken(k){this.accessToken=k}setSource(k){return this._audioElement.pause(),this._audioElement.removeAttribute("src"),k.endsWith(".m3u8")?E.default.isSupported()?(this.hls??(this.hls=new E.default({debug:!1,enableWorker:!0,lowLatencyMode:!0,maxBufferHole:0,maxBufferLength:30,maxBufferSize:0,autoStartLoad:!0,testBandwidth:!0,xhrSetup:C=>{this.accessToken&&C.setRequestHeader("authorization",`Bearer ${this.accessToken}`)}})),this.hls?.loadSource(k),this.hls?.attachMedia(this._audioElement)):this._audioElement.canPlayType("application/vnd.apple.mpegurl")&&(this._audioElement.src=`${k}${this.accessToken?`?token=${this.accessToken}`:""}`):(this.hls?.destroy(),this.hls=void 0,this._audioElement.src=`${k}${this.accessToken?`?token=${this.accessToken}`:""}`),this}play(){return this._audioElement.play()}pause(){this._audioElement.pause()}stop(){this._audioElement.pause(),this._audioElement.currentTime=0,URL.revokeObjectURL(this._audioElement.src),this._audioElement.removeAttribute("src"),this._audioElement.removeAttribute("data-src")}setVolume(k){if((0,g.isPlatform)("android")||(0,g.isPlatform)("ios")){this._audioElement.volume=1;return}k<0&&(k=0),k>100&&(k=100),this.volume=k,this._audioElement.volume=k/100}fadeVolume(k){k<0&&(k=0),k>100&&(k=100),this._audioElement.volume=k/100}getVolume(){return this.volume}mute(){this._audioElement.muted=!0}unmute(){this._audioElement.muted=!1}isPlaying(){return this.state===S.PlayerState.PLAYING}getDuration(){return this.duration}getCurrentTime(){return this.currentTime}getBuffer(){return this._audioElement.buffered.length}getPlaybackRate(){return this._audioElement.playbackRate}setCurrentTime(k){return this._audioElement.currentTime=k,this}getAudioElement(){return this._audioElement}getTimeData(){return{position:Math.abs(this.getCurrentTime()),duration:Math.abs(this.getDuration()),remaining:this.getDuration()<0?1/0:Math.abs(this.getDuration())-Math.abs(this.getCurrentTime()),buffered:this.getBuffer(),percentage:Math.abs(this.getCurrentTime())/Math.abs(this.getDuration())*100}}setCrossFadeSteps(k){this.crossFadeSteps=k}setAutoPlayback(k){this._disableAutoPlayback=k}_fadeIn(k=!1){k&&(this.fadeVolume(0),this.fadeInVolume=0),this._audioElement.play().then(),this.fadeInVolume<this.volume?(this.fadeInVolume+=this.crossFadeSteps,setTimeout(()=>this._fadeIn(),200)):(this.fadeInVolume=this.volume,this.isFading=!1),this.fadeInVolume>100&&(this.fadeInVolume=100),this.fadeVolume(this.fadeInVolume),this.fadeInVolume>=this.volume-this.crossFadeSteps*12&&this.parent.emit("nextSong")}_fadeOut(k=!1){this.isFading=!0,k&&(this.fadeOutVolume=this.volume),this.fadeOutVolume>0?(this.fadeOutVolume-=this.crossFadeSteps,setTimeout(()=>this._fadeOut(),200)):this.fadeOutVolume=0,this.fadeOutVolume<0&&(this.fadeOutVolume=0),this.fadeVolume(this.fadeOutVolume),this.fadeOutVolume==0&&(this.pause(),URL.revokeObjectURL(this._audioElement?.src),this._audioElement?.removeAttribute("src"),this._audioElement?.removeAttribute("data-src"),this.parent.emit("endFadeOut"),setTimeout(()=>{this.hasNextQueued=!1,this.isFading=!1,this.parent.emit("setCurrentAudio",this._audioElement)},500))}setRepeating(k){this.repeat=k}_initialize(){this._createAudioElement(this.options.id),this._addEvents()}_createAudioElement(k){this._audioElement=document.createElement("audio"),this._audioElement.id=`audio-${k}`,this._audioElement.preload="auto",this._audioElement.controls=!1,this._audioElement.autoplay=!0,this._audioElement.loop=!1,this._audioElement.setAttribute("tabindex","-1");let C=this.options.volume??100;return C<0&&(C=0),C>100&&(C=100),this._audioElement.volume=C/100,this._audioElement.crossOrigin="anonymous",document.body.appendChild(this._audioElement),this}playEvent(){this.state=S.PlayerState.PLAYING,this.parent.emit("play-internal",this._audioElement),this._initializeContext(),this.isFading||this.parent.emit("play",this._audioElement)}pauseEvent(){this.state=S.PlayerState.PAUSED,this.parent.emit("pause-internal",this._audioElement),this.isFading||this.parent.emit("pause",this._audioElement)}endedEvent(){this.state=S.PlayerState.ENDED,this.parent.emit("ended",this._audioElement)}errorEvent(){console.error("Error",this._audioElement.error),this.state=S.PlayerState.ERROR,this.parent.emit("error",this._audioElement)}waitingEvent(){this.state=S.PlayerState.BUFFERING,this.parent.emit("waiting",this._audioElement)}canplayEvent(){this.parent.emit("canplay",this._audioElement),!this.isPlaying()&&(this.state=S.PlayerState.IDLE)}loadedmetadataEvent(){this.parent.emit("loadedmetadata",this._audioElement),!this.isPlaying()&&(this.state=S.PlayerState.IDLE)}loadstartEvent(){this.state=S.PlayerState.LOADING,this.parent.emit("loadstart",this._audioElement)}timeupdateEvent(){this.state=S.PlayerState.PLAYING,this.currentTime=this._audioElement.currentTime,this.duration=this._audioElement.duration,this.parent.emit("time-internal",this.getTimeData()),(!this.isFading||this.repeat=="one")&&this.parent.emit("time",this.getTimeData()),!this.hasNextQueued&&this.repeat!=="one"&&this._audioElement.currentTime>=this._audioElement.duration-this.prefetchLeeway&&!this._disableAutoPlayback&&(this.hasNextQueued=!0,this.parent.emit("queueNext")),this.repeat!=="one"&&this._audioElement.currentTime>=this._audioElement.duration-this.fadeDuration*4&&!this._disableAutoPlayback&&this.parent.emit("startFadeOut")}durationchangeEvent(){this.duration=this._audioElement.duration,this.parent.emit("duration",this._audioElement.duration)}volumechangeEvent(){this.parent.emit("volume",this.volume)}seekedEvent(){console.log("seeked",this._audioElement.currentTime),this.parent.emit("seeked",{buffered:this._audioElement.buffered.length,duration:this._audioElement.duration,percentage:this._audioElement.currentTime/this._audioElement.duration*100,position:this._audioElement.currentTime,remaining:this._audioElement.duration-this._audioElement.currentTime})}_addEvents(){this._audioElement.addEventListener("play",this.playEvent.bind(this)),this._audioElement.addEventListener("pause",this.pauseEvent.bind(this)),this._audioElement.addEventListener("ended",this.endedEvent.bind(this)),this._audioElement.addEventListener("error",this.errorEvent.bind(this)),this._audioElement.addEventListener("waiting",this.waitingEvent.bind(this)),this._audioElement.addEventListener("canplay",this.canplayEvent.bind(this)),this._audioElement.addEventListener("loadedmetadata",this.loadedmetadataEvent.bind(this)),this._audioElement.addEventListener("loadstart",this.loadstartEvent.bind(this)),this._audioElement.addEventListener("timeupdate",this.timeupdateEvent.bind(this)),this._audioElement.addEventListener("durationchange",this.durationchangeEvent.bind(this)),this._audioElement.addEventListener("volumechange",this.volumechangeEvent.bind(this)),this._audioElement.addEventListener("seeked",this.seekedEvent.bind(this))}_removeEvents(){this._audioElement.removeEventListener("play",this.playEvent.bind(this)),this._audioElement.removeEventListener("pause",this.pauseEvent.bind(this)),this._audioElement.removeEventListener("ended",this.endedEvent.bind(this)),this._audioElement.removeEventListener("error",this.errorEvent.bind(this)),this._audioElement.removeEventListener("waiting",this.waitingEvent.bind(this)),this._audioElement.removeEventListener("canplay",this.canplayEvent.bind(this)),this._audioElement.removeEventListener("loadedmetadata",this.loadedmetadataEvent.bind(this)),this._audioElement.removeEventListener("loadstart",this.loadstartEvent.bind(this)),this._audioElement.removeEventListener("timeupdate",this.timeupdateEvent.bind(this)),this._audioElement.removeEventListener("durationchange",this.durationchangeEvent.bind(this)),this._audioElement.removeEventListener("volumechange",this.volumechangeEvent.bind(this)),this._audioElement.removeEventListener("seeked",this.seekedEvent.bind(this))}createFilter(k,C){const x=this.context.createBiquadFilter();return x.frequency.value=k,x.type=C,x.gain.value=0,x}_initializeContext(){if(!(this.isTv||localStorage.getItem("nmplayer-music-supports-audio-context")==="false")){if(!this.context)try{this.motion=(0,R.spectrumAnalyser)(this._audioElement,this.motionConfig),this.motionColors.length&&(this.motion.registerGradient("theme",{bgColor:"transparent",dir:"h",colorStops:this.motionColors}),this.motion.gradient="theme"),setTimeout(()=>{this.motion.canvas.style.position="absolute",this.motion.canvas.style.height="320px",this.motion.canvas.style.width="1400px",this.motion.canvas.style.overflow="hidden",this.motion.canvas.style.opacity="0",this.motion.canvas.style.pointerEvents="none"},500),this.context=this.motion.audioCtx,this.context.addEventListener("error",()=>{localStorage.setItem("nmplayer-music-supports-audio-context","false"),this.context.close().then(),location.reload()}),this._preGain=this.context.createGain(),this._filters=this.bands.slice(1).map(k=>this.createFilter(k.frequency,"peaking")),this._panner=this.context.createStereoPanner(),this.motion.connectedSources.at(0).connect(this._preGain),this._filters.reduce((k,C)=>(k.connect(C),C),this._preGain).connect(this._panner).connect(this.context.destination),this.parent.on("setPreGain",k=>{this._preGain.gain.value=k}),this.parent.on("setPanner",k=>{this._panner.pan.value=k}),this.parent.on("setFilter",k=>{const C=this.bands.findIndex(x=>x.frequency===k.frequency);this._filters[C-1].gain.value=k.gain}),this.parent.loadEqualizerSettings()}catch(k){console.error("Failed to create AudioContext:",k);return}this.context&&this.context.state==="suspended"&&this.context.resume().then(()=>{console.log("AudioContext resumed")}).catch(k=>{console.error("Failed to resume AudioContext:",k)})}}};c.default=L}),require_equalizer=__commonJSMin(c=>{Object.defineProperty(c,"__esModule",{value:!0}),c.equalizerPresets=c.equalizerBands=c.equalizerSliderValues=void 0,c.equalizerSliderValues={pan:{min:-1,max:1,step:.01,default:0},pre:{min:-1,max:3,step:1,default:0},band:{min:-12,max:12,step:.01,default:0}},c.equalizerBands=[{frequency:"Pre",gain:c.equalizerSliderValues.pre.default},{frequency:70,gain:c.equalizerSliderValues.band.default},{frequency:180,gain:c.equalizerSliderValues.band.default},{frequency:320,gain:c.equalizerSliderValues.band.default},{frequency:600,gain:c.equalizerSliderValues.band.default},{frequency:1e3,gain:c.equalizerSliderValues.band.default},{frequency:3e3,gain:c.equalizerSliderValues.band.default},{frequency:6e3,gain:c.equalizerSliderValues.band.default},{frequency:12e3,gain:c.equalizerSliderValues.band.default},{frequency:14e3,gain:c.equalizerSliderValues.band.default},{frequency:16e3,gain:c.equalizerSliderValues.band.default}],c.equalizerPresets=[{name:"Custom",values:[{frequency:70,gain:0},{frequency:180,gain:0},{frequency:320,gain:0},{frequency:600,gain:0},{frequency:1e3,gain:0},{frequency:3e3,gain:0},{frequency:6e3,gain:0},{frequency:12e3,gain:0},{frequency:14e3,gain:0},{frequency:16e3,gain:0}]},Object.freeze({name:"Classical",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:-4.499943750703116}),Object.freeze({frequency:12e3,gain:-4.499943750703116}),Object.freeze({frequency:14e3,gain:-4.499943750703116}),Object.freeze({frequency:16e3,gain:-5.9999250009374885})]}),Object.freeze({name:"Club",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:2.249971875351558}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:3.74995312558593}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:2.249971875351558}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Dance",values:[Object.freeze({frequency:70,gain:5.9999250009374885}),Object.freeze({frequency:180,gain:4.499943750703116}),Object.freeze({frequency:320,gain:1.4999812502343721}),Object.freeze({frequency:600,gain:0}),Object.freeze({frequency:1e3,gain:0}),Object.freeze({frequency:3e3,gain:-3.74995312558593}),Object.freeze({frequency:6e3,gain:-4.499943750703116}),Object.freeze({frequency:12e3,gain:-4.499943750703116}),Object.freeze({frequency:14e3,gain:0}),Object.freeze({frequency:16e3,gain:0})]}),Object.freeze({name:"Flat",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:.37499531255859303}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Laptop speakers/headphones",values:[Object.freeze({frequency:70,gain:2.9999625004687442}),Object.freeze({frequency:180,gain:6.749915626054674}),Object.freeze({frequency:320,gain:3.374957813027337}),Object.freeze({frequency:600,gain:-2.249971875351558}),Object.freeze({frequency:1e3,gain:-1.4999812502343721}),Object.freeze({frequency:3e3,gain:1.124985937675779}),Object.freeze({frequency:6e3,gain:2.9999625004687442}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:7.874901563730453}),Object.freeze({frequency:16e3,gain:8.999887501406231})]}),Object.freeze({name:"Large hall",values:[Object.freeze({frequency:70,gain:6.374920313496081}),Object.freeze({frequency:180,gain:6.374920313496081}),Object.freeze({frequency:320,gain:3.74995312558593}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:-2.9999625004687442}),Object.freeze({frequency:6e3,gain:-2.9999625004687442}),Object.freeze({frequency:12e3,gain:-2.9999625004687442}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Party",values:[Object.freeze({frequency:70,gain:4.499943750703116}),Object.freeze({frequency:180,gain:4.499943750703116}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:.37499531255859303}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:4.499943750703116}),Object.freeze({frequency:16e3,gain:4.499943750703116})]}),Object.freeze({name:"Pop",values:[Object.freeze({frequency:70,gain:-1.124985937675779}),Object.freeze({frequency:180,gain:2.9999625004687442}),Object.freeze({frequency:320,gain:4.499943750703116}),Object.freeze({frequency:600,gain:4.874939063261709}),Object.freeze({frequency:1e3,gain:3.374957813027337}),Object.freeze({frequency:3e3,gain:-.7499906251171861}),Object.freeze({frequency:6e3,gain:-1.4999812502343721}),Object.freeze({frequency:12e3,gain:-1.4999812502343721}),Object.freeze({frequency:14e3,gain:-1.124985937675779}),Object.freeze({frequency:16e3,gain:-1.124985937675779})]}),Object.freeze({name:"Reggae",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:-.37499531255859303}),Object.freeze({frequency:600,gain:-3.74995312558593}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:4.124948438144523}),Object.freeze({frequency:6e3,gain:4.124948438144523}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Rock",values:[Object.freeze({frequency:70,gain:4.874939063261709}),Object.freeze({frequency:180,gain:2.9999625004687442}),Object.freeze({frequency:320,gain:-3.374957813027337}),Object.freeze({frequency:600,gain:-4.874939063261709}),Object.freeze({frequency:1e3,gain:-2.249971875351558}),Object.freeze({frequency:3e3,gain:2.6249671879101513}),Object.freeze({frequency:6e3,gain:5.624929688378895}),Object.freeze({frequency:12e3,gain:6.749915626054674}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:6.749915626054674})]}),Object.freeze({name:"Soft",values:[Object.freeze({frequency:70,gain:2.9999625004687442}),Object.freeze({frequency:180,gain:1.124985937675779}),Object.freeze({frequency:320,gain:-.7499906251171861}),Object.freeze({frequency:600,gain:-1.4999812502343721}),Object.freeze({frequency:1e3,gain:-.7499906251171861}),Object.freeze({frequency:3e3,gain:2.6249671879101513}),Object.freeze({frequency:6e3,gain:5.2499343758203025}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:7.49990625117186})]}),Object.freeze({name:"Ska",values:[Object.freeze({frequency:70,gain:-1.4999812502343721}),Object.freeze({frequency:180,gain:-2.9999625004687442}),Object.freeze({frequency:320,gain:-2.6249671879101513}),Object.freeze({frequency:600,gain:-.37499531255859303}),Object.freeze({frequency:1e3,gain:2.6249671879101513}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:5.624929688378895}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:5.9999250009374885})]}),Object.freeze({name:"Full Bass",values:[Object.freeze({frequency:70,gain:5.9999250009374885}),Object.freeze({frequency:180,gain:5.9999250009374885}),Object.freeze({frequency:320,gain:5.9999250009374885}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:1.124985937675779}),Object.freeze({frequency:3e3,gain:-2.6249671879101513}),Object.freeze({frequency:6e3,gain:-5.2499343758203025}),Object.freeze({frequency:12e3,gain:-6.374920313496081}),Object.freeze({frequency:14e3,gain:-6.749915626054674}),Object.freeze({frequency:16e3,gain:-6.749915626054674})]}),Object.freeze({name:"Soft Rock",values:[Object.freeze({frequency:70,gain:2.6249671879101513}),Object.freeze({frequency:180,gain:2.6249671879101513}),Object.freeze({frequency:320,gain:1.4999812502343721}),Object.freeze({frequency:600,gain:-.37499531255859303}),Object.freeze({frequency:1e3,gain:-2.6249671879101513}),Object.freeze({frequency:3e3,gain:-3.374957813027337}),Object.freeze({frequency:6e3,gain:-2.249971875351558}),Object.freeze({frequency:12e3,gain:-.37499531255859303}),Object.freeze({frequency:14e3,gain:1.874976562792965}),Object.freeze({frequency:16e3,gain:5.624929688378895})]}),Object.freeze({name:"Full Treble",values:[Object.freeze({frequency:70,gain:-5.9999250009374885}),Object.freeze({frequency:180,gain:-5.9999250009374885}),Object.freeze({frequency:320,gain:-5.9999250009374885}),Object.freeze({frequency:600,gain:-2.6249671879101513}),Object.freeze({frequency:1e3,gain:1.874976562792965}),Object.freeze({frequency:3e3,gain:6.749915626054674}),Object.freeze({frequency:6e3,gain:9.749878126523418}),Object.freeze({frequency:12e3,gain:9.749878126523418}),Object.freeze({frequency:14e3,gain:9.749878126523418}),Object.freeze({frequency:16e3,gain:10.499868751640605})]}),Object.freeze({name:"Full Bass & Treble",values:[Object.freeze({frequency:70,gain:4.499943750703116}),Object.freeze({frequency:180,gain:3.74995312558593}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:-4.499943750703116}),Object.freeze({frequency:1e3,gain:-2.9999625004687442}),Object.freeze({frequency:3e3,gain:1.124985937675779}),Object.freeze({frequency:6e3,gain:5.2499343758203025}),Object.freeze({frequency:12e3,gain:6.749915626054674}),Object.freeze({frequency:14e3,gain:7.49990625117186}),Object.freeze({frequency:16e3,gain:7.49990625117186})]}),Object.freeze({name:"Live",values:[Object.freeze({frequency:70,gain:-2.9999625004687442}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:2.6249671879101513}),Object.freeze({frequency:600,gain:3.374957813027337}),Object.freeze({frequency:1e3,gain:3.74995312558593}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:2.6249671879101513}),Object.freeze({frequency:12e3,gain:1.874976562792965}),Object.freeze({frequency:14e3,gain:1.874976562792965}),Object.freeze({frequency:16e3,gain:1.4999812502343721})]}),Object.freeze({name:"Techno",values:[Object.freeze({frequency:70,gain:4.874939063261709}),Object.freeze({frequency:180,gain:3.74995312558593}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:-3.374957813027337}),Object.freeze({frequency:1e3,gain:-2.9999625004687442}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:4.874939063261709}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:5.9999250009374885}),Object.freeze({frequency:16e3,gain:5.624929688378895})]})]}),require_helpers=__commonJSMin(c=>{var h=c&&c.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(c,"__esModule",{value:!0});var g=h(require_audioNode()),E=require_state(),S=require_equalizer(),R=class extends EventTarget{constructor(){super(),this.volume=Number(localStorage.getItem("nmplayer-music-volume"))||100,this.muted=!1,this.duration=0,this.currentTime=0,this.buffered=0,this.playbackRate=1,this.fadeDuration=3,this.currentSong=null,this.state=E.PlayerState.IDLE,this.volumeState=E.VolumeState.UNMUTED,this.isShuffling=!1,this.isRepeating=!1,this.isMuted=!1,this.isPaused=!1,this.isPlaying=!1,this.isStopped=!1,this.isSeeking=!1,this.isTransitioning=!1,this.newSourceLoaded=!1,this.baseUrl="/",this.accessToken="",this._options={},this.context=null,this.preGain=null,this.filters=[],this.panner=null,this.siteTitle="NoMercy Player",this.disableAutoPlayback=!1,this.motionConfig={alphaBars:!0,ansiBands:!0,barSpace:.25,bgAlpha:0,channelLayout:"dual-horizontal",colorMode:"bar-level",fadePeaks:!1,fftSize:16384,fillAlpha:.5,frequencyScale:"log",gravity:3.8,height:void 0,ledBars:!1,lineWidth:5,linearAmplitude:!0,linearBoost:1.4,loRes:!1,lumiBars:!1,maxDecibels:-35,maxFPS:60,maxFreq:16e3,minDecibels:-85,minFreq:30,mirror:0,mode:2,noteLabels:!1,outlineBars:!1,overlay:!0,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:1,reflexBright:1,reflexFit:!0,reflexRatio:.5,roundBars:!1,showBgColor:!1,showFPS:!1,showPeaks:!1,showScaleX:!1,showScaleY:!1,smoothing:.7,spinSpeed:1,splitGradient:!1,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:"D",width:void 0},this.motionColors=[],this.equalizerPanning=0,this.eventTarget={},this.events=[],this._audioElement1=new g.default({id:1,volume:this.volume/100,bands:S.equalizerBands,motionConfig:this.motionConfig,motionColors:this.motionColors},this),this._audioElement2=new g.default({id:2,volume:this.volume/100,bands:S.equalizerBands,motionConfig:this.motionConfig,motionColors:this.motionColors},this),this._currentAudio=this._audioElement1,this._nextAudio=this._audioElement2,this.eventTarget=new EventTarget,this.equalizerBands=S.equalizerBands,this.equalizerSliderValues=S.equalizerSliderValues,this.equalizerPresets=S.equalizerPresets,this._audioElement1.context=this.context,this._audioElement1._preGain=this.preGain,this._audioElement1._filters=this.filters,this._audioElement1._panner=this.panner,this._audioElement1._disableAutoPlayback=this.disableAutoPlayback,this._audioElement2.context=this.context,this._audioElement2._preGain=this.preGain,this._audioElement2._filters=this.filters,this._audioElement2._panner=this.panner,this._audioElement2._disableAutoPlayback=this.disableAutoPlayback}setAccessToken(L){this.accessToken=L,this._audioElement1.setAccessToken(L),this._audioElement2.setAccessToken(L)}setBaseUrl(L){this.baseUrl=L}getNewSource(L){if(!L?.path)throw new Error("No path provided for new source");return new Promise(k=>k(encodeURI(`${this.baseUrl}${L?.path}`).replace(/#/u,"%23")))}loadEqualizerSettings(){const L=localStorage.getItem("nmplayer-music-equalizer-settings");if(L){this.equalizerBands=JSON.parse(L);for(const k of this.equalizerBands){if(k.frequency==="Pre"){this?.setPreGain(k.gain);continue}this.setFilter(k)}}}setPreGain(L){this.emit("setPreGain",L)}setPanner(L){this.equalizerPanning=L,this.emit("setPanner",L)}setFilter(L){this.emit("setFilter",L)}saveEqualizerSettings(){localStorage.setItem("nmplayer-music-equalizer-settings",JSON.stringify(this.equalizerBands))}setTitle(L){if(!L||L==""){document.title=this.siteTitle;return}const k=[];L&&k.push(L),window.matchMedia("(display-mode: standalone)").matches||(L&&k.push("-"),k.push(this.siteTitle)),document.title=k.join(" ")}emit(L,k){this.eventTarget?.dispatchEvent?.(new CustomEvent(L,{detail:k}))}on(L,k){const C=x=>k(x.detail);C.original=k,this.eventTarget.addEventListener(L,C),this.events.push({type:L,fn:C})}off(L,k){if(k){const C=this.events.find(x=>x.type===L&&x.fn.original===k);if(C){this.eventTarget.removeEventListener(L,C.fn);const x=this.events.findIndex(q=>q===C);x>-1&&this.events.splice(x,1)}return}if(L==="all"){this.events.forEach(C=>{this.eventTarget.removeEventListener(C.type,C.fn)}),this.events=[];return}this.events.filter(C=>C.type===L).forEach(C=>{this.eventTarget.removeEventListener(C.type,C.fn);const x=this.events.findIndex(q=>q===C);x>-1&&this.events.splice(x,1)})}once(L,k){this.eventTarget.addEventListener(L,C=>k(C.detail),{once:!0})}};c.default=R}),require_queue=__commonJSMin(c=>{var h=c&&c.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(c,"__esModule",{value:!0});var g=h(require_helpers()),E=class extends g.default{constructor(){super(),this.currentSong=null,this._repeat="off",this._queue=[],this._backLog=[],this._shuffle=!1,this._initializeQueue()}getQueue(){return this._queue}setQueue(S){this._queue=[...S].map(R=>Object.assign({},R)),this.emit("queue",this._queue)}addToQueue(S){this._queue.push(Object.assign({},S)),this.emit("queue",this._queue)}pushToQueue(S){S=Object.assign({},S),S.forEach(R=>this._queue.push(R)),this.emit("queue",this._queue)}removeFromQueue(S){this._queue.splice(this._queue.indexOf(S),1),this.emit("queue",this._queue)}addToQueueNext(S){this._queue.unshift(Object.assign({},S)),this.emit("queue",this._queue)}getBackLog(){return this._backLog}setBackLog(S){this._backLog=[...S].map(R=>Object.assign({},R)),this.emit("backlog",this._backLog)}addToBackLog(S){S&&(this._backLog.push(Object.assign({},S)),this.emit("backlog",this._backLog))}pushToBackLog(S){S=Object.assign({},S),S.forEach(R=>this._backLog.push(R)),this.emit("backlog",this._backLog)}removeFromBackLog(S){this._backLog.splice(this._backLog.indexOf(S),1),this.emit("backlog",this._backLog)}setCurrentSong(S){this.currentSong=S,this.emit("song",S),S&&this.getNewSource(S).then(R=>{this._currentAudio.setSource(R),this._currentAudio.play().then(()=>{this._currentAudio.getAudioElement().setAttribute("data-src",S?.id?.toString())})})}next(){if(this.addToBackLog(this.currentSong),this._queue?.length>0){let S=this._queue[0];if(this._shuffle){const R=Math.round(Math.random()*(this._queue.length-1));S=this._queue[R]}this.setCurrentSong(S),this.removeFromQueue(S)}else this.setCurrentSong(this._backLog[0]),this.setQueue(this._backLog.slice(1)),this.setBackLog([])}previous(){if(this._currentAudio.currentTime>3)this._currentAudio.setCurrentTime(0);else if(this._backLog.length>0){const S=this._backLog.at(-1);if(!S)return;this.currentSong&&this.addToQueueNext(this.currentSong),this.setCurrentSong(S),this.removeFromBackLog(S)}else this._currentAudio.setCurrentTime(0)}playTrack(S,R){if((!this.currentSong?.id||this.currentSong?.id!==S?.id)&&this.setCurrentSong(S),R){const L=R.findIndex(k=>k.id===S.id);if(L!==-1){const k=R.slice(L+1),C=R.slice(0,L),x=[...k,...C];this.setQueue(x)}}}shuffle(S){this._shuffle=S,this.isShuffling=S,this.emit("shuffle",S)}repeat(S){this._repeat=S,this.emit("repeat",this._repeat),this.isRepeating=this._repeat!=="off",this._currentAudio.setRepeating(this._repeat),this._nextAudio.setRepeating(this._repeat)}_initializeQueue(){this.on("ended",()=>{this.disableAutoPlayback||this._repeat==="one"&&(this._currentAudio.setCurrentTime(0),setTimeout(()=>{this._currentAudio.play().then()},150))}),this.on("queueNext",()=>{if(this.disableAutoPlayback||this._repeat==="one"||(this._repeat==="all"&&this._queue.length===0&&(this.setQueue(this._backLog),this.setBackLog([])),this._queue.length==0))return;const S=this.volume;this.getNewSource(this._queue[0]).then(R=>{this._currentAudio.isFading=!0,this._nextAudio.setSource(R),this._nextAudio.fadeVolume(0),this.once("startFadeOut",()=>{this._repeat!=="one"&&(this._currentAudio.setCrossFadeSteps(S/this.fadeDuration/5),this._currentAudio._fadeOut(!0),this._nextAudio.setCrossFadeSteps(S/this.fadeDuration/5),this._nextAudio._fadeIn(!0),this.once("nextSong",()=>{if(this._repeat==="one")return;const L=this._queue[0];this.addToBackLog(this.currentSong),this.currentSong=L,this.removeFromQueue(L),this.emit("song",L),this.once("setCurrentAudio",()=>{this._repeat!="one"&&(this._currentAudio.isFading=!1,this._currentAudio=this._nextAudio,this._nextAudio=this._currentAudio==this._audioElement1?this._audioElement2:this._audioElement1)})}))})}).catch(R=>{console.log(R),this.currentSong=null})}),this.on("ended",S=>{this.disableAutoPlayback||S==this._currentAudio.getAudioElement()&&(this.currentSong=null)}),this.on("error",this.next.bind(this))}};c.default=E}),require_dist=__commonJSMin(c=>{var h=c&&c.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(c,"__esModule",{value:!0}),c.PlayerCore=void 0;var g=h(require_dist$2()),E=h(require_queue()),S=require_state(),R=class extends E.default{constructor(L){super(),this._initializeCore(),L.expose&&(window.musicPlayer=this),this.mediaSession=new g.default,this.baseUrl=L.baseUrl,L.motionConfig&&(this.motionConfig=L.motionConfig),L.motionColors&&(this.motionColors=L.motionColors),L.siteTitle&&(this.siteTitle=L.siteTitle),L.disableAutoPlayback!==void 0&&(this.disableAutoPlayback=L.disableAutoPlayback),this.actions=L.actions}dispose(){this._audioElement1.dispose(),this._audioElement2.dispose(),this.mediaSession?.setPlaybackState("none")}play(){return this._currentAudio.play()}pause(){this._currentAudio.pause()}togglePlayback(){this.isPlaying?this.pause():this.play().then()}stop(){this._currentAudio.stop(),this.currentSong=null,this.state=S.PlayerState.STOPPED,this.emit("song",null),this.emit("stop"),this.setQueue([]),this.mediaSession?.setPlaybackState("none")}setVolume(L){const k=Math.floor(L);this._currentAudio.setVolume(k),this._nextAudio.setVolume(k),localStorage.setItem("nmplayer-music-volume",k.toString())}getVolume(){return this._currentAudio.getVolume()}mute(){this._currentAudio.mute(),this._nextAudio.mute(),this.volumeState=S.VolumeState.MUTED,this.isMuted=!0,this.emit("mute",!0),localStorage.setItem("nmplayer-music-muted","true")}unmute(){this._currentAudio.unmute(),this._nextAudio.unmute(),this.volumeState=S.VolumeState.UNMUTED,this.isMuted=!1,this.emit("mute",!1),localStorage.setItem("nmplayer-music-muted","false")}toggleMute(){this.volumeState===S.VolumeState.MUTED?this.unmute():this.mute()}seek(L){this.getDuration()>L&&this._currentAudio.setCurrentTime(L)}getDuration(){return this._currentAudio.getDuration()}getCurrentTime(){return this._currentAudio.getCurrentTime()}getBuffer(){return this._currentAudio.getBuffer()}getTimeData(){return this._currentAudio.getTimeData()}setAutoPlayback(L){this.disableAutoPlayback=L,this._audioElement1.setAutoPlayback(L),this._audioElement2.setAutoPlayback(L)}_initializeCore(){this.mediaSession?.setPlaybackState("none"),this.on("ready",this.handleReady.bind(this)),this.on("play",this.handlePlay.bind(this)),this.on("pause",this.handlePause.bind(this)),this.on("song",this.handleCurrentSongChange.bind(this)),this.on("time",this.handleTimeUpdate.bind(this)),this.on("error",this.handleError.bind(this)),this.setVolume(parseInt(localStorage.getItem("nmplayer-music-volume")??"100",10)),setTimeout(()=>{this.emit("ready")},1500)}handleReady(){this.mediaSession?.setActionHandler({play:this.actions?.play?.bind(this)??this.play.bind(this),pause:this.actions?.pause?.bind(this)??this.pause.bind(this),stop:this.actions?.stop?.bind(this)??this.stop.bind(this),previous:this.actions?.previous?.bind(this)??this.previous.bind(this),next:this.actions?.next?.bind(this)??this.next.bind(this),seek:this.actions?.seek?.bind(this)??this.seek.bind(this),getPosition:this.getCurrentTime.bind(this)})}handlePlay(){this.isPlaying=!0,this.state=S.PlayerState.PLAYING,this.mediaSession?.setPlaybackState("playing")}handlePause(){this.isPlaying=!1,this.state=S.PlayerState.PAUSED,this.mediaSession?.setPlaybackState("paused")}handleCurrentSongChange(L){if(!L){this.currentSong=null,this.mediaSession?.setPlaybackState("none");return}const k=this.currentSong?.artist_track?.slice(1)?.map(C=>` Ft. ${C.name}`).join("");window.location.hash.includes("music")&&this.setTitle(`${this.currentSong?.artist_track?.[0]?.name} - ${this.currentSong?.name} ${k}`),this.mediaSession?.setMetadata({title:`${this.currentSong?.name}`,artist:`${this.currentSong?.artist_track?.[0]?.name} ${k}`,album:this.currentSong?.album_track?.[0]?.name??"",artwork:this.currentSong?.cover?`${this.baseUrl}${this.currentSong?.cover}`:void 0})}handleTimeUpdate(L){const k=this.currentSong?.artist_track?.slice(1)?.map(C=>` Ft. ${C.name}`).join("");window.location.hash.includes("music")&&this.setTitle(`${this.currentSong?.artist_track?.[0]?.name} - ${this.currentSong?.name} ${k}`),L.duration&&this.mediaSession?.setPositionState({position:L.position,duration:L.duration,playbackRate:this._currentAudio.getPlaybackRate()})}handleError(){this.state=S.PlayerState.ERROR,this.isPlaying=!1,this.mediaSession?.setPlaybackState("none")}};c.PlayerCore=R}),import_dist=require_dist();init_vue_runtime_esm_bundler();init_preload_helper();function cn(...c){return twMerge(clsx(c))}function episodeCounter(c){let h=0,g=0;return c&&c?.number_of_items&&(h=c.number_of_items??0,g=c.have_items??0,g=g>=0?g:0),{number_of_items:h,have_items:g}}function scrollIntoView(c){const g=c??document.activeElement.parentElement;if(!g)return;const E=document.activeElement.getBoundingClientRect().top+document.activeElement.getBoundingClientRect().height/2-g.offsetHeight/3,S=g.scrollTop,R=performance.now();function L(k){const C=k-R,x=Math.min(C/300,1);g.scrollTo(S+E*x,0),C<300&&requestAnimationFrame(L)}requestAnimationFrame(L)}function scrollCenter(c,h,g){if(!c||!h)return;const E=g?.duration||60,S=h.getBoundingClientRect(),R=c.getBoundingClientRect(),L=R.top+R.height/2-(S.top+S.height/2),k=h.scrollTop+L,C=h.scrollTop,x=performance.now();function q(X){const ie=X-x,se=Math.min(ie/E,1),ue=C+(k-C)*se;h.scrollTo(0,Math.floor(ue)),ie<E&&requestAnimationFrame(q)}requestAnimationFrame(q)}function scrollTo(c,h){const g=h?.duration||60,E=h?.margin||1.5,S=c.scrollTop,R=performance.now();function L(k){const C=k-R,x=Math.min(C/g,1);c.scrollTo(0,Math.floor(S+E*x)),C<g&&requestAnimationFrame(L)}requestAnimationFrame(L)}function scrollIntoBox(){const h=document.activeElement.getBoundingClientRect(),g=document.activeElement.parentElement,E=h.left-h.width/1.8,S=document.activeElement.dataset?.x?Number.parseInt(document.activeElement.dataset.x,10)*(h.width/1.8*4):g.scrollLeft,R=performance.now();function L(k){const C=k-R,x=Math.min(C/100,1);g.scrollTo(S+E*x,300),C<100&&requestAnimationFrame(L)}requestAnimationFrame(L)}function shouldMarquee(c){const h=c.querySelector('[data-marquee="scroller"]');h.style.removeProperty("--marquee-width"),h.classList.remove("animate-marquee");const g=c.getBoundingClientRect()?.width??0;g<(h.getBoundingClientRect()?.width??0)?(h.style.setProperty("--marquee-width",`${g}px`),h.classList.add("animate-marquee")):(h.style.removeProperty("--marquee-width"),h.classList.remove("animate-marquee"))}const stopPropagation=c=>c.stopPropagation(),preventDefault=c=>c.preventDefault();function stopAndPrevent(c){c.stopPropagation(),c.preventDefault()}async function lockPortrait(){if(isPlatform("capacitor")){const{ScreenOrientation:c}=await __vitePreload(async()=>{const{ScreenOrientation:h}=await import("./esm-CVivdEa_.js");return{ScreenOrientation:h}},__vite__mapDeps([96,1,2]));try{await c.lock({orientation:"portrait"})}catch{}}}async function lockLandscape(){if(isPlatform("capacitor")){const{ScreenOrientation:c}=await __vitePreload(async()=>{const{ScreenOrientation:h}=await import("./esm-CVivdEa_.js");return{ScreenOrientation:h}},__vite__mapDeps([96,1,2]));try{await c.lock({orientation:"landscape"})}catch{}}}async function unlockOrientation(){if(isPlatform("capacitor")){const{ScreenOrientation:c}=await __vitePreload(async()=>{const{ScreenOrientation:h}=await import("./esm-CVivdEa_.js");return{ScreenOrientation:h}},__vite__mapDeps([96,1,2]));try{await c.unlock()}catch{}}}function isPortrait(){return window.innerHeight>window.innerWidth}function isLandscape(){return window.innerHeight<window.innerWidth}async function enableImmersiveMode(){}async function disableImmersiveMode(){}var clicks=ref(0),timer=ref(),delay=300;function onDoubleClick(c,h,g){clicks.value++,clicks.value===1?timer.value=setTimeout(()=>{clicks.value=0,h(c)},delay):(clearTimeout(timer.value),g?.(c),clicks.value=0)}var ClickEventHandler=class{clicked=0;doubleClickLength=350;pendingClick={};singleClickEvtCallback;doubleClickEvtCallback;constructor(c,h,g,E=350){this.singleClickEvtCallback=h,this.doubleClickEvtCallback=g,this.doubleClickLength=E,c.removeEventListener("click",this.leftClickHandler),c.addEventListener("click",this.leftClickHandler)}leftClickHandler(c){if(console.log("leftClickHandler",c),c.button===0){if(this.clicked++,this.clicked>=2){this.doubleClickEvtCallback(c),clearTimeout(this.pendingClick),this.clicked=0;return}clearTimeout(this.pendingClick),this.pendingClick=setTimeout(()=>{this.singleClickEvtCallback(c),this.clicked=0},this.doubleClickLength)}}};init_dist();init_preload_helper();var App=registerPlugin("App",{web:()=>__vitePreload(()=>import("./web-Bk0DmXa6.js"),[]).then(c=>new c.AppWeb)}),LIBVERSION="2.0.5",UA_MAX_LENGTH=500,USER_AGENT="user-agent",EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",STR_TYPE="string",UA_BROWSER="browser",UA_CPU="cpu",UA_DEVICE="device",UA_ENGINE="engine",UA_OS="os",UA_RESULT="result",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",ARCHITECTURE="architecture",MAJOR="major",MODEL="model",CONSOLE="console",MOBILE="mobile",TABLET="tablet",SMARTTV="smarttv",WEARABLE="wearable",XR="xr",EMBEDDED="embedded",INAPP="inapp",BRANDS="brands",FORMFACTORS="formFactors",FULLVERLIST="fullVersionList",PLATFORM="platform",PLATFORMVER="platformVersion",BITNESS="bitness",CH_HEADER="sec-ch-ua",CH_HEADER_FULL_VER_LIST=CH_HEADER+"-full-version-list",CH_HEADER_ARCH=CH_HEADER+"-arch",CH_HEADER_BITNESS=CH_HEADER+"-"+BITNESS,CH_HEADER_FORM_FACTORS=CH_HEADER+"-form-factors",CH_HEADER_MOBILE=CH_HEADER+"-"+MOBILE,CH_HEADER_MODEL=CH_HEADER+"-"+MODEL,CH_HEADER_PLATFORM=CH_HEADER+"-"+PLATFORM,CH_HEADER_PLATFORM_VER=CH_HEADER_PLATFORM+"-version",CH_ALL_VALUES=[BRANDS,FULLVERLIST,MOBILE,MODEL,PLATFORM,PLATFORMVER,ARCHITECTURE,FORMFACTORS,BITNESS],AMAZON="Amazon",APPLE="Apple",ASUS="ASUS",BLACKBERRY="BlackBerry",GOOGLE="Google",HUAWEI="Huawei",LENOVO="Lenovo",HONOR="Honor",LG="LG",MICROSOFT="Microsoft",MOTOROLA="Motorola",NVIDIA="Nvidia",ONEPLUS="OnePlus",OPPO="OPPO",SAMSUNG="Samsung",SHARP="Sharp",SONY="Sony",XIAOMI="Xiaomi",ZEBRA="Zebra",CHROME="Chrome",CHROMIUM="Chromium",CHROMECAST="Chromecast",EDGE="Edge",FIREFOX="Firefox",OPERA="Opera",FACEBOOK="Facebook",SOGOU="Sogou",PREFIX_MOBILE="Mobile ",SUFFIX_BROWSER=" Browser",WINDOWS="Windows",NAVIGATOR=typeof window!==UNDEF_TYPE&&window.navigator?window.navigator:void 0,NAVIGATOR_UADATA=NAVIGATOR&&NAVIGATOR.userAgentData?NAVIGATOR.userAgentData:void 0,extend=function(c,h){var g={},E=h;if(!isExtensions(h)){E={};for(var S in h)for(var R in h[S])E[R]=h[S][R].concat(E[R]?E[R]:[])}for(var L in c)g[L]=E[L]&&E[L].length%2===0?E[L].concat(c[L]):c[L];return g},enumerize=function(c){for(var h={},g=0;g<c.length;g++)h[c[g].toUpperCase()]=c[g];return h},has=function(c,h){if(typeof c===OBJ_TYPE&&c.length>0){for(var g in c)if(lowerize(h)==lowerize(c[g]))return!0;return!1}return isString$1(c)?lowerize(h)==lowerize(c):!1},isExtensions=function(c,h){for(var g in c)return/^(browser|cpu|device|engine|os)$/.test(g)||(h?isExtensions(c[g]):!1)},isString$1=function(c){return typeof c===STR_TYPE},itemListToArray=function(c){if(c){for(var h=[],g=strip(/\\?\"/g,c).split(","),E=0;E<g.length;E++)if(g[E].indexOf(";")>-1){var S=trim(g[E]).split(";v=");h[E]={brand:S[0],version:S[1]}}else h[E]=trim(g[E]);return h}},lowerize=function(c){return isString$1(c)?c.toLowerCase():c},majorize=function(c){return isString$1(c)?strip(/[^\d\.]/g,c).split(".")[0]:void 0},setProps=function(c){for(var h in c)if(c.hasOwnProperty(h)){var g=c[h];typeof g==OBJ_TYPE&&g.length==2?this[g[0]]=g[1]:this[g]=void 0}return this},strip=function(c,h){return isString$1(h)?h.replace(c,EMPTY):h},stripQuotes=function(c){return strip(/\\?\"/g,c)},trim=function(c,h){if(isString$1(c))return c=strip(/^\s\s*/,c),typeof h===UNDEF_TYPE?c:c.substring(0,UA_MAX_LENGTH)},rgxMapper=function(c,h){if(!(!c||!h))for(var g=0,E,S,R,L,k,C;g<h.length&&!k;){var x=h[g],q=h[g+1];for(E=S=0;E<x.length&&!k&&x[E];)if(k=x[E++].exec(c),k)for(R=0;R<q.length;R++)C=k[++S],L=q[R],typeof L===OBJ_TYPE&&L.length>0?L.length===2?typeof L[1]==FUNC_TYPE?this[L[0]]=L[1].call(this,C):this[L[0]]=L[1]:L.length>=3&&(typeof L[1]===FUNC_TYPE&&!(L[1].exec&&L[1].test)?L.length>3?this[L[0]]=C?L[1].apply(this,L.slice(2)):void 0:this[L[0]]=C?L[1].call(this,C,L[2]):void 0:L.length==3?this[L[0]]=C?C.replace(L[1],L[2]):void 0:L.length==4?this[L[0]]=C?L[3].call(this,C.replace(L[1],L[2])):void 0:L.length>4&&(this[L[0]]=C?L[3].apply(this,[C.replace(L[1],L[2])].concat(L.slice(4))):void 0)):this[L]=C||void 0;g+=2}},strMapper=function(c,h){for(var g in h)if(typeof h[g]===OBJ_TYPE&&h[g].length>0){for(var E=0;E<h[g].length;E++)if(has(h[g][E],c))return g===UNKNOWN?void 0:g}else if(has(h[g],c))return g===UNKNOWN?void 0:g;return h.hasOwnProperty("*")?h["*"]:c},windowsVersionMap={ME:"4.90","NT 3.51":"3.51","NT 4.0":"4.0",2e3:["5.0","5.01"],XP:["5.1","5.2"],Vista:"6.0",7:"6.1",8:"6.2","8.1":"6.3",10:["6.4","10.0"],NT:""},formFactorsMap={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},browserHintsMap={Chrome:"Google Chrome",Edge:"Microsoft Edge","Edge WebView2":"Microsoft Edge WebView2","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"},defaultRegexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[VERSION,[NAME,PREFIX_MOBILE+"Chrome"]],[/webview.+edge\/([\w\.]+)/i],[VERSION,[NAME,EDGE+" WebView"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[VERSION,[NAME,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[NAME,VERSION],[/opios[\/ ]+([\w\.]+)/i],[VERSION,[NAME,OPERA+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[VERSION,[NAME,OPERA+" GX"]],[/\bopr\/([\w\.]+)/i],[VERSION,[NAME,OPERA]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[VERSION,[NAME,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[VERSION,[NAME,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[NAME,VERSION],[/quark(?:pc)?\/([-\w\.]+)/i],[VERSION,[NAME,"Quark"]],[/\bddg\/([\w\.]+)/i],[VERSION,[NAME,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[VERSION,[NAME,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[VERSION,[NAME,"WeChat"]],[/konqueror\/([\w\.]+)/i],[VERSION,[NAME,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[VERSION,[NAME,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[VERSION,[NAME,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[VERSION,[NAME,"Smart "+LENOVO+SUFFIX_BROWSER]],[/(avast|avg)\/([\w\.]+)/i],[[NAME,/(.+)/,"$1 Secure"+SUFFIX_BROWSER],VERSION],[/\bfocus\/([\w\.]+)/i],[VERSION,[NAME,FIREFOX+" Focus"]],[/\bopt\/([\w\.]+)/i],[VERSION,[NAME,OPERA+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[VERSION,[NAME,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[VERSION,[NAME,"Dolphin"]],[/coast\/([\w\.]+)/i],[VERSION,[NAME,OPERA+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI"+SUFFIX_BROWSER]],[/fxios\/([\w\.-]+)/i],[VERSION,[NAME,PREFIX_MOBILE+FIREFOX]],[/\bqihoobrowser\/?([\w\.]*)/i],[VERSION,[NAME,"360"]],[/\b(qq)\/([\w\.]+)/i],[[NAME,/(.+)/,"$1Browser"],VERSION],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[NAME,/(.+)/,"$1"+SUFFIX_BROWSER],VERSION],[/samsungbrowser\/([\w\.]+)/i],[VERSION,[NAME,SAMSUNG+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[VERSION,[NAME,SOGOU+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[NAME,SOGOU+" Mobile"],VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[NAME,VERSION],[/(lbbrowser|rekonq)/i],[NAME],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[VERSION,NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[NAME,FACEBOOK],VERSION,[TYPE,INAPP]],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat|klarna)[\/ ]([-\w\.]+)/i],[NAME,VERSION,[TYPE,INAPP]],[/\bgsa\/([\w\.]+) .*safari\//i],[VERSION,[NAME,"GSA"],[TYPE,INAPP]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[VERSION,[NAME,"TikTok"],[TYPE,INAPP]],[/\[(linkedin)app\]/i],[NAME,[TYPE,INAPP]],[/(zalo(?:app)?)[\/\sa-z]*([\w\.-]+)/i],[[NAME,/(.+)/,"Zalo"],VERSION,[TYPE,INAPP]],[/(chromium)[\/ ]([-\w\.]+)/i],[NAME,VERSION],[/headlesschrome(?:\/([\w\.]+)| )/i],[VERSION,[NAME,CHROME+" Headless"]],[/wv\).+chrome\/([\w\.]+).+edgw\//i],[VERSION,[NAME,EDGE+" WebView2"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[NAME,CHROME+" WebView"],VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[VERSION,[NAME,"Android"+SUFFIX_BROWSER]],[/chrome\/([\w\.]+) mobile/i],[VERSION,[NAME,PREFIX_MOBILE+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[NAME,VERSION],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[VERSION,[NAME,PREFIX_MOBILE+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[NAME,PREFIX_MOBILE+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[VERSION,NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[NAME,PREFIX_MOBILE+FIREFOX],VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[NAME,"Netscape"],VERSION],[/(wolvic|librewolf)\/([\w\.]+)/i],[NAME,VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[VERSION,[NAME,FIREFOX+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[NAME,[VERSION,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[NAME,[VERSION,/[^\d\.]+./,EMPTY]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[ARCHITECTURE,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[ARCHITECTURE,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[ARCHITECTURE,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[ARCHITECTURE,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[ARCHITECTURE,"arm"]],[/ sun4\w[;\)]/i],[[ARCHITECTURE,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i,/((ppc|powerpc)(64)?)( mac|;|\))/i,/(?:osf1|[freopnt]{3,4}bsd) (alpha)/i],[[ARCHITECTURE,/ower/,EMPTY,lowerize]],[/winnt.+\[axp/i],[[ARCHITECTURE,"alpha"]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[MODEL,[VENDOR,SAMSUNG],[TYPE,TABLET]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr]|browser)[-\w]+)/i,/sec-(sgh\w+)/i],[MODEL,[VENDOR,SAMSUNG],[TYPE,MOBILE]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[MODEL,[VENDOR,APPLE],[TYPE,MOBILE]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[MODEL,[VENDOR,APPLE],[TYPE,TABLET]],[/(macintosh);/i],[MODEL,[VENDOR,APPLE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[MODEL,[VENDOR,SHARP],[TYPE,MOBILE]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[MODEL,[VENDOR,HONOR],[TYPE,TABLET]],[/honor([-\w ]+)[;\)]/i],[MODEL,[VENDOR,HONOR],[TYPE,MOBILE]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[MODEL,[VENDOR,HUAWEI],[TYPE,TABLET]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[MODEL,[VENDOR,HUAWEI],[TYPE,MOBILE]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[MODEL,/_/g," "],[VENDOR,XIAOMI],[TYPE,TABLET]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[MODEL,/_/g," "],[VENDOR,XIAOMI],[TYPE,MOBILE]],[/droid.+; (cph2[3-6]\d[13579]|((gm|hd)19|(ac|be|in|kb)20|(d[en]|eb|le|mt)21|ne22)[0-2]\d|p[g-k]\w[1m]10)\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[MODEL,[VENDOR,ONEPLUS],[TYPE,MOBILE]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[MODEL,[VENDOR,OPPO],[TYPE,MOBILE]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[MODEL,[VENDOR,strMapper,{OnePlus:["203","304","403","404","413","415"],"*":OPPO}],[TYPE,TABLET]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[MODEL,[VENDOR,"BLU"],[TYPE,MOBILE]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[MODEL,[VENDOR,"Vivo"],[TYPE,MOBILE]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[MODEL,[VENDOR,"Realme"],[TYPE,MOBILE]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[MODEL,[VENDOR,LENOVO],[TYPE,TABLET]],[/lenovo[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i],[MODEL,[VENDOR,LENOVO],[TYPE,MOBILE]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ]([\w\s]+)(\)| bui)/i,/((?:moto(?! 360)[-\w\(\) ]+|xt\d{3,4}[cgkosw\+]?[-\d]*|nexus 6)(?= bui|\)))/i],[MODEL,[VENDOR,MOTOROLA],[TYPE,MOBILE]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[MODEL,[VENDOR,MOTOROLA],[TYPE,TABLET]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[MODEL,[VENDOR,LG],[TYPE,TABLET]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch|webos))(\w+)/i,/\blg-?([\d\w]+) bui/i],[MODEL,[VENDOR,LG],[TYPE,MOBILE]],[/(nokia) (t[12][01])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[MODEL,/_/g," "],[TYPE,MOBILE],[VENDOR,"Nokia"]],[/(pixel (c|tablet))\b/i],[MODEL,[VENDOR,GOOGLE],[TYPE,TABLET]],[/droid.+;(?: google)? (g(01[13]a|020[aem]|025[jn]|1b60|1f8f|2ybb|4s1m|576d|5nz6|8hhn|8vou|a02099|c15s|d1yq|e2ae|ec77|gh2x|kv4x|p4bc|pj41|r83y|tt9q|ur25|wvk6)|pixel[\d ]*a?( pro)?( xl)?( fold)?( \(5g\))?)( bui|\))/i],[MODEL,[VENDOR,GOOGLE],[TYPE,MOBILE]],[/(google) (pixelbook( go)?)/i],[VENDOR,MODEL],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-\w\w\d\d)(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[MODEL,[VENDOR,SONY],[TYPE,MOBILE]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[MODEL,"Xperia Tablet"],[VENDOR,SONY],[TYPE,TABLET]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[MODEL,[VENDOR,AMAZON],[TYPE,TABLET]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[MODEL,/(.+)/g,"Fire Phone $1"],[VENDOR,AMAZON],[TYPE,MOBILE]],[/(playbook);[-\w\),; ]+(rim)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[MODEL,[VENDOR,BLACKBERRY],[TYPE,MOBILE]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[MODEL,[VENDOR,ASUS],[TYPE,TABLET]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[MODEL,[VENDOR,ASUS],[TYPE,MOBILE]],[/(nexus 9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[MODEL,[VENDOR,"TCL"],[TYPE,TABLET]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[MODEL,[VENDOR,"TCL"],[TYPE,MOBILE]],[/(itel) ((\w+))/i],[[VENDOR,lowerize],MODEL,[TYPE,strMapper,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[MODEL,[VENDOR,"Meizu"],[TYPE,MOBILE]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[MODEL,[VENDOR,"Ulefone"],[TYPE,MOBILE]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[MODEL,[VENDOR,"Energizer"],[TYPE,MOBILE]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[MODEL,[VENDOR,"Cat"],[TYPE,MOBILE]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[MODEL,[VENDOR,"Smartfren"],[TYPE,MOBILE]],[/droid.+; (a(in)?(0(15|59|6[35])|142)p?)/i],[MODEL,[VENDOR,"Nothing"],[TYPE,MOBILE]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[MODEL,[VENDOR,"Archos"],[TYPE,TABLET]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[MODEL,[VENDOR,"Archos"],[TYPE,MOBILE]],[/; (n159v)/i],[MODEL,[VENDOR,"HMD"],[TYPE,MOBILE]],[/(imo) (tab \w+)/i,/(infinix|tecno) (x1101b?|p904|dp(7c|8d|10a)( pro)?|p70[1-3]a?|p904|t1101)/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|infinix|lava|oneplus|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(oppo) ?([\w ]+) bui/i,/droid[^;]+; (philips)[_ ]([sv-x][\d]{3,4}[xz]?)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(surface duo)/i],[MODEL,[VENDOR,MICROSOFT],[TYPE,TABLET]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[MODEL,[VENDOR,"Fairphone"],[TYPE,MOBILE]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[MODEL,[VENDOR,NVIDIA],[TYPE,TABLET]],[/(sprint) (\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,MICROSOFT],[TYPE,MOBILE]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,TABLET]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,MOBILE]],[/(philips)[\w ]+tv/i,/smart-tv.+(samsung)/i],[VENDOR,[TYPE,SMARTTV]],[/hbbtv.+maple;(\d+)/i],[[MODEL,/^/,"SmartTV"],[VENDOR,SAMSUNG],[TYPE,SMARTTV]],[/(vizio)(?: |.+model\/)(\w+-\w+)/i,/tcast.+(lg)e?. ([-\w]+)/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[VENDOR,LG],[TYPE,SMARTTV]],[/(apple) ?tv/i],[VENDOR,[MODEL,APPLE+" TV"],[TYPE,SMARTTV]],[/crkey.*devicetype\/chromecast/i],[[MODEL,CHROMECAST+" Third Generation"],[VENDOR,GOOGLE],[TYPE,SMARTTV]],[/crkey.*devicetype\/([^/]*)/i],[[MODEL,/^/,"Chromecast "],[VENDOR,GOOGLE],[TYPE,SMARTTV]],[/fuchsia.*crkey/i],[[MODEL,CHROMECAST+" Nest Hub"],[VENDOR,GOOGLE],[TYPE,SMARTTV]],[/crkey/i],[[MODEL,CHROMECAST],[VENDOR,GOOGLE],[TYPE,SMARTTV]],[/(portaltv)/i],[MODEL,[VENDOR,FACEBOOK],[TYPE,SMARTTV]],[/droid.+aft(\w+)( bui|\))/i],[MODEL,[VENDOR,AMAZON],[TYPE,SMARTTV]],[/(shield \w+ tv)/i],[MODEL,[VENDOR,NVIDIA],[TYPE,SMARTTV]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[MODEL,[VENDOR,SHARP],[TYPE,SMARTTV]],[/(bravia[\w ]+)( bui|\))/i],[MODEL,[VENDOR,SONY],[TYPE,SMARTTV]],[/(mi(tv|box)-?\w+) bui/i],[MODEL,[VENDOR,XIAOMI],[TYPE,SMARTTV]],[/Hbbtv.*(technisat) (.*);/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[VENDOR,/.+\/(\w+)/,"$1",strMapper,{LG:"lge"}],[MODEL,trim],[TYPE,SMARTTV]],[/(playstation \w+)/i],[MODEL,[VENDOR,SONY],[TYPE,CONSOLE]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[MODEL,[VENDOR,MICROSOFT],[TYPE,CONSOLE]],[/(ouya)/i,/(nintendo) (\w+)/i,/(retroid) (pocket ([^\)]+))/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/droid.+; (shield)( bui|\))/i],[MODEL,[VENDOR,NVIDIA],[TYPE,CONSOLE]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[MODEL,[VENDOR,SAMSUNG],[TYPE,WEARABLE]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[VENDOR,MODEL,[TYPE,WEARABLE]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[MODEL,[VENDOR,OPPO],[TYPE,WEARABLE]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[MODEL,[VENDOR,APPLE],[TYPE,WEARABLE]],[/(opwwe\d{3})/i],[MODEL,[VENDOR,ONEPLUS],[TYPE,WEARABLE]],[/(moto 360)/i],[MODEL,[VENDOR,MOTOROLA],[TYPE,WEARABLE]],[/(smartwatch 3)/i],[MODEL,[VENDOR,SONY],[TYPE,WEARABLE]],[/(g watch r)/i],[MODEL,[VENDOR,LG],[TYPE,WEARABLE]],[/droid.+; (wt63?0{2,3})\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,WEARABLE]],[/droid.+; (glass) \d/i],[MODEL,[VENDOR,GOOGLE],[TYPE,XR]],[/(pico) ([\w ]+) os\d/i],[VENDOR,MODEL,[TYPE,XR]],[/(quest( \d| pro)?s?).+vr/i],[MODEL,[VENDOR,FACEBOOK],[TYPE,XR]],[/mobile vr; rv.+firefox/i],[[TYPE,XR]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[VENDOR,[TYPE,EMBEDDED]],[/(aeobc)\b/i],[MODEL,[VENDOR,AMAZON],[TYPE,EMBEDDED]],[/(homepod).+mac os/i],[MODEL,[VENDOR,APPLE],[TYPE,EMBEDDED]],[/windows iot/i],[[TYPE,EMBEDDED]],[/droid.+; ([\w- ]+) (4k|android|smart|google)[- ]?tv/i],[MODEL,[TYPE,SMARTTV]],[/\b((4k|android|smart|opera)[- ]?tv|tv; rv:|large screen[\w ]+safari)\b/i],[[TYPE,SMARTTV]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[MODEL,[TYPE,strMapper,{mobile:"Mobile",xr:"VR","*":TABLET}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[TYPE,TABLET]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[TYPE,MOBILE]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[MODEL,[VENDOR,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[VERSION,[NAME,EDGE+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[NAME,VERSION],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[VERSION,[NAME,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[NAME,VERSION],[/ladybird\//i],[[NAME,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[VERSION,NAME]],os:[[/(windows nt) (6\.[23]); arm/i],[[NAME,/N/,"R"],[VERSION,strMapper,windowsVersionMap]],[/(windows (?:phone|mobile|iot))(?: os)?[\/ ]?([\d\.]*( se)?)/i,/(windows)[\/ ](1[01]|2000|3\.1|7|8(\.1)?|9[58]|me|server 20\d\d( r2)?|vista|xp)/i],[NAME,VERSION],[/windows nt ?([\d\.\)]*)(?!.+xbox)/i,/\bwin(?=3| ?9|n)(?:nt| 9x )?([\d\.;]*)/i],[[VERSION,/(;|\))/g,"",strMapper,windowsVersionMap],[NAME,WINDOWS]],[/(windows ce)\/?([\d\.]*)/i],[NAME,VERSION],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[VERSION,/_/g,"."],[NAME,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+(haiku|morphos))/i],[[NAME,"macOS"],[VERSION,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[VERSION,[NAME,CHROMECAST+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[VERSION,[NAME,CHROMECAST+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[VERSION,[NAME,CHROMECAST+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[VERSION,[NAME,CHROMECAST+" Linux"]],[/crkey\/([\d\.]+)/i],[VERSION,[NAME,CHROMECAST]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[VERSION,NAME],[/(ubuntu) ([\w\.]+) like android/i],[[NAME,/(.+)/,"$1 Touch"],VERSION],[/(harmonyos)[\/ ]?([\d\.]*)/i,/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen)\w*[-\/\.; ]?([\d\.]*)/i],[NAME,VERSION],[/\(bb(10);/i],[VERSION,[NAME,BLACKBERRY]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[VERSION,[NAME,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[VERSION,[NAME,FIREFOX+" OS"]],[/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i,/webos(?:[ \/]?|\.tv-20(?=2[2-9]))(\d[\d\.]*)/i],[VERSION,[NAME,"webOS"]],[/web0s;.+?(?:chr[o0]me|safari)\/(\d+)/i],[[VERSION,strMapper,{25:"120",24:"108",23:"94",22:"87",6:"79",5:"68",4:"53",3:"38",2:"538",1:"537","*":"TV"}],[NAME,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[VERSION,[NAME,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[NAME,"Chrome OS"],VERSION],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/linux.+(mint)[\/\(\) ]?([\w\.]*)/i,/(mageia|vectorlinux|fuchsia|arcaos|arch(?= ?linux))[;l ]([\d\.]*)/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire|knoppix)(?: gnu[\/ ]linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/\b(aix)[; ]([1-9\.]{0,4})/i,/(hurd|linux|morphos)(?: (?:arm|x86|ppc)\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) ?(r\d)?/i],[NAME,VERSION],[/(sunos) ?([\d\.]*)/i],[[NAME,"Solaris"],VERSION],[/\b(beos|os\/2|amigaos|openvms|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[NAME,VERSION]]},defaultProps=function(){var c={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return setProps.call(c.init,[[UA_BROWSER,[NAME,VERSION,MAJOR,TYPE]],[UA_CPU,[ARCHITECTURE]],[UA_DEVICE,[TYPE,MODEL,VENDOR]],[UA_ENGINE,[NAME,VERSION]],[UA_OS,[NAME,VERSION]]]),setProps.call(c.isIgnore,[[UA_BROWSER,[VERSION,MAJOR]],[UA_ENGINE,[VERSION]],[UA_OS,[VERSION]]]),setProps.call(c.isIgnoreRgx,[[UA_BROWSER,/ ?browser$/i],[UA_OS,/ ?os$/i]]),setProps.call(c.toString,[[UA_BROWSER,[NAME,VERSION]],[UA_CPU,[ARCHITECTURE]],[UA_DEVICE,[VENDOR,MODEL]],[UA_ENGINE,[NAME,VERSION]],[UA_OS,[NAME,VERSION]]]),c}(),createIData=function(c,h){var g=defaultProps.init[h],E=defaultProps.isIgnore[h]||0,S=defaultProps.isIgnoreRgx[h]||0,R=defaultProps.toString[h]||0;function L(){setProps.call(this,g)}return L.prototype.getItem=function(){return c},L.prototype.withClientHints=function(){return NAVIGATOR_UADATA?NAVIGATOR_UADATA.getHighEntropyValues(CH_ALL_VALUES).then(function(k){return c.setCH(new UACHData(k,!1)).parseCH().get()}):c.parseCH().get()},L.prototype.withFeatureCheck=function(){return c.detectFeature().get()},h!=UA_RESULT&&(L.prototype.is=function(k){var C=!1;for(var x in this)if(this.hasOwnProperty(x)&&!has(E,x)&&lowerize(S?strip(S,this[x]):this[x])==lowerize(S?strip(S,k):k)){if(C=!0,k!=UNDEF_TYPE)break}else if(k==UNDEF_TYPE&&C){C=!C;break}return C},L.prototype.toString=function(){var k=EMPTY;for(var C in R)typeof this[R[C]]!==UNDEF_TYPE&&(k+=(k?" ":EMPTY)+this[R[C]]);return k||UNDEF_TYPE}),NAVIGATOR_UADATA||(L.prototype.then=function(k){var C=this,x=function(){for(var X in C)C.hasOwnProperty(X)&&(this[X]=C[X])};x.prototype={is:L.prototype.is,toString:L.prototype.toString};var q=new x;return k(q),q}),new L};function UACHData(c,h){if(c=c||{},setProps.call(this,CH_ALL_VALUES),h)setProps.call(this,[[BRANDS,itemListToArray(c[CH_HEADER])],[FULLVERLIST,itemListToArray(c[CH_HEADER_FULL_VER_LIST])],[MOBILE,/\?1/.test(c[CH_HEADER_MOBILE])],[MODEL,stripQuotes(c[CH_HEADER_MODEL])],[PLATFORM,stripQuotes(c[CH_HEADER_PLATFORM])],[PLATFORMVER,stripQuotes(c[CH_HEADER_PLATFORM_VER])],[ARCHITECTURE,stripQuotes(c[CH_HEADER_ARCH])],[FORMFACTORS,itemListToArray(c[CH_HEADER_FORM_FACTORS])],[BITNESS,stripQuotes(c[CH_HEADER_BITNESS])]]);else for(var g in c)this.hasOwnProperty(g)&&typeof c[g]!==UNDEF_TYPE&&(this[g]=c[g])}function UAItem(c,h,g,E){return this.get=function(S){return S?this.data.hasOwnProperty(S)?this.data[S]:void 0:this.data},this.set=function(S,R){return this.data[S]=R,this},this.setCH=function(S){return this.uaCH=S,this},this.detectFeature=function(){if(NAVIGATOR&&NAVIGATOR.userAgent==this.ua)switch(this.itemType){case UA_BROWSER:NAVIGATOR.brave&&typeof NAVIGATOR.brave.isBrave==FUNC_TYPE&&this.set(NAME,"Brave");break;case UA_DEVICE:!this.get(TYPE)&&NAVIGATOR_UADATA&&NAVIGATOR_UADATA[MOBILE]&&this.set(TYPE,MOBILE),this.get(MODEL)=="Macintosh"&&NAVIGATOR&&typeof NAVIGATOR.standalone!==UNDEF_TYPE&&NAVIGATOR.maxTouchPoints&&NAVIGATOR.maxTouchPoints>2&&this.set(MODEL,"iPad").set(TYPE,TABLET);break;case UA_OS:!this.get(NAME)&&NAVIGATOR_UADATA&&NAVIGATOR_UADATA[PLATFORM]&&this.set(NAME,NAVIGATOR_UADATA[PLATFORM]);break;case UA_RESULT:var S=this.data,R=function(L){return S[L].getItem().detectFeature().get()};this.set(UA_BROWSER,R(UA_BROWSER)).set(UA_CPU,R(UA_CPU)).set(UA_DEVICE,R(UA_DEVICE)).set(UA_ENGINE,R(UA_ENGINE)).set(UA_OS,R(UA_OS))}return this},this.parseUA=function(){return this.itemType!=UA_RESULT&&rgxMapper.call(this.data,this.ua,this.rgxMap),this.itemType==UA_BROWSER&&this.set(MAJOR,majorize(this.get(VERSION))),this},this.parseCH=function(){var S=this.uaCH,R=this.rgxMap;switch(this.itemType){case UA_BROWSER:case UA_ENGINE:var L=S[FULLVERLIST]||S[BRANDS],k;if(L)for(var C=0;C<L.length;C++){var x=L[C].brand||L[C],q=L[C].version;this.itemType==UA_BROWSER&&!/not.a.brand/i.test(x)&&(!k||/Chrom/.test(k)&&x!=CHROMIUM||k==EDGE&&/WebView2/.test(x))&&(x=strMapper(x,browserHintsMap),k=this.get(NAME),k&&!/Chrom/.test(k)&&/Chrom/.test(x)||this.set(NAME,x).set(VERSION,q).set(MAJOR,majorize(q)),k=x),this.itemType==UA_ENGINE&&x==CHROMIUM&&this.set(VERSION,q)}break;case UA_CPU:var X=S[ARCHITECTURE];X&&(X&&S[BITNESS]=="64"&&(X+="64"),rgxMapper.call(this.data,X+";",R));break;case UA_DEVICE:if(S[MOBILE]&&this.set(TYPE,MOBILE),S[MODEL]&&(this.set(MODEL,S[MODEL]),!this.get(TYPE)||!this.get(VENDOR))){var ie={};rgxMapper.call(ie,"droid 9; "+S[MODEL]+")",R),!this.get(TYPE)&&ie.type&&this.set(TYPE,ie.type),!this.get(VENDOR)&&ie.vendor&&this.set(VENDOR,ie.vendor)}if(S[FORMFACTORS]){var se;if(typeof S[FORMFACTORS]!="string")for(var ue=0;!se&&ue<S[FORMFACTORS].length;)se=strMapper(S[FORMFACTORS][ue++],formFactorsMap);else se=strMapper(S[FORMFACTORS],formFactorsMap);this.set(TYPE,se)}break;case UA_OS:var ge=S[PLATFORM];if(ge){var ae=S[PLATFORMVER];ge==WINDOWS&&(ae=parseInt(majorize(ae),10)>=13?"11":"10"),this.set(NAME,ge).set(VERSION,ae)}this.get(NAME)==WINDOWS&&S[MODEL]=="Xbox"&&this.set(NAME,"Xbox").set(VERSION,void 0);break;case UA_RESULT:var Se=this.data,xe=function($e){return Se[$e].getItem().setCH(S).parseCH().get()};this.set(UA_BROWSER,xe(UA_BROWSER)).set(UA_CPU,xe(UA_CPU)).set(UA_DEVICE,xe(UA_DEVICE)).set(UA_ENGINE,xe(UA_ENGINE)).set(UA_OS,xe(UA_OS))}return this},setProps.call(this,[["itemType",c],["ua",h],["uaCH",E],["rgxMap",g],["data",createIData(this,c)]]),this}function UAParser(c,h,g){if(typeof c===OBJ_TYPE?(isExtensions(c,!0)?(typeof h===OBJ_TYPE&&(g=h),h=c):(g=c,h=void 0),c=void 0):typeof c===STR_TYPE&&!isExtensions(h,!0)&&(g=h,h=void 0),g)if(typeof g.append===FUNC_TYPE){var E={};g.forEach(function(q,X){E[String(X).toLowerCase()]=q}),g=E}else{var S={};for(var R in g)g.hasOwnProperty(R)&&(S[String(R).toLowerCase()]=g[R]);g=S}if(!(this instanceof UAParser))return new UAParser(c,h,g).getResult();var L=typeof c===STR_TYPE?c:g&&g[USER_AGENT]?g[USER_AGENT]:NAVIGATOR&&NAVIGATOR.userAgent?NAVIGATOR.userAgent:EMPTY,k=new UACHData(g,!0),C=h?extend(defaultRegexes,h):defaultRegexes,x=function(q){return q==UA_RESULT?function(){return new UAItem(q,L,C,k).set("ua",L).set(UA_BROWSER,this.getBrowser()).set(UA_CPU,this.getCPU()).set(UA_DEVICE,this.getDevice()).set(UA_ENGINE,this.getEngine()).set(UA_OS,this.getOS()).get()}:function(){return new UAItem(q,L,C[q],k).parseUA().get()}};return setProps.call(this,[["getBrowser",x(UA_BROWSER)],["getCPU",x(UA_CPU)],["getDevice",x(UA_DEVICE)],["getEngine",x(UA_ENGINE)],["getOS",x(UA_OS)],["getResult",x(UA_RESULT)],["getUA",function(){return L}],["setUA",function(q){return isString$1(q)&&(L=q.length>UA_MAX_LENGTH?trim(q,UA_MAX_LENGTH):q),this}]]).setUA(L),this}UAParser.VERSION=LIBVERSION;UAParser.BROWSER=enumerize([NAME,VERSION,MAJOR,TYPE]);UAParser.CPU=enumerize([ARCHITECTURE]);UAParser.DEVICE=enumerize([MODEL,VENDOR,TYPE,CONSOLE,MOBILE,SMARTTV,TABLET,WEARABLE,EMBEDDED]);UAParser.ENGINE=UAParser.OS=enumerize([NAME,VERSION]);var res=new UAParser().getResult();res.browser.name=navigator.brave?"Brave":res.browser.name;async function makeDeviceInfo(){const c=await Device.getInfo();let h="";switch(c.platform){case"android":h=c.platform,isPlatform("tablet")&&(h="tablet");break;case"ios":h=c.platform,isPlatform("tablet")&&(h="tablet");break;case"web":h=c.platform,isPlatform("tablet")&&(h="tablet"),isPlatform("electron")&&(h="desktop"),isPlatform("mobileweb")&&(h="android");break;default:h=c.platform}const g=c.name??localStorage.getItem("CapacitorStorage.deviceName")??localStorage.getItem("CapacitorStorage.deviceId")??deviceId.value,E=useLocalStorage("nmplayer-music-volume",100);return{id:localStorage.getItem("CapacitorStorage.deviceId")??deviceId.value,browser:res.browser.name??"",os:`${c.model.toLowerCase().includes(c.operatingSystem.toLowerCase())?"":c.operatingSystem} ${c.osVersion}`.trim(),device:c.manufacturer?`${c.manufacturer} ${c.model}`:"",type:h,name:g,version:"0.0.1",volume_percent:E.value}}init_vue_runtime_esm_bundler();var ai=ref();const appInfo=computed(()=>ai.value);var di=ref();const deviceInfo=computed(()=>di.value);var ci=ref();const clientInfo=computed(()=>ci.value);var bi=ref();const batteryInfo=computed(()=>bi.value);var as=ref();const appState=computed(()=>as.value),deviceName=useLocalStorage("deviceName",ci.value?.name);function setDeviceName(c){deviceName.value=c,Preferences.set({key:"deviceName",value:c}).catch(h=>{console.error("Failed to persist deviceName:",h)})}const deviceId=useLocalStorage("deviceId","");function setDeviceId(c){deviceId.value=c,Preferences.set({key:"deviceId",value:c}).catch(h=>{console.error("Failed to persist deviceId:",h)})}async function getDeviceName(){setDeviceName((await Preferences.get({key:"deviceName"})).value??toRaw(deviceInfo.value)?.name??deviceId.value)}async function getDeviceId(){setDeviceId((await Device.getId()).identifier)}(async()=>{try{di.value=await Device.getInfo(),ci.value=await makeDeviceInfo(),await getDeviceId(),await getDeviceName(),isPlatform("capacitor")&&isPlatform("android")&&(ai.value=await App.getInfo(),bi.value=await Device.getBatteryInfo()),await App.addListener("appStateChange",c=>{as.value=c}),console.log({appInfo:toRaw(appInfo.value),deviceInfo:toRaw(deviceInfo.value),batteryInfo:toRaw(batteryInfo.value)})}catch(c){console.error("Failed to initialize device info:",c)}})();init_vue_runtime_esm_bundler();const mc=ref(!1),musicSocketIsConnected=computed(()=>mc.value);var si$1=ref();const musicSocketInstance=computed(()=>si$1.value),musicSocketConnection=computed(()=>si$1.value?.connection);function setMusicSocketInstance(c){si$1.value=c}var ps=ref();const playerState=computed(()=>ps.value);watch(si$1,c=>{c?.connection&&(c?.connection?.on("connected",connected$1),c?.connection?.on("disconnected",disconnected$1),c?.connection?.on("error",error$1),c?.connection?.on("MusicPlayerState",handleMusicPlayerState),c?.connection?.on("ConnectedDevicesState",handleMusicConnectedDevicesState),c?.connection?.on("ChangeDevice",handleMusicBroadcastStatus),c?.connection?.invoke("Devices").then(handleMusicConnectedDevicesState).catch(h=>{console.error("Failed to invoke Devices:",h)}),window.addEventListener("beforeunload",()=>{c?.connection?.stop()},{once:!0}),window.addEventListener("unload",()=>{c?.connection?.stop()},{once:!0}))});function connected$1(){mc.value=!0,console.log("Connected to Music SignalR"),document.dispatchEvent(new Event("musicHub-connected"))}function disconnected$1(c){mc.value=!1,console.log("Disconnected from Music SignalR",c),document.dispatchEvent(new Event("musicHub-disconnected"))}function error$1(c){mc.value=!1,console.error("Music SignalR Error:",c),document.dispatchEvent(new Event("musicHub-error"))}function handleMusicBroadcastStatus(c){if(c)for(const h of c.events){const g=h.deviceBroadcastStatus;currentMusicDeviceId.value=g.device_id,g.device_id===deviceId.value?audioPlayer_default.unmute():audioPlayer_default.mute()}}function handleMusicPlayerState(c){if(c)for(const h of c.events){if(h.type!=="PlayerStateChanged")continue;const g=h.event.state;if(!g)continue;if(!g.item){audioPlayer_default.stop(),currentMusicDeviceId.value=null;continue}const E=(Date.now()-g.timestamp)/2,S=(g.progress_ms+E)/1e3;currentMusicDeviceId.value=g.device_id,setCurrentPlaylist(g.current_list);const R=g.device_id===deviceId.value;R&&!g.muted_state?audioPlayer_default.unmute():audioPlayer_default.mute();const L=Math.max(0,Math.min(100,g.volume_percentage));if(audioPlayer_default.setVolume(L),volume.value=L,audioPlayer_default.repeat(g.repeat_state),audioPlayer_default.shuffle(g.shuffle_state),audioPlayer_default.setQueue(g.playlist),currentSong.value?.id!==g.item.id)audioPlayer_default.setCurrentSong(g.item),audioPlayer_default.once("error",()=>{console.error("Failed to load track:",g.item.name)}),audioPlayer_default.once("canplay",()=>{audioPlayer_default.seek(S),g.is_playing?audioPlayer_default.play().catch(k=>{console.error("Failed to play after canplay:",k)}):audioPlayer_default.pause()});else{currentSong.value=g.item;const k=Math.abs((currentTime.value||0)-S);(R?k>.75:k>2)&&audioPlayer_default.seek(S),g.is_playing?audioPlayer_default.play().catch(C=>{console.error("Failed to sync play state:",C)}):audioPlayer_default.pause()}}}function handleMusicConnectedDevicesState(c){connectedMusicDevices.value=c.toSorted((h,g)=>h?.device_id.localeCompare(g?.device_id))}init_vue_runtime_esm_bundler();const connectedMusicDevices=ref([]),currentMusicDeviceId=ref(null),currentTime=ref(0),duration=ref(0),remainingTime=ref(0),percentage=ref(0),currentSong=ref(null),currentPlaylist=ref(null),queue=ref([]),backlog=ref([]),isPlaying=ref(!1),isMuted=ref(!1),isShuffling=ref(!1),isRepeating=ref("off"),volume=ref(0),panning=ref(0),bands=ref([]),equalizerPresets=ref([]),equalizerSliderValues=ref({}),equalizerPreset=ref({}),lyricsMenuOpen=ref(!1),hasLyrics=ref(!1),deviceMenuOpen=ref(!1);var modalOpen=ref(!1);const fullPlayerModalOpen=ref(modalOpen.value),queueMenuOpen=ref(!1),equalizerMenuOpen=ref(!1),audioPlayer=new import_dist.PlayerCore({motionConfig:{canvas:document.getElementById("visualizer")},motionColors:["#ff0000","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000"],siteTitle,expose:!0,disableAutoPlayback:user.value.features?.nomercyConnect??!1,actions:{play:()=>{if(!user.value.features?.nomercyConnect){audioPlayer.play().catch(c=>{console.error("Failed to play:",c)});return}currentMusicDeviceId.value||musicSocketConnection.value?.invoke("ChangeDeviceCommand",deviceId.value).then(()=>{console.log("Switched to device:",deviceId.value)}).catch(c=>{console.error("Error switching device:",c)}),musicSocketConnection.value?.invoke("PlaybackCommand","play",null)},pause:()=>{if(!user.value.features?.nomercyConnect){audioPlayer.pause();return}currentMusicDeviceId.value||musicSocketConnection.value?.invoke("ChangeDeviceCommand",deviceId.value).then(()=>{console.log("Switched to device:",deviceId.value)}).catch(c=>{console.error("Error switching device:",c)}),musicSocketConnection.value?.invoke("PlaybackCommand","pause",null)},stop:()=>{if(setLyricsMenuOpen(!1),setQueueMenuOpen(!1),setDeviceMenuOpen(!1),!user.value.features?.nomercyConnect){audioPlayer.stop();return}musicSocketConnection.value?.invoke("PlaybackCommand","stop",null)},previous:()=>{if(!user.value.features?.nomercyConnect){audioPlayer.previous();return}musicSocketConnection.value?.invoke("PlaybackCommand","previous",null)},next:()=>{if(!user.value.features?.nomercyConnect){audioPlayer.next();return}musicSocketConnection.value?.invoke("PlaybackCommand","next",null)},seek:c=>{musicSocketConnection.value?.invoke("PlaybackCommand","seek",c),audioPlayer.seek(c)}}});watch(user,c=>{audioPlayer.setAutoPlayback(c.features?.nomercyConnect??!1)});var audioPlayer_default=audioPlayer;function setLyricsMenuOpen(c){lyricsMenuOpen.value=c,queueMenuOpen.value=!1,deviceMenuOpen.value=!1,equalizerMenuOpen.value=!1}function toggleLyricsMenuOpen(){lyricsMenuOpen.value=!lyricsMenuOpen.value,queueMenuOpen.value=!1,deviceMenuOpen.value=!1,equalizerMenuOpen.value=!1}function setHasLyrics(c){hasLyrics.value=c}function setDeviceMenuOpen(c){deviceMenuOpen.value=c,lyricsMenuOpen.value=!1,queueMenuOpen.value=!1,equalizerMenuOpen.value=!1}function toggleDeviceMenuOpen(){deviceMenuOpen.value=!deviceMenuOpen.value,lyricsMenuOpen.value=!1,queueMenuOpen.value=!1,equalizerMenuOpen.value=!1}function setFullPlayerModalOpen(c){fullPlayerModalOpen.value=c,setMusicSize(c?SizeState.full:SizeState.compact)}function openFullPlayer(){fullPlayerModalOpen.value=!0,setMusicSize(SizeState.full)}function closeFullPlayer(){fullPlayerModalOpen.value=!1,setMusicSize(SizeState.compact)}function setCurrentPlaylist(c){currentPlaylist.value=c}function setQueueMenuOpen(c){queueMenuOpen.value=c,lyricsMenuOpen.value=!1,deviceMenuOpen.value=!1,equalizerMenuOpen.value=!1}function toggleQueueMenuOpen(){queueMenuOpen.value=!queueMenuOpen.value,lyricsMenuOpen.value=!1,deviceMenuOpen.value=!1,equalizerMenuOpen.value=!1}const musicVisibility=ref(VisibilityState.hidden),musicSize=ref(SizeState.compact);function setMusicSize(c){musicSize.value=c}function toggleEqualizerMenuOpen(){equalizerMenuOpen.value=!equalizerMenuOpen.value,lyricsMenuOpen.value=!1,queueMenuOpen.value=!1,deviceMenuOpen.value=!1}function convertToPercentage(c,h,g){let E=(c-h)/(g-h)*100;return E<=20?E+=5/20*E:E>=80&&(E-=5/20*(100-E)),Math.max(0,Math.min(100,E))}function handleFullReset(){panning.value=0,setEqualizerPreset(equalizerPresets.value.find(c=>c.name==="Flat"))}function handleChange(c,h,g){const E=Number.parseFloat(h.target.value);if(c==="panning"){panning.value=E,audioPlayer.setPanner(E),audioPlayer.saveEqualizerSettings();return}if(g?.gain){if(g.gain=E,g.frequency==="Pre"){audioPlayer.setPreGain(E),audioPlayer.saveEqualizerSettings();return}bands.value=[...bands.value.map(S=>S.frequency===g.frequency?(audioPlayer.setFilter(g),g):S)],audioPlayer.equalizerBands=bands.value,audioPlayer.saveEqualizerSettings()}}function handleReset(c,h,g){onDoubleClick(h,()=>{},()=>{if(c==="panning"){panning.value=0,audioPlayer.setPanner(0),audioPlayer.saveEqualizerSettings();return}if(g?.gain){if(g.gain=0,g.frequency==="Pre"){audioPlayer.setPreGain(0),audioPlayer.saveEqualizerSettings();return}bands.value=[...bands.value.map(E=>E.frequency===g.frequency?(audioPlayer.setFilter(g),g):E)],audioPlayer.equalizerBands=bands.value,audioPlayer.saveEqualizerSettings()}})}function setEqualizerPreset(c){equalizerPreset.value=equalizerPresets.value.find(h=>h.name===(c?.name??"Flat"))??equalizerPresets.value[0],bands.value=[{frequency:"Pre",gain:equalizerSliderValues.value.pre.default},...equalizerPreset.value.values],audioPlayer.equalizerBands=bands.value;for(let h=1;h<bands.value.length;h++)audioPlayer.setFilter(bands.value[h]);audioPlayer.saveEqualizerSettings()}panning.value=audioPlayer.equalizerPanning;bands.value=audioPlayer.equalizerBands;equalizerPresets.value=audioPlayer.equalizerPresets;equalizerSliderValues.value=audioPlayer.equalizerSliderValues;equalizerPreset.value=audioPlayer.equalizerPresets.find(c=>c.name==="Flat")??equalizerPresets.value[0];var lastTime=0;audioPlayer.on("time",c=>{currentTime.value=c.position,duration.value=c.duration,remainingTime.value=c.remaining,percentage.value=c.percentage,currentMusicDeviceId.value===deviceId.value&&c.position-lastTime>5&&(lastTime=c.position)});audioPlayer.on("song",c=>{currentSong.value=c,lastTime=0,c?musicVisibility.value=VisibilityState.showing:(musicVisibility.value=VisibilityState.hidden,lyricsMenuOpen.value=!1,queueMenuOpen.value=!1,deviceMenuOpen.value=!1,equalizerMenuOpen.value=!1)});audioPlayer.on("queue",c=>{queue.value=toRaw(c)});audioPlayer.on("backlog",c=>{backlog.value=toRaw(c)});audioPlayer.on("play",()=>{isPlaying.value=!0});audioPlayer.on("pause",()=>{isPlaying.value=!1});audioPlayer.on("stop",()=>{isPlaying.value=!1});audioPlayer.on("mute",c=>{isMuted.value=c});audioPlayer.on("shuffle",c=>{isShuffling.value=c});audioPlayer.on("repeat",c=>{isRepeating.value=c});audioPlayer.on("volume",c=>{volume.value=c});init_vue_runtime_esm_bundler();function initializeAudioPlayer(){return audioPlayer_default.accessToken?Promise.resolve():new Promise(c=>{watch(currentServer,g=>{g&&(audioPlayer_default.setBaseUrl(g.serverBaseUrl),audioPlayer_default.setAccessToken(user.value.accessToken))}),audioPlayer_default.setBaseUrl(currentServer.value?.serverBaseUrl),audioPlayer_default.setAccessToken(user.value.accessToken);const h=useLocalStorage("nmplayer-music-supports-audio-context",!1);h.value=!1,c()})}var inititalizeAudioPlayer_default=initializeAudioPlayer;init_vue_runtime_esm_bundler();const vc=ref(!1),videoSocketIsConnected=computed(()=>vc.value);var si=ref();const videoSocketInstance=computed(()=>si.value);window.videoSocketInstance=si;const videoSocketConnection=computed(()=>si.value?.connection);function setVideoSocketInstance(c){si.value=c}function useVideoSocket(){return si.value?.connection?toRaw(si.value?.connection):null}watch(si,c=>{c?.connection&&(c?.connection?.on("connected",connected),c?.connection?.on("disconnected",disconnected),c?.connection?.on("error",error),window.addEventListener("beforeunload",()=>{c?.connection?.stop()},{once:!0}),window.addEventListener("unload",()=>{c?.connection?.stop()},{once:!0}))});function connected(){vc.value=!0,console.log("Connected to Video SignalR"),document.dispatchEvent(new Event("videoHub-connected"))}function disconnected(c){vc.value=!1,console.log("Disconnected from Video SignalR",c),document.dispatchEvent(new Event("videoHub-disconnected"))}function error(c){vc.value=!1,console.error("Video SignalR Error:",c),document.dispatchEvent(new Event("videoHub-error"))}function connect(c){c&&(c.on("connect",onConnect),c.on("disconnected",onDisconnect),c.on("notify",onNotify),c.on("command",onCommand),c.on("RefreshLibrary",onUpdateContent),c.on("addActivityLog",onAddActivityLog),c.on("setActivityLog",onSetActivityLog),c.on("pingEvent",pingEvent))}function disconnect(c){c&&(c.off("connect",onConnect),c.off("disconnected",onDisconnect),c.off("notify",onNotify),c.off("command",onCommand),c.off("RefreshLibrary",onUpdateContent),c.off("addActivityLog",onAddActivityLog),c.off("setActivityLog",onSetActivityLog),c.off("pingEvent",pingEvent))}function onConnect(c,h){c&&(document.dispatchEvent(new Event("baseHub-connected")),document.dispatchEvent(new CustomEvent("toast",{detail:{severity:"info",summary:instance.t(`Connected to ${h}`),life:3e3}})))}function onDisconnect(c,h){c&&(document.dispatchEvent(new Event("baseHub-disconnected")),document.dispatchEvent(new CustomEvent("toast",{detail:{severity:"error",summary:instance.t(`Disconnected from ${h}`),life:5e3}})))}function onNotify(c){document.dispatchEvent(new CustomEvent("toast",{detail:{severity:c.type,summary:translate(c.title,...c.args),detail:c.body,life:c.duration}}))}function onUpdateContent(c){queryClient.invalidateQueries(c).then()}async function onCommand(data){const deviceId$1=await Device.getId().then(c=>c.identifier);if(data.deviceId===deviceId$1)return;const func=eval(`(${data})`);typeof func=="function"&&func()}function onAddActivityLog(c){}function onSetActivityLog(c){}function pingEvent(c){useVideoSocket()?.invoke("pongEvent",c).then()}var InfiniteRetryPolicy=class{nextRetryDelayInMilliseconds(c){return[0,1e3,2e3,5e3][c.previousRetryCount]??1e4}},SocketClient=class{connection=null;accessToken;baseUrl;clientInfo=clientInfo.value;keepAliveInterval=5;endpoint;disposed=!1;constructor(c,h,g="socket"){this.baseUrl=c?.replace(/\/$/,""),this.accessToken=h,this.endpoint=g,this.connection=this.connectionBuilder()}dispose=async()=>{this.disposed=!0,this.connection&&await this.connection.stop()};on(c,h){this.connection?.on(c,h)}off(c,h){h?this.connection?.off(c,h):this.connection?.off(c)}async invoke(c,...h){if(this.connection?.state==="Connected")return await this.connection.invoke(c,...h);throw new Error("Connection not established")}setup=async()=>{this.connection&&(this.disposed=!1,this.connection.onreconnecting(c=>{console.log("SignalR Disconnected.",c?.message),onDisconnect(this.connection,this.endpoint)}),this.connection.onreconnected(()=>{console.log("SignalR Reconnected."),onConnect(this.connection,this.endpoint)}),this.connection.onclose(async c=>{console.log("SignalR Closed.",c),onDisconnect(this.connection,this.endpoint),!(!this.connection||this.disposed)&&await this.startWithRetry()}),await this.startWithRetry())};startWithRetry=async()=>{const c=[0,1e3,2e3,5e3];for(;!this.disposed;)try{await this.connection.start(),onConnect(this.connection,this.endpoint),connect(this.connection);return}catch(h){if(this.disposed)return;const g=c.shift()??1e4;console.warn(`SignalR ${this.endpoint} connect failed, retrying in ${g}ms...`,h),await new Promise(E=>setTimeout(E,g))}};connectionBuilder(){const c=this.urlBuilder(),h=new URL(`${this.baseUrl}/${this.endpoint}`);return h.search=c.toString(),new HubConnectionBuilder().withUrl(h.toString(),{transport:HttpTransportType.WebSockets}).withKeepAliveInterval(this.keepAliveInterval*1e3).withAutomaticReconnect(new InfiniteRetryPolicy).withStatefulReconnect().configureLogging(LogLevel.Critical).build()}urlBuilder(){return new URLSearchParams({access_token:this.accessToken,client_id:this.clientInfo.id,client_name:this.clientInfo.name,client_type:this.clientInfo.type??"web",client_version:this.clientInfo.version,client_os:this.clientInfo.os,client_browser:this.clientInfo.browser,client_device:this.clientInfo.device,client_volume:this.clientInfo.volume_percent.toString()})}},SocketClient_default=SocketClient;init_vue_runtime_esm_bundler();var done$3=ref(!1);function initializeVideoSocket(){return new Promise(async(c,h)=>{if(done$3.value)return c();if(done$3.value=!0,!currentServer.value||!user.value)return user.value.features??={},user.value.features.nomercyConnect=!1,c();let g=new SocketClient_default(currentServer.value.serverBaseUrl,user.value.accessToken,"videoHub");return await g.setup(),setVideoSocketInstance(g),setTimeout(()=>{watch(currentServer,async E=>{!E||!user.value||!g||(g.connection?.stop(),await g.dispose(),g=new SocketClient_default(E.serverBaseUrl,user.value.accessToken,"videoHub"),await g.setup(),setVideoSocketInstance(g))})},5e3),c()})}var initializeVideoSocket_default=initializeVideoSocket;init_vue_runtime_esm_bundler();var done$2=ref(!1);function initializeMusicSocket(){return new Promise(async(c,h)=>{if(done$2.value)return c();if(done$2.value=!0,!currentServer.value||!user.value||!user.value.features?.nomercyConnect)return user.value.features??={},user.value.features.nomercyConnect=!1,c();let g=new SocketClient_default(currentServer.value.serverBaseUrl,user.value.accessToken,"musicHub");return await g.setup(),setMusicSocketInstance(g),setTimeout(()=>{watch(currentServer,async E=>{console.log("Current server changed, reinitializing music socket",E),!(!E||!user.value||!g)&&(g.connection?.stop(),await g.dispose(),g=new SocketClient_default(E.serverBaseUrl,user.value.accessToken,"musicHub"),await g.setup(),setMusicSocketInstance(g))})},5e3),c()})}var initializeMusicSocket_default=initializeMusicSocket;init_vue_runtime_esm_bundler();var done$1=ref(!1);function getServerPermissions(){return new Promise((c,h)=>{if(done$1.value){c();return}if(!currentServer.value){c();return}deduplicatedRequest("setup/permissions",()=>serverClient_default(5).get("setup/permissions")).then(({data:g})=>{setCurrentServer({...currentServer.value,is_owner:g.owner,is_manager:g.manager}),done$1.value=!0,c()}).catch(async()=>{done$1.value=!0,await router_default.replace({name:"Server offline"}).then(()=>c()),c()})})}var getServerPermissions_default=getServerPermissions;init_vue_runtime_esm_bundler();var done=ref(!1);function getServerSetup(){return new Promise((c,h)=>{if(done.value){c();return}if(serverInfoRequested.value){c();return}if(!currentServer.value){c();return}deduplicatedRequest("setup/server-info",()=>serverClient_default(5).get("setup/server-info")).then(({data:g})=>{if(serverSetupComplete.value=g.data?.setup_complete??!1,serverInfoRequested.value=!0,!g.data?.setup_complete){console.log("Server setup not complete, redirecting to post-installation page"),redirectUrl.value="/setup/post-install",router_default.replace({name:"Post Install"}).then(()=>c()),done.value=!0;return}done.value=!0,c()}).catch(async g=>{serverSetupComplete.value=!0,done.value=!0,await router_default.replace({name:"Server offline"}).then(()=>h(g)),h(g)})})}var getServerSetup_default=getServerSetup,chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function InvalidCharacterError(c){console.error(c)}InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.name="InvalidCharacterError";function polyfill(c=""){const h=String(c).replace(/[=]+$/u,"");if(h.length%4===1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");let g=0,E=0,S=0,R="";for(let L;L=h.charAt(S++);~L&&(E=g%4?E*64+L:L,g++%4)&&(R+=String.fromCharCode(255&E>>(-2*g&6))))L=chars.indexOf(L);return R}var atob$1=typeof window<"u"&&window.atob&&window.atob.bind(window)||polyfill;function b64DecodeUnicode$1(c){return decodeURIComponent(atob$1(c).replace(/(.)/gu,(h,g)=>{let E=g.charCodeAt(0).toString(16).toUpperCase();return E.length<2&&(E=`0${E}`),`%${E}`}))}function base64_url_decode(c){let h=c.replace(/-/gu,"+").replace(/_/gu,"/");switch(h.length%4){case 0:break;case 2:h+="==";break;case 3:h+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return b64DecodeUnicode$1(h)}catch{return atob$1(h)}}function InvalidTokenError(c){console.error(c)}InvalidTokenError.prototype=new Error;InvalidTokenError.prototype.name="InvalidTokenError";function jwtDecode(c,h){if(typeof c!="string")throw new InvalidTokenError("Invalid token specified: must be a string");h=h||{};const g=h.header===!0?0:1,E=c.split(".")[g];if(typeof E!="string")throw new InvalidTokenError(`Invalid token specified: missing part #${g+1}`);let S;try{S=base64_url_decode(E)}catch(R){throw new InvalidTokenError(`Invalid token specified: invalid base64 for part #${g+1} (${R.message})`)}try{return JSON.parse(S)}catch(R){throw new InvalidTokenError(`Invalid token specified: invalid json for part #${g+1} (${R.message})`)}}function parseToken(c){return jwtDecode(c)}var cdnClient_default=c=>client_default({baseUrl:`https://cdn${suffix}.nomercy.tv`,timeout:c}),originalLocation=window.location.href.startsWith("file://")?"http://localhost:5173":window.location.origin,clientId="nomercy-ui",clientSecret="";function refreshToken(){return new Promise((c,h)=>{const g=location.search.split("refreshToken=")?.[1]?.split("&")?.[0]??localStorage.getItem("refresh_token")??void 0;if(!g)throw new Error("No refresh token available");cdnClient_default().post(`${authBaseUrl}token`,{grant_type:"refresh_token",client_id:clientId,client_secret:clientSecret,refresh_token:g},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(E=>(storeTokens(E.data),c(E))).catch(E=>(console.error(E),clearTokens(),sessionStorage.clear(),localStorage.clear(),location.reload(),h(E)))})}function storeTokens(c){setUser({...user.value,refreshIn:new Date(Date.now()+c.expires_in*1e3).getTime(),accessToken:c.access_token,refreshToken:c.refresh_token,idToken:c.id_token,expiresIn:c.expires_in}),isPlatform("capacitor")&&(localStorage.setItem("access_token",c.access_token),localStorage.setItem("refresh_token",c.refresh_token),localStorage.setItem("id_token",c.id_token));try{const h=parseToken(c.id_token);console.log("decodedToken",h),setUser({...user.value,name:h.display_name,email:h.email,id:h.sub,locale:h.locale})}catch(h){console.error(h)}}function clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("id_token")}function logout(){keycloak.value?.logout(),clearTokens(),sessionStorage.clear(),localStorage.clear()}function Keycloak(c){if(!(this instanceof Keycloak))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");if(typeof c!="string"&&!isObject(c))throw new Error("The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.");if(isObject(c)){const M="oidcProvider"in c?["clientId"]:["url","realm","clientId"];for(const z of M)if(!c[z])throw new Error(`The configuration object is missing the required '${z}' property.`)}var h=this,g,E=[],S,R={enable:!0,callbackList:[],interval:5};h.didInitialize=!1;var L=!0,k=li(console.info),C=li(console.warn);globalThis.isSecureContext||C(`[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.
Continuing to run your application insecurely will lead to unexpected behavior and breakage.

For more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`),h.init=function(M={}){if(h.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");if(h.didInitialize=!0,h.authenticated=!1,S=qr(),["default","cordova","cordova-native"].indexOf(M.adapter)>-1?g=re(M.adapter):typeof M.adapter=="object"?g=M.adapter:window.Cordova||window.cordova?g=re("cordova"):g=re(),typeof M.useNonce<"u"&&(L=M.useNonce),typeof M.checkLoginIframe<"u"&&(R.enable=M.checkLoginIframe),M.checkLoginIframeInterval&&(R.interval=M.checkLoginIframeInterval),M.onLoad==="login-required"&&(h.loginRequired=!0),M.responseMode)if(M.responseMode==="query"||M.responseMode==="fragment")h.responseMode=M.responseMode;else throw"Invalid value for responseMode";if(M.flow){switch(M.flow){case"standard":h.responseType="code";break;case"implicit":h.responseType="id_token token";break;case"hybrid":h.responseType="code id_token token";break;default:throw"Invalid value for flow"}h.flow=M.flow}if(M.timeSkew!=null&&(h.timeSkew=M.timeSkew),M.redirectUri&&(h.redirectUri=M.redirectUri),M.silentCheckSsoRedirectUri&&(h.silentCheckSsoRedirectUri=M.silentCheckSsoRedirectUri),typeof M.silentCheckSsoFallback=="boolean"?h.silentCheckSsoFallback=M.silentCheckSsoFallback:h.silentCheckSsoFallback=!0,typeof M.pkceMethod<"u"){if(M.pkceMethod!=="S256"&&M.pkceMethod!==!1)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${M.pkceMethod}.`);h.pkceMethod=M.pkceMethod}else h.pkceMethod="S256";typeof M.enableLogging=="boolean"?h.enableLogging=M.enableLogging:h.enableLogging=!1,M.logoutMethod==="POST"?h.logoutMethod="POST":h.logoutMethod="GET",typeof M.scope=="string"&&(h.scope=M.scope),typeof M.acrValues=="string"&&(h.acrValues=M.acrValues),typeof M.messageReceiveTimeout=="number"&&M.messageReceiveTimeout>0?h.messageReceiveTimeout=M.messageReceiveTimeout:h.messageReceiveTimeout=1e4,h.responseMode||(h.responseMode="fragment"),h.responseType||(h.responseType="code",h.flow="standard");var z=Ee(),P=Ee();P.promise.then(function(){h.onReady&&h.onReady(h.authenticated),z.setSuccess(h.authenticated)}).catch(function(K){z.setError(K)});var ce=Se();function oe(){var K=function(pe){pe||(be.prompt="none"),M.locale&&(be.locale=M.locale),h.login(be).then(function(){P.setSuccess()}).catch(function(Ce){P.setError(Ce)})},ee=async function(){var pe=document.createElement("iframe"),Ce=await h.createLoginUrl({prompt:"none",redirectUri:h.silentCheckSsoRedirectUri});pe.setAttribute("src",Ce),pe.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),pe.setAttribute("title","keycloak-silent-check-sso"),pe.style.display="none",document.body.appendChild(pe);var Pt=function(sr){sr.origin!==window.location.origin||pe.contentWindow!==sr.source||(ae(we(sr.data),P),document.body.removeChild(pe),window.removeEventListener("message",Pt))};window.addEventListener("message",Pt)},be={};switch(M.onLoad){case"check-sso":R.enable?ne().then(function(){Je().then(function(pe){pe?P.setSuccess():h.silentCheckSsoRedirectUri?ee():K(!1)}).catch(function(pe){P.setError(pe)})}):h.silentCheckSsoRedirectUri?ee():K(!1);break;case"login-required":K(!0);break;default:throw"Invalid value for onLoad"}}function te(){var K=we(window.location.href);if(K&&window.history.replaceState(window.history.state,null,K.newUrl),K&&K.valid)return ne().then(function(){ae(K,P)}).catch(function(ee){P.setError(ee)});M.token&&M.refreshToken?($e(M.token,M.refreshToken,M.idToken),R.enable?ne().then(function(){Je().then(function(ee){ee?(h.onAuthSuccess&&h.onAuthSuccess(),P.setSuccess(),It()):P.setSuccess()}).catch(function(ee){P.setError(ee)})}):h.updateToken(-1).then(function(){h.onAuthSuccess&&h.onAuthSuccess(),P.setSuccess()}).catch(function(ee){h.onAuthError&&h.onAuthError(),M.onLoad?oe():P.setError(ee)})):M.onLoad?oe():P.setSuccess()}return ce.then(function(){A().then(te).catch(function(K){z.setError(K)})}),ce.catch(function(K){z.setError(K)}),z.promise},h.login=function(M){return g.login(M)};function x(M){if(typeof crypto>"u"||typeof crypto.getRandomValues>"u")throw new Error("Web Crypto API is not available.");return crypto.getRandomValues(new Uint8Array(M))}function q(M){return X(M,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}function X(M,z){for(var P=x(M),ce=new Array(M),oe=0;oe<M;oe++)ce[oe]=z.charCodeAt(P[oe]%z.length);return String.fromCharCode.apply(null,ce)}async function ie(M,z){if(M!=="S256")throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${M}'.`);return bytesToBase64(new Uint8Array(await sha256Digest(z))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function se(M){var z={id_token:{acr:M}};return JSON.stringify(z)}h.createLoginUrl=async function(M){var z=nt(),P=nt(),ce=g.redirectUri(M),oe={state:z,nonce:P,redirectUri:encodeURIComponent(ce),loginOptions:M};M&&M.prompt&&(oe.prompt=M.prompt);var te;M&&M.action=="register"?te=h.endpoints.register():te=h.endpoints.authorize();var K=M&&M.scope||h.scope;K?K.indexOf("openid")===-1&&(K="openid "+K):K="openid";var ee=te+"?client_id="+encodeURIComponent(h.clientId)+"&redirect_uri="+encodeURIComponent(ce)+"&state="+encodeURIComponent(z)+"&response_mode="+encodeURIComponent(h.responseMode)+"&response_type="+encodeURIComponent(h.responseType)+"&scope="+encodeURIComponent(K);if(L&&(ee=ee+"&nonce="+encodeURIComponent(P)),M&&M.prompt&&(ee+="&prompt="+encodeURIComponent(M.prompt)),M&&typeof M.maxAge=="number"&&(ee+="&max_age="+encodeURIComponent(M.maxAge)),M&&M.loginHint&&(ee+="&login_hint="+encodeURIComponent(M.loginHint)),M&&M.idpHint&&(ee+="&kc_idp_hint="+encodeURIComponent(M.idpHint)),M&&M.action&&M.action!="register"&&(ee+="&kc_action="+encodeURIComponent(M.action)),M&&M.locale&&(ee+="&ui_locales="+encodeURIComponent(M.locale)),M&&M.acr){var be=se(M.acr);ee+="&claims="+encodeURIComponent(be)}if((M&&M.acrValues||h.acrValues)&&(ee+="&acr_values="+encodeURIComponent(M.acrValues||h.acrValues)),h.pkceMethod)try{const pe=q(96),Ce=await ie(h.pkceMethod,pe);oe.pkceCodeVerifier=pe,ee+="&code_challenge="+Ce,ee+="&code_challenge_method="+h.pkceMethod}catch(pe){throw new Error("Failed to generate PKCE challenge.",{cause:pe})}return S.add(oe),ee},h.logout=function(M){return g.logout(M)},h.createLogoutUrl=function(M){if((M?.logoutMethod??h.logoutMethod)==="POST")return h.endpoints.logout();var z=h.endpoints.logout()+"?client_id="+encodeURIComponent(h.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(g.redirectUri(M,!1));return h.idToken&&(z+="&id_token_hint="+encodeURIComponent(h.idToken)),z},h.register=function(M){return g.register(M)},h.createRegisterUrl=async function(M){return M||(M={}),M.action="register",await h.createLoginUrl(M)},h.createAccountUrl=function(M){var z=ue(),P=void 0;return typeof z<"u"&&(P=z+"/account?referrer="+encodeURIComponent(h.clientId)+"&referrer_uri="+encodeURIComponent(g.redirectUri(M))),P},h.accountManagement=function(){return g.accountManagement()},h.hasRealmRole=function(M){var z=h.realmAccess;return!!z&&z.roles.indexOf(M)>=0},h.hasResourceRole=function(M,z){if(!h.resourceAccess)return!1;var P=h.resourceAccess[z||h.clientId];return!!P&&P.roles.indexOf(M)>=0},h.loadUserProfile=function(){var M=ue()+"/account",z=new XMLHttpRequest;z.open("GET",M,!0),z.setRequestHeader("Accept","application/json"),z.setRequestHeader("Authorization","bearer "+h.token);var P=Ee();return z.onreadystatechange=function(){z.readyState==4&&(z.status==200?(h.profile=JSON.parse(z.responseText),P.setSuccess(h.profile)):P.setError())},z.send(),P.promise},h.loadUserInfo=function(){var M=h.endpoints.userinfo(),z=new XMLHttpRequest;z.open("GET",M,!0),z.setRequestHeader("Accept","application/json"),z.setRequestHeader("Authorization","bearer "+h.token);var P=Ee();return z.onreadystatechange=function(){z.readyState==4&&(z.status==200?(h.userInfo=JSON.parse(z.responseText),P.setSuccess(h.userInfo)):P.setError())},z.send(),P.promise},h.isTokenExpired=function(M){if(!h.tokenParsed||!h.refreshToken&&h.flow!="implicit")throw"Not authenticated";if(h.timeSkew==null)return k("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var z=h.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+h.timeSkew;if(M){if(isNaN(M))throw"Invalid minValidity";z-=M}return z<0},h.updateToken=function(M){var z=Ee();if(!h.refreshToken)return z.setError(),z.promise;M=M||5;var P=function(){var ce=!1;if(M==-1?(ce=!0,k("[KEYCLOAK] Refreshing token: forced refresh")):(!h.tokenParsed||h.isTokenExpired(M))&&(ce=!0,k("[KEYCLOAK] Refreshing token: token expired")),!ce)z.setSuccess(!1);else{var oe="grant_type=refresh_token&refresh_token="+h.refreshToken,te=h.endpoints.token();if(E.push(z),E.length==1){var K=new XMLHttpRequest;K.open("POST",te,!0),K.setRequestHeader("Content-type","application/x-www-form-urlencoded"),K.withCredentials=!0,oe+="&client_id="+encodeURIComponent(h.clientId);var ee=new Date().getTime();K.onreadystatechange=function(){if(K.readyState==4)if(K.status==200){k("[KEYCLOAK] Token refreshed"),ee=(ee+new Date().getTime())/2;var be=JSON.parse(K.responseText);$e(be.access_token,be.refresh_token,be.id_token,ee),h.onAuthRefreshSuccess&&h.onAuthRefreshSuccess();for(var pe=E.pop();pe!=null;pe=E.pop())pe.setSuccess(!0)}else{C("[KEYCLOAK] Failed to refresh token"),K.status==400&&h.clearToken(),h.onAuthRefreshError&&h.onAuthRefreshError();for(var pe=E.pop();pe!=null;pe=E.pop())pe.setError("Failed to refresh token: An unexpected HTTP error occurred while attempting to refresh the token.")}},K.send(oe)}}};return R.enable?Je().then(function(){P()}).catch(function(ce){z.setError(ce)}):P(),z.promise},h.clearToken=function(){h.token&&($e(null,null,null),h.onAuthLogout&&h.onAuthLogout(),h.loginRequired&&h.login())};function ue(){if(typeof h.authServerUrl<"u")return h.authServerUrl.charAt(h.authServerUrl.length-1)=="/"?h.authServerUrl+"realms/"+encodeURIComponent(h.realm):h.authServerUrl+"/realms/"+encodeURIComponent(h.realm)}function ge(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function ae(M,z){var P=M.code,ce=M.error,oe=M.prompt,te=new Date().getTime();if(M.kc_action_status&&h.onActionUpdate&&h.onActionUpdate(M.kc_action_status,M.kc_action),ce){if(oe!="none")if(M.error_description&&M.error_description==="authentication_expired")h.login(M.loginOptions);else{var K={error:ce,error_description:M.error_description};h.onAuthError&&h.onAuthError(K),z&&z.setError(K)}else z&&z.setSuccess();return}else h.flow!="standard"&&(M.access_token||M.id_token)&&Ce(M.access_token,null,M.id_token,!0);if(h.flow!="implicit"&&P){var ee="code="+P+"&grant_type=authorization_code",be=h.endpoints.token(),pe=new XMLHttpRequest;pe.open("POST",be,!0),pe.setRequestHeader("Content-type","application/x-www-form-urlencoded"),ee+="&client_id="+encodeURIComponent(h.clientId),ee+="&redirect_uri="+M.redirectUri,M.pkceCodeVerifier&&(ee+="&code_verifier="+M.pkceCodeVerifier),pe.withCredentials=!0,pe.onreadystatechange=function(){if(pe.readyState==4)if(pe.status==200){var Pt=JSON.parse(pe.responseText);Ce(Pt.access_token,Pt.refresh_token,Pt.id_token,h.flow==="standard"),It()}else h.onAuthError&&h.onAuthError(),z&&z.setError()},pe.send(ee)}function Ce(Pt,sr,fr,xi){te=(te+new Date().getTime())/2,$e(Pt,sr,fr,te),L&&h.idTokenParsed&&h.idTokenParsed.nonce!=M.storedNonce?(k("[KEYCLOAK] Invalid nonce, clearing token"),h.clearToken(),z&&z.setError()):xi&&(h.onAuthSuccess&&h.onAuthSuccess(),z&&z.setSuccess())}}function Se(){var M=Ee(),z;typeof c=="string"&&(z=c);function P(K){K?h.endpoints={authorize:function(){return K.authorization_endpoint},token:function(){return K.token_endpoint},logout:function(){if(!K.end_session_endpoint)throw"Not supported by the OIDC server";return K.end_session_endpoint},checkSessionIframe:function(){if(!K.check_session_iframe)throw"Not supported by the OIDC server";return K.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!K.userinfo_endpoint)throw"Not supported by the OIDC server";return K.userinfo_endpoint}}:h.endpoints={authorize:function(){return ue()+"/protocol/openid-connect/auth"},token:function(){return ue()+"/protocol/openid-connect/token"},logout:function(){return ue()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){return ue()+"/protocol/openid-connect/login-status-iframe.html"},thirdPartyCookiesIframe:function(){return ue()+"/protocol/openid-connect/3p-cookies/step1.html"},register:function(){return ue()+"/protocol/openid-connect/registrations"},userinfo:function(){return ue()+"/protocol/openid-connect/userinfo"}}}if(z){var ce=new XMLHttpRequest;ce.open("GET",z,!0),ce.setRequestHeader("Accept","application/json"),ce.onreadystatechange=function(){if(ce.readyState==4)if(ce.status==200||xe(ce)){var K=JSON.parse(ce.responseText);h.authServerUrl=K["auth-server-url"],h.realm=K.realm,h.clientId=K.resource,P(null),M.setSuccess()}else M.setError()},ce.send()}else{h.clientId=c.clientId;var oe=c.oidcProvider;if(!oe)h.authServerUrl=c.url,h.realm=c.realm,P(null),M.setSuccess();else if(typeof oe=="string"){var te;oe.charAt(oe.length-1)=="/"?te=oe+".well-known/openid-configuration":te=oe+"/.well-known/openid-configuration";var ce=new XMLHttpRequest;ce.open("GET",te,!0),ce.setRequestHeader("Accept","application/json"),ce.onreadystatechange=function(){ce.readyState==4&&(ce.status==200||xe(ce)?(P(JSON.parse(ce.responseText)),M.setSuccess()):M.setError())},ce.send()}else P(oe),M.setSuccess()}return M.promise}function xe(M){return M.status==0&&M.responseText&&M.responseURL.startsWith("file:")}function $e(M,z,P,ce){if(h.tokenTimeoutHandle&&(clearTimeout(h.tokenTimeoutHandle),h.tokenTimeoutHandle=null),z?(h.refreshToken=z,h.refreshTokenParsed=decodeToken(z)):(delete h.refreshToken,delete h.refreshTokenParsed),P?(h.idToken=P,h.idTokenParsed=decodeToken(P)):(delete h.idToken,delete h.idTokenParsed),M){if(h.token=M,h.tokenParsed=decodeToken(M),h.sessionId=h.tokenParsed.sid,h.authenticated=!0,h.subject=h.tokenParsed.sub,h.realmAccess=h.tokenParsed.realm_access,h.resourceAccess=h.tokenParsed.resource_access,ce&&(h.timeSkew=Math.floor(ce/1e3)-h.tokenParsed.iat),h.timeSkew!=null&&(k("[KEYCLOAK] Estimated time difference between browser and server is "+h.timeSkew+" seconds"),h.onTokenExpired)){var oe=(h.tokenParsed.exp-new Date().getTime()/1e3+h.timeSkew)*1e3;k("[KEYCLOAK] Token expires in "+Math.round(oe/1e3)+" s"),oe<=0?h.onTokenExpired():h.tokenTimeoutHandle=setTimeout(h.onTokenExpired,oe)}}else delete h.token,delete h.tokenParsed,delete h.subject,delete h.realmAccess,delete h.resourceAccess,h.authenticated=!1}function nt(){if(typeof crypto>"u"||typeof crypto.randomUUID>"u")throw new Error("Web Crypto API is not available.");return crypto.randomUUID()}function we(M){var z=ht(M);if(z){var P=S.get(z.state);return P&&(z.valid=!0,z.redirectUri=P.redirectUri,z.storedNonce=P.nonce,z.prompt=P.prompt,z.pkceCodeVerifier=P.pkceCodeVerifier,z.loginOptions=P.loginOptions),z}}function ht(M){var z;switch(h.flow){case"standard":z=["code","state","session_state","kc_action_status","kc_action","iss"];break;case"implicit":z=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","kc_action","iss"];break;case"hybrid":z=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","kc_action","iss"];break}z.push("error"),z.push("error_description"),z.push("error_uri");var P=M.indexOf("?"),ce=M.indexOf("#"),oe,te;if(h.responseMode==="query"&&P!==-1?(oe=M.substring(0,P),te=Pe(M.substring(P+1,ce!==-1?ce:M.length),z),te.paramsString!==""&&(oe+="?"+te.paramsString),ce!==-1&&(oe+=M.substring(ce))):h.responseMode==="fragment"&&ce!==-1&&(oe=M.substring(0,ce),te=Pe(M.substring(ce+1),z),te.paramsString!==""&&(oe+="#"+te.paramsString)),te&&te.oauthParams){if(h.flow==="standard"||h.flow==="hybrid"){if((te.oauthParams.code||te.oauthParams.error)&&te.oauthParams.state)return te.oauthParams.newUrl=oe,te.oauthParams}else if(h.flow==="implicit"&&(te.oauthParams.access_token||te.oauthParams.error)&&te.oauthParams.state)return te.oauthParams.newUrl=oe,te.oauthParams}}function Pe(M,z){for(var P=M.split("&"),ce={paramsString:"",oauthParams:{}},oe=0;oe<P.length;oe++){var te=P[oe].indexOf("="),K=P[oe].slice(0,te);z.indexOf(K)!==-1?ce.oauthParams[K]=P[oe].slice(te+1):(ce.paramsString!==""&&(ce.paramsString+="&"),ce.paramsString+=P[oe])}return ce}function Ee(){var M={setSuccess:function(z){M.resolve(z)},setError:function(z){M.reject(z)}};return M.promise=new Promise(function(z,P){M.resolve=z,M.reject=P}),M}function Ne(M,z,P){var ce=null,oe=new Promise(function(te,K){ce=setTimeout(function(){K({error:P||"Promise is not settled within timeout of "+z+"ms"})},z)});return Promise.race([M,oe]).finally(function(){clearTimeout(ce)})}function ne(){var M=Ee();if(!R.enable||R.iframe)return M.setSuccess(),M.promise;var z=document.createElement("iframe");R.iframe=z,z.onload=function(){var oe=h.endpoints.authorize();oe.charAt(0)==="/"?R.iframeOrigin=ge():R.iframeOrigin=oe.substring(0,oe.indexOf("/",8)),M.setSuccess()};var P=h.endpoints.checkSessionIframe();z.setAttribute("src",P),z.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),z.setAttribute("title","keycloak-session-iframe"),z.style.display="none",document.body.appendChild(z);var ce=function(oe){if(!(oe.origin!==R.iframeOrigin||R.iframe.contentWindow!==oe.source)&&(oe.data=="unchanged"||oe.data=="changed"||oe.data=="error")){oe.data!="unchanged"&&h.clearToken();for(var te=R.callbackList.splice(0,R.callbackList.length),K=te.length-1;K>=0;--K){var ee=te[K];oe.data=="error"?ee.setError():ee.setSuccess(oe.data=="unchanged")}}};return window.addEventListener("message",ce,!1),M.promise}function It(){R.enable&&h.token&&setTimeout(function(){Je().then(function(M){M&&It()})},R.interval*1e3)}function Je(){var M=Ee();if(R.iframe&&R.iframeOrigin){var z=h.clientId+" "+(h.sessionId?h.sessionId:"");R.callbackList.push(M);var P=R.iframeOrigin;R.callbackList.length==1&&R.iframe.contentWindow.postMessage(z,P)}else M.setSuccess();return M.promise}function A(){var M=Ee();if((R.enable||h.silentCheckSsoRedirectUri)&&typeof h.endpoints.thirdPartyCookiesIframe=="function"){var z=document.createElement("iframe");z.setAttribute("src",h.endpoints.thirdPartyCookiesIframe()),z.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),z.setAttribute("title","keycloak-3p-check-iframe"),z.style.display="none",document.body.appendChild(z);var P=function(ce){z.contentWindow===ce.source&&(ce.data!=="supported"&&ce.data!=="unsupported"||(ce.data==="unsupported"&&(C(`[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:

 - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).
 - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).

For more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers`),R.enable=!1,h.silentCheckSsoFallback&&(h.silentCheckSsoRedirectUri=!1)),document.body.removeChild(z),window.removeEventListener("message",P),M.setSuccess()))};window.addEventListener("message",P,!1)}else M.setSuccess();return Ne(M.promise,h.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")}function re(M){if(!M||M=="default")return{login:async function(K){return window.location.assign(await h.createLoginUrl(K)),Ee().promise},logout:async function(K){if((K?.logoutMethod??h.logoutMethod)==="GET"){window.location.replace(h.createLogoutUrl(K));return}const ee=document.createElement("form");ee.setAttribute("method","POST"),ee.setAttribute("action",h.createLogoutUrl(K)),ee.style.display="none";const be={id_token_hint:h.idToken,client_id:h.clientId,post_logout_redirect_uri:g.redirectUri(K,!1)};for(const[pe,Ce]of Object.entries(be)){const Pt=document.createElement("input");Pt.setAttribute("type","hidden"),Pt.setAttribute("name",pe),Pt.setAttribute("value",Ce),ee.appendChild(Pt)}document.body.appendChild(ee),ee.submit()},register:async function(K){return window.location.assign(await h.createRegisterUrl(K)),Ee().promise},accountManagement:function(){var K=h.createAccountUrl();if(typeof K<"u")window.location.href=K;else throw"Not supported by the OIDC server";return Ee().promise},redirectUri:function(K,ee){return arguments.length==1&&(ee=!0),K&&K.redirectUri?K.redirectUri:h.redirectUri?h.redirectUri:location.href}};if(M=="cordova"){R.enable=!1;var z=function(K,ee,be){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(K,ee,be):window.open(K,ee,be)},P=function(K){return K&&K.cordovaOptions?Object.keys(K.cordovaOptions).reduce(function(ee,be){return ee[be]=K.cordovaOptions[be],ee},{}):{}},ce=function(K){return Object.keys(K).reduce(function(ee,be){return ee.push(be+"="+K[be]),ee},[]).join(",")},oe=function(K){var ee=P(K);return ee.location="no",K&&K.prompt=="none"&&(ee.hidden="yes"),ce(ee)},te=function(){return h.redirectUri||"http://localhost"};return{login:async function(K){var ee=Ee(),be=oe(K),pe=z(await h.createLoginUrl(K),"_blank",be),Ce=!1,Pt=!1,sr=function(){Pt=!0,pe.close()};return pe.addEventListener("loadstart",function(fr){fr.url.indexOf(te())==0&&(ae(we(fr.url),ee),sr(),Ce=!0)}),pe.addEventListener("loaderror",function(fr){Ce||(fr.url.indexOf(te())==0?(ae(we(fr.url),ee),sr(),Ce=!0):(ee.setError(),sr()))}),pe.addEventListener("exit",function(fr){Pt||ee.setError({reason:"closed_by_user"})}),ee.promise},logout:function(K){var ee=Ee(),be=z(h.createLogoutUrl(K),"_blank","location=no,hidden=yes,clearcache=yes"),pe;return be.addEventListener("loadstart",function(Ce){Ce.url.indexOf(te())==0&&be.close()}),be.addEventListener("loaderror",function(Ce){Ce.url.indexOf(te())==0||(pe=!0),be.close()}),be.addEventListener("exit",function(Ce){pe?ee.setError():(h.clearToken(),ee.setSuccess())}),ee.promise},register:async function(K){var ee=Ee(),be=z(await h.createRegisterUrl(),"_blank",oe(K));return be.addEventListener("loadstart",function(pe){pe.url.indexOf(te())==0&&(be.close(),ae(we(pe.url),ee))}),ee.promise},accountManagement:function(){var K=h.createAccountUrl();if(typeof K<"u"){var ee=z(K,"_blank","location=no");ee.addEventListener("loadstart",function(be){be.url.indexOf(te())==0&&ee.close()})}else throw"Not supported by the OIDC server"},redirectUri:function(K){return te()}}}if(M=="cordova-native")return R.enable=!1,{login:async function(K){var ee=Ee(),be=await h.createLoginUrl(K);return universalLinks.subscribe("keycloak",function(pe){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),ae(we(pe.url),ee)}),window.cordova.plugins.browsertab.openUrl(be),ee.promise},logout:function(K){var ee=Ee(),be=h.createLogoutUrl(K);return universalLinks.subscribe("keycloak",function(pe){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),h.clearToken(),ee.setSuccess()}),window.cordova.plugins.browsertab.openUrl(be),ee.promise},register:async function(K){var ee=Ee(),be=await h.createRegisterUrl(K);return universalLinks.subscribe("keycloak",function(pe){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),ae(we(pe.url),ee)}),window.cordova.plugins.browsertab.openUrl(be),ee.promise},accountManagement:function(){var K=h.createAccountUrl();if(typeof K<"u")window.cordova.plugins.browsertab.openUrl(K);else throw"Not supported by the OIDC server"},redirectUri:function(K){return K&&K.redirectUri?K.redirectUri:h.redirectUri?h.redirectUri:"http://localhost"}};throw"invalid adapter type: "+M}const U="kc-callback-";var bt=function(){if(!(this instanceof bt))return new bt;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var M=this;function z(){const te=Date.now();for(const[K,ee]of ce()){const be=oe(ee);(be===null||be<te)&&localStorage.removeItem(K)}}function P(){for(const[te]of ce())localStorage.removeItem(te)}function ce(){return Object.entries(localStorage).filter(([te])=>te.startsWith(U))}function oe(te){let K;try{K=JSON.parse(te)}catch{return null}return isObject(K)&&"expires"in K&&typeof K.expires=="number"?K.expires:null}M.get=function(te){if(te){var K=U+te,ee=localStorage.getItem(K);return ee&&(localStorage.removeItem(K),ee=JSON.parse(ee)),z(),ee}},M.add=function(te){z();const K=U+te.state,ee=JSON.stringify({...te,expires:Date.now()+3600*1e3});try{localStorage.setItem(K,ee)}catch{P(),localStorage.setItem(K,ee)}}},Rr=function(){if(!(this instanceof Rr))return new Rr;var M=this;M.get=function(oe){if(oe){var te=P(U+oe);if(ce(U+oe,"",z(-100)),te)return JSON.parse(te)}},M.add=function(oe){ce(U+oe.state,JSON.stringify(oe),z(60))},M.removeItem=function(oe){ce(oe,"",z(-100))};var z=function(oe){var te=new Date;return te.setTime(te.getTime()+oe*60*1e3),te},P=function(oe){for(var te=oe+"=",K=document.cookie.split(";"),ee=0;ee<K.length;ee++){for(var be=K[ee];be.charAt(0)==" ";)be=be.substring(1);if(be.indexOf(te)==0)return be.substring(te.length,be.length)}return""},ce=function(oe,te,K){var ee=oe+"="+te+"; expires="+K.toUTCString()+"; ";document.cookie=ee}};function qr(){try{return new bt}catch{}return new Rr}function li(M){return function(){h.enableLogging&&M.apply(console,Array.prototype.slice.call(arguments))}}}var keycloak_default=Keycloak;function bytesToBase64(c){const h=String.fromCodePoint(...c);return btoa(h)}async function sha256Digest(c){const h=new TextEncoder().encode(c);if(typeof crypto>"u"||typeof crypto.subtle>"u")throw new Error("Web Crypto API is not available.");return await crypto.subtle.digest("SHA-256",h)}function decodeToken(c){const[h,g]=c.split(".");if(typeof g!="string")throw new Error("Unable to decode token, payload not found.");let E;try{E=base64UrlDecode(g)}catch(S){throw new Error("Unable to decode token, payload is not a valid Base64URL value.",{cause:S})}try{return JSON.parse(E)}catch(S){throw new Error("Unable to decode token, payload is not a valid JSON value.",{cause:S})}}function base64UrlDecode(c){let h=c.replaceAll("-","+").replaceAll("_","/");switch(h.length%4){case 0:break;case 2:h+="==";break;case 3:h+="=";break;default:throw new Error("Input is not of the correct length.")}try{return b64DecodeUnicode(h)}catch{return atob(h)}}function b64DecodeUnicode(c){return decodeURIComponent(atob(c).replace(/(.)/g,(h,g)=>{let E=g.charCodeAt(0).toString(16).toUpperCase();return E.length<2&&(E="0"+E),"%"+E}))}function isObject(c){return typeof c=="object"&&c!==null}init_vue_runtime_esm_bundler();function isArray(c){return Array.isArray(c)}function isFunction(c){return typeof c=="function"}function isNil(c){return c==null}function isString(c){return typeof c=="string"}var state=reactive({keycloak:void 0,isAuthenticated:!1,hasFailed:!1,error:null,isPending:!1,token:"",decodedToken:{},username:"",userId:"",roles:[],resourceRoles:{}}),setKeycloak=c=>{state.keycloak=c},setToken=(c,h)=>{state.token=c;const g=h;state.decodedToken=g,state.roles=g.realm_access?g.realm_access.roles:[],state.username=g.preferred_username,state.userId=g.sub,state.resourceRoles=g.resource_access?Object.fromEntries(Object.entries(g.resource_access).map(([E,S])=>[E,S.roles])):{}},hasFailed=(c,h)=>{state.hasFailed=c,h instanceof Error?state.error=h:isString(h?.error)?state.error=new Error(h.error):isString(h)?state.error=new Error(h):state.error=new Error("Unknown"),state.error.name="[vue-keycloak]",console.error(state.error)},isPending=c=>{state.isPending=c},isAuthenticated=c=>{state.isAuthenticated=c},$keycloak=void 0;async function updateToken(c){try{return await $keycloak.updateToken(c),setToken($keycloak.token,$keycloak.tokenParsed),$keycloak.token}catch(h){const g=isNil(h)?new Error("Failed to refresh the access token"):h;throw hasFailed(!0,g),g}}async function getToken(c=10){return updateToken(c)}function createKeycloak(c){try{$keycloak=new keycloak_default(c),setKeycloak($keycloak)}catch(h){hasFailed(!0,isNil(h)?new Error("Failed to create the keycloak adapter"):h)}return $keycloak}async function initKeycloak(c){try{isPending(!0),isAuthenticated(await $keycloak.init(c)),isNil($keycloak.token)||setToken($keycloak.token,$keycloak.tokenParsed)}catch(h){isAuthenticated(!1),hasFailed(!0,isNil(h)?new Error("Failed to initialize the keycloak adapter"):h)}finally{isPending(!1)}}var useKeycloak=()=>({...toRefs(state),hasRoles:c=>isArray(c)&&state.isAuthenticated&&c.every(h=>state.roles.includes(h)),hasResourceRoles:(c,h)=>isArray(c)&&!isNil(h)&&state.isAuthenticated&&!isNil(state.resourceRoles)&&isArray(state.resourceRoles[h])&&c.every(g=>state.resourceRoles[h].includes(g))}),defaultInitConfig={flow:"standard",checkLoginIframe:!1,onLoad:"login-required"},vueKeycloak={install:async(c,h)=>{if(isNil(h)){hasFailed(!0,new Error("The VueKeycloakPluginConfig is required"));return}let g;if(isFunction(h)?g=await h():g=h,isNil(g.config)){hasFailed(!0,new Error("The KeycloakConfig is required"));return}const E=g.config,S=isNil(g.initOptions)?defaultInitConfig:{...defaultInitConfig,...g.initOptions},R=createKeycloak(E);isNil(R)||(c.config.globalProperties.$keycloak=R,await initKeycloak(S))}};function storeUserDetails(){return new Promise((c,h)=>{if(user.value?.id){c();return}try{const{isAuthenticated:g}=useKeycloak();if(g.value){const{keycloak:E,roles:S,token:R}=useKeycloak();return setUser({...user.value,accessToken:R.value}),E.value?.idTokenParsed&&setUser({...user.value,id:E.value?.idTokenParsed.sub,name:E.value?.idTokenParsed.display_name??E.value?.idTokenParsed?.name,email:E.value?.idTokenParsed?.email,moderator:S.value.includes("nova")}),c()}else refreshToken().then(()=>{g.value=!0,c()})}catch{h(new Error("Not authenticated"))}})}var middlewareConfig={sequential:[storeUserDetails,getLocations_default],parallel:[getServerPermissions_default,getServerSetup_default,getLibraries_default],deferred:[inititalizeAudioPlayer_default,initializeVideoSocket_default,initializeMusicSocket_default]},beforeResolve_default=middlewareConfig;async function handlePromises(c,h){if(Array.isArray(c)){for(const g of c)await g().catch(E=>{throw new Error(E)});h?.();return}if(c.sequential)for(const g of c.sequential)await g().catch(E=>{throw new Error(E)});c.parallel&&await Promise.all(c.parallel.map(g=>g().catch(E=>{throw new Error(E)}))),h?.(),c.deferred&&queueMicrotask(()=>{Promise.all(c.deferred.map(g=>g().catch(console.error)))})}var router=createRouter({history:createWebHistory("/"),routes});router.beforeResolve(async(c,h,g)=>{if(isPlatform("capacitor")&&c.name!=="Auth"&&!user.value.accessToken){const{isAuthenticated:E}=useKeycloak();if(!E.value)return g({name:"Auth"})}if(c.name==="Auth")return g();await handlePromises(beforeResolve_default,g).catch(()=>g({name:"Server offline"}))});beforeEach_default(router);afterEach_default(router);var router_default=router;init_vue_runtime_esm_bundler();var pl=ref([]);const musicPlaylist=computed(()=>pl.value);function setMusicPlaylists(c){pl.value=c}init_dist();init_preload_helper();var Share=registerPlugin("Share",{web:()=>__vitePreload(()=>import("./web-B2HntlSH.js"),[]).then(c=>new c.ShareWeb)});init_vue_runtime_esm_bundler();var getRequest=(c,h)=>serverClient_default().get(c);function putRequest(c,h){return serverClient_default().put(c,{data:h})}function postRequest(c,h){return serverClient_default().post(c,{data:h})}function deleteRequest(c,h){return serverClient_default().delete(c,{data:h})}function patchRequest(c,h){return serverClient_default().patch(c,{data:h})}function makeContextMenu(c){return c.map(h=>{let g;return h.method==="GET"?g=getRequest:h.method==="PUT"?g=putRequest:h.method==="POST"?g=postRequest:h.method==="PATCH"?g=patchRequest:h.method==="DELETE"?g=deleteRequest:g=h.command,{label:h.title,icon:h.icon,confirm:h.confirm,args:h.args,command:()=>g(h.args?.url,contextMenuContext.value).then(()=>{h.args?.replaceKey&&document.dispatchEvent(new CustomEvent("mutateId",{detail:{id:h.args?.replaceKey}}))}).catch(E=>{console.error("Context menu command failed:",E)})}})}const contextMenu=ref({});var cmi=ref();const contextMenuItems=computed(()=>cmi.value);function setContextMenu(c){cmi.value=c}var cmc=ref(null);const contextMenuContext=computed(()=>cmc.value);function setContextMenuContext(c){cmc.value=c}const trackContextMenuItems=ref([]),cardMenu=ref(),selectedTrackRow=ref();function onTrackRowRightClick(c,h,g){selectedTrackRow.value=g;const E=h.path.startsWith("/music/album"),S=h.path.startsWith("/music/artist"),R=h.path.startsWith("/music/playlists"),L=[],k={label:t("Add to playlist"),icon:"mooooom-add",items:[{label:t("New playlist"),icon:"mooooom-add",command:()=>{const C=new CustomEvent("showModal",{detail:{modalName:"createPlaylist",modalTitle:"Add to new playlist",modalProps:selectedTrackRow.value}});document.dispatchEvent(C)}}]};musicPlaylist.value.length===0&&k.items.push({label:t("No playlists")});for(const C of musicPlaylist.value)h.path!==`/music/playlists/${C.id}`&&k.items.push({label:C.name,icon:"mooooom-playlist1Add",args:{disabled:h.path===`/music/playlists/${C.id}`},command:()=>{serverClient_default().post(`/music/playlists/${C.id}/tracks`,{id:selectedTrackRow.value?.id}).then(()=>{queryClient.invalidateQueries({queryKey:["music","tracks"]}).then(()=>{console.log("refetching tracks")})}).catch(x=>{console.error(x)})}});L.push(k),R&&L.push({label:t("Remove from playlist"),icon:"mooooom-remove",command:()=>{serverClient_default().delete(`/music/playlists/${h.params.id}/tracks/${selectedTrackRow.value?.id}`).then(()=>{queryClient.invalidateQueries({queryKey:["music","tracks"]}).then(()=>{console.log("refetching tracks")})}).catch(C=>{console.error(C)})}}),L.push({label:t("Save to your liked songs"),icon:"mooooom-heart",command:async()=>{await serverClient_default().post(`${selectedTrackRow.value?.link}/like`,{value:!selectedTrackRow.value?.liked.value}).then(({data:C})=>{selectedTrackRow.value&&(selectedTrackRow.value.value=C.args?.[0]==="liked"||C.args?.[1]==="liked")})}},{label:t("Add to queue"),icon:"mooooom-currentPlaylist",command:()=>{if(selectedTrackRow.value){if(audioPlayer_default.currentSong===null){console.log("playing track"),audioPlayer_default.playTrack(selectedTrackRow.value);return}console.log("adding track to queue"),audioPlayer_default.addToQueue(selectedTrackRow.value)}}},{separator:!0}),!E&&selectedTrackRow.value?.album_track&&selectedTrackRow.value?.album_track?.length<2?L.push({label:t("Go to album"),icon:"mooooom-disk",command:async()=>{selectedTrackRow.value?.album_track?.[0]?.link&&await router_default.push(selectedTrackRow.value?.album_track?.[0]?.link)}}):!E&&selectedTrackRow.value?.album_track&&selectedTrackRow.value?.album_track?.length>1&&L.push({label:t("Go to album"),icon:"mooooom-disk",items:selectedTrackRow.value?.album_track?.map(C=>({label:C.name,icon:"mooooom-disk",command:async()=>await router_default.push(C.link)}))}),!S&&selectedTrackRow.value?.artist_track&&selectedTrackRow.value?.artist_track?.length<2?L.push({label:t("Go to artist"),icon:"mooooom-user",command:async()=>{selectedTrackRow.value?.artist_track?.[0]?.link&&await router_default.push(selectedTrackRow.value?.artist_track?.[0]?.link)}}):!S&&selectedTrackRow.value?.artist_track&&selectedTrackRow.value?.artist_track?.length>1&&L.push({label:t("Go to artist"),icon:"mooooom-user",items:selectedTrackRow.value?.artist_track?.map(C=>({label:C.name,icon:"mooooom-user",command:async()=>await router_default.push(C.link)}))}),L.push({separator:!0},{label:t("Share"),icon:"mooooom-shareSquare",items:[{label:t("Copy page link"),icon:"mooooom-fileCopy",command:async()=>await copyToClipboard(window.location.href)},{label:t("Copy track link"),icon:"mooooom-fileCopy",command:()=>selectedTrackRow.value?copyToClipboard(`${currentServer.value?.serverBaseUrl}${selectedTrackRow.value?.link}?token=${testUserToken.value}`):{}},{label:t("Share page"),icon:"mooooom-fileCopy",command:async()=>{const C={url:window.location.href};await Share.share(C)}}]}),trackContextMenuItems.value=L,cardMenu.value.show(c)}init_vue_runtime_esm_bundler();var Modal_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"Modal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},title:{type:String,required:!0},params:{type:Object,required:!1},subTitle:{type:String,required:!1},maxWidth:{type:String,required:!1,default:"max-w-xl"},hidden:{type:Boolean,required:!1,default:!1},background:{type:Boolean,required:!1},noClose:{type:Boolean,required:!1,default:!1}},setup(c){const h=c,g=ref(h.open);return watch(h,E=>{g.value=E.open}),watch(g,E=>{E||h.close(new Event("close"))}),(E,S)=>{const R=resolveComponent("ScrollPanel"),L=resolveComponent("Dialog");return openBlock(),createBlock(L,{open:g.value,"onUpdate:open":S[0]||(S[0]=k=>g.value=k),visible:g.value,"onUpdate:visible":S[1]||(S[1]=k=>g.value=k),class:normalizeClass([{[c.maxWidth]:!0,"no-close":c.noClose,"has-background":c.background},"dialog w-available overflow-clip relative isolate"]),header:E.$t(c.title,c.params),as:"dialog",modal:""},{footer:withCtx(()=>[renderSlot(E.$slots,"actions",{class:"z-10 mt-auto"})]),default:withCtx(()=>[createVNode(R,{dt:{bar:{background:"rgb(var(--surface-1) / 60%)"}},class:"w-available h-available"},{default:withCtx(()=>[renderSlot(E.$slots,"default")]),_:3})]),_:3},8,["open","visible","class","header"])}}}),Modal_default=Modal_vue_vue_type_script_setup_true_lang_default,mooooom_icons_default="/assets/mooooom-icons-iAYOXOVr.svg";init_vue_runtime_esm_bundler();var _hoisted_1$7=["xlink:href"],MoooomIcon_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"MoooomIcon",props:{icon:{type:String,required:!0},className:{type:String,required:!1,default:""}},setup(c){const h=c,g=computed(()=>twMerge("w-6 h-auto aspect-square flex-shrink-0 flex pointer-events-none",h.className));return(E,S)=>(openBlock(),createElementBlock("svg",{class:normalizeClass(g.value)},[createBaseVNode("use",{"xlink:href":`${unref(mooooom_icons_default)}#${c.icon}`},null,8,_hoisted_1$7)],2))}}),MoooomIcon_default=MoooomIcon_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var _hoisted_1$6=["id","data-variant","for","inert"],_hoisted_2$5={class:"whitespace-nowrap leading-[100%] empty:hidden"},_hoisted_3$4={key:0,class:"text-left text-xs font-semibold line-clamp-1 sm:text-sm"},_hoisted_4$4={key:1},_hoisted_5$3=["id","data-variant","for","href","inert"],_hoisted_6$2={class:"whitespace-nowrap leading-[100%] empty:hidden"},_hoisted_7$1={key:0,class:"text-left text-xs font-semibold line-clamp-1 sm:text-sm"},_hoisted_8$1={key:1},_hoisted_9=["id","data-variant","disabled","inert"],_hoisted_10={class:"whitespace-nowrap leading-[100%] empty:hidden"},_hoisted_11={key:1},Button_vue_vue_type_script_setup_true_lang_default=defineComponent({inheritAttrs:!1,__name:"Button",props:{id:{type:String,required:!0},variant:{type:String,default:"default",required:!1},size:{type:String,default:"md",required:!1},onClick:{type:Function,required:!1},title:{type:String,default:"",required:!1},color:{type:String,default:"gray",required:!1},htmlFor:{type:String,default:"",required:!1},href:{type:String,default:"",required:!1},disabled:{type:Boolean,default:!1,required:!1},startIcon:{type:String,required:!1},endIcon:{type:String,required:!1},component:{type:String,default:"button",required:!1}},setup(c){const h=c,g=cva("flex justify-center items-center px-4 py-2 gap-2 rounded-lg text-sm select-none w-auto font-semibold leading-[100%]",{variants:{variant:{default:`
					!bg-gradient-to-b dark:!bg-gradient-to-b
					from-[var(--color-6)] to-[var(--color-7)]
					hover:from-[var(--color-5)] hover:to-[var(--color-6)]
					active:from-[var(--color-7)] active:to-[var(--color-8)]
					button-filled text-[var(--color-1)]
					shadow-lg
					shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--surface-2)_r_g_b/60%)_inset,0_6px_10px_-4px_rgba(from_var(--surface-2)_r_g_b/70%)]
					dark:shadow-none active:!shadow-none active:!dark:shadow-none
				`,contained:`
					!bg-gradient-to-b dark:!bg-gradient-to-b
					from-[var(--color-6)] to-[var(--color-7)]
					hover:from-[var(--color-5)] hover:to-[var(--color-6)]
					active:from-[var(--color-7)] active:to-[var(--color-8)]
					button-filled text-[var(--color-1)]
					shadow-lg
					shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--surface-2)_r_g_b/60%)_inset,0_6px_10px_-4px_rgba(from_var(--surface-2)_r_g_b/70%)]
					dark:shadow-none active:!shadow-none active:!dark:shadow-none
				`,text:`
					outline-transparent hover:outline-[rgb(from_var(--color-5)_r_g_b/80%)]
					hover:outline-1 hover:outline text-[rgb(from_var(--background-contrast-12)_r_g_b/80%)]
				`,outlined:`
					text-[var(--color-7)] border-[var(--color-5)] border-2
					focus-visible:border-[var(--color-6)] hover:border-[var(--color-7)]
					hover:bg-[rgba(var(--color-7),.1)]
					shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--surface-2)_r_g_b/60%)_inset,0_6px_10px_-4px_rgba(from_var(--surface-2)_r_g_b/70%)]
					dark:shadow-none active:!shadow-none active:!dark:shadow-none
				`,primary:`
					!bg-gradient-to-b dark:!bg-gradient-to-b
					from-[var(--color-6)] to-[var(--color-7)]
					hover:from-[var(--color-5)] hover:to-[var(--color-6)]
					active:from-[var(--color-7)] active:to-[var(--color-8)]
					button-filled text-[var(--color-1)]
					shadow-lg
					shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--surface-2)_r_g_b/60%)_inset,0_6px_10px_-4px_rgba(from_var(--surface-2)_r_g_b/70%)]
					dark:shadow-none active:!shadow-none active:!dark:shadow-none
				`},size:{sm:"h-8 text-xs px-3",md:"h-9 text-sm px-4",lg:"h-12 text-base px-6"},disabled:{true:"grayscale !cursor-not-allowed",false:""}},defaultVariants:{variant:"default",size:"md",disabled:!1}}),E=useAttrs(),S=computed(()=>{const C=`var(--color-${h.color}-8)`;return{"--color-1":`hsl(from ${C} h s 97%)`,"--color-2":`hsl(from ${C} h s 93%)`,"--color-3":`hsl(from ${C} h s 88%)`,"--color-4":`hsl(from ${C} h s 80%)`,"--color-5":`hsl(from ${C} h s 70%)`,"--color-6":`hsl(from ${C} h s 60%)`,"--color-7":`hsl(from ${C} h s 50%)`,"--color-8":C,"--color-9":`hsl(from ${C} h s 35%)`,"--color-10":`hsl(from ${C} h s 25%)`,"--color-11":`hsl(from ${C} h s 15%)`,"--color-12":`hsl(from ${C} h s 5%)`,...E.style||{}}}),R=computed(()=>E.class||""),L=computed(()=>{const C=/\bh-\d+\b/.test(R.value);return g({variant:h.variant,size:C?void 0:h.size,disabled:h.disabled,className:R.value})}),k=computed(()=>{const{class:C,style:x,...q}=E;return q});return(C,x)=>c.component==="label"?(openBlock(),createElementBlock("label",mergeProps({key:0,id:c.id,class:L.value,"data-variant":c.variant,for:c.htmlFor,inert:c.disabled,style:S.value},k.value,{onClick:x[0]||(x[0]=(...q)=>c.onClick&&c.onClick(...q))}),[c.startIcon?(openBlock(),createBlock(MoooomIcon_default,{key:0,icon:c.startIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0),createBaseVNode("span",_hoisted_2$5,[C.$slots?(openBlock(),createElementBlock("p",_hoisted_3$4,[renderSlot(C.$slots,"default")])):c.title?(openBlock(),createElementBlock("span",_hoisted_4$4,toDisplayString(C.$t(c.title)),1)):createCommentVNode("",!0)]),c.endIcon?(openBlock(),createBlock(MoooomIcon_default,{key:1,icon:c.endIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0)],16,_hoisted_1$6)):c.component==="link"?(openBlock(),createElementBlock("a",mergeProps({key:1,id:c.id,class:L.value,"data-variant":c.variant,for:c.htmlFor,href:c.href,inert:c.disabled,style:S.value},k.value,{onClick:x[1]||(x[1]=(...q)=>c.onClick&&c.onClick(...q))}),[c.startIcon?(openBlock(),createBlock(MoooomIcon_default,{key:0,icon:c.startIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0),createBaseVNode("span",_hoisted_6$2,[C.$slots?(openBlock(),createElementBlock("p",_hoisted_7$1,[renderSlot(C.$slots,"default")])):c.title?(openBlock(),createElementBlock("span",_hoisted_8$1,toDisplayString(C.$t(c.title)),1)):createCommentVNode("",!0)]),c.endIcon?(openBlock(),createBlock(MoooomIcon_default,{key:1,icon:c.endIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0)],16,_hoisted_5$3)):(openBlock(),createElementBlock("button",mergeProps({key:2,id:c.id,class:L.value,"data-variant":c.variant,disabled:c.disabled,inert:c.disabled,style:S.value},k.value,{type:"button",onClick:x[2]||(x[2]=(...q)=>c.onClick&&c.onClick(...q))}),[c.startIcon?(openBlock(),createBlock(MoooomIcon_default,{key:0,icon:c.startIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0),createBaseVNode("span",_hoisted_10,[C.$slots?renderSlot(C.$slots,"default",{key:0}):c.title?(openBlock(),createElementBlock("span",_hoisted_11,toDisplayString(C.$t(c.title)),1)):createCommentVNode("",!0)]),c.endIcon?(openBlock(),createBlock(MoooomIcon_default,{key:1,icon:c.endIcon,class:"w-5"},null,8,["icon"])):createCommentVNode("",!0)],16,_hoisted_9))}}),Button_default=Button_vue_vue_type_script_setup_true_lang_default,__plugin_vue_export_helper_default=(c,h)=>{const g=c.__vccOpts||c;for(const[E,S]of h)g[E]=S;return g};init_vue_runtime_esm_bundler();var _sfc_main={},_hoisted_1$5={class:"",fill:"none",style:{"max-width":"100%",height:"100%"},viewBox:"0 0 50 40",xmlns:"http://www.w3.org/2000/svg"};function _sfc_render(c,h){return openBlock(),createElementBlock("svg",_hoisted_1$5,[...h[0]||(h[0]=[createStaticVNode('<g data-v-093f3362><g data-v-093f3362><path clip-rule="evenodd" d="M19.377 32.271c-1.495 1.01-2.243 1.516-2.864 1.481a1.846 1.846 0 01-1.368-.726c-.376-.495-.376-1.398-.376-3.202V10.176c0-1.804 0-2.707.376-3.202a1.846 1.846 0 011.368-.726c.621-.035 1.369.47 2.864 1.48l14.54 9.824c1.212.82 1.819 1.23 2.031 1.745.185.45.185.956 0 1.406-.212.515-.819.925-2.032 1.745l-14.54 9.823zm23.392-25.81c.68 0 1.231.552 1.231 1.231v24.616c0 .68-.551 1.23-1.23 1.23h-2.924a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23h2.923z" fill="var(--color-logo-back)" fill-rule="evenodd" data-v-093f3362></path><path d="M35.948 19.297l.462-.19-.462.19zm-2.032 3.15l-.28-.414.28.415zm2.032-1.744l.462.19-.462-.19zM15.145 33.026l-.398.302.398-.302zm1.368.726l.028-.499-.028.5zm0-27.504l-.027-.5.027.5zm-2.244 3.928v19.648h1V10.176h-1zm19.927 6.962l-14.54-9.824-.56.829 14.54 9.824.56-.829zm-14.54 15.548l14.54-9.824-.56-.829-14.54 9.824.56.829zM44.5 7.692a1.73 1.73 0 00-1.73-1.73v1a.73.73 0 01.73.73h1zm0 24.616V7.692h-1v24.616h1zm-1.73 1.73a1.73 1.73 0 001.73-1.73h-1a.73.73 0 01-.73.73v1zm-2.924 0h2.923v-1h-2.923v1zm-1.73-1.73c0 .956.774 1.73 1.73 1.73v-1a.73.73 0 01-.73-.73h-1zm0-24.616v24.616h1V7.692h-1zm1.73-1.73a1.73 1.73 0 00-1.73 1.73h1a.73.73 0 01.73-.73v-1zm2.923 0h-2.923v1h2.923v-1zm-9.133 12.005c.615.415 1.047.708 1.355.96.307.25.436.417.495.56l.924-.38c-.153-.372-.434-.667-.786-.955-.352-.287-.83-.61-1.428-1.014l-.56.829zm.56 4.895c.599-.405 1.076-.727 1.428-1.014.352-.288.633-.583.786-.955l-.924-.38c-.06.143-.188.31-.495.56-.308.252-.74.545-1.355.96l.56.829zm1.29-3.374c.135.328.135.696 0 1.025l.924.38a2.346 2.346 0 000-1.786l-.924.38zM14.269 29.824c0 .892 0 1.596.05 2.137.048.536.152 1.004.428 1.367l.796-.605c-.1-.131-.184-.363-.229-.853-.044-.485-.045-1.134-.045-2.046h-1zm4.828 2.033c-.756.51-1.294.874-1.72 1.109-.432.237-.67.296-.836.287l-.055.999c.455.025.9-.15 1.372-.41.476-.262 1.06-.657 1.799-1.156l-.56-.829zm-4.35 1.471a2.346 2.346 0 001.739.924l.055-.999a1.346 1.346 0 01-.998-.53l-.796.605zm.522-23.152c0-.912 0-1.561.045-2.046.045-.49.13-.722.23-.853l-.797-.605c-.276.363-.38.83-.429 1.367-.05.54-.049 1.245-.049 2.137h1zm4.388-2.862c-.74-.5-1.323-.894-1.799-1.156-.471-.26-.917-.435-1.372-.41l.055.999c.165-.01.404.05.835.287.427.235.965.598 1.72 1.109l.56-.829zm-4.114-.037c.24-.315.604-.508.998-.53l-.055-.999a2.346 2.346 0 00-1.74.924l.797.605z" fill="url(#paint0-:rq:)" fill-opacity="0.6" mask="url(#path-1-:rq:)" data-v-093f3362></path><mask id="path-1-:rq:" data-v-093f3362><path clip-rule="evenodd" d="M19.377 32.271c-1.495 1.01-2.243 1.516-2.864 1.481a1.846 1.846 0 01-1.368-.726c-.376-.495-.376-1.398-.376-3.202V10.176c0-1.804 0-2.707.376-3.202a1.846 1.846 0 011.368-.726c.621-.035 1.369.47 2.864 1.48l14.54 9.824c1.212.82 1.819 1.23 2.031 1.745.185.45.185.956 0 1.406-.212.515-.819.925-2.032 1.745l-14.54 9.823zm23.392-25.81c.68 0 1.231.552 1.231 1.231v24.616c0 .68-.551 1.23-1.23 1.23h-2.924a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23h2.923z" fill-rule="evenodd" data-v-093f3362></path></mask></g><g data-v-093f3362><path clip-rule="evenodd" d="M6.88 33.439c-1.226.828-2.88-.05-2.88-1.53V8.091c0-1.48 1.654-2.358 2.88-1.53l17.625 11.91a1.846 1.846 0 010 3.059L6.88 33.439zM32 6.462c.68 0 1.23.55 1.23 1.23v24.616c0 .68-.55 1.23-1.23 1.23h-2.923a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23H32z" fill="var(--color-logo-front)" fill-rule="evenodd" data-v-093f3362></path><path d="M24.505 21.53l-.28-.415.28.415zM3.5 8.09v23.82h1V8.09h-1zm21.285 9.966L7.16 6.146l-.56.83 17.625 11.909.56-.829zM7.16 33.853l17.625-11.909-.56-.829L6.6 33.025l.56.828zm26.57-26.16A1.73 1.73 0 0032 5.961v1a.73.73 0 01.73.73h1zm0 24.615V7.692h-1v24.616h1zM32 34.038a1.73 1.73 0 001.73-1.73h-1a.73.73 0 01-.73.73v1zm-2.923 0H32v-1h-2.923v1zm-1.73-1.73c0 .956.774 1.73 1.73 1.73v-1a.73.73 0 01-.73-.73h-1zm0-24.616v24.616h1V7.692h-1zm1.73-1.73a1.73 1.73 0 00-1.73 1.73h1a.73.73 0 01.73-.73v-1zm2.923 0h-2.923v1H32v-1zm-7.775 12.923c.79.533.79 1.697 0 2.23l.56.829a2.346 2.346 0 000-3.888l-.56.829zM3.5 31.909c0 1.88 2.102 2.997 3.66 1.944l-.56-.828a1.346 1.346 0 01-2.1-1.116h-1zm1-23.818a1.346 1.346 0 012.1-1.116l.56-.828C5.602 5.094 3.5 6.21 3.5 8.09h1z" fill="url(#paint1-:rq:)" fill-opacity="0.6" mask="url(#path-3-:rq:)" data-v-093f3362></path><mask id="path-3-:rq:" data-v-093f3362><path clip-rule="evenodd" d="M6.88 33.439c-1.226.828-2.88-.05-2.88-1.53V8.091c0-1.48 1.654-2.358 2.88-1.53l17.625 11.91a1.846 1.846 0 010 3.059L6.88 33.439zM32 6.462c.68 0 1.23.55 1.23 1.23v24.616c0 .68-.55 1.23-1.23 1.23h-2.923a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23H32z" fill-rule="evenodd" data-v-093f3362></path></mask></g><g data-v-093f3362><path clip-rule="evenodd" d="M19.377 32.271c-1.495 1.01-2.243 1.516-2.864 1.481a1.846 1.846 0 01-1.368-.726c-.376-.495-.376-1.398-.376-3.202V10.176c0-1.804 0-2.707.376-3.202a1.846 1.846 0 011.368-.726c.621-.035 1.369.47 2.864 1.48l14.54 9.824c1.212.82 1.819 1.23 2.031 1.745.185.45.185.956 0 1.406-.212.515-.819.925-2.032 1.745l-14.54 9.823zm23.392-25.81c.68 0 1.231.552 1.231 1.231v24.616c0 .68-.551 1.23-1.23 1.23h-2.924a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23h2.923z" fill="url(#paint2-:rq:)" fill-rule="evenodd" data-v-093f3362></path><path d="M35.948 19.297l.462-.19-.462.19zm-2.032 3.15l-.28-.414.28.415zm2.032-1.744l.462.19-.462-.19zM15.145 33.026l-.398.302.398-.302zm1.368.726l.028-.499-.028.5zm0-27.504l-.027-.5.027.5zm-2.244 3.928v19.648h1V10.176h-1zm19.927 6.962l-14.54-9.824-.56.829 14.54 9.824.56-.829zm-14.54 15.548l14.54-9.824-.56-.829-14.54 9.824.56.829zM44.5 7.692a1.73 1.73 0 00-1.73-1.73v1a.73.73 0 01.73.73h1zm0 24.616V7.692h-1v24.616h1zm-1.73 1.73a1.73 1.73 0 001.73-1.73h-1a.73.73 0 01-.73.73v1zm-2.924 0h2.923v-1h-2.923v1zm-1.73-1.73c0 .956.774 1.73 1.73 1.73v-1a.73.73 0 01-.73-.73h-1zm0-24.616v24.616h1V7.692h-1zm1.73-1.73a1.73 1.73 0 00-1.73 1.73h1a.73.73 0 01.73-.73v-1zm2.923 0h-2.923v1h2.923v-1zm-9.133 12.005c.615.415 1.047.708 1.355.96.307.25.436.417.495.56l.924-.38c-.153-.372-.434-.667-.786-.955-.352-.287-.83-.61-1.428-1.014l-.56.829zm.56 4.895c.599-.405 1.076-.727 1.428-1.014.352-.288.633-.583.786-.955l-.924-.38c-.06.143-.188.31-.495.56-.308.252-.74.545-1.355.96l.56.829zm1.29-3.374c.135.328.135.696 0 1.025l.924.38a2.346 2.346 0 000-1.786l-.924.38zM14.269 29.824c0 .892 0 1.596.05 2.137.048.536.152 1.004.428 1.367l.796-.605c-.1-.131-.184-.363-.229-.853-.044-.485-.045-1.134-.045-2.046h-1zm4.828 2.033c-.756.51-1.294.874-1.72 1.109-.432.237-.67.296-.836.287l-.055.999c.455.025.9-.15 1.372-.41.476-.262 1.06-.657 1.799-1.156l-.56-.829zm-4.35 1.471a2.346 2.346 0 001.739.924l.055-.999a1.346 1.346 0 01-.998-.53l-.796.605zm.522-23.152c0-.912 0-1.561.045-2.046.045-.49.13-.722.23-.853l-.797-.605c-.276.363-.38.83-.429 1.367-.05.54-.049 1.245-.049 2.137h1zm4.388-2.862c-.74-.5-1.323-.894-1.799-1.156-.471-.26-.917-.435-1.372-.41l.055.999c.165-.01.404.05.835.287.427.235.965.598 1.72 1.109l.56-.829zm-4.114-.037c.24-.315.604-.508.998-.53l-.055-.999a2.346 2.346 0 00-1.74.924l.797.605z" fill="url(#paint2-:rq:)" fill-opacity="0.6" mask="url(#path-5-:rq:)" data-v-093f3362></path><mask id="path-5-:rq:" data-v-093f3362><path clip-rule="evenodd" d="M19.377 32.271c-1.495 1.01-2.243 1.516-2.864 1.481a1.846 1.846 0 01-1.368-.726c-.376-.495-.376-1.398-.376-3.202V10.176c0-1.804 0-2.707.376-3.202a1.846 1.846 0 011.368-.726c.621-.035 1.369.47 2.864 1.48l14.54 9.824c1.212.82 1.819 1.23 2.031 1.745.185.45.185.956 0 1.406-.212.515-.819.925-2.032 1.745l-14.54 9.823zm23.392-25.81c.68 0 1.231.552 1.231 1.231v24.616c0 .68-.551 1.23-1.23 1.23h-2.924a1.23 1.23 0 01-1.23-1.23V7.692c0-.68.55-1.23 1.23-1.23h2.923z" fill-rule="evenodd" data-v-093f3362></path></mask></g></g><defs data-v-093f3362><linearGradient id="paint0-:rq:" gradientUnits="userSpaceOnUse" x1="12.615" x2="25.54" y1="4.223" y2="25.247" data-v-093f3362><stop stop-color="#fff" data-v-093f3362></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-093f3362></stop></linearGradient><linearGradient id="paint1-:rq:" gradientUnits="userSpaceOnUse" x1="1.846" x2="14.777" y1="4.218" y2="25.245" data-v-093f3362><stop stop-color="#fff" data-v-093f3362></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-093f3362></stop></linearGradient><linearGradient id="paint2-:rq:" gradientUnits="userSpaceOnUse" x1="29.385" x2="29.385" y1="6.246" y2="33.754" data-v-093f3362><stop stop-color="#fff" stop-opacity="0.4" data-v-093f3362></stop><stop offset="0.5" stop-color="#fff" stop-opacity="0.1" data-v-093f3362></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-093f3362></stop></linearGradient><linearGradient id="paint3-:rq:" gradientUnits="userSpaceOnUse" x1="12.615" x2="23.324" y1="4.223" y2="16.967" data-v-093f3362><stop stop-color="#fff" data-v-093f3362></stop><stop offset="1" stop-color="#fff" stop-opacity="0" data-v-093f3362></stop></linearGradient></defs>',2)])])}var AppLogoSquare_default=__plugin_vue_export_helper_default(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-093f3362"]]);init_vue_runtime_esm_bundler();var _hoisted_1$4={key:0,class:"aspect-square !absolute inset-0 overflow-clip z-10 h-available w-available object-cover"},_hoisted_2$4=["srcset"],_hoisted_3$3=["srcset"],_hoisted_4$3=["srcset"],_hoisted_5$2=["id","alt","data-id","loading","onfocus","onload","src"],CoverImage_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"CoverImage",props:{data:{type:Object,required:!1},className:{type:String,required:!1,default:""},disableGradient:{type:Boolean,required:!1,default:!1},style:{type:Object,required:!1,default:()=>({})},id:{type:String,required:!1,default:""},loading:{type:String,required:!1,default:"lazy"},onload:{type:Function,required:!1},handleFocus:{type:Function,required:!1},size:{type:Number,required:!1,default:500},imageRef:{type:Object,required:!1,default:null}},setup(c){const h=c,g=ref(null);function E(){if(!h.data?.cover){g.value=null;return}const C=location.hostname.includes("dev")?"-dev":"";if(h.data?.cover?.startsWith("blob:")){g.value=h.data?.cover;return}if(h.data?.cover?.startsWith("data:")){g.value=h.data?.cover;return}if(h.data?.cover?.startsWith("https://")&&h.data?.cover?.includes("fanart.tv")){g.value=h.data?.cover?.replace("https://",`https://api${C}.nomercy.tv/cors?url=https://`)?.replace("https://",`https://api${C}.nomercy.tv/cors?url=https://`);return}if(h.data?.cover?.startsWith("https://")){g.value=h.data?.cover;return}if(h.data?.cover?.startsWith("/")){g.value=encodeURI(`${currentServer.value?.serverBaseUrl.replace(/\/$/,"")}${h.data?.cover}`);return}g.value=null}onMounted(()=>{E()}),watch(h,()=>{E()});const S=ref(!1);function R(C){}function L(){}function k(C,x){return h.data?.cover?.startsWith("blob:")||h.data?.cover?.startsWith("data:")?"":`?width=${x}&type=${C} 1x`}return(C,x)=>c.data?.cover&&!S.value?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass([c.className,"aspect-square relative z-0 overflow-clip"]),style:normalizeStyle({backgroundImage:`
            radial-gradient(
                farthest-corner at top left,
                    ${c.data.color_palette?.cover?.lightVibrant},
                    hsl(0 0% 100% / 4%) 300px
                ),
                radial-gradient(
                    farthest-corner at top right,
                    ${c.data.color_palette?.cover?.lightMuted},
                    hsl(0 0% 100% / 4%) 300px
                ),
                radial-gradient(
                    farthest-corner at bottom left,
                    ${c.data.color_palette?.cover?.primary},
                    hsl(0 0% 100% / 4%)
                ),
                radial-gradient(
                    farthest-corner at bottom right,
                    ${c.data.color_palette?.cover?.darkMuted},
                hsl(0 0% 100% / 4%) 300px
            )`,...c.style})},[g.value?(openBlock(),createElementBlock("picture",_hoisted_1$4,[createBaseVNode("source",{srcset:`${g.value}${k("avif",c.size??500)}`,type:"image/avif"},null,8,_hoisted_2$4),createBaseVNode("source",{srcset:`${g.value}${k("webp",c.size??500)}`,crossorigin:"anonymous",type:"image/webp"},null,8,_hoisted_3$3),createBaseVNode("source",{srcset:`${g.value}${k("jpeg",c.size??500)}`,crossorigin:"anonymous",type:"image/jpeg"},null,8,_hoisted_4$3),createBaseVNode("img",{id:c.id,ref:c.imageRef,alt:`cover image for ${c.data.name??"image"}`,"data-id":c.data?.id,loading:c.loading,onclick:L,onerror:R,onfocus:c.handleFocus,onload:c.onload,src:`${g.value}`,class:"aspect-square !absolute inset-0 overflow-clip z-10 h-available w-available object-cover",crossorigin:"anonymous",tabindex:"-1"},null,8,_hoisted_5$2)])):(openBlock(),createBlock(AppLogoSquare_default,{key:1,class:normalizeClass(unref(twMerge)("z-0 overflow-clip bg-black p-[15%] h-full w-full",c.className))},null,8,["class"]))],6)):(openBlock(),createBlock(AppLogoSquare_default,{key:1,class:normalizeClass(unref(twMerge)("z-0 overflow-clip bg-black h-full w-full aspect-square relative p-4",c.className))},null,8,["class"]))}}),CoverImage_default=CoverImage_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var _hoisted_1$3={class:"relative"},_hoisted_2$3={class:"min-w-[286px] aspect-square flex items-center justify-center flex-col"},ImageDrop_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"ImageDrop",props:{data:{type:Object,required:!0}},emits:["onImage"],setup(c,{emit:h}){const g=c,E=h,S=ref(),R=ref(),L=ref(null),k=ref(null),C=ref(!0);function x(ue){const ge=ue.files[0],ae=new FileReader;ae.onload=async Se=>{L.value=Se.target?.result,E("onImage",Se.target?.result)},ae.readAsDataURL(ge),k.value=ge,C.value=!1}function q(){C.value=!0}function X(){C.value=!0}function ie(){S.value.clear(),k.value=null,L.value=null}onBeforeMount(async()=>{if(g.data?.cover==null)return;const ue=new FileReader;ue.onload=async ae=>{L.value=ae.target?.result,k.value=ae.target?.result,E("onImage",ae.target?.result),C.value=!1};const ge=await fetch(`${currentServer.value?.serverBaseUrl.replace(/\/$/,"")}${g.data?.cover}`).then(ae=>ae.blob());ue.readAsDataURL(ge)});const se=computed(()=>k.value?.objectURL?.split("?")?.at(0)??k.value?.split("?")?.at(0)??"");return(ue,ge)=>(openBlock(),createElementBlock("div",_hoisted_1$3,[createVNode(unref(script$2),{id:"imageDrop",ref_key:"fileUpload",ref:S,class:"p-button-outlined relative",mode:"basic",onRemove:X,onSelect:x,onUpload:q},createSlots({_:2},[se.value?{name:"chooseicon",fn:withCtx(()=>[renderSlot(ue.$slots,"default",{ref:R.value,data:{cover:se.value}})]),key:"1"}:{name:"chooseicon",fn:withCtx(()=>[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("span",null,toDisplayString(ue.$t("Drag and drop files to here to upload.")),1)])]),key:"0"}]),1536),C.value?createCommentVNode("",!0):(openBlock(),createBlock(Button_default,{key:0,id:"clear",class:"absolute top-2 right-2 z-50 !px-2",color:"slate","end-icon":"trash",title:"Remove Image",variant:"default",onClick:ie}))]))}}),ImageDrop_default=ImageDrop_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var _hoisted_1$2={class:"flex gap-4 -mb-5 p-1"},_hoisted_2$2={class:"flex flex-col gap-4 group/cover rounded-lg overflow-clip"},_hoisted_3$2={class:"opacity-0 duration-150 transition-all group-hover/cover:opacity-100 group-hover/cover:bg-black/40 inset-0 absolute grid items-center text-lg font-semibold"},_hoisted_4$2={class:"flex flex-col gap-6 w-full"},_hoisted_5$1={class:"flex flex-col gap-2"},_hoisted_6$1={for:"title"},_hoisted_7={class:"flex flex-col gap-2"},_hoisted_8={for:"description"},CreatePlaylistModal_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"CreatePlaylistModal",props:{data:{type:Object,required:!0},onClose:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(c){const h=c,g=useToast(),E=ref(h.data?.modalProps?.name?.trim()===""),S=ref(h.data?.modalProps?.name??""),R=ref(h.data?.modalProps?.description??""),L=ref(h.data?.modalProps?.cover??null);function k(x){L.value=x}function C(){h.data?.modalProps?.name==null?serverClient_default().post("music/playlists",{name:S.value,description:R.value,cover:L.value,tracks:[h.data?.modalProps.id]}).then(({data:x})=>{queryClient.invalidateQueries({queryKey:["music-playlists"]}),g.add({severity:"info",summary:"Success",detail:"Image Uploaded",life:3e3}),h.onClose()}).catch(x=>{g.add({severity:"error",summary:"Failed to create playlist",detail:x.message,life:3e3})}):serverClient_default().patch(h.data?.modalProps.link,{name:S.value,description:R.value,cover:L.value}).then(({data:x})=>{queryClient.invalidateQueries({queryKey:["music-playlists"]}),g.add({severity:"info",summary:"Success",detail:"Playlist Updated",life:3e3}),h.onClose()}).catch(x=>{g.add({severity:"error",summary:"Failed to update playlist",detail:x.message,life:3e3})})}return watch(S,x=>{E.value=x.trim()===""}),(x,q)=>{const X=resolveComponent("InputText"),ie=resolveComponent("Textarea");return openBlock(),createBlock(Modal_default,{close:h.onClose,open:!0,params:c.data.modalTitleArgs,title:c.data.modalTitle,"max-width":"max-w-3xl"},{actions:withCtx(()=>[createVNode(Button_default,{id:"delete",color:"red",variant:"contained",onClick:h.onDelete},{default:withCtx(()=>[createTextVNode(toDisplayString(x.$t("Delete playlist")),1)]),_:1},8,["onClick"]),createVNode(Button_default,{id:"upload",class:"ml-auto",color:"white",variant:"text",onClick:h.onClose},{default:withCtx(()=>[createTextVNode(toDisplayString(x.$t("Cancel")),1)]),_:1},8,["onClick"]),createVNode(Button_default,{id:"upload",disabled:E.value,color:"theme","end-icon":"floppyDisk",onClick:C},{default:withCtx(()=>[createTextVNode(toDisplayString(x.$t("Save")),1)]),_:1},8,["disabled"])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[c.data.modalProps?(openBlock(),createBlock(ImageDrop_default,{key:0,data:c.data.modalProps,onOnImage:k},{default:withCtx(({data:se,ref:ue})=>[se?.cover?(openBlock(),createBlock(CoverImage_default,{key:0,id:"image",data:se,"img-ref":ue,size:250,"class-name":"aspect-square min-w-72",loading:"eager"},null,8,["data","img-ref"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_3$2,toDisplayString(x.$t("Drag and drop files to here to upload.")),1)]),_:1},8,["data"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$1,[createBaseVNode("label",_hoisted_6$1,toDisplayString(x.$t("Title")),1),createVNode(X,{id:"title",modelValue:S.value,"onUpdate:modelValue":q[0]||(q[0]=se=>S.value=se),class:"w-full mt-0.5",name:"","no-ring":"",required:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_7,[createBaseVNode("label",_hoisted_8,toDisplayString(x.$t("Description")),1),createVNode(ie,{id:"description",modelValue:R.value,"onUpdate:modelValue":q[1]||(q[1]=se=>R.value=se),placeholder:x.$t("Add an optional description"),class:"w-full scrollbar-thin",name:"","no-ring":"",rows:"6"},null,8,["modelValue","placeholder"])])])])]),_:1},8,["close","params","title"])}}}),CreatePlaylistModal_default=CreatePlaylistModal_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var sim=ref(!1);const showImageModal=computed(()=>sim.value);function setImageModalOpen(c){sim.value=c}var sss=ref(!1);const showScreensaver=computed(()=>sss.value);function setShowScreensaver(c){sss.value=c}var dss=ref(!1);const disableScreensaver=computed(()=>dss.value);function setDisableScreensaver(c){dss.value=c}var imd=ref();const imageModalData=computed(()=>imd.value);function setImageModalData(c){imd.value=c}var ct=ref();const currentType=computed(()=>ct.value);function setCurrentType(c){ct.value=c}var ni=ref(0);const newIndex=computed(()=>ni.value);function setNewIndex(c){ni.value=c}var tmp=ref(null);const temp=computed(()=>tmp.value);function setTemp(c){tmp.value=c}const imageModal=ref();watch([sim,sss],async([c,h])=>{(c||h)&&!dss.value?(document.querySelector("#imageModal")?.showModal(),document.activeElement.blur()):document.querySelector("#imageModal")?.close()});init_vue_runtime_esm_bundler();var _hoisted_1$1={key:0,class:"absolute inset-0 h-available w-available bg-black/30 dark:bg-black/50 shadow"},_hoisted_2$1=["srcset"],_hoisted_3$1=["alt","fetchpriority","height","loading","src","width"],_hoisted_4$1={class:"w-available h-available inset-0 grid place-items-center place-center bg-[rgb(from_var(--color-logo-dark)_r_g_b/20%)]"},TMDBImage_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"TMDBImage",props:{path:{type:String,required:!1},colorPalette:{type:Object,required:!1},title:{type:String,required:!1},className:{type:String,required:!1},size:{type:Number,required:!1},aspect:{type:String,required:!1},type:{type:String,required:!1,default:"image"},autoShadow:{type:Boolean,required:!1,default:!1},loading:{type:String,required:!1,default:"lazy"},priority:{type:String,required:!1,default:"low"},onload:{type:Function,required:!1}},setup(c){const h=c,g=ref(0),E=ref(!1),S=typeof window<"u"?window.devicePixelRatio:1,R=computed(()=>{if(!h.size)return null;const ge=S>1.5?2:1;return h.size*ge}),L=computed(()=>{if(!(!h.path||!currentServer.value))return`https://app.nomercy.tv/tmdb-images${h.path}?width=${R.value}&format=webp`}),k=computed(()=>{if(h.path)return`https://media.themoviedb.org/t/p/${getCommonSize(h?.size??"original")}${h.path}`});computed(()=>isDarkMode.value?0:20);const C=computed(()=>({"--c-1":"var(--color-theme-8)","--c-2":"rgb(from var(--color-theme-8) r g b / 3%)","--c-3":"rgb(from var(--color-theme-8) r g b / 14%)","--c-4":"rgb(from var(--color-theme-8) r g b / 1%)",backgroundImage:h.type==="logo"||!useAutoThemeColors?h.type==="logo"?"":`
                    radial-gradient(
                        farthest-corner at top left,
                                var(--color-theme-9),
                                hsl(0 0% 100% / 4%) 300px
                            ),
                            radial-gradient(
                                farthest-corner at top right,
                                var(--color-theme-2),
                                hsl(0 0% 100% / 4%) 300px
                            ),
                            radial-gradient(
                                farthest-corner at bottom left,
                                var(--color-theme-6),
                                hsl(0 0% 100% / 4%)
                            ),
                            radial-gradient(
                                farthest-corner at bottom right,
                                var(--color-theme-12),
                        hsl(0 0% 100% / 4%) 300px
                    )
                `:`
				radial-gradient(
					farthest-corner at top left,
							${h.colorPalette?.lightVibrant??"var(--c-1)"},
							hsl(0 0% 100% / 4%) 300px
						),
						radial-gradient(
							farthest-corner at top right,
							${h.colorPalette?.dominant??"var(--c-2)"},
							hsl(0 0% 100% / 4%) 300px
						),
						radial-gradient(
							farthest-corner at bottom left,
							${h.colorPalette?.darkVibrant??"var(--c-3)"},
							hsl(0 0% 100% / 4%)
						),
						radial-gradient(
							farthest-corner at bottom right,
							${h.colorPalette?.dominant??"var(--c-4)"},
					hsl(0 0% 100% / 4%) 300px
				)
			`})),x=computed(()=>h.aspect==="poster"?3/2:h.aspect==="backdrop"?9/16:null),q=computed(()=>h.aspect==="poster"||h.aspect==="backdrop"?"w-available":"w-auto"),X=computed(()=>!h.size||!x.value?0:h.size*x.value);watch(L,ge=>{ge&&(E.value=!1)});function ie(ge){g.value=1,h.onload?.(ge)}function se(){g.value=0}function ue(ge){ge.target.onerror=null,E.value=!0,g.value=1}return(ge,ae)=>(openBlock(),createElementBlock("div",{class:normalizeClass([{"aspect-poster":c.aspect==="poster","aspect-backdrop":c.aspect==="backdrop"},"pointer-events-none bottom-0 mx-auto flex select-none place-self-start max-w-available w-available h-available"]),style:normalizeStyle(C.value)},[g.value===0&&c.type==="image"?(openBlock(),createElementBlock("div",_hoisted_1$1)):createCommentVNode("",!0),!E.value&&c.path&&!c.path?.includes?.("undefined")?(openBlock(),createElementBlock("picture",{key:1,style:normalizeStyle(`opacity: ${g.value}; float: ${c.type==="logo"?"right":""}`),class:"pointer-events-none absolute inset-0 h-full flex select-none flex-col items-start justify-start tv:justify-start self-end transition-all duration-500"},[createBaseVNode("source",{srcset:L.value,type:"image/webp"},null,8,_hoisted_2$1),createBaseVNode("img",{alt:`tmdb image for ${c.title??"image"}`,class:normalizeClass([{"aspect-poster w-available min-w-available h-available":c.aspect==="poster","aspect-backdrop w-auto h-available":c.aspect==="backdrop","w-auto !h-inherit":c.aspect===null,"object-fit w-auto h-available":c.type==="logo","object-cover object-top":c.type==="image",[`${q.value}`]:!0,[`${c.className}`]:!0},"pointer-events-auto bg-bottom transition-all duration-500"]),fetchpriority:c.priority,height:X.value,loading:c.loading==="eager"?"eager":"lazy",onerror:ue,onload:ie,onloadstart:se,src:k.value,style:normalizeStyle(`
					float: ${c.type==="logo"?"right":""};
					object-position: top center;
				`),width:c.size,crossorigin:"anonymous"},null,14,_hoisted_3$1)],4)):c.type==="image"?(openBlock(),createElementBlock("div",{key:2,class:normalizeClass([c.type==="image"?"bg-surface-1":"","inset-0 grid aspect-video h-available w-available place-items-center place-center"])},[createBaseVNode("div",_hoisted_4$1,[createVNode(AppLogoSquare_default,{class:"h-auto w-3/5 max-h-[60%] -translate-y-[5%]"})])],2)):createCommentVNode("",!0)],6))}}),TMDBImage_default=TMDBImage_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var _hoisted_1=["src"],_hoisted_2={class:"absolute left-0 z-0 bottom-0 sm:p-4 sm:bottom-6 sm:left-8 tv:bottom-2 tv:left-6 transform-gpu"},_hoisted_3={class:"flex h-inherit w-full select-none items-start justify-start bg-cover min-h-20 max-h-20 sm:min-h-[20vh] sm:max-h-[20vh] min-w-[30vw] max-w-[30vw] transform-gpu"},_hoisted_4={"aria-hidden":"true",class:"z-0 flex h-10 w-10 items-center justify-center min-w-[2.5rem] min-h-[2.5rem]","data-state":"closed",style:{opacity:"0.3"},tabindex:"-1"},_hoisted_5={"aria-hidden":"true",class:"z-0 flex h-10 w-10 items-center justify-center transitioning min-w-[2.5rem] min-h-[2.5rem]","data-state":"closed",style:{opacity:"0.3"},tabindex:"-1"},_hoisted_6={class:"absolute right-6 bottom-3 z-0 tv:h-12 h-20 tv:w-12 w-20 tv:right-3.5"},WallpaperStyle=function(c){return c[c.Fill=0]="Fill",c[c.Fit=1]="Fit",c[c.Stretch=2]="Stretch",c[c.Tile=3]="Tile",c[c.Center=4]="Center",c[c.Span=5]="Span",c}(WallpaperStyle||{}),ImageModal_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"ImageModal",setup(c){const h=ref(!1),g=ref(),E=ref(),S=ref(1),R=ref(),L=ref(),k=ref(),C=ref(),x=ref(),q=ref(WallpaperStyle.Fill),X=computed(()=>"https://app.nomercy.tv/tmdb-images"),ie=computed(()=>showScreensaver.value?2400:400);function se(){setImageModalOpen(!1),setImageModalData(void 0),g.value=null}function ue(){clearTimeout(k.value),k.value=setTimeout(()=>{document.querySelector("#imageModal")?.classList.add("allchildren:cursor-none"),h.value=!0},2e3),h.value=!1,document.querySelector("#imageModal")?.classList.remove("allchildren:cursor-none")}function ge(){setTimeout(()=>{L.value&&(L.value.style.opacity="0")},ie.value)}function ae(we){se(),we.stopPropagation(),we.preventDefault(),cardMenu.value.hide(we)}function Se(){serverClient_default().post("dashboard/server/wallpaper",{path:imageModalData.value?.src,color:R.value?R.value:imageModalData.value?.color_palette?.image?.darkVibrant??"",style:q.value})}async function xe(we,ht){let Pe;try{const Ee=await axios_default.get(we,{responseType:"blob"}),Ne=new Blob([Ee.data]);Pe=URL.createObjectURL(Ne);const ne=document.createElement("a");ne.href=Pe,ne.download=ht,ne.click()}catch(Ee){console.error(Ee)}}async function $e(we){try{const ht=await fetch(we);if(!ht.ok)throw new Error("Failed to fetch the image");const Pe=await ht.blob(),Ee=new window.ClipboardItem({[Pe.type]:new Promise(Ne=>Ne(Pe))});await navigator.clipboard.write([Ee]),console.log("Image copied to clipboard successfully!")}catch(ht){console.error("Failed to copy image to clipboard:",ht)}}function nt(we){we.preventDefault(),we.stopPropagation(),trackContextMenuItems.value=[{label:"Save image as...",icon:"mooooom-download",command:()=>{xe(imageModalData.value?.src??"",imageModalData.value?.src??"image")}},{label:"Copy image",icon:"mooooom-fileCopy",command:()=>{$e(g.value??"")}},{label:"Open image in new tab",icon:"mooooom-bookOpenBookmark",command:()=>{window.open(g.value??"")}},{label:"Set as desktop wallpaper (Windows only)",icon:"mooooom-monitor",items:[{label:"Fill",icon:"mooooom-monitor",command:()=>{q.value=WallpaperStyle.Fill,Se()}},{label:"Fit",icon:"mooooom-monitor",command:()=>{q.value=WallpaperStyle.Fit,Se()}},{label:"Stretch",icon:"mooooom-monitor",command:()=>{q.value=WallpaperStyle.Stretch,Se()}},{label:"Center",icon:"mooooom-monitor",command:()=>{q.value=WallpaperStyle.Center,Se()}},{label:"Span",icon:"mooooom-monitor",command:()=>{q.value=WallpaperStyle.Span,Se()}}]}],cardMenu.value.show(we)}return watch(showImageModal,we=>{we?window.addEventListener("mousemove",ue):(window.removeEventListener("mousemove",ue),clearTimeout(k.value))}),onBeforeUnmount(()=>{clearTimeout(k.value),clearTimeout(C.value),clearTimeout(x.value)}),watch(imageModalData,async we=>{L?.value?.style&&(L.value.style.opacity="1"),we&&(g.value===null&&we.src?(g.value=`${X.value}${we.src}?width=3840`,R.value=pickPaletteColor(we.color_palette?.image),C.value=setTimeout(()=>{ge(),E.value=void 0,setTimeout(()=>{E.value=we.meta?.logo?.src,S.value=we.meta?.logo?.aspectRatio||1},4e3)},ie.value)):we.src&&(C.value=setTimeout(()=>{ge(),g.value=`${X.value}${we.src}?width=3840`,R.value=pickPaletteColor(we.color_palette?.image),E.value=void 0,setTimeout(()=>{E.value=`${we.meta?.logo?.src}?width=3840`,S.value=we.meta?.logo?.aspectRatio||1},4e3)},ie.value)))}),(we,ht)=>(openBlock(),createBlock(unref($),null,{default:withCtx(()=>[createBaseVNode("dialog",{id:"imageModal",ref:"imageModal",style:normalizeStyle(R.value?`--color-theme-8: ${R.value};`:""),class:"fixed inset-0 w-screen h-screen z-[999999999] bg-surface-4 dark:bg-surface-9 m-0 max-w-screen max-h-screen overflow-clip transform-gpu"},[(unref(showImageModal)||unref(showScreensaver))&&!unref(disableScreensaver)?(openBlock(),createElementBlock("div",{key:0,ref_key:"overlayRef",ref:L,style:normalizeStyle(`--delay: ${unref(showScreensaver)?"2400ms":"400ms"}`),class:"pointer-events-none fixed inset-0 bg-black w-available h-available z-999 transitioning-slower transform-gpu"},null,4)):createCommentVNode("",!0),createBaseVNode("div",{class:"absolute inset-0 z-0 h-screen w-screen items-center border-solid border-black bg-black p-8 text-center left-50 border-1 transitioning-slower transform-gpu",onClick:ae},[createBaseVNode("img",{src:g.value??"",alt:"",class:"h-0 w-0 opacity-0",onLoad:ge},null,40,_hoisted_1),createBaseVNode("div",{style:normalizeStyle(`background-image: url(${g.value});`),class:"absolute z-0 bg-center opacity-75 -inset-[50vh] w-[200vw] h-[400vh] bg-blur transform-gpu"},null,4),createBaseVNode("button",{class:normalizeClass([!h.value&&!unref(showScreensaver)?"flex":"hidden","absolute flex transitioning top-8 right-8 w-10 min-w-[2.5rem] h-10 min-h-[2.5rem] z-0 items-center justify-center disabled:opacity-50 disabled:text-surface-3 disabled:hover:!bg-transparent rounded-full overflow-clip hover:bg-transparent focus-visible:bg-transparent active:bg-transparent sm:focus-visible:bg-surface-4/80 sm:hover:bg-surface-4/80 pointer-events-auto"]),"aria-hidden":"true",tabindex:"-1",onClick:se},[createVNode(MoooomIcon_default,{class:"h-5 w-5",icon:"cross"})],2),createVNode(unref(script),{ref_key:"cardMenu",ref:cardMenu,model:unref(trackContextMenuItems),class:"!z-[999999999999999999999]"},null,8,["model"]),createBaseVNode("div",{style:normalizeStyle(`background-image: url(${g.value}); aspect-ratio: ${unref(imageModalData)?.aspectRatio}`),class:"absolute inset-2 tv:inset-2 z-0 m-auto h-auto overflow-clip rounded-xl bg-cover bg-center bg-no-repeat opacity-90 shadow-img max-w-[82vw] max-h-[83vh] bg-image-blur md:inset-16 transform-gpu",onContextmenu:ht[0]||(ht[0]=Pe=>nt(Pe))},null,36),createBaseVNode("div",{style:normalizeStyle(`background-image: url(${g.value}); aspect-ratio: ${unref(imageModalData)?.aspectRatio}; box-shadow: 0 0 800px 80px rgba(0,0,0,.2) inset;`),class:"absolute inset-2 tv:inset-20 z-0 m-auto h-auto overflow-clip rounded-xl bg-cover bg-center bg-no-repeat shadow-img max-w-[82vw] max-h-[83vh] md:inset-24 pointer-events-none transform-gpu",onContextmenu:ht[1]||(ht[1]=Pe=>nt(Pe))},[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[E.value?(openBlock(),createBlock(TMDBImage_default,{key:E.value,"auto-shadow":!0,path:E.value,shadow:R.value,size:500,class:"object-contain h-available object-[0_0%] !duration-700 children:!duration-700 transform-gpu","class-name":"relative self-start px-4 py-4 !items-start",type:"logo"},null,8,["path","shadow"])):createCommentVNode("",!0)])])],36),createBaseVNode("div",{class:normalizeClass([h.value&&!unref(showScreensaver)?"flex":"hidden","absolute bottom-6 mx-auto -ml-8 flex w-full justify-center gap-8 text-crimson-11"])},[createBaseVNode("button",_hoisted_4,[createVNode(MoooomIcon_default,{class:"h-8 w-8/10",icon:"arrowLeft"})]),createBaseVNode("button",_hoisted_5,[createVNode(MoooomIcon_default,{class:"h-8 w-8/10",icon:"arrowRight"})])],2),createBaseVNode("div",_hoisted_6,[createVNode(AppLogoSquare_default,{class:""})])])],4)]),_:1}))}}),ImageModal_default=ImageModal_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();var App_vue_vue_type_script_setup_true_lang_default=defineComponent({__name:"App",setup(c){const h=useToast(),g=useId();cardMenu.value,contextMenu.value;function E(C){h.add({severity:C.severity,summary:C.summary,detail:C.detail,life:C.life})}onMounted(async()=>{document.addEventListener("toast",C=>{E(C.detail)})});const S=ref(null);function R(C,x){C==="createPlaylist"&&(S.value=x)}function L(){S.value=null}function k(){S.value&&serverClient_default().delete(`music/playlists/${S.value?.modalProps?.id}`).then(({data:C})=>{queryClient.invalidateQueries({queryKey:["music-playlists"]}),h.add({severity:"info",summary:"Success",detail:"Playlist Deleted",life:3e3}),L()}).catch(C=>{h.add({severity:"error",summary:"Failed to create playlist",detail:C.message,life:3e3})})}return useEventListener(document,"showModal",C=>{const x=C;R(x.detail.modalName,x.detail)}),(C,x)=>{const q=resolveComponent("Toast");return openBlock(),createBlock(unref(IonApp),null,{default:withCtx(()=>[createVNode(unref(IonRouterOutlet),{animations:"false"}),createVNode(q,{class:"z-1199"}),S.value?(openBlock(),createBlock(CreatePlaylistModal_default,{key:unref(g),data:S.value,"on-close":L,"on-delete":k},null,8,["data"])):createCommentVNode("",!0),createVNode(unref(script),{ref_key:"cardMenu",ref:cardMenu,model:unref(trackContextMenuItems)},null,8,["model"]),(openBlock(),createBlock(Suspense,null,{default:withCtx(()=>[createVNode(ImageModal_default)]),_:1})),createVNode(unref(script$1)),createVNode(unref(script),{ref_key:"contextMenu",ref:contextMenu,model:unref(contextMenuItems)},null,8,["model"])]),_:1})}}}),App_default=App_vue_vue_type_script_setup_true_lang_default;init_vue_runtime_esm_bundler();init_preload_helper();setupChunkErrorRecovery();if("serviceWorker"in navigator){let c=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{c||(c=!0,window.location.reload())})}var lazyImports={App:()=>__vitePreload(()=>import("./esm-B_9M_EjO.js"),__vite__mapDeps([97,1,2])),router:()=>__vitePreload(()=>import("./router-CpaYH2tE.js"),__vite__mapDeps([98,1,2,3,4,5,7])),deviceInfo:()=>__vitePreload(()=>import("./deviceInfo-7OX-7MwJ.js"),__vite__mapDeps([99,1,2,3,4,5])),utils:()=>__vitePreload(()=>import("./utils-CD8_BsI7.js"),__vite__mapDeps([100,1,2,3,4,5])),user:()=>__vitePreload(()=>import("./user-BGp2frU-.js"),__vite__mapDeps([101,1,2])),routeState:()=>__vitePreload(()=>import("./routeState-BHfsUTzP.js"),__vite__mapDeps([102,1,2,3,4,5,7])),preloadService:()=>__vitePreload(()=>import("./PreloadService-B-1jbWNC.js"),__vite__mapDeps([103,1,2]))},app=createApp(App_default);lazyImports.deviceInfo().then();lazyImports.preloadService().then(({preloadService:c})=>c.init());async function setupApplication(){const{setupApp:c}=await __vitePreload(async()=>{const{setupApp:h}=await import("./setupApp-CNe524co.js");return{setupApp:h}},__vite__mapDeps([104,1,2,3,4,5,6,7,28,35,105]));return c(app)}async function initializeWebApp(){const{redirectUrl:c}=await lazyImports.routeState();if(c.value=window.location.pathname,!isPlatform("capacitor")&&!location.search.includes("refreshToken")){const[h,g,{setUserFromWebKeycloak:E}]=await Promise.all([__vitePreload(()=>import("./dist-CwT09umP.js"),__vite__mapDeps([106,1,2])),__vitePreload(()=>import("./config-BcjZmlRC.js"),[]),lazyImports.user()]);app.use(h.vueKeycloak,{initOptions:{onLoad:"login-required",checkLoginIframe:!1,enableLogging:!0,responseMode:"query",redirectUri:`${window.location.href||"#/"}${window.location.hash.includes("?")?"":"?"}`},config:g.keycloakConfig});const S=h.useKeycloak();watch(S.decodedToken,async()=>{E(S),await setupApplication();const{checkAndApplyPendingUpdate:R}=await __vitePreload(async()=>{const{checkAndApplyPendingUpdate:L}=await import("./updateState-CMA_0NzW.js");return{checkAndApplyPendingUpdate:L}},[]);R()})}}runCacheMigration().then(async()=>{try{const{checkForUpdates:c}=await __vitePreload(async()=>{const{checkForUpdates:h}=await import("./versionCheck-CijlhitS.js");return{checkForUpdates:h}},__vite__mapDeps([107,1,2,108,109]));if(await c())return}catch{}initializeWebApp()});export{equalizerMenuOpen as $,setOverlayCarouselButtons as $i,convertToHumanReact as $n,breakDescription as $r,scrollCenter as $t,getToken as A,useLocalStorage as Aa,clearLibraries as Ai,isSearchRoute as An,objectsEqual as Ar,musicSocketConnection as At,videoSocketConnection as B,isMobile as Bi,setBackground as Bn,sort_updated_asc as Br,setDeviceName as Bt,makeContextMenu as C,onClickOutside as Ca,suffix as Ci,isHomeRoute as Cn,byObjectValues as Cr,setHasLyrics as Ct,Share as D,useEventListener as Da,SortOrder as Di,isPlaylistRoute as Dn,find_most as Dr,toggleLyricsMenuOpen as Dt,setContextMenuContext as E,useCycleList as Ea,SizeState as Ei,isMusicSearchRoute as En,distinct as Er,toggleEqualizerMenuOpen as Et,SocketClient_default as F,tryOnScopeDispose as Fa,dashboardCardGrid as Fi,background as Fn,sortByPosterAlphabetized as Fr,clientInfo as Ft,connectedMusicDevices as G,queryClient as Gi,setSortType as Gn,uniqueBy as Gr,enableImmersiveMode as Gt,audioPlayer_default as H,media_types as Hi,setLogo as Hn,trackSort as Hr,ClickEventHandler as Ht,connect as I,useToggle as Ia,dashboardColumnGrid as Ii,colorPalette as In,sortByPriority as Ir,deviceId as It,currentPlaylist as J,setCurrentServer as Ji,sidebarContainerElement as Jn,getDataUrl as Jr,isPortrait as Jt,convertToPercentage as K,serverClient_default as Ki,setTitle as Kn,formatDuration as Kr,episodeCounter as Kt,onConnect as L,genreColors as Li,focusColor as Ln,sortByPriorityKeyed as Lr,deviceInfo as Lt,vueKeycloak as M,useSwipe as Ma,setLibraries as Mi,isTrackRoute as Mn,sortBy as Mr,appInfo as Mt,clearTokens as N,refDebounced as Na,buttonClasses as Ni,redirectUrl as Nn,sortBy2 as Nr,appState as Nt,setMusicPlaylists as O,useIdle as Oa,SortType as Oi,isPreferencesRoute as On,groupBy as Or,toggleQueueMenuOpen as Ot,logout as P,tryOnMounted as Pa,dashboardBigCardGrid as Pi,searchUrl as Pn,sortByMathPercentage as Pr,batteryInfo as Pt,duration as Q,setDisplayLanguage as Qi,calculateDuration as Qn,alphaNumericRange as Qr,preventDefault as Qt,onDisconnect as R,green as Ri,poster as Rn,sortByType as Rr,deviceName as Rt,contextMenu as S,defaultDocument as Sa,siteTitle as Si,isDashboardRoute as Sn,Unique as Sr,setFullPlayerModalOpen as St,setContextMenu as T,useColorMode as Ta,tmdbImageBaseUrl as Ti,isMusicRoute as Tn,createEnumFromArray as Tr,toggleDeviceMenuOpen as Tt,bands as U,orange as Ui,setPoster as Un,uniqBy as Ur,cn as Ut,audioPlayer as V,isNative as Vi,setColorPalette as Vn,sort_updated_desc as Vr,App as Vt,closeFullPlayer as W,purple as Wi,setSortOrder as Wn,unique as Wr,disableImmersiveMode as Wt,currentTime as X,displayLanguage as Xi,sortType as Xn,humanFileSize as Xr,lockPortrait as Xt,currentSong as Y,client_default as Yi,sortOrder as Yn,getRandomNumberBetween as Yr,lockLandscape as Yt,deviceMenuOpen as Z,screensaverDelay as Zi,title as Zn,mathPercentage as Zr,onDoubleClick as Zt,AppLogoSquare_default as _,setUserFromWebKeycloak as _a,translate as _i,servers_default as _n,pickPaletteColor as _r,queue as _t,newIndex as a,useAutoThemeColors as aa,create_UUID as ai,stopPropagation as an,timeAgoShort as ar,handleFullReset as at,MoooomIcon_default as b,updateUserFromApi as ba,keycloakConfig as bi,isAlbumRoute as bn,tooDark as br,setCurrentPlaylist as bt,setImageModalData as c,availableTranslations as ca,isIp as ci,addNotification as cn,isJsonString as cr,isPlaying as ct,setShowScreensaver as d,Preferences as da,lineBreakLongTitle as di,removeNotification as dn,getCpuColor as dr,lyricsMenuOpen as dt,setScreensaverDelay as ea,breakLogoTitle as ei,scrollIntoBox as en,convertToSeconds as er,equalizerPreset as et,setTemp as f,WebPlugin as fa,lineBreakShowTitle as fi,markAllMessagesRead as fn,getEdgeStyle as fr,musicSize as ft,CoverImage_default as g,setUser as ga,stringFormat as gi,serverLibraries as gn,parseColorToHex as gr,percentage as gt,temp as h,keycloak as ha,setTitle$1 as hi,apiClient_default as hn,hexOpacity as hr,panning as ht,disableScreensaver as i,showBackdrops as ia,copyToClipboard as ii,stopAndPrevent as in,parseYear as ir,handleChange as it,useKeycloak as j,useOnline as ja,libraries_default as ji,isSongRoute as jn,shuffle as jr,playerState as jt,router_default as k,useIntersectionObserver as ka,rgbaToHex as ki,isQueueRoute as kn,mappedEntries as kr,volume as kt,setImageModalOpen as l,i18next_default as la,isPublicIp as li,clearNotifications as ln,isValidObject as lr,isRepeating as lt,showScreensaver as m,registerPlugin as ma,random_string as mi,removeMessage as mn,greenToRed as mr,openFullPlayer as mt,TMDBImage_default as n,setUseAutoThemeColors as na,breakTitle2 as ni,scrollTo as nn,humanTimeExtended as nr,equalizerSliderValues as nt,setCurrentType as o,useOverlayCarouselButtons as oa,generateRandomString as oi,unlockOrientation as on,userTime as or,handleReset as ot,showImageModal as p,init_dist as pa,pad as pi,messages_default as pn,getGpuColor as pr,musicVisibility as pt,currentMusicDeviceId as q,currentServer as qi,setupComplete as qn,getCommonSize as qr,isLandscape as qt,currentType as r,setUsePercentageColors as ra,censorPublicIpAddresses as ri,shouldMarquee as rn,isXmasTime as rr,fullPlayerModalOpen as rt,setDisableScreensaver as s,usePercentageColors as sa,hash as si,require_dist$2 as sn,checkboxValue as sr,isMuted as st,ImageModal_default as t,setShowBackdrops as ta,breakTitle as ti,scrollIntoView as tn,humanTime as tr,equalizerPresets as tt,setNewIndex as u,languages as ua,limitSentenceByCharacters as ui,notifications_default as un,getColorFromPercent as ur,isShuffling as ut,__plugin_vue_export_helper_default as v,testUserToken as va,ucfirst as vi,setServers as vn,redToGreen as vr,queueMenuOpen as vt,onTrackRowRightClick as w,unrefElement as wa,tmdbApiKey as wi,isLibraryRoute as wn,chunk as wr,setMusicSize as wt,Modal_default as x,user as xa,libraryTypes as xi,isArtistRoute as xn,tooLight as xr,setEqualizerPreset as xt,Button_default as y,u as ya,authBaseUrl as yi,hasMusicLibrary as yn,themeColors as yr,remainingTime as yt,useVideoSocket as z,greetingValue as zi,scrollContainerElement as zn,sort_updated as zr,setDeviceId as zt};
