import{r as N,g as U}from"./media-C2AqgyMX.js";import{r as G,a as $}from"./vendor-C28OoIfY.js";import{r as Q}from"./vue-ionic-DNlOg-eX.js";var y={},p={},z={},O={},q={},C;function S(){if(C)return q;C=1,Object.defineProperty(q,"__esModule",{value:!0}),q.VolumeState=q.PlayerState=void 0;var u;(function(h){h.PLAYING="PLAYING",h.PAUSED="PAUSED",h.STOPPED="STOPPED",h.ENDED="ENDED",h.LOADING="LOADING",h.ERROR="ERROR",h.IDLE="IDLE",h.BUFFERING="BUFFERING"})(u||(q.PlayerState=u={}));var c;return function(h){h.MUTED="MUTED",h.UNMUTED="UNMUTED"}(c||(q.VolumeState=c={})),q}var f={},F;function H(){if(F)return f;F=1;var u=f&&f.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(f,"__esModule",{value:!0}),f.spectrumAnalyser=f.AudioMotionAnalyzer=void 0;const c=u(G());f.AudioMotionAnalyzer=c.default;const h=(a,i)=>new c.default({source:a,...i});return f.spectrumAnalyser=h,f}var V;function Y(){if(V)return O;V=1;var u=O&&O.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(O,"__esModule",{value:!0});const c=Q,h=u(N()),a=S(),i=H();class r{constructor(t,n){this._audioElement={},this.state=a.PlayerState.STOPPED,this.duration=0,this.currentTime=0,this.volume=100,this.isFading=!1,this.context=null,this.motion=null,this.options={},this.motionColors=["#ff0000","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000"],this.fadeDuration=3,this.prefetchLeeway=10,this.crossFadeSteps=20,this.fadeOutVolume=0,this.fadeInVolume=100,this.hasNextQueued=!1,this.repeat="off",this._disableAutoPlayback=!1,this.isTv=window.matchMedia("(width: 960px) and (height: 540px)").matches,this.bands=[],this._preGain=null,this._filters=[],this._panner=null,this.options=t,this.parent=n,this.prefetchLeeway=t.prefetchLeeway??10,this.fadeDuration=t.fadeDuration??3,this.bands=t.bands,this.motionConfig=t.motionConfig,this.motionColors=t.motionColors,this._initialize()}dispose(){this._removeEvents(),this._audioElement.remove()}setAccessToken(t){this.accessToken=t}setSource(t){var n,s,o;return this._audioElement.pause(),this._audioElement.removeAttribute("src"),t.endsWith(".m3u8")?h.default.isSupported()?(this.hls??(this.hls=new h.default({debug:!1,enableWorker:!0,lowLatencyMode:!0,maxBufferHole:0,maxBufferLength:30,maxBufferSize:0,autoStartLoad:!0,testBandwidth:!0,xhrSetup:l=>{this.accessToken&&l.setRequestHeader("authorization",`Bearer ${this.accessToken}`)}})),(s=this.hls)==null||s.loadSource(t),(o=this.hls)==null||o.attachMedia(this._audioElement)):this._audioElement.canPlayType("application/vnd.apple.mpegurl")&&(this._audioElement.src=`${t}${this.accessToken?`?token=${this.accessToken}`:""}`):((n=this.hls)==null||n.destroy(),this.hls=void 0,this._audioElement.src=`${t}${this.accessToken?`?token=${this.accessToken}`:""}`),this}play(){return this._audioElement.play()}pause(){this._audioElement.pause()}stop(){this._audioElement.pause(),this._audioElement.currentTime=0,URL.revokeObjectURL(this._audioElement.src),this._audioElement.removeAttribute("src"),this._audioElement.removeAttribute("data-src")}setVolume(t){if((0,c.isPlatform)("android")||(0,c.isPlatform)("ios")){this._audioElement.volume=1;return}t<0&&(t=0),t>100&&(t=100),this.volume=t,this._audioElement.volume=t/100}fadeVolume(t){t<0&&(t=0),t>100&&(t=100),this._audioElement.volume=t/100}getVolume(){return this.volume}mute(){this._audioElement.muted=!0}unmute(){this._audioElement.muted=!1}isPlaying(){return this.state===a.PlayerState.PLAYING}getDuration(){return this.duration}getCurrentTime(){return this.currentTime}getBuffer(){return this._audioElement.buffered.length}getPlaybackRate(){return this._audioElement.playbackRate}setCurrentTime(t){return this._audioElement.currentTime=t,this}getAudioElement(){return this._audioElement}getTimeData(){return{position:Math.abs(this.getCurrentTime()),duration:Math.abs(this.getDuration()),remaining:this.getDuration()<0?1/0:Math.abs(this.getDuration())-Math.abs(this.getCurrentTime()),buffered:this.getBuffer(),percentage:Math.abs(this.getCurrentTime())/Math.abs(this.getDuration())*100}}setCrossFadeSteps(t){this.crossFadeSteps=t}setAutoPlayback(t){this._disableAutoPlayback=t}_fadeIn(t=!1){t&&(this.fadeVolume(0),this.fadeInVolume=0),this._audioElement.play().then(),this.fadeInVolume<this.volume?(this.fadeInVolume+=this.crossFadeSteps,setTimeout(()=>this._fadeIn(),200)):(this.fadeInVolume=this.volume,this.isFading=!1),this.fadeInVolume>100&&(this.fadeInVolume=100),this.fadeVolume(this.fadeInVolume),this.fadeInVolume>=this.volume-this.crossFadeSteps*12&&this.parent.emit("nextSong")}_fadeOut(t=!1){var n,s,o;this.isFading=!0,t&&(this.fadeOutVolume=this.volume),this.fadeOutVolume>0?(this.fadeOutVolume-=this.crossFadeSteps,setTimeout(()=>this._fadeOut(),200)):this.fadeOutVolume=0,this.fadeOutVolume<0&&(this.fadeOutVolume=0),this.fadeVolume(this.fadeOutVolume),this.fadeOutVolume==0&&(this.pause(),URL.revokeObjectURL((n=this._audioElement)==null?void 0:n.src),(s=this._audioElement)==null||s.removeAttribute("src"),(o=this._audioElement)==null||o.removeAttribute("data-src"),this.parent.emit("endFadeOut"),setTimeout(()=>{this.hasNextQueued=!1,this.isFading=!1,this.parent.emit("setCurrentAudio",this._audioElement)},500))}setRepeating(t){this.repeat=t}_initialize(){this._createAudioElement(this.options.id),this._addEvents()}_createAudioElement(t){return this._audioElement=document.createElement("audio"),this._audioElement.id=`audio-${t}`,this._audioElement.preload="auto",this._audioElement.controls=!1,this._audioElement.autoplay=!0,this._audioElement.loop=!1,this._audioElement.setAttribute("tabindex","-1"),this._audioElement.volume=this.options.volume??1,this._audioElement.crossOrigin="anonymous",document.body.appendChild(this._audioElement),this}playEvent(){this.state=a.PlayerState.PLAYING,this.parent.emit("play-internal",this._audioElement),this._initializeContext(),this.isFading||this.parent.emit("play",this._audioElement)}pauseEvent(){this.state=a.PlayerState.PAUSED,this.parent.emit("pause-internal",this._audioElement),this.isFading||this.parent.emit("pause",this._audioElement)}endedEvent(){this.state=a.PlayerState.ENDED,this.parent.emit("ended",this._audioElement)}errorEvent(){console.error("Error",this._audioElement.error),this.state=a.PlayerState.ERROR,this.parent.emit("error",this._audioElement)}waitingEvent(){this.state=a.PlayerState.BUFFERING,this.parent.emit("waiting",this._audioElement)}canplayEvent(){this.parent.emit("canplay",this._audioElement),!this.isPlaying()&&(this.state=a.PlayerState.IDLE)}loadedmetadataEvent(){this.parent.emit("loadedmetadata",this._audioElement),!this.isPlaying()&&(this.state=a.PlayerState.IDLE)}loadstartEvent(){this.state=a.PlayerState.LOADING,this.parent.emit("loadstart",this._audioElement)}timeupdateEvent(){this.state=a.PlayerState.PLAYING,this.currentTime=this._audioElement.currentTime,this.duration=this._audioElement.duration,this.parent.emit("time-internal",this.getTimeData()),(!this.isFading||this.repeat=="one")&&this.parent.emit("time",this.getTimeData()),!this.hasNextQueued&&this.repeat!=="one"&&this._audioElement.currentTime>=this._audioElement.duration-this.prefetchLeeway&&!this._disableAutoPlayback&&(this.hasNextQueued=!0,this.parent.emit("queueNext")),this.repeat!=="one"&&this._audioElement.currentTime>=this._audioElement.duration-this.fadeDuration*4&&!this._disableAutoPlayback&&this.parent.emit("startFadeOut")}durationchangeEvent(){this.duration=this._audioElement.duration,this.parent.emit("duration",this._audioElement.duration)}volumechangeEvent(){this.parent.emit("volume",this.volume)}seekedEvent(){console.log("seeked",this._audioElement.currentTime),this.parent.emit("seeked",{buffered:this._audioElement.buffered.length,duration:this._audioElement.duration,percentage:this._audioElement.currentTime/this._audioElement.duration*100,position:this._audioElement.currentTime,remaining:this._audioElement.duration-this._audioElement.currentTime})}_addEvents(){this._audioElement.addEventListener("play",this.playEvent.bind(this)),this._audioElement.addEventListener("pause",this.pauseEvent.bind(this)),this._audioElement.addEventListener("ended",this.endedEvent.bind(this)),this._audioElement.addEventListener("error",this.errorEvent.bind(this)),this._audioElement.addEventListener("waiting",this.waitingEvent.bind(this)),this._audioElement.addEventListener("canplay",this.canplayEvent.bind(this)),this._audioElement.addEventListener("loadedmetadata",this.loadedmetadataEvent.bind(this)),this._audioElement.addEventListener("loadstart",this.loadstartEvent.bind(this)),this._audioElement.addEventListener("timeupdate",this.timeupdateEvent.bind(this)),this._audioElement.addEventListener("durationchange",this.durationchangeEvent.bind(this)),this._audioElement.addEventListener("volumechange",this.volumechangeEvent.bind(this)),this._audioElement.addEventListener("seeked",this.seekedEvent.bind(this))}_removeEvents(){this._audioElement.removeEventListener("play",this.playEvent.bind(this)),this._audioElement.removeEventListener("pause",this.pauseEvent.bind(this)),this._audioElement.removeEventListener("ended",this.endedEvent.bind(this)),this._audioElement.removeEventListener("error",this.errorEvent.bind(this)),this._audioElement.removeEventListener("waiting",this.waitingEvent.bind(this)),this._audioElement.removeEventListener("canplay",this.canplayEvent.bind(this)),this._audioElement.removeEventListener("loadedmetadata",this.loadedmetadataEvent.bind(this)),this._audioElement.removeEventListener("loadstart",this.loadstartEvent.bind(this)),this._audioElement.removeEventListener("timeupdate",this.timeupdateEvent.bind(this)),this._audioElement.removeEventListener("durationchange",this.durationchangeEvent.bind(this)),this._audioElement.removeEventListener("volumechange",this.volumechangeEvent.bind(this)),this._audioElement.removeEventListener("seeked",this.seekedEvent.bind(this))}createFilter(t,n){const s=this.context.createBiquadFilter();return s.frequency.value=t,s.type=n,s.gain.value=0,s}_initializeContext(){if(!(this.isTv||localStorage.getItem("nmplayer-music-supports-audio-context")==="false")){if(!this.context)try{this.motion=(0,i.spectrumAnalyser)(this._audioElement,this.motionConfig),this.motionColors.length&&(this.motion.registerGradient("theme",{bgColor:"transparent",dir:"h",colorStops:this.motionColors}),this.motion.gradient="theme"),setTimeout(()=>{this.motion.canvas.style.position="absolute",this.motion.canvas.style.height="320px",this.motion.canvas.style.width="1400px",this.motion.canvas.style.overflow="hidden",this.motion.canvas.style.opacity="0",this.motion.canvas.style.pointerEvents="none"},500),this.context=this.motion.audioCtx,this.context.addEventListener("error",()=>{localStorage.setItem("nmplayer-music-supports-audio-context","false"),this.context.close().then(),location.reload()}),this._preGain=this.context.createGain(),this._filters=this.bands.slice(1).map(n=>this.createFilter(n.frequency,"peaking")),this._panner=this.context.createStereoPanner(),this.motion.connectedSources.at(0).connect(this._preGain),this._filters.reduce((n,s)=>(n.connect(s),s),this._preGain).connect(this._panner).connect(this.context.destination),this.parent.on("setPreGain",n=>{this._preGain.gain.value=n}),this.parent.on("setPanner",n=>{this._panner.pan.value=n}),this.parent.on("setFilter",n=>{const s=this.bands.findIndex(o=>o.frequency===n.frequency);this._filters[s-1].gain.value=n.gain}),this.parent.loadEqualizerSettings()}catch(t){console.error("Failed to create AudioContext:",t);return}this.context&&this.context.state==="suspended"&&this.context.resume().then(()=>{console.log("AudioContext resumed")}).catch(t=>{console.error("Failed to resume AudioContext:",t)})}}}return O.default=r,O}var j={},R;function W(){return R||(R=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.equalizerPresets=u.equalizerBands=u.equalizerSliderValues=void 0,u.equalizerSliderValues={pan:{min:-1,max:1,step:.01,default:0},pre:{min:-1,max:3,step:1,default:0},band:{min:-12,max:12,step:.01,default:0}},u.equalizerBands=[{frequency:"Pre",gain:u.equalizerSliderValues.pre.default},{frequency:70,gain:u.equalizerSliderValues.band.default},{frequency:180,gain:u.equalizerSliderValues.band.default},{frequency:320,gain:u.equalizerSliderValues.band.default},{frequency:600,gain:u.equalizerSliderValues.band.default},{frequency:1e3,gain:u.equalizerSliderValues.band.default},{frequency:3e3,gain:u.equalizerSliderValues.band.default},{frequency:6e3,gain:u.equalizerSliderValues.band.default},{frequency:12e3,gain:u.equalizerSliderValues.band.default},{frequency:14e3,gain:u.equalizerSliderValues.band.default},{frequency:16e3,gain:u.equalizerSliderValues.band.default}],u.equalizerPresets=[{name:"Custom",values:[{frequency:70,gain:0},{frequency:180,gain:0},{frequency:320,gain:0},{frequency:600,gain:0},{frequency:1e3,gain:0},{frequency:3e3,gain:0},{frequency:6e3,gain:0},{frequency:12e3,gain:0},{frequency:14e3,gain:0},{frequency:16e3,gain:0}]},Object.freeze({name:"Classical",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:-4.499943750703116}),Object.freeze({frequency:12e3,gain:-4.499943750703116}),Object.freeze({frequency:14e3,gain:-4.499943750703116}),Object.freeze({frequency:16e3,gain:-5.9999250009374885})]}),Object.freeze({name:"Club",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:2.249971875351558}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:3.74995312558593}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:2.249971875351558}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Dance",values:[Object.freeze({frequency:70,gain:5.9999250009374885}),Object.freeze({frequency:180,gain:4.499943750703116}),Object.freeze({frequency:320,gain:1.4999812502343721}),Object.freeze({frequency:600,gain:0}),Object.freeze({frequency:1e3,gain:0}),Object.freeze({frequency:3e3,gain:-3.74995312558593}),Object.freeze({frequency:6e3,gain:-4.499943750703116}),Object.freeze({frequency:12e3,gain:-4.499943750703116}),Object.freeze({frequency:14e3,gain:0}),Object.freeze({frequency:16e3,gain:0})]}),Object.freeze({name:"Flat",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:.37499531255859303}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Laptop speakers/headphones",values:[Object.freeze({frequency:70,gain:2.9999625004687442}),Object.freeze({frequency:180,gain:6.749915626054674}),Object.freeze({frequency:320,gain:3.374957813027337}),Object.freeze({frequency:600,gain:-2.249971875351558}),Object.freeze({frequency:1e3,gain:-1.4999812502343721}),Object.freeze({frequency:3e3,gain:1.124985937675779}),Object.freeze({frequency:6e3,gain:2.9999625004687442}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:7.874901563730453}),Object.freeze({frequency:16e3,gain:8.999887501406231})]}),Object.freeze({name:"Large hall",values:[Object.freeze({frequency:70,gain:6.374920313496081}),Object.freeze({frequency:180,gain:6.374920313496081}),Object.freeze({frequency:320,gain:3.74995312558593}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:-2.9999625004687442}),Object.freeze({frequency:6e3,gain:-2.9999625004687442}),Object.freeze({frequency:12e3,gain:-2.9999625004687442}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Party",values:[Object.freeze({frequency:70,gain:4.499943750703116}),Object.freeze({frequency:180,gain:4.499943750703116}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:.37499531255859303}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:.37499531255859303}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:4.499943750703116}),Object.freeze({frequency:16e3,gain:4.499943750703116})]}),Object.freeze({name:"Pop",values:[Object.freeze({frequency:70,gain:-1.124985937675779}),Object.freeze({frequency:180,gain:2.9999625004687442}),Object.freeze({frequency:320,gain:4.499943750703116}),Object.freeze({frequency:600,gain:4.874939063261709}),Object.freeze({frequency:1e3,gain:3.374957813027337}),Object.freeze({frequency:3e3,gain:-.7499906251171861}),Object.freeze({frequency:6e3,gain:-1.4999812502343721}),Object.freeze({frequency:12e3,gain:-1.4999812502343721}),Object.freeze({frequency:14e3,gain:-1.124985937675779}),Object.freeze({frequency:16e3,gain:-1.124985937675779})]}),Object.freeze({name:"Reggae",values:[Object.freeze({frequency:70,gain:.37499531255859303}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:-.37499531255859303}),Object.freeze({frequency:600,gain:-3.74995312558593}),Object.freeze({frequency:1e3,gain:.37499531255859303}),Object.freeze({frequency:3e3,gain:4.124948438144523}),Object.freeze({frequency:6e3,gain:4.124948438144523}),Object.freeze({frequency:12e3,gain:.37499531255859303}),Object.freeze({frequency:14e3,gain:.37499531255859303}),Object.freeze({frequency:16e3,gain:.37499531255859303})]}),Object.freeze({name:"Rock",values:[Object.freeze({frequency:70,gain:4.874939063261709}),Object.freeze({frequency:180,gain:2.9999625004687442}),Object.freeze({frequency:320,gain:-3.374957813027337}),Object.freeze({frequency:600,gain:-4.874939063261709}),Object.freeze({frequency:1e3,gain:-2.249971875351558}),Object.freeze({frequency:3e3,gain:2.6249671879101513}),Object.freeze({frequency:6e3,gain:5.624929688378895}),Object.freeze({frequency:12e3,gain:6.749915626054674}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:6.749915626054674})]}),Object.freeze({name:"Soft",values:[Object.freeze({frequency:70,gain:2.9999625004687442}),Object.freeze({frequency:180,gain:1.124985937675779}),Object.freeze({frequency:320,gain:-.7499906251171861}),Object.freeze({frequency:600,gain:-1.4999812502343721}),Object.freeze({frequency:1e3,gain:-.7499906251171861}),Object.freeze({frequency:3e3,gain:2.6249671879101513}),Object.freeze({frequency:6e3,gain:5.2499343758203025}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:7.49990625117186})]}),Object.freeze({name:"Ska",values:[Object.freeze({frequency:70,gain:-1.4999812502343721}),Object.freeze({frequency:180,gain:-2.9999625004687442}),Object.freeze({frequency:320,gain:-2.6249671879101513}),Object.freeze({frequency:600,gain:-.37499531255859303}),Object.freeze({frequency:1e3,gain:2.6249671879101513}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:5.624929688378895}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:6.749915626054674}),Object.freeze({frequency:16e3,gain:5.9999250009374885})]}),Object.freeze({name:"Full Bass",values:[Object.freeze({frequency:70,gain:5.9999250009374885}),Object.freeze({frequency:180,gain:5.9999250009374885}),Object.freeze({frequency:320,gain:5.9999250009374885}),Object.freeze({frequency:600,gain:3.74995312558593}),Object.freeze({frequency:1e3,gain:1.124985937675779}),Object.freeze({frequency:3e3,gain:-2.6249671879101513}),Object.freeze({frequency:6e3,gain:-5.2499343758203025}),Object.freeze({frequency:12e3,gain:-6.374920313496081}),Object.freeze({frequency:14e3,gain:-6.749915626054674}),Object.freeze({frequency:16e3,gain:-6.749915626054674})]}),Object.freeze({name:"Soft Rock",values:[Object.freeze({frequency:70,gain:2.6249671879101513}),Object.freeze({frequency:180,gain:2.6249671879101513}),Object.freeze({frequency:320,gain:1.4999812502343721}),Object.freeze({frequency:600,gain:-.37499531255859303}),Object.freeze({frequency:1e3,gain:-2.6249671879101513}),Object.freeze({frequency:3e3,gain:-3.374957813027337}),Object.freeze({frequency:6e3,gain:-2.249971875351558}),Object.freeze({frequency:12e3,gain:-.37499531255859303}),Object.freeze({frequency:14e3,gain:1.874976562792965}),Object.freeze({frequency:16e3,gain:5.624929688378895})]}),Object.freeze({name:"Full Treble",values:[Object.freeze({frequency:70,gain:-5.9999250009374885}),Object.freeze({frequency:180,gain:-5.9999250009374885}),Object.freeze({frequency:320,gain:-5.9999250009374885}),Object.freeze({frequency:600,gain:-2.6249671879101513}),Object.freeze({frequency:1e3,gain:1.874976562792965}),Object.freeze({frequency:3e3,gain:6.749915626054674}),Object.freeze({frequency:6e3,gain:9.749878126523418}),Object.freeze({frequency:12e3,gain:9.749878126523418}),Object.freeze({frequency:14e3,gain:9.749878126523418}),Object.freeze({frequency:16e3,gain:10.499868751640605})]}),Object.freeze({name:"Full Bass & Treble",values:[Object.freeze({frequency:70,gain:4.499943750703116}),Object.freeze({frequency:180,gain:3.74995312558593}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:-4.499943750703116}),Object.freeze({frequency:1e3,gain:-2.9999625004687442}),Object.freeze({frequency:3e3,gain:1.124985937675779}),Object.freeze({frequency:6e3,gain:5.2499343758203025}),Object.freeze({frequency:12e3,gain:6.749915626054674}),Object.freeze({frequency:14e3,gain:7.49990625117186}),Object.freeze({frequency:16e3,gain:7.49990625117186})]}),Object.freeze({name:"Live",values:[Object.freeze({frequency:70,gain:-2.9999625004687442}),Object.freeze({frequency:180,gain:.37499531255859303}),Object.freeze({frequency:320,gain:2.6249671879101513}),Object.freeze({frequency:600,gain:3.374957813027337}),Object.freeze({frequency:1e3,gain:3.74995312558593}),Object.freeze({frequency:3e3,gain:3.74995312558593}),Object.freeze({frequency:6e3,gain:2.6249671879101513}),Object.freeze({frequency:12e3,gain:1.874976562792965}),Object.freeze({frequency:14e3,gain:1.874976562792965}),Object.freeze({frequency:16e3,gain:1.4999812502343721})]}),Object.freeze({name:"Techno",values:[Object.freeze({frequency:70,gain:4.874939063261709}),Object.freeze({frequency:180,gain:3.74995312558593}),Object.freeze({frequency:320,gain:.37499531255859303}),Object.freeze({frequency:600,gain:-3.374957813027337}),Object.freeze({frequency:1e3,gain:-2.9999625004687442}),Object.freeze({frequency:3e3,gain:.37499531255859303}),Object.freeze({frequency:6e3,gain:4.874939063261709}),Object.freeze({frequency:12e3,gain:5.9999250009374885}),Object.freeze({frequency:14e3,gain:5.9999250009374885}),Object.freeze({frequency:16e3,gain:5.624929688378895})]})]}(j)),j}var M;function J(){if(M)return z;M=1;var u=z&&z.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(z,"__esModule",{value:!0});const c=u(Y()),h=S(),a=W();class i extends EventTarget{constructor(){super(),this.volume=Number(localStorage.getItem("nmplayer-music-volume"))||100,this.muted=!1,this.duration=0,this.currentTime=0,this.buffered=0,this.playbackRate=1,this.fadeDuration=3,this.currentSong=null,this.state=h.PlayerState.IDLE,this.volumeState=h.VolumeState.UNMUTED,this.isShuffling=!1,this.isRepeating=!1,this.isMuted=!1,this.isPaused=!1,this.isPlaying=!1,this.isStopped=!1,this.isSeeking=!1,this.isTransitioning=!1,this.newSourceLoaded=!1,this.baseUrl="/",this.accessToken="",this._options={},this.context=null,this.preGain=null,this.filters=[],this.panner=null,this.siteTitle="NoMercy Player",this.disableAutoPlayback=!1,this.motionConfig={alphaBars:!0,ansiBands:!0,barSpace:.25,bgAlpha:0,channelLayout:"dual-horizontal",colorMode:"bar-level",fadePeaks:!1,fftSize:16384,fillAlpha:.5,frequencyScale:"log",gravity:3.8,height:void 0,ledBars:!1,lineWidth:5,linearAmplitude:!0,linearBoost:1.4,loRes:!1,lumiBars:!1,maxDecibels:-35,maxFPS:60,maxFreq:16e3,minDecibels:-85,minFreq:30,mirror:0,mode:2,noteLabels:!1,outlineBars:!1,overlay:!0,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:1,reflexBright:1,reflexFit:!0,reflexRatio:.5,roundBars:!1,showBgColor:!1,showFPS:!1,showPeaks:!1,showScaleX:!1,showScaleY:!1,smoothing:.7,spinSpeed:1,splitGradient:!1,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:"D",width:void 0},this.motionColors=[],this.equalizerPanning=0,this.eventTarget={},this.events=[],this._audioElement1=new c.default({id:1,volume:this.volume/100,bands:a.equalizerBands,motionConfig:this.motionConfig,motionColors:this.motionColors},this),this._audioElement2=new c.default({id:2,volume:this.volume/100,bands:a.equalizerBands,motionConfig:this.motionConfig,motionColors:this.motionColors},this),this._currentAudio=this._audioElement1,this._nextAudio=this._audioElement2,this.eventTarget=new EventTarget,this.equalizerBands=a.equalizerBands,this.equalizerSliderValues=a.equalizerSliderValues,this.equalizerPresets=a.equalizerPresets,this._audioElement1.context=this.context,this._audioElement1._preGain=this.preGain,this._audioElement1._filters=this.filters,this._audioElement1._panner=this.panner,this._audioElement1._disableAutoPlayback=this.disableAutoPlayback,this._audioElement2.context=this.context,this._audioElement2._preGain=this.preGain,this._audioElement2._filters=this.filters,this._audioElement2._panner=this.panner,this._audioElement2._disableAutoPlayback=this.disableAutoPlayback}setAccessToken(e){this.accessToken=e,this._audioElement1.setAccessToken(e),this._audioElement2.setAccessToken(e)}setBaseUrl(e){this.baseUrl=e}getNewSource(e){if(!(e!=null&&e.path))throw new Error("No path provided for new source");return new Promise(t=>t(encodeURI(`${this.baseUrl}${e==null?void 0:e.path}`).replace(/#/u,"%23")))}loadEqualizerSettings(){const e=localStorage.getItem("nmplayer-music-equalizer-settings");if(e){this.equalizerBands=JSON.parse(e);for(const t of this.equalizerBands){if(t.frequency==="Pre"){this==null||this.setPreGain(t.gain);continue}this.setFilter(t)}}}setPreGain(e){this.emit("setPreGain",e)}setPanner(e){this.equalizerPanning=e,this.emit("setPanner",e)}setFilter(e){this.emit("setFilter",e)}saveEqualizerSettings(){localStorage.setItem("nmplayer-music-equalizer-settings",JSON.stringify(this.equalizerBands))}setTitle(e){if(!e||e==""){document.title=this.siteTitle;return}const t=[];e&&t.push(e),window.matchMedia("(display-mode: standalone)").matches||(e&&t.push("-"),t.push(this.siteTitle)),document.title=t.join(" ")}emit(e,t){var n,s;(s=(n=this.eventTarget)==null?void 0:n.dispatchEvent)==null||s.call(n,new CustomEvent(e,{detail:t}))}on(e,t){this.eventTarget.addEventListener(e,n=>t(n.detail)),this.events.push({type:e,fn:t})}off(e,t){if(t){this.eventTarget.removeEventListener(e,t);const s=this.events.findIndex(o=>o.type===e&&o.fn===t);s>-1&&this.events.splice(s,1)}if(e==="all"){this.events.forEach(s=>{this.eventTarget.removeEventListener(s.type,s.fn)}),this.events=[];return}this.events.filter(s=>s.type===e).forEach(s=>{this.eventTarget.removeEventListener(s.type,s.fn);const o=this.events.findIndex(l=>l===s);o>-1&&this.events.splice(o,1)})}once(e,t){this.eventTarget.addEventListener(e,n=>t(n.detail),{once:!0})}}return z.default=i,z}var B;function X(){if(B)return p;B=1;var u=p&&p.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(p,"__esModule",{value:!0});const c=u(J());class h extends c.default{constructor(){super(),this.currentSong=null,this._repeat="off",this._queue=[],this._backLog=[],this._shuffle=!1,this._initializeQueue()}getQueue(){return this._queue}setQueue(i){this._queue=[...i].map(r=>Object.assign({},r)),this.emit("queue",this._queue)}addToQueue(i){this._queue.push(Object.assign({},i)),this.emit("queue",this._queue)}pushToQueue(i){i=Object.assign({},i),i.forEach(r=>this._queue.push(r)),this.emit("queue",this._queue)}removeFromQueue(i){this._queue.splice(this._queue.indexOf(i),1),this.emit("queue",this._queue)}addToQueueNext(i){this._queue.unshift(Object.assign({},i)),this.emit("queue",this._queue)}getBackLog(){return this._backLog}setBackLog(i){this._backLog=[...i].map(r=>Object.assign({},r)),this.emit("backlog",this._backLog)}addToBackLog(i){i&&(this._backLog.push(Object.assign({},i)),this.emit("backlog",this._backLog))}pushToBackLog(i){i=Object.assign({},i),i.forEach(r=>this._backLog.push(r)),this.emit("backlog",this._backLog)}removeFromBackLog(i){this._backLog.splice(this._backLog.indexOf(i),1),this.emit("backlog",this._backLog)}setCurrentSong(i){this.currentSong=i,this.emit("song",i),i&&this.getNewSource(i).then(r=>{this._currentAudio.setSource(r),this._currentAudio.play().then(()=>{var e;this._currentAudio.getAudioElement().setAttribute("data-src",(e=i==null?void 0:i.id)==null?void 0:e.toString())})})}next(){var i;if(this.addToBackLog(this.currentSong),((i=this._queue)==null?void 0:i.length)>0){let r=this._queue[0];if(this._shuffle){const e=Math.round(Math.random()*(this._queue.length-1));r=this._queue[e]}this.setCurrentSong(r),this.removeFromQueue(r)}else this.setCurrentSong(this._backLog[0]),this.setQueue(this._backLog.slice(1)),this.setBackLog([])}previous(){if(this._currentAudio.currentTime>3)this._currentAudio.setCurrentTime(0);else if(this._backLog.length>0){const i=this._backLog.at(-1);if(!i)return;this.currentSong&&this.addToQueueNext(this.currentSong),this.setCurrentSong(i),this.removeFromBackLog(i)}else this._currentAudio.setCurrentTime(0)}playTrack(i,r){var e,t;if((!((e=this.currentSong)!=null&&e.id)||((t=this.currentSong)==null?void 0:t.id)!==(i==null?void 0:i.id))&&this.setCurrentSong(i),r){const n=r.findIndex(s=>s.id===i.id);if(n!==-1){const s=r.slice(n+1),o=r.slice(0,n),l=[...s,...o];this.setQueue(l)}}}shuffle(i){this._shuffle=i,this.isShuffling=i,this.emit("shuffle",i)}repeat(i){this._repeat=i,this.emit("repeat",this._repeat),this.isRepeating=this._repeat!=="off",this._currentAudio.setRepeating(this._repeat),this._nextAudio.setRepeating(this._repeat)}_initializeQueue(){this.on("ended",()=>{this.disableAutoPlayback||this._repeat==="one"&&(this._currentAudio.setCurrentTime(0),setTimeout(()=>{this._currentAudio.play().then()},150))}),this.on("queueNext",()=>{if(this.disableAutoPlayback||this._repeat==="one"||(this._repeat==="all"&&this._queue.length===0&&(this.setQueue(this._backLog),this.setBackLog([])),this._queue.length==0))return;const i=this.volume;this.getNewSource(this._queue[0]).then(r=>{this._currentAudio.isFading=!0,this._nextAudio.setSource(r),this._nextAudio.fadeVolume(0),this.once("startFadeOut",()=>{this._repeat!=="one"&&(this._currentAudio.setCrossFadeSteps(i/this.fadeDuration/5),this._currentAudio._fadeOut(!0),this._nextAudio.setCrossFadeSteps(i/this.fadeDuration/5),this._nextAudio._fadeIn(!0),this.once("nextSong",()=>{if(this._repeat==="one")return;const e=this._queue[0];this.addToBackLog(this.currentSong),this.currentSong=e,this.removeFromQueue(e),this.emit("song",e),this.once("setCurrentAudio",()=>{this._repeat!="one"&&(this._currentAudio.isFading=!1,this._currentAudio=this._nextAudio,this._nextAudio=this._currentAudio==this._audioElement1?this._audioElement2:this._audioElement1)})}))})}).catch(r=>{console.log(r),this.currentSong=null})}),this.on("ended",i=>{this.disableAutoPlayback||i==this._currentAudio.getAudioElement()&&(this.currentSong=null)}),this.on("error",this.next.bind(this))}}return p.default=h,p}var I;function K(){if(I)return y;I=1;var u=y&&y.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(y,"__esModule",{value:!0}),y.PlayerCore=void 0;const c=u($()),h=u(X()),a=S();class i extends h.default{constructor(e){super(),this._initializeCore(),e.expose&&(window.musicPlayer=this),this.mediaSession=new c.default,this.baseUrl=e.baseUrl,e.motionConfig&&(this.motionConfig=e.motionConfig),e.motionColors&&(this.motionColors=e.motionColors),e.siteTitle&&(this.siteTitle=e.siteTitle),e.disableAutoPlayback!==void 0&&(this.disableAutoPlayback=e.disableAutoPlayback),this.actions=e.actions}dispose(){var e;this._audioElement1.dispose(),this._audioElement2.dispose(),(e=this.mediaSession)==null||e.setPlaybackState("none")}play(){return this._currentAudio.play()}pause(){this._currentAudio.pause()}togglePlayback(){this.isPlaying?this.pause():this.play().then()}stop(){var e;this._currentAudio.stop(),this.currentSong=null,this.state=a.PlayerState.STOPPED,this.emit("song",null),this.emit("stop"),this.setQueue([]),(e=this.mediaSession)==null||e.setPlaybackState("none")}setVolume(e){const t=Math.floor(e);this._currentAudio.setVolume(t),this._nextAudio.setVolume(t),localStorage.setItem("nmplayer-music-volume",t.toString())}getVolume(){return this._currentAudio.getVolume()}mute(){this._currentAudio.mute(),this._nextAudio.mute(),this.volumeState=a.VolumeState.MUTED,this.isMuted=!0,this.emit("mute",!0),localStorage.setItem("nmplayer-music-muted","true")}unmute(){this._currentAudio.unmute(),this._nextAudio.unmute(),this.volumeState=a.VolumeState.UNMUTED,this.isMuted=!1,this.emit("mute",!1),localStorage.setItem("nmplayer-music-muted","false")}toggleMute(){this.volumeState===a.VolumeState.MUTED?this.unmute():this.mute()}seek(e){this.getDuration()>e&&this._currentAudio.setCurrentTime(e)}getDuration(){return this._currentAudio.getDuration()}getCurrentTime(){return this._currentAudio.getCurrentTime()}getBuffer(){return this._currentAudio.getBuffer()}getTimeData(){return this._currentAudio.getTimeData()}setAutoPlayback(e){this.disableAutoPlayback=e,this._audioElement1.setAutoPlayback(e),this._audioElement2.setAutoPlayback(e)}_initializeCore(){var e;(e=this.mediaSession)==null||e.setPlaybackState("none"),this.on("ready",this.handleReady.bind(this)),this.on("play",this.handlePlay.bind(this)),this.on("pause",this.handlePause.bind(this)),this.on("song",this.handleCurrentSongChange.bind(this)),this.on("time",this.handleTimeUpdate.bind(this)),this.on("error",this.handleError.bind(this)),this.setVolume(parseInt(localStorage.getItem("nmplayer-music-volume")??"100",10)),setTimeout(()=>{this.emit("ready")},1500)}handleReady(){var e,t,n,s,o,l,d,m,g,b,_,E,v;(v=this.mediaSession)==null||v.setActionHandler({play:((t=(e=this.actions)==null?void 0:e.play)==null?void 0:t.bind(this))??this.play.bind(this),pause:((s=(n=this.actions)==null?void 0:n.pause)==null?void 0:s.bind(this))??this.pause.bind(this),stop:((l=(o=this.actions)==null?void 0:o.stop)==null?void 0:l.bind(this))??this.stop.bind(this),previous:((m=(d=this.actions)==null?void 0:d.previous)==null?void 0:m.bind(this))??this.previous.bind(this),next:((b=(g=this.actions)==null?void 0:g.next)==null?void 0:b.bind(this))??this.next.bind(this),seek:((E=(_=this.actions)==null?void 0:_.seek)==null?void 0:E.bind(this))??this.seek.bind(this),getPosition:this.getCurrentTime.bind(this)})}handlePlay(){var e;this.isPlaying=!0,this.state=a.PlayerState.PLAYING,(e=this.mediaSession)==null||e.setPlaybackState("playing")}handlePause(){var e;this.isPlaying=!1,this.state=a.PlayerState.PAUSED,(e=this.mediaSession)==null||e.setPlaybackState("paused")}handleCurrentSongChange(e){var n,s,o,l,d,m,g,b,_,E,v,A,P,T,k,L,x,D;if(!e){this.currentSong=null,(n=this.mediaSession)==null||n.setPlaybackState("none");return}const t=(l=(o=(s=this.currentSong)==null?void 0:s.artist_track)==null?void 0:o.slice(1))==null?void 0:l.map(w=>` Ft. ${w.name}`).join("");window.location.hash.includes("music")&&this.setTitle(`${(g=(m=(d=this.currentSong)==null?void 0:d.artist_track)==null?void 0:m[0])==null?void 0:g.name} - ${(b=this.currentSong)==null?void 0:b.name} ${t}`),(D=this.mediaSession)==null||D.setMetadata({title:`${(_=this.currentSong)==null?void 0:_.name}`,artist:`${(A=(v=(E=this.currentSong)==null?void 0:E.artist_track)==null?void 0:v[0])==null?void 0:A.name} ${t}`,album:((k=(T=(P=this.currentSong)==null?void 0:P.album_track)==null?void 0:T[0])==null?void 0:k.name)??"",artwork:(L=this.currentSong)!=null&&L.cover?`${this.baseUrl}${(x=this.currentSong)==null?void 0:x.cover}`:void 0})}handleTimeUpdate(e){var n,s,o,l,d,m,g,b;const t=(o=(s=(n=this.currentSong)==null?void 0:n.artist_track)==null?void 0:s.slice(1))==null?void 0:o.map(_=>` Ft. ${_.name}`).join("");window.location.hash.includes("music")&&this.setTitle(`${(m=(d=(l=this.currentSong)==null?void 0:l.artist_track)==null?void 0:d[0])==null?void 0:m.name} - ${(g=this.currentSong)==null?void 0:g.name} ${t}`),e.duration&&((b=this.mediaSession)==null||b.setPositionState({position:e.position,duration:e.duration,playbackRate:this._currentAudio.getPlaybackRate()}))}handleError(){var e;this.state=a.PlayerState.ERROR,this.isPlaying=!1,(e=this.mediaSession)==null||e.setPlaybackState("none")}}return y.PlayerCore=i,y.default=i,y}var Z=K();const ne=U(Z);export{ne as M};
