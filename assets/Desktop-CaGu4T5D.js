import{C as f,G as q,J as l,Ot as $,S as r,T as y,Tt as g,X as J,c as S,ct as v,g as b,gt as _,j as A,k as p,kt as C,ot as ce,w as P,x as n}from"./i18n-Bgv5p1Yb.js";import"./ionic-B1wlflFe.js";import{C as ve,_ as de}from"./vue-core-Dey0Eikg.js";import{t as pe}from"./primevue-CuC2W_MW.js";import"./query-xyWPY_A0.js";import{Aa as fe,Ri as L,Ui as Y,Wi as me,hr as w,mr as Z,pr as E,qi as Q,sa as ee,ur as te,z as xe}from"./index-DLX3dE7o.js";import"./KeepCounting-BTwWMA0m.js";import"./useInfiniteServerClient-DG5_vM7O.js";import{t as M}from"./useServerClient-BXRsp2bm.js";import"./ScrollContainer-CeB9S2n1.js";import{t as ge}from"./useMounted-Cjvkyxzm.js";import{s as ye}from"./RipperOverlay-DxVqjbwq.js";import"./ripperSocket-o6W57gTr.js";import"./FloatingBackButton-1LbxvOkI.js";import{n as k,r as j,t as he}from"./DashboardLayout-BuvOLFFC.js";import{t as _e}from"./ActivityCard-Ckl-8r9M.js";import{n as F,r as N,t as H}from"./ServerSystemInfoCard-B--P6ANO.js";S();var we={class:"flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch text-slate-11/80 dark:text-slate-11/80"},ke={class:"flex flex-grow flex-col items-start justify-start gap-1 text-left"},Ce={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start self-stretch"},be={class:"w-8 flex-shrink-0 flex-grow-0 text-sm"},Se={class:"relative h-2 flex-grow rounded-lg"},Ae={class:"w-10 flex-shrink-0 flex-grow-0 text-right text-sm"},Re=A({__name:"ResourceBar",props:{cpu:{type:Number,required:!0,default:0},value:{type:Number,required:!0,default:0}},setup(u){const a=u,s=n(()=>ee.value?te(a.value,Z):"var(--color-theme-8)");return(m,c)=>(l(),y("div",we,[r("div",ke,[r("div",Ce,[r("p",be,C(u.cpu),1),r("div",Se,[c[0]||(c[0]=r("div",{class:"absolute h-2 w-full rounded left-[-1px] top-[-1px] bg-surface-2 dark:bg-surface-1"},null,-1)),r("div",{style:$({width:`${u.value}%`,backgroundImage:`linear-gradient(90deg, ${s.value} 0%, ${s.value} 100%)`}),class:"absolute h-2 rounded transition-all duration-500 left-[-1px] top-[-1px]"},null,4)]),r("p",Ae,C(Math.floor(u.value))+"% ",1)])])]))}}),Pe=Re;S();var $e={class:"relative flex aspect-video h-auto w-full flex-1 flex-shrink-0 flex-col items-start justify-center gap-1 flex-grow-1 text-surface-12/11"},Me={class:"relative h-full flex-1 flex-shrink-0 w-available"},Ne={class:"absolute top-2/3 left-1/2 -translate-x-1/2 text-center font-semibold text-[2.5vw] monospace sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.6vw]"},ze={class:"flex-shrink-0 flex-grow-0 scale-75 self-stretch text-center text-sm font-semibold w-available text-[2.5vw] sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.7vw]"},Oe=A({__name:"ResourceCircle",props:{name:{type:String,required:!0},value:{type:Number,required:!0},size:{type:Number,required:!0}},setup(u){const a=u,s=n(()=>{if(ee.value)return te(a.value,Z);switch(a.name){case"CPU":return w(me,50);case"Memory":return w(Y,50);case"GPU":return w(L,50);default:return w(L,50)}}),m=n(()=>Math.PI*72),c=n(()=>(1-(a.value===-1?0:a.value)/100)*m.value);return(d,o)=>(l(),y("div",$e,[r("div",Me,[(l(),y("svg",{style:$({width:u.size*2,height:u.size*2}),class:"absolute inset-2 mx-auto rounded",fill:"none",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 152 148",xmlns:"http://www.w3.org/2000/svg"},[o[0]||(o[0]=r("path",{class:"stroke-black/50",d:"M148 76C148 66.5448 146.138 57.1822 142.519 48.4468C138.901 39.7114 133.598 31.7741 126.912 25.0883C120.226 18.4025 112.289 13.099 103.553 9.48068C94.8178 5.86234 85.4552 4 76 4C66.5448 3.99999 57.1823 5.86232 48.4468 9.48066C39.7114 13.099 31.7742 18.4025 25.0883 25.0883C18.4025 31.7741 13.099 39.7113 9.48069 48.4468C5.86234 57.1822 4 66.5448 4 76","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8"},null,-1)),r("path",{style:$({stroke:s.value,strokeDasharray:m.value,strokeDashoffset:c.value}),class:"absolute -top-1 -left-1 h-2 rounded transition-all duration-500",d:"M4 76C4 56.9044 11.5857 38.5909 25.0883 25.0883C38.5909 11.5857 56.9044 4 76 4C95.0956 4 113.409 11.5857 126.912 25.0883C140.414 38.5909 148 56.9044 148 76","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8"},null,4)],4)),r("p",Ne,C(u.value===-1?d.$t(""):Math.floor(u.value))+C(u.value===-1?"":"%"),1)]),r("p",ze,C(u.name),1)]))}}),B=Oe;S();var De={class:"flex items-start justify-between gap-2 overflow-clip w-available text-surface-12/80"},Ie={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start self-stretch"},h=40,Ue=A({__name:"ServerResourceCard",setup(u){const{data:a}=M({path:"dashboard/server/info",queryKey:["serverInfo",Q.value?.serverBaseUrl]}),s=_(),m=_("graph"),c=_(Array.from({length:h}).fill("")),d=_(Array.from({length:h}).fill(null)),o=_(Array.from({length:h}).fill(null)),z=_(Array.from({length:h}).fill([null]));ge(()=>k.value?.invoke("StartResources"),()=>k.value?.invoke("StopResources").catch(),10);function re(){k.value?.invoke("StartResources")}q(()=>{xe()?.onreconnected(re)});const G=n(()=>s.value?.cpu?.core?.toSorted((e,t)=>e.index-t.index)??[]),O=n(()=>s.value?.gpu?.toSorted((e,t)=>e.index-t.index).map(e=>(e.power+e.core)/2)??[]),V=n(()=>s.value?.cpu?.core?.length?Math.floor(G.value?.reduce((e,t)=>e+t.utilization,0)/G.value.length):-1),T=n(()=>s.value?.memory?.percentage==="NaN"?-1:s.value?.memory?.percentage??-1),ae=n(()=>{if(s.value?.gpu?.length===0)return-1;const e=Math.floor(O.value?.reduce((t,i)=>t+i,0)/O.value.length);return Number.isNaN(e)?-1:e}),D=n(()=>(window.innerWidth-5e3)/3);function le(e){if(e.length===1)return[{color:E(e[0]),opacity:50}];const U=(75-25)/(3-1),K=[];for(let R=0;R<e.length;R++){const ie=25+R%3*U;K.push({color:E(e[R]),opacity:ie})}return K}function se(e){e&&(s.value=e,d.value=[...d.value.slice(-h),V.value],o.value=[...o.value.slice(-h),T.value],z.value=[...z.value.slice(-h),O.value])}ye(k,"ResourceUpdate",se);const oe=n(()=>({labels:c.value,datasets:[...a.value?.cpu?.map((e,t)=>{const i="#94f";return{label:`CPU ${a.value?.cpu.length>1?t:""}`,data:d.value,yAxisID:"y",borderColor:w(i,50)}})??[],{label:"Memory",data:o.value,yAxisID:"y",borderColor:w(Y,50)},...a.value?.gpu?.map((e,t)=>{const i=le(a.value?.gpu)[t],x=w(i.color,i.opacity);return{label:`GPU ${a.value?.gpu.length>1?t:""}`,data:z.value.map(U=>U[t]),yAxisID:"y",borderColor:x}})??[]]})),I=fe("legendPosition","bottom"),ue=n(()=>{const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--surface-12"),i=e.getPropertyValue("--p-content-border-color"),x=["left","top","right","bottom"];return{indexAxis:"x",maintainAspectRatio:!1,animation:!1,plugins:{legend:{labels:{color:t},value:I.value,onClick(){I.value=x[(x.indexOf(I.value)+1)%x.length]}}},elements:{line:{tension:.2},point:{pointStyle:!1}},scales:{x:{ticks:{color:"transparent"},grid:{color:"transparent"}},y:{min:0,max:100,beginAtZero:!0,clip:!0,ticks:{color:t},grid:{color:i}}}}}),ne=n(()=>`${(a.value?.gpu?.length??0)*40+120}px`);return(e,t)=>(l(),f(N,{title:"Resources monitor"},{cta:v(()=>[...t[0]||(t[0]=[])]),default:v(()=>[r("div",De,[p(B,{size:D.value,value:V.value,name:"CPU"},null,8,["size","value"]),t[1]||(t[1]=r("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),p(B,{size:D.value,value:T.value,name:"Memory"},null,8,["size","value"]),t[2]||(t[2]=r("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),p(B,{size:D.value,value:ae.value,name:"GPU"},null,8,["size","value"])]),r("div",Ie,[m.value==="bar"?(l(!0),y(b,{key:0},J(s.value?.cpu?.core??[],(i,x)=>(l(),y(b,{key:i.index},[Number.isNaN(i.utilization)?P("",!0):(l(),f(Pe,{key:0,cpu:x,value:i.utilization},null,8,["cpu","value"]))],64))),128)):P("",!0),m.value==="graph"?(l(),f(g(pe),{key:1,data:oe.value,options:ue.value,style:$(`height: ${ne.value}`),class:"w-available",type:"line"},null,8,["data","options","style"])):P("",!0)])]),_:1}))}}),W=Ue;S();var Be=A({__name:"ServerActivityCard",setup(u){const{data:a}=M({path:"dashboard/activity",refetchInterval:1e4,data:{take:999},queryKey:["server","activity"]}),{data:s}=M({path:"dashboard/devices",refetchInterval:1e4,queryKey:["devices"]});return(m,c)=>g(j)?(l(),f(N,{key:0,title:"Activity",background:!1},{cta:v(()=>[...c[0]||(c[0]=[])]),default:v(()=>[(l(!0),y(b,null,J(g(a)?.slice(0,5)??[],d=>(l(),f(_e,{key:d?.id,devices:g(s)??[],activity:d},null,8,["devices","activity"]))),128))]),_:1})):P("",!0)}}),X=Be;S();var qe={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-1 xl:row-start-1"},je={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-3 xl:row-start-1"},Ge={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 lg:col-start-1 lg:row-start-2 2xl:col-span-2 2xl:col-start-5 2xl:row-start-1 2xl:flex"},Ve=A({__name:"Desktop",setup(u){const a=_(!0);ce(k,d=>{a.value=!!d}),q(()=>{setTimeout(()=>{a.value=!!k.value},1e3)});const{data:s,error:m}=M({path:"dashboard/server/storage",queryKey:["dashboard","storage",Q.value?.serverBaseUrl]});q(()=>{console.raw(s.value)});const c=n(()=>window.CSS.supports("grid-template-rows: masonry"));return(d,o)=>(l(),f(g(ve),null,{default:v(()=>[p(g(de),{fullscreen:!0},{default:v(()=>[p(he,{"grid-style":c.value?3:2,styles:"grid-template-rows: masonry; masonry-surface-flow: next;",title:"Dashboard overview"},{cta:v(()=>[...o[0]||(o[0]=[])]),default:v(()=>[c.value?(l(),y(b,{key:0},[p(H),p(F),p(X),g(j)?(l(),f(W,{key:0})):(l(),f(N,{key:1,class:"animate-pulse",title:"Resources monitor"},{cta:v(()=>[...o[1]||(o[1]=[])]),default:v(()=>[o[2]||(o[2]=r("div",{class:"min-h-80"},null,-1))]),_:1}))],64)):(l(),y(b,{key:1},[r("div",qe,[p(H),g(j)?(l(),f(W,{key:0})):(l(),f(N,{key:1,class:"animate-pulse",title:"Resources monitor"},{cta:v(()=>[...o[3]||(o[3]=[])]),default:v(()=>[o[4]||(o[4]=r("div",{class:"min-h-80"},null,-1))]),_:1}))]),r("div",je,[p(F)]),r("div",Ge,[p(X)])],64))]),_:1},8,["grid-style"])]),_:1})]),_:1}))}}),ot=Ve;export{ot as default};
