{"version":3,"file":"Tv-C5bJ3NjL.js","sources":["../../src/views/Base/Home/components/TvCarousel.vue","../../src/views/Base/Libraries/Tv.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, PropType, ref } from 'vue';\n\nimport TvCard from '@/views/Base/Home/components/TvCard.vue';\n\nconst props = defineProps({\n  carousel: {\n    type: Object,\n    required: true,\n  },\n  scrollToCenter: {\n    type: Function,\n    required: true,\n  },\n  scrollIndex: {\n    type: Number,\n    required: true,\n  },\n  setScrollIndex: {\n    type: Function as PropType<(index: number) => void>,\n    required: true,\n  },\n  cardsPerScroll: {\n    type: Number,\n    required: true,\n  },\n  unlockKeys: {\n    type: Function as PropType<() => void>,\n    required: true,\n  },\n  index: {\n    type: Number,\n    required: true,\n  },\n  setHasMoreCardsToRight: {\n    type: Function as PropType<(hasMore: boolean) => void>,\n    required: true,\n  },\n});\n\nconst carouselDiv = ref<HTMLDivElement>();\nconst focusCard = () => {\n  const cards = Array.from(carouselDiv.value?.querySelectorAll<HTMLAnchorElement>('a') ?? []);\n  const visibleCards = cards.filter((card: HTMLAnchorElement) => card.isVisible());\n  const card = visibleCards.at(props.scrollIndex);\n\n  if (card) {\n    card?.focus();\n  } else if (visibleCards.length > 0) {\n    visibleCards.at(-1)?.focus();\n  } else if (cards.at(props.scrollIndex)?.href) {\n    cards.at(props.scrollIndex)?.focus();\n    props.setHasMoreCardsToRight(true);\n  } else {\n    cards.at(-1)?.focus();\n    props.setHasMoreCardsToRight(true);\n  }\n};\n\nconst handleKeysLocked = () => {\n  setTimeout(() => {\n    props.unlockKeys();\n  }, 200);\n};\n\nconst visible = ref(false);\nonMounted(() => {\n  setTimeout(() => {\n    visible.value = true;\n  }, 50 * props.index);\n});\n</script>\n\n<template>\n\n  <div v-if=\"visible\" class=\"flex flex-col gap-1 w-full\">\n\n    <h3 v-if=\"carousel.props.title ?? carousel.title\" class=\"text-lg font-bold text-auto-12 text-slate-light-1 ml-2\">\n      {{ carousel.props.title ?? carousel.title }}\n    </h3>\n\n    <div tabindex=\"1\" ref=\"carouselDiv\"\n      class=\"flex flex-nowrap w-full p-1 snap-x snap-mandatory overflow-x-auto pointer-events-none scroll-mr-20\"\n      :data-carousel=\"carousel.props.title ?? carousel.title\" @focus=\"focusCard\">\n      <template v-for=\"(item, index) in carousel.props?.items as any ?? []\" :key=\"item\">\n        <TvCard tabindex=\"0\" :item=\"item\" :index=\"index\" @focus=\"handleKeysLocked()\" :scrollToCenter=\"scrollToCenter\"\n          :style=\"`flex-basis: calc(100% / ${cardsPerScroll} - 0.70rem)`\" />\n      </template>\n    </div>\n\n  </div>\n</template>","<script setup lang=\"ts\">\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { IonContent, IonPage, onIonViewDidEnter } from '@ionic/vue';\n\nimport type { HomeItem } from '@/types/api/base/home';\n\nimport { getMutating, getMutation, getQuery } from '@/lib/routerHelper';\nimport router from '@/router';\n\nimport TvCarousel from '@/views/Base/Home/components/TvCarousel.vue';\nimport TvHomeCard from '@/views/Base/Home/components/TvHomeCard.vue';\n\nconst routeName = router.currentRoute.value.name;\n\nconst isMutating = getMutating();\n\nconst { data: homeData } = getQuery<HomeItem>({\n  path: '/libraries/tv',\n  queryKey: ['libraries', 'tv'],\n});\n\nconst { data: mutatedData, mutate } = getMutation<HomeItem>({\n  homeData: homeData,\n  queryKey: ['libraries', 'tv'],\n});\n\nrouter.beforeEach(async (to) => {\n  if (!homeData.value) return;\n\n  if (to.name !== routeName) return;\n\n  const mutations = homeData.value?.filter?.(item => item?.update?.when == 'pageLoad') ?? [];\n  mutate(mutations);\n});\n\nwatch(homeData, (value) => {\n  if (!value) return;\n  jumpTo('#watch_now');\n});\n\nconst top = ref<HTMLElement>();\nconst bottom = ref<HTMLElement>();\nconst cardsPerScroll = ref(7);\n\nconst jumpTo = (id: string) => {\n  const element = document.querySelector<HTMLElement>(id);\n  if (element) {\n    element.focus();\n\n    content.value?.$el?.scrollToTop(0);\n\n    top.value?.classList.remove('opacity-[0.001]');\n    unlockKeys();\n  }\n};\n\nconst content = ref<VueDivElement>();\nconst scrollToBottom = () => {\n  content.value?.$el?.scrollToBottom(0);\n  content.value?.$el?.scrollIntoView({\n    behavior: 'smooth',\n    block: 'center',\n    inline: 'nearest',\n  });\n\n  top.value?.classList.add('opacity-[0.001]');\n\n  bottom.value?.querySelector<HTMLAnchorElement>('[data-card]')?.focus();\n};\n\nonIonViewDidEnter(() => {\n  setTimeout(() => {\n    top.value?.focus();\n  }, 1000);\n});\n\nconst scrollIndex = ref(0);\nconst setScrollIndex = (index: number) => {\n  scrollIndex.value = index;\n};\nconst hasMoreCardsToRight = ref(false);\nconst setHasMoreCardsToRight = (value: boolean) => {\n  hasMoreCardsToRight.value = value;\n};\n\nconst scrollToCenter = (e: FocusEvent) => {\n\n  document.activeElement?.scrollIntoView({\n    behavior: 'smooth',\n    block: 'center',\n    inline: scrollIndex.value == 2 || hasMoreCardsToRight.value ? 'center' : undefined,\n  });\n\n  setTimeout(() => {\n    const cardIndex = (e.target as HTMLAnchorElement)?.getAttribute('index')?.toInt() ?? 0;\n\n    const carouselDiv = (e.target as HTMLAnchorElement).closest('[data-carousel]') as HTMLElement;\n    carouselDiv.dataset.focussedIndex = cardIndex.toString();\n\n    const cards = carouselDiv.querySelectorAllArray<HTMLAnchorElement>('a');\n    const visibleCards = cards.filter((card: HTMLAnchorElement) => card.isVisible());\n\n    const currentIndex = visibleCards.indexOf(e.target as HTMLAnchorElement);\n\n    // allow horizontal scroll when the card index is below 3\n    if (scrollIndex.value !== currentIndex) {\n      hasMoreCardsToRight.value = true;\n    }\n\n    setScrollIndex(currentIndex);\n\n    // prevent horizontal scroll when the last or second last card is focused\n    if (cardIndex > carouselDiv.childNodes.length - cardsPerScroll.value) {\n      hasMoreCardsToRight.value = false;\n    }\n  }, 400);\n  //\n  // watch(scrollIndex, () => {\n  //   const cardIndex = (e.target as HTMLAnchorElement)?.getAttribute('index')?.toInt() ?? 0;\n  //   const carouselDiv = (e.target as HTMLAnchorElement).closest('[data-carousel]') as HTMLElement;\n  //\n  //   // prevent horizontal scroll when the last or second last card is focused\n  //   if (cardIndex > carouselDiv.childNodes.length - 5) {\n  //     hasMoreCardsToRight.value = false;\n  //   }\n  // });\n\n\n};\n\nconst timeout = ref<NodeJS.Timeout>();\n\nconst keysLocked = ref(false);\nconst unlockKeys = () => {\n  clearTimeout(timeout.value);\n  keysLocked.value = false;\n};\n\nconst handleKeyDown = (e: KeyboardEvent) => {\n  if (!(e.target as HTMLElement).dataset.card) return;\n  if (!keysLocked.value) {\n    keysLocked.value = true;\n    return;\n  } else {\n    e.preventDefault();\n  }\n\n  timeout.value = setTimeout(() => {\n    unlockKeys();\n  }, 200);\n};\n\nonMounted(() => {\n  document.addEventListener('keydown', handleKeyDown);\n});\n\nonUnmounted(() => {\n  document.removeEventListener('keydown', handleKeyDown);\n});\n\nconst homeCardData = computed(() => (mutatedData.value ?? homeData.value)\n  ?.filter(d => d.component == 'NMHomeCard') ?? [])\n\nconst carouselsData = computed(() => (mutatedData.value ?? homeData.value)\n  ?.filter(d => d.component == 'NMCarousel') ?? [])\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\" ref=\"content\">\n\n      <div v-if=\"!isMutating\" class=\"flex flex-col gap-8 pt-24 pb-4\" id=\"container\">\n        <div tabindex=\"0\" ref=\"top\" @focus=\"jumpTo('#watch_now')\"\n          class=\"flex items-center mx-12 w-available min-h-[60vh] relative overflow-hidden rounded-2xl border-2 border-slate-light-9 transition-opacity duration-300\">\n          <template v-for=\"(carousel) in homeCardData\" :key=\"carousel.props.title\">\n            <TvHomeCard :carousel=\"carousel\" :items=\"carousel.props.items\" />\n          </template>\n        </div>\n\n        <div v-if=\"carouselsData.length > 0\" tabindex=\"0\" ref=\"bottom\" @focus=\"scrollToBottom\"\n          class=\"mx-11 flex flex-col justify-start items-start w-available gap-5 h-[calc(100vh-6rem)] overflow-auto\">\n          <template v-if=\"!isMutating\">\n            <template v-for=\"(carousel, index) in carouselsData\" :key=\"carousel.props.title\">\n              <TvCarousel v-if=\"carousel.props.items.length > 0\" :carousel=\"carousel\" :index=\"index\"\n                :scrollToCenter=\"scrollToCenter\" :scrollIndex=\"scrollIndex\" :setScrollIndex=\"setScrollIndex\"\n                :cardsPerScroll=\"cardsPerScroll\" :unlockKeys=\"unlockKeys\"\n                :setHasMoreCardsToRight=\"setHasMoreCardsToRight\" />\n            </template>\n          </template>\n        </div>\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n\n<style scoped>\nion-content::part(background) {\n  @apply bg-slate-light-3 dark:bg-slate-dark-1;\n}\n</style>\n"],"names":["props","__props","carouselDiv","ref","focusCard","cards","_a","visibleCards","card","_b","_c","_d","_e","handleKeysLocked","visible","onMounted","routeName","router","isMutating","getMutating","homeData","getQuery","mutatedData","mutate","getMutation","to","mutations","item","watch","value","jumpTo","top","bottom","cardsPerScroll","id","element","content","unlockKeys","scrollToBottom","_g","_f","onIonViewDidEnter","scrollIndex","setScrollIndex","index","hasMoreCardsToRight","setHasMoreCardsToRight","scrollToCenter","e","cardIndex","currentIndex","timeout","keysLocked","handleKeyDown","onUnmounted","homeCardData","computed","d","carouselsData"],"mappings":"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"}