import{$ as Y,a8 as Z,a_ as G,d as u,c as m,o as n,p as d,j as s,A as f,x as l,z as T,ab as ee,B as te,w as D,h as ae,b as c,a0 as y}from"./vue-ionic-Db_NiJFp.js";import{u as O}from"./useServerClient-CUQzpYwE.js";import{be as se,c as H,a as oe,bf as le}from"./index-dhF1HRpl.js";import{_ as re}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BYC73pez.js";import{_ as ie}from"./Modal.vue_vue_type_script_setup_true_lang-DgmZ3_6v.js";import{_ as A}from"./Button.vue_vue_type_script_setup_true_lang-BO0XnUC6.js";import{T as x}from"./Toggle-1gKv3zJD.js";import{u as ne}from"./useApiClient-yX3mJQ9g.js";import{_ as de}from"./Select.vue_vue_type_script_setup_true_lang-COJR_GFa.js";import{u as ue}from"./primevue-Bn7Q4nqF.js";import"./vendor-Dgtccx1h.js";import"./icons-BW5E66pf.js";import"./rxjs-BCp2L9Rn.js";import"./media-C2AqgyMX.js";import"./api-BBofn2cc.js";import"./swiper-D00Cnjmx.js";import"./useInfiniteServerClient-BLSEFIWT.js";import"./music-player-bBxcOCLu.js";import"./useMounted-CcCfyv5S.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-C85dnblQ.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-DHzcpnxP.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-BY75sSIQ.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-DLM3Fn1x.js";import"./Button.vue_vue_type_script_setup_true_lang-ZOdlfYgK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"my-6 text-sm text-auto-10"},ce=Y({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const w=v,{t:p}=Z(),B=G(),i=u([]);function S(){var a;if(!w.id){i.value.push({type:"error",place:"email",message:p("Email is required")});return}se().post("server/server-users",{_method:"delete",id:(a=H.value)==null?void 0:a.id,user_id:w.id}).then(()=>{B.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),w.close()}return(a,q)=>(n(),m(ie,{open:v.open,close:v.close,params:{name:v.name},title:"Delete server member {{name}}"},{actions:d(()=>[T(A,{id:"yes",type:"button",color:"red",variant:"contained","end-icon":"userRemove",onClick:S},{default:d(()=>[f(l(a.$t("Yes")),1)]),_:1}),T(A,{id:"no",type:"button",variant:"text",color:"white",onClick:v.close},{default:d(()=>[f(l(a.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:d(()=>[s("p",me,[f(l(a.$t("Are you sure you want to delete this server member?")),1),q[0]||(q[0]=s("br",null,null,-1)),f(" "+l(a.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),pe={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},fe={class:"mt-4 mb-2"},ve={class:"flex flex-col gap-2"},be={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},he={class:"whitespace-pre-wrap text-sm font-semibold"},ge={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ye={class:"whitespace-pre-wrap text-sm font-semibold"},we={class:"mt-4 mb-2"},_e={class:"flex w-full flex-col gap-2"},ke={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},$e={class:"whitespace-pre-wrap text-sm font-semibold"},Ve={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},Ce={class:"whitespace-pre-wrap text-sm font-semibold"},xe={class:"mt-4 mb-2"},Te={class:"flex w-1/2 flex-col gap-2"},Ae={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},qe={class:"whitespace-pre-wrap text-sm font-semibold"},tt=Y({__name:"Edit",setup(v){var K,M,N,R,Q,P,j,z,F;const w=G(),p=ee(),B=ue(),{data:i}=O({path:"/dashboard/libraries"}),{data:S}=ne({path:"server/server-users",params:{id:(K=H.value)==null?void 0:K.id},queryKey:["server_users"]}),{data:a,error:q}=O({path:`dashboard/users/${p.params.id}/permissions`,queryKey:["userPermissions",p.params.id]}),I=te(()=>{var e,t;return(t=(e=S.value)==null?void 0:e.find(r=>r.id===p.params.id))==null?void 0:t.name}),_=u((M=a.value)==null?void 0:M.allowed),k=u((N=a.value)==null?void 0:N.manage),$=u((R=a.value)==null?void 0:R.audio_transcoding),V=u((Q=a.value)==null?void 0:Q.video_transcoding),L=u((P=a.value)==null?void 0:P.no_transcoding),b=u(((j=i.value)==null?void 0:j.filter(e=>{var t,r;return(r=(t=a.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}).length)===((z=i.value)==null?void 0:z.length)),h=u((F=i.value)==null?void 0:F.filter(e=>{var t,r;return(r=(t=a.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}));D(a,e=>{var t,r,C;_.value=e==null?void 0:e.allowed,k.value=e==null?void 0:e.manage,$.value=e==null?void 0:e.audio_transcoding,V.value=e==null?void 0:e.video_transcoding,L.value=e==null?void 0:e.no_transcoding,h.value=(t=i.value)==null?void 0:t.filter(g=>{var o;return(o=e==null?void 0:e.libraries)==null?void 0:o.includes(g.id)}),b.value=((r=i.value)==null?void 0:r.filter(g=>{var o;return(o=e==null?void 0:e.libraries)==null?void 0:o.includes(g.id)}).length)===((C=i.value)==null?void 0:C.length)});const U=u(!1);function J(){U.value=!0}function W(){U.value=!1}function E(){window.history.back()}function X(){var e;oe().patch(`dashboard/users/${p.params.id}/permissions`,{allowed:_.value,manage:k.value,audio_transcoding:$.value,video_transcoding:V.value,no_transcoding:L.value,libraries:(e=h.value)==null?void 0:e.map(t=>t.id)}).then(({data:t})=>{w.invalidateQueries({queryKey:["userPermissions",p.params.id]}),B.add({severity:t.status==="ok"?"success":"error",summary:le(t.message,...t.args),life:2e3}),E()})}return D(b,e=>{e&&(h.value=i.value)}),D(h,e=>{i.value}),(e,t)=>(n(),m(re,{error:y(q),title:"Server member: {{name}}",params:{name:I.value},back:!0},{cta:d(()=>t[6]||(t[6]=[])),actions:d(()=>[T(A,{id:"yes",type:"button",variant:"text",class:"mr-auto",color:"text-auto-alpha-11","start-icon":"userDelete",onClick:J},{default:d(()=>[f(l(e.$t("Remove user")),1)]),_:1}),T(A,{id:"cancel",type:"button",variant:"text",color:"white",onClick:E},{default:d(()=>[f(l(e.$t("Cancel")),1)]),_:1}),T(A,{id:"save",type:"button",color:"theme",onClick:X},{default:d(()=>[f(l(e.$t("Save")),1)]),_:1})]),default:d(()=>{var r,C,g;return[y(a)?(n(),ae("div",pe,[s("h3",fe,l(e.$t("Base permissions"))+": ",1),s("div",ve,[s("label",be,[_.value!==void 0?(n(),m(x,{key:0,id:"allowed",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),label:"Manage",class:"mr-2"},null,8,["modelValue"])):c("",!0),s("span",he,l(e.$t("Allow this user to access content")),1)]),s("label",ge,[k.value!==void 0?(n(),m(x,{key:0,id:"manage",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=o=>k.value=o),label:"Manage",class:"mr-2"},null,8,["modelValue"])):c("",!0),s("span",ye,l(e.$t("Allow this user to manage the server")),1)])]),s("h3",we,l(e.$t("Media playback"))+": ",1),s("div",_e,[s("label",ke,[$.value!==void 0?(n(),m(x,{key:0,id:"audioTranscoding",modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=o=>$.value=o),label:"AudioTranscoding",class:"mr-2"},null,8,["modelValue"])):c("",!0),s("span",$e,l(e.$t("Allow audio playback that requires transcoding")),1)]),s("label",Ve,[V.value!==void 0?(n(),m(x,{key:0,id:"videoTranscoding",modelValue:V.value,"onUpdate:modelValue":t[3]||(t[3]=o=>V.value=o),label:"VideoTranscoding",class:"mr-2"},null,8,["modelValue"])):c("",!0),s("span",Ce,l(e.$t("Allow video playback that requires transcoding")),1)])]),s("h3",xe,l(e.$t("Library Access"))+": ",1),s("div",Te,[s("label",Ae,[b.value!==void 0?(n(),m(x,{key:0,id:"allowedAllLibraries",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o),label:"AllowedAllLibraries",class:"mr-2"},null,8,["modelValue"])):c("",!0),s("span",qe,l(e.$t("Enable access to all libraries")),1)]),b.value?c("",!0):(n(),m(de,{key:0,id:"libraries",modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=o=>h.value=o),label:"libraries",placeholder:"Select libraries",multiple:"",items:y(i),"option-label":"title"},null,8,["modelValue","items"]))])])):c("",!0),(r=y(a))!=null&&r.id?(n(),m(ce,{key:1,id:(C=y(a))==null?void 0:C.id,name:(g=y(a))==null?void 0:g.name,close:W,open:U.value},null,8,["id","name","open"])):c("",!0)]}),_:1},8,["error","params"]))}});export{tt as default};
