import{l as A,B as y,w as H,ae as M,R as w,cN as V,du as K,dv as N,cO as U,I as O,Y as P,al as L,d as $,o as h,s as T,q as Q,t as g,dw as X,cX as Y,dx as F,dy as J,dz as W,D as Z,a5 as ee,a8 as te,dA as se,c as S,a as n,b as q,r as D,j as ae,K as C,z as oe,n as z}from"./index-DkQngsHe.js";import{u as ne}from"./useMounted-BfGYJuv5.js";import{u as le}from"./useServerClient-CmW8VHrx.js";import{H as E}from"./HubConnection-CMQnVIkW.js";import{_ as re}from"./FloatingBackButton.vue_vue_type_script_setup_true_lang-Da0SgVOE.js";import{_ as ce}from"./Button.vue_vue_type_script_setup_true_lang-B5T8NTkB.js";import{_ as ie}from"./ScrollContainer.vue_vue_type_script_setup_true_lang-BJWiF2I-.js";import{r as de,_ as ue}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-oED-RT0Y.js";const a=A(),Oe=y(()=>{var t;return(t=a.value)==null?void 0:t.connection}),k=A(!1);function B(){var t,s,o;k.value=!0,document.dispatchEvent(new Event("dashboardHub-connected")),(t=a.value)!=null&&t.connection&&(N((s=a.value)==null?void 0:s.connection,"Dashboard Hub"),U((o=a.value)==null?void 0:o.connection))}function b(t){k.value=!1,console.log("Disconnected from Dashboard SignalR",t),document.dispatchEvent(new Event("dashboardHub-disconnected"))}function G(t){k.value=!1,console.error("Dashboard SignalR Error:",t),document.dispatchEvent(new Event("dashboardHub-error"))}H(w,async t=>{var o,l,u,m,x,f,v,p;const s=(o=M.value)==null?void 0:o.accessToken;t&&k.value&&((u=(l=a.value)==null?void 0:l.connection)==null||u.stop().then(),(m=a.value)==null||m.dispose(),a.value=new V(w.value.serverBaseUrl,s,"dashboardHub"),(f=(x=a.value)==null?void 0:x.connection)==null||f.on("connected",B),(p=(v=a.value)==null?void 0:v.connection)==null||p.on("disconnected",b),await I().catch(G))});async function I(){var t,s,o,l;if(((s=(t=a.value)==null?void 0:t.connection)==null?void 0:s.state)!==E.Connected)return(l=(o=a.value)==null?void 0:o.connection)==null?void 0:l.start().then(B)}async function fe(){var t,s,o,l;try{return((s=(t=a.value)==null?void 0:t.connection)==null?void 0:s.state)===E.Disconnected||(l=(o=a.value)==null?void 0:o.connection)==null?void 0:l.stop().then(b).catch(b)}catch(u){console.error("Error stopping Dashboard SignalR:",u),b()}}async function R(){var s,o,l,u,m,x,f,v,p,e,r,i,d;const t=(s=M.value)==null?void 0:s.accessToken;w.value&&(!((l=(o=a.value)==null?void 0:o.connection)!=null&&l.state)||((m=(u=a.value)==null?void 0:u.connection)==null?void 0:m.state)===E.Disconnected)&&(a.value=new V(w.value.serverBaseUrl,t,"dashboardHub"),(f=(x=a.value)==null?void 0:x.connection)==null||f.on("connected",B),(p=(v=a.value)==null?void 0:v.connection)==null||p.on("disconnected",b),await I().catch(G),(r=(e=a.value)==null?void 0:e.connection)==null||r.onreconnecting(c=>{console.log("SignalR Disconnected.",c==null?void 0:c.message),K(a.value.connection,"Dashboard Hub"),b()}),(d=(i=a.value)==null?void 0:i.connection)==null||d.onreconnected(()=>{console.log("SignalR Reconnected."),N(a.value.connection,"Dashboard Hub"),B()}))}const ve=O({__name:"HelpButton",setup(t){const s=P(),o=y(()=>`https://docs${L}.nomercy.tv${s.path.replace(/\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/gu,"")}`);return(l,u)=>(h(),$(ce,{id:"help",href:o.value,variant:"text",component:"link",target:"_blank",color:"auto","start-icon":"messageBubbleQuestion",class:"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5"},{default:T(()=>[Q(g(l.$t("Help")),1)]),_:1},8,["href"]))}}),he={key:0,class:"grid h-full w-full place-items-center"},pe={class:"relative flex items-center justify-start gap-8 overflow-hidden"},me={class:"relative flex w-full flex-col gap-4"},xe={class:"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80"},ge={class:"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line"},ye=["inert"],be={class:"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-auto-7/6 xl:px-6"},we={class:"relative flex h-full flex-col items-start justify-center gap-1 text-slate-light-12/80 dark:text-slate-dark-12/80"},ke={class:"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold"},_e={key:1,class:"hidden h-8 w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex"},Se={class:"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row"},$e={key:0,class:"grid h-full w-full place-items-center"},De={class:"relative flex flex-col items-center justify-start gap-8 overflow-hidden"},Be={class:"relative flex w-full flex-col gap-4"},Ce={class:"text-7xl font-bold text-center text-slate-light-12/80 dark:text-slate-dark-12/80"},He={class:"left-0 text-2xl text-center text-slate-light-12/80 dark:text-slate-dark-12/80 whitespace-pre-line"},Ee={key:2,class:"sticky bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-auto-7/6 empty:hidden sm:h-16 xl:px-6"},Te=O({__name:"DashboardLayout",props:X({title:{type:String,required:!0},params:{type:Object,required:!1},description:{type:String,required:!1},gridStyle:{type:Number,required:!1,default:0},back:{type:Boolean,required:!1,default:!1},error:{type:Object,required:!1},allowAnyone:{type:Boolean,required:!1,default:!1},styles:{type:String,required:!1}},{modelValue:{required:!1,type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const s=t,o=Y(t,"modelValue"),{dataUpdatedAt:l,error:u,isPending:m}=le({path:"dashboard/server",enabled:!s.allowAnyone,refetchInterval:1e4,queryKey:["dashboard","server",k.value]}),x=y(()=>s.gridStyle===1?F.value:s.gridStyle===2?J.value:s.gridStyle===3?W.value:s.gridStyle===4?"flex flex-wrap h-available":"flex flex-wrap h-available overflow-clip"),f=y(()=>{var r,i,d,c,_;if(s.allowAnyone)return null;const e=u.value;if(((r=e==null?void 0:e.response)==null?void 0:r.status)!==200)return{code:((d=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:d.status)??null,message:((_=(c=e==null?void 0:e.response)==null?void 0:c.data)==null?void 0:_.detail)??""}}),v=y(()=>{var r,i,d,c;const e=s.error;if(console.log(e),!(!(e!=null&&e.response)||((r=e==null?void 0:e.response)==null?void 0:r.status)===200))return{code:(i=e==null?void 0:e.response)==null?void 0:i.status,message:((c=(d=e==null?void 0:e.response)==null?void 0:d.data)==null?void 0:c.detail)??""}});Z(()=>{ee(null),te(null)}),ne(R,fe,20);const p=y(()=>{var e;return(((e=f.value)==null?void 0:e.code)||m.value)&&!s.allowAnyone});return H(p,e=>{e&&o.value!==void 0&&(o.value=!1)}),H(l,e=>{e&&!k.value&&R()}),(e,r)=>{var i,d,c,_,j;return h(),$(se,null,[p.value?(h(),S("div",he,[n("div",pe,[n("div",me,[n("p",xe,g((i=f.value)!=null&&i.code?(d=f.value)==null?void 0:d.code:"Offline"),1),n("p",ge,g((c=f.value)==null?void 0:c.message),1)])])])):(h(),S("div",{key:1,class:z([{" min-h-[92vh] sm:min-h-[92.75vh]":!e.$slots.cta," min-h-[92vh] sm:min-h-[90.1vh]":!!e.$slots.cta},"flex flex-col relative z-0 flex-1 h-available overflow-clip items-start justify-start self-stretch w-available"])},[n("div",{class:"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch",inert:C(de)},[r[0]||(r[0]=n("div",{class:"absolute inset-0 z-0 h-full w-full"},null,-1)),n("div",be,[n("div",we,[n("p",ke,g(e.$t(t.title,t.params)),1),t.back?(h(),$(re,{key:0,position:"relative",class:"left-4"})):(h(),S("p",_e,g(e.$t(t.description??"")),1))]),D(e.$slots,"title"),n("div",Se,[ae(ve),D(e.$slots,"cta")])])],8,ye),v.value?(h(),S("div",$e,[n("div",De,[n("div",Be,[n("p",Ce,g(v.value.code),1),n("p",He,g(v.value.message),1)])])])):(h(),$(ie,{key:1,static:!0,frame:"",class:"z-0 w-full flex-1 overflow-y-auto overflow-x-hidden sm:p-4"},{default:T(()=>[n("div",{class:z(["h-auto w-full flex-wrap content-start gap-4 flex-1",x.value]),style:oe(t.styles)},[D(e.$slots,"default")],6)]),_:3})),!v.value&&e.$slots.actions?(h(),S("div",Ee,[r[1]||(r[1]=n("div",{class:"absolute inset-0 -z-10 h-full w-full"},null,-1)),D(e.$slots,"actions")])):q("",!0),(_=C(w))!=null&&_.is_owner||(j=C(w))!=null&&j.is_manager?(h(),$(ue,{key:3})):q("",!0)],2))],1024)}}});export{Te as _,Oe as c,k as d};
