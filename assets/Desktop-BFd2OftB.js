import{I as $,d as y,o as c,s as l,a as o,c as I,l as f,B as M,f as k,q as v,t as _,j as n,K as h,dr as j,R as S,ao as B,bu as A,F as E,h as T,bh as U}from"./index-DkQngsHe.js";import{u as F}from"./useApiClient-PwYH9-Ws.js";import{_ as K}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DnCqx71_.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-B5T8NTkB.js";import{_ as L}from"./DashboardCard.vue_vue_type_script_setup_true_lang-ca1oupPg.js";import{_ as N}from"./Avatar.vue_vue_type_script_setup_true_lang-BZ1iBbUo.js";import{u as z}from"./index-Czi9s18M.js";import{u as D}from"./useServerClient-CmW8VHrx.js";import{_ as O}from"./Modal.vue_vue_type_script_setup_true_lang-DaZzj8Xb.js";import"./useQuery-jTNaBwZN.js";import"./useBaseQuery-BnGe7Aaf.js";import"./useQueryClient-Cy1MABnp.js";import"./useInfiniteServerClient-BHsBwDbE.js";import"./useMounted-BfGYJuv5.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-Da0SgVOE.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-BBYVQkaB.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-BJWiF2I-.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-oED-RT0Y.js";import"./ripperSocket-BmFnZdbx.js";import"./md5-DjzWtdxH.js";import"./Shadow-CSihFWI0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},P=["src"],Q=$({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(u,d)=>(c(),y(L,{route:`/dashboard/users/${r.data.user_id}`,line1:r.data.name,line2:""},{image:l(()=>[o("div",Z,[d[0]||(d[0]=o("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(c(),I("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,P)):(c(),y(N,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"]))}}),R={class:"flex w-full flex-col justify-start text-left"},W={class:"py-4 text-sm text-auto-10"},G={class:"flex flex-col gap-2 w-full"},H={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},J=$({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const u=r,{t:d}=z();f(null);const a=f(""),p=f([]),{data:b}=D({path:"/dashboard/libraries"}),s=f();function g(){p.value=[],u.close()}function m(i){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(i).toLowerCase())}const w=M(()=>a.value?m(a.value):!1);function q(){var i,e;if(!a.value){p.value.push({type:"error",place:"email",message:d("Email is required")});return}if(!m(a.value)){p.value.push({type:"error",place:"email",message:d("Invalid email address")});return}j().post("server/server-users",{id:(i=S.value)==null?void 0:i.id,email:a.value,libraries:(e=s.value)==null?void 0:e.map(t=>t.id)}).then(()=>{B.invalidateQueries({queryKey:["server_users"]}),a.value="",u.close()}).catch(({response:t})=>{(t==null?void 0:t.status)!==200&&(t!=null&&t.data)&&p.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})}return(i,e)=>{const t=k("InputText"),V=k("MultiSelect");return c(),y(O,{open:r.open,close:g,title:"Invite user"},{actions:l(()=>[n(C,{id:"yes",type:"button",color:"theme",variant:"contained","end-icon":"emailSend",disabled:!w.value,onClick:q},{default:l(()=>[v(_(i.$t("Send")),1)]),_:1},8,["disabled"]),n(C,{id:"no",type:"button",variant:"text",onClick:g},{default:l(()=>[v(_(i.$t("Cancel")),1)]),_:1})]),default:l(()=>[o("div",R,[o("p",W,[v(_(i.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=o("br",null,null,-1)),v(" "+_(i.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),o("div",G,[e[3]||(e[3]=o("label",{for:"email"},"Email",-1)),n(t,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=x=>a.value=x),class:"mb-4"},null,8,["modelValue"])]),o("div",H,[e[4]||(e[4]=o("label",{for:"libraries"},"Allowed libraries",-1)),n(V,{id:"libraries",modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=x=>s.value=x),display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:h(b),"option-label":"title"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),we=$({__name:"Desktop",setup(r){var b;const u=f(!1),{data:d}=F({path:"server/server-users",params:{id:(b=S.value)==null?void 0:b.id},queryKey:["server_users"]});function a(){u.value=!0,setTimeout(()=>{var s;(s=document.querySelector("#email"))==null||s.focus()},300)}function p(){u.value=!1}return(s,g)=>(c(),y(h(U),null,{default:l(()=>[n(h(A),{fullscreen:!0},{default:l(()=>[n(K,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[n(C,{id:"invite",color:"theme","start-icon":"userAdd",onClick:a},{default:l(()=>[v(_(s.$t("Invite user")),1)]),_:1})]),default:l(()=>[(c(!0),I(E,null,T([...h(d)??[]].sort((m,w)=>m.name.localeCompare(w.name)),m=>(c(),y(Q,{key:m.user_id,data:m},null,8,["data"]))),128)),n(J,{open:u.value,close:p},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{we as default};
