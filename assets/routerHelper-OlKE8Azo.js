var R=s=>{throw TypeError(s)};var w=(s,t,e)=>t.has(s)||R("Cannot "+e);var i=(s,t,e)=>(w(s,t,"read from private field"),e?e.call(s):t.get(s)),g=(s,t,e)=>t.has(s)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),K=(s,t,e,r)=>(w(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e),M=(s,t,e)=>(w(s,t,"access private method"),e);import{d3 as D,d6 as U,dk as Q,dl as I,de as L,B as _,cJ as k,df as F,dh as J,w as q,J as j,bQ as A,dg as B,Y as P,di as T,ao as l,dm as Y,R as z,O as x,a2 as G,cI as H}from"./index-C_qNKMWs.js";import{u as N}from"./useQuery-DTS8T947.js";import{u as V}from"./useQueryClient-C4PrSAx1.js";import{u as W}from"./useMutationState-mgoRudmX.js";var y,f,n,d,p,O,C,E,X=(E=class extends D{constructor(t,e){super();g(this,p);g(this,y);g(this,f);g(this,n);g(this,d);K(this,y,t),this.setOptions(e),this.bindMethods(),M(this,p,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const e=this.options;this.options=i(this,y).defaultMutationOptions(t),U(this.options,e)||i(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,n),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&Q(e.mutationKey)!==Q(this.options.mutationKey)?this.reset():((r=i(this,n))==null?void 0:r.state.status)==="pending"&&i(this,n).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,n))==null||t.removeObserver(this)}onMutationUpdate(t){M(this,p,O).call(this),M(this,p,C).call(this,t)}getCurrentResult(){return i(this,f)}reset(){var t;(t=i(this,n))==null||t.removeObserver(this),K(this,n,void 0),M(this,p,O).call(this),M(this,p,C).call(this)}mutate(t,e){var r;return K(this,d,e),(r=i(this,n))==null||r.removeObserver(this),K(this,n,i(this,y).getMutationCache().build(i(this,y),this.options)),i(this,n).addObserver(this),i(this,n).execute(t)}},y=new WeakMap,f=new WeakMap,n=new WeakMap,d=new WeakMap,p=new WeakSet,O=function(){var e;const t=((e=i(this,n))==null?void 0:e.state)??I();K(this,f,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},C=function(t){L.batch(()=>{var e,r,a,o,c,v,b,m;if(i(this,d)&&this.hasListeners()){const u=i(this,f).variables,h=i(this,f).context;(t==null?void 0:t.type)==="success"?((r=(e=i(this,d)).onSuccess)==null||r.call(e,t.data,u,h),(o=(a=i(this,d)).onSettled)==null||o.call(a,t.data,null,u,h)):(t==null?void 0:t.type)==="error"&&((v=(c=i(this,d)).onError)==null||v.call(c,t.error,u,h),(m=(b=i(this,d)).onSettled)==null||m.call(b,void 0,t.error,u,h))}this.listeners.forEach(u=>{u(i(this,f))})})},E);function Z(s,t){const e=V(),r=_(()=>e.defaultMutationOptions(k(s))),a=new X(e,r.value),o=F(a.getCurrentResult()),c=a.subscribe(u=>{J(o,u)}),v=(u,h)=>{a.mutate(u,h).catch(()=>{})};q(r,()=>{a.setOptions(r.value)}),A(()=>{c()});const m=j(o);return q(()=>o.error,u=>{if(u&&B(r.value.throwOnError,[u]))throw u}),{...m,mutate:v,mutateAsync:o.mutate,reset:o.reset}}function S(s){var r;const t=P(),e=[];return(r=s??(t==null?void 0:t.path))==null||r.split("/").slice(1).forEach(a=>{a.includes("?")?(e.push(a.split("?")[0]),e.push(a.split("?")[1].split("=")[1])):e.push(a)}),e}function at({queryKey:s,path:t}={queryKey:void 0,path:void 0}){return W({mutationKey:s??S(t)})}const $=T();q($,async s=>{s&&(await l.invalidateQueries(),l.getMutationCache().clear())});q(z,async s=>{s||Y(),l.getQueriesData({type:"all"}).forEach(t=>{l.invalidateQueries({queryKey:t}),l.removeQueries({queryKey:t}),l.getMutationCache().clear(),l.clear()}),await l.invalidateQueries(),l.removeQueries(),l.getMutationCache().clear(),l.clear()});function ut({queryKey:s,path:t}={queryKey:void 0,path:void 0}){return N({queryKey:s??S(t),queryFn:async()=>x().get(t??G.currentRoute.value.path).then(({data:e})=>e.data)})}function nt({queryKey:s,path:t,homeData:e}){return Z({mutationKey:s??S(t),mutationFn:async r=>{var o;const a=[...((o=e.value)==null?void 0:o.map(c=>structuredClone(H(c))))??[]];for(const c of r)await x().post(t??c.update.link,{replace_id:c.update.body.replace_id}).then(v=>{var b,m,u;for(let h=0;h<a.length;h++)a[h].id===((m=(b=c.update)==null?void 0:b.body)==null?void 0:m.replace_id)&&(a[h]=(u=v.data)==null?void 0:u.data[0])});return a}})}export{ut as a,nt as b,at as g,S as q};
