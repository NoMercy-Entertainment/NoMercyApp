import{$ as Z,At as l,C as D,Dt as j,Et as y,H as _e,K as he,O as z,S as a,T as v,Y as o,Z as L,_t as i,c as J,g as G,j as X,k as u,lt as x,st as M,w as P,x as ae}from"./i18n-DXLa9EKW.js";import"./ionic-B9XaRwPa.js";import{x as xe,y as be}from"./vue-core-DBpBuPMK.js";import{c as W,h as R,w as ye}from"./primevue-wrrgrfJj.js";import{c as re}from"./query-DJ5OsBey.js";import{$i as H,Qi as N,Si as le,b as te,fr as se,k as oe,ka as ge,x as we,y as T,za as $e}from"./index-CLM6Y7vI.js";import"./useInfiniteServerClient-DbihGahL.js";import{t as ie}from"./useServerClient-QYfn39K-.js";import{t as Y}from"./ScrollContainer-aZQSs5X2.js";import"./useMounted-DrbBl1d-.js";import"./RipperOverlay-DCWWVsFD.js";import"./ripperSocket-AoTnHHCA.js";import"./FloatingBackButton-BrTpeYvl.js";import{t as q}from"./Checkbox-Bjsg5322.js";import{t as ke}from"./DashboardLayout-BtrwC5sp.js";import{t as Ce}from"./useSortable-BsdiAA6X.js";be();J();var Se={class:"my-6 text-sm text-surface-10"},Ve=X({__name:"DeleteSpecialModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(A){const k=A,g=re(),m=ye(),c=i(!1);async function n(){if(!c.value){c.value=!0;try{const{data:_}=await N().delete(`dashboard/specials/${k.id}`);m.add({severity:_.status==="ok"?"success":"error",summary:le(_.status==="ok"?"Success":"Error"),detail:le(_.message,..._.args??[]),life:5e3}),g.invalidateQueries({queryKey:["dashboard","specials"]}),k.close(),k.noRedirect||oe.back()}catch{c.value=!1}}}return(_,w)=>{const C=Z("Button");return o(),D(we,{close:A.close,open:A.open,params:{special:k.name},"max-width":"max-w-xl",title:"Delete special {{special}}"},{actions:x(()=>[u(C,{id:"yes",disabled:c.value,onclick:n,color:"red","end-icon":"trash",type:"button"},{default:x(()=>[z(l(c.value?_.$t("Deleting..."):_.$t("Delete")),1)]),_:1},8,["disabled"]),u(C,{id:"no",disabled:c.value,onclick:A.close,color:"auto",type:"button",variant:"text"},{default:x(()=>[z(l(_.$t("Cancel")),1)]),_:1},8,["disabled","onclick"])]),default:x(()=>[a("div",Se,l(_.$t("Are you sure you want to delete this special?")),1)]),_:1},8,["close","open","params"])}}}),De=Ve;J();var Ee={class:"flex flex-col gap-4 w-full h-full min-h-0"},Ae={class:"relative flex items-center flex-1 rounded-lg border border-surface-8/8 bg-surface-2 shadow-lg"},Ie={key:0,class:"absolute top-full left-0 right-0 mt-1 z-50 rounded-lg border border-surface-5/8 bg-surface-6 shadow-lg overflow-hidden"},Be={key:0,class:"flex items-center justify-center h-16 text-sm text-surface-9"},Pe={class:"flex flex-col"},Ue=["onClick"],ze={key:1,class:"w-[18px] flex-shrink-0"},Te={class:"flex flex-col flex-1 min-w-0"},qe={class:"text-sm font-medium text-surface-12 truncate"},Oe={key:0,class:"text-xs text-surface-9 truncate"},Re={class:"text-xs text-surface-9 w-16 text-right capitalize flex-shrink-0"},je={class:"flex gap-4 w-full h-full min-h-0"},Me={class:"flex flex-col flex-1 min-w-0 rounded-lg border border-surface-5 bg-surface-2 overflow-hidden"},Ne={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},Fe={class:"text-xs font-medium text-surface-12 flex-1"},Qe={class:"flex flex-col flex-1 overflow-hidden relative"},Ke={class:"flex flex-col"},Le={key:0,class:"flex items-center justify-center h-24 text-sm text-surface-9"},Ge=["onClick"],We={class:"flex flex-col flex-1 min-w-0"},He={class:"text-sm font-medium text-surface-12 truncate"},Ye={key:0,class:"text-xs text-surface-9 truncate"},Ze={class:"text-xs text-surface-9 w-16 text-right capitalize flex-shrink-0"},Je={class:"flex flex-col items-center justify-start gap-2 flex-shrink-0 py-10"},Xe={class:"flex flex-col flex-1 min-w-0 rounded-lg border border-surface-5 bg-surface-2 overflow-hidden"},ea={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},aa={class:"text-xs font-medium text-surface-12 w-12"},la={class:"text-xs font-medium text-surface-12 flex-1"},ta={class:"flex flex-col flex-1 overflow-hidden relative"},sa={key:0,class:"flex items-center justify-center h-24 text-sm text-surface-9"},ra={class:"flex flex-col flex-1 min-w-0"},oa={class:"text-sm font-medium text-surface-12 truncate"},ia={key:0,class:"text-xs text-surface-9 truncate"},da={class:"text-sm text-surface-9 w-12 text-right flex-shrink-0"},ua={class:"flex items-start gap-4 px-4 py-2 bg-surface-5/10 border-b border-surface-1/8"},na={class:"text-xs font-medium text-surface-12 flex flex-1 justify-start gap-2"},ca={class:"w-12 text-right"},va=X({__name:"PlaylistEditor",props:{specialId:{}},setup(A,{expose:k}){const g=A,m=i([]),c=i([]),n=i(""),_=$e(n,350),w=i([]),C=i(!1),S=i([]),I=i(null),$=i(!1),V=i(null),d=i([]),f=i([]),{data:E,refetch:O}=ie({path:`dashboard/specials/${g.specialId}/items`,queryKey:["dashboard","specials",g.specialId,"items"]});M(_,async e=>{if(e.trim().length<2){w.value=[],$.value=!1;return}C.value=!0;try{const{data:s}=await N().get(`dashboard/specials/search?q=${encodeURIComponent(e)}`);w.value=Array.isArray(s)?s:s.data??[],$.value=!0}catch{w.value=[]}finally{C.value=!1}}),ge(I,()=>{$.value=!1});function B(){w.value.length&&($.value=!0)}function U(e){return m.value.some(s=>s.media_id===e.id&&s.media_type===e.media_type)||d.value.some(s=>s.media_id===e.id&&s.media_type===e.media_type)}function r(e){return{id:`avail-${e.media_type}-${e.id}`,order:m.value.length,media_type:e.media_type,media_id:e.id,title:e.title,overview:e.overview,still:e.still,poster:e.poster,year:e.year,show_title:e.show_title,season_number:e.season_number,episode_number:e.episode_number,available:e.available}}function p(e){const s=S.value.indexOf(e);s>=0?S.value.splice(s,1):S.value.push(e)}function F(){w.value.filter(e=>S.value.includes(e.id)&&!U(e)).forEach(e=>{m.value.push(r(e))}),S.value=[]}const h=ae(()=>se(c.value,m.value));function de(e){const s=c.value.indexOf(e);s>=0?c.value.splice(s,1):c.value.push(e)}function ue(){h.value?c.value=[]:c.value=m.value.map(e=>e.id)}M(E,e=>{e&&(d.value=[...e].sort((s,b)=>s.order-b.order))},{immediate:!0}),Ce(V,d,{animation:150,handle:".drag-handle"});const ee=ae(()=>se(f.value,d.value));function ne(e){const s=f.value.indexOf(e);s>=0?f.value.splice(s,1):f.value.push(e)}function ce(){ee.value?f.value=[]:f.value=d.value.map(e=>e.id)}function ve(){const e=m.value.filter(b=>c.value.includes(b.id)&&!d.value.some(t=>t.media_id===b.media_id&&t.media_type===b.media_type)),s=d.value.length;e.forEach((b,t)=>{d.value.push({...b,id:`pending-${b.media_type}-${b.media_id}`,order:s+t})}),m.value=m.value.filter(b=>!c.value.includes(b.id)),c.value=[]}function fe(){d.value.filter(e=>f.value.includes(e.id)).forEach(e=>{m.value.some(s=>s.media_id===e.media_id&&s.media_type===e.media_type)||m.value.push({...e,id:`avail-${e.media_type}-${e.media_id}`})}),d.value=d.value.filter(e=>!f.value.includes(e.id)),f.value=[]}const pe=re(),Q=i(!1);async function me(){Q.value=!0;try{await N().patch(`dashboard/specials/${g.specialId}/items`,{items:d.value.map((e,s)=>({media_type:e.media_type,media_id:e.media_id,order:s}))}),await pe.invalidateQueries({queryKey:["dashboard","specials",g.specialId,"items"]}),await O()}finally{Q.value=!1}}return k({save:me,isSaving:Q}),(e,s)=>{const b=Z("InputText");return o(),v("div",Ee,[a("div",{ref_key:"searchWrapperEl",ref:I,class:"relative flex gap-4 pt-4"},[a("div",Ae,[u(te,{"class-name":"absolute left-3 w-4 text-surface-9 pointer-events-none z-10",icon:"searchMagnifyingGlass"}),u(b,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),placeholder:e.$t("Search movies and episodes..."),class:"w-full !pl-9",size:"small",variant:"filled",onFocus:B},null,8,["modelValue","placeholder"])]),u(T,{id:"add-from-search",disabled:S.value.length===0,color:"theme","end-icon":"addCircle",type:"button",variant:"contained",onClick:F},{default:x(()=>[z(l(e.$t("Add selected")),1)]),_:1},8,["disabled"]),$.value&&(C.value||w.value.length>0)?(o(),v("div",Ie,[C.value?(o(),v("div",Be,[...s[1]||(s[1]=[a("div",{class:"w-8 h-8 border-2 border-focus border-t-transparent rounded-full animate-spin"},null,-1)])])):(o(),D(Y,{key:1,static:!1,class:"max-h-80"},{default:x(()=>[a("div",Pe,[(o(!0),v(G,null,L(w.value,t=>(o(),v("div",{key:`${t.media_type}-${t.id}`,class:j([[U(t)?"opacity-40 cursor-default":"cursor-pointer"],"flex items-center gap-3 px-4 h-11 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"]),onClick:K=>!U(t)&&p(t.id)},[U(t)?(o(),v("span",ze)):(o(),D(q,{key:0,"model-value":S.value.includes(t.id)},null,8,["model-value"])),a("div",Te,[a("span",qe,l(t.title),1),t.show_title?(o(),v("span",Oe,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):P("",!0)]),a("span",Re,l(t.media_type),1)],10,Ue))),128))])]),_:1}))])):P("",!0)],512),a("div",je,[a("div",Me,[a("div",Ne,[u(q,{"model-value":h.value,"onUpdate:modelValue":ue},null,8,["model-value"]),a("span",Fe,l(e.$t("Title")),1)]),a("div",Qe,[u(Y,{static:!1,class:"flex-1 min-h-0"},{default:x(()=>[a("div",Ke,[m.value.length===0?(o(),v("div",Le,l(e.$t("Search and add items above")),1)):(o(!0),v(G,{key:1},L(m.value,t=>(o(),v("div",{key:t.id,class:j([[!t.available&&"opacity-40"],"flex items-center gap-4 px-4 h-12 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"]),onClick:K=>de(t.id)},[u(q,{"model-value":c.value.includes(t.id)},null,8,["model-value"]),a("div",We,[a("span",He,l(t.title),1),t.show_title?(o(),v("span",Ye,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):P("",!0)]),a("span",Ze,l(t.media_type),1)],10,Ge))),128))])]),_:1})])]),a("div",Je,[u(T,{id:"add-to-playlist",disabled:c.value.length===0,class:"!w-8",color:"theme","end-icon":"arrowRight",size:"sm",onClick:ve},null,8,["disabled"]),u(T,{id:"remove-from-playlist",disabled:f.value.length===0,class:"!w-8",color:"theme",size:"sm","start-icon":"arrowLeft",variant:"outlined",onClick:fe},null,8,["disabled"])]),a("div",Xe,[a("div",ea,[a("span",aa,l(e.$t("Order")),1),u(q,{"model-value":ee.value,"onUpdate:modelValue":ce},null,8,["model-value"]),a("span",la,l(e.$t("Title")),1)]),a("div",ta,[u(Y,{static:!1,class:"flex-1 min-h-0"},{default:x(()=>[a("div",{ref_key:"playlistEl",ref:V,class:"flex flex-col"},[d.value.length===0?(o(),v("div",sa,l(e.$t("Add items from the left panel")),1)):(o(!0),v(G,{key:1},L(d.value,(t,K)=>(o(),v("div",{key:t.id,class:"flex items-center gap-4 px-4 h-12 select-none hover:bg-surface-12/4 transition-colors duration-100 odd:bg-surface-12/[0.02]"},[u(te,{"class-name":"drag-handle w-4 text-surface-9 cursor-grab active:cursor-grabbing flex-shrink-0 !pointer-events-auto",icon:"menuDotsVertical"}),u(q,{"model-value":f.value.includes(t.id),"onUpdate:modelValue":Ma=>ne(t.id)},null,8,["model-value","onUpdate:modelValue"]),a("div",ra,[a("span",oa,l(t.title),1),t.show_title?(o(),v("span",ia,l(t.show_title)+" · S"+l(t.season_number)+"E"+l(t.episode_number),1)):P("",!0)]),a("span",da,l(K+1),1)]))),128))],512)]),_:1})]),a("div",ua,[a("span",na,[a("span",null,l(e.$t("Total"))+":",1),a("span",ca,l(d.value.length),1),a("span",null,l(e.$t("items")),1)])])])])])}}}),fa=va;J();var pa={class:"flex items-center gap-2"},ma={key:0,class:"flex gap-6 w-full p-4"},_a={class:"flex flex-col gap-4 rounded-xl bg-surface-12/3 p-5 w-full"},ha={class:"text-base font-semibold text-surface-12"},xa={class:"flex flex-col gap-2"},ba={class:"text-sm font-medium text-surface-12/60",for:"name"},ya={class:"flex flex-col gap-2"},ga={class:"text-sm font-medium text-surface-12/60",for:"overview"},wa={class:"flex flex-col gap-4 rounded-xl bg-surface-12/3 p-5 w-full"},$a={class:"text-base font-semibold text-surface-12"},ka={class:"flex flex-col gap-4"},Ca={class:"flex items-start gap-4"},Sa={key:1,class:"w-28 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-backdrop flex items-center justify-center"},Va={class:"text-xs text-surface-9"},Da={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Ea={class:"text-sm font-medium text-surface-12/60",for:"backdrop"},Aa={class:"flex items-start gap-4"},Ia={key:1,class:"w-28 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-backdrop flex items-center justify-center"},Ba={class:"text-xs text-surface-9"},Pa={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Ua={class:"text-sm font-medium text-surface-12/60",for:"logo"},za={class:"flex items-start gap-4"},Ta={key:1,class:"w-20 flex-shrink-0 rounded-lg bg-surface-12/6 aspect-poster flex items-center justify-center"},qa={class:"text-xs text-surface-9"},Oa={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Ra={class:"text-sm font-medium text-surface-12/60",for:"poster"},ja=X({__name:"Edit",setup(A){const k=xe(),{data:g,error:m,refetch:c}=ie({path:"dashboard/specials",queryKey:["dashboard","specials"]}),n=i();_e(()=>{c()}),he(()=>{g.value&&(n.value=g.value.find(r=>r.id===k.params.id))}),M(g,r=>{r&&(n.value=r.find(p=>p.id===k.params.id))});const _=i(!1);function w(){_.value=!0}function C(){_.value=!1}function S(){oe.back()}const I=i(n.value?.title||""),$=i(n.value?.overview||""),V=i(n.value?.backdrop||""),d=i(n.value?.poster||""),f=i(n.value?.logo||"");M(n,r=>{r&&(I.value=r?.title,$.value=r?.overview,V.value=r?.backdrop,d.value=r?.poster,f.value=r?.logo)});const E=i("Details"),O=i(),B=i(!1);async function U(){if(!B.value){B.value=!0;try{await Promise.all([N().patch(`/dashboard/specials/${n.value?.id}`,{title:I.value,overview:$.value,backdrop:V.value,poster:d.value,logo:f.value}),O.value?.save()])}finally{B.value=!1}}}return(r,p)=>{const F=Z("Textarea");return o(),D(ke,{error:y(m),"grid-style":4,params:{title:n.value?.title},"class-name":"!m-0",title:"Special: {{title}}"},{"pre-cta":x(()=>[a("nav",pa,[a("button",{class:j([E.value==="Details"?"bg-focus/11 border-focus/4":"border-transparent hover:bg-focus/10 hover:border-focus/4","flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-semibold transition-colors duration-200"]),onClick:p[0]||(p[0]=h=>E.value="Details")},l(r.$t("Details")),3),a("button",{class:j([E.value==="Playlist"?"bg-focus/11 border-focus/4":"border-transparent hover:bg-focus/10 hover:border-focus/4","flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-semibold transition-colors duration-200"]),onClick:p[1]||(p[1]=h=>E.value="Playlist")},l(r.$t("Playlist")),3)])]),actions:x(()=>[u(T,{id:"remove",class:"children:text-gray-400 children:transition-colors children:duration-100 children:hover:text-red-dark-8",color:"auto","start-icon":"folderRemove",type:"button",variant:"text",onClick:w},{default:x(()=>[z(l(r.$t("Remove")),1)]),_:1}),u(T,{id:"cancel",color:"white",type:"button",variant:"text",onClick:S},{default:x(()=>[z(l(r.$t("Cancel")),1)]),_:1}),u(T,{id:"save",disabled:B.value,class:"ml-auto",color:"theme",type:"button",onClick:U},{default:x(()=>[z(l(B.value?r.$t("Saving..."):r.$t("Save")),1)]),_:1},8,["disabled"])]),default:x(()=>[E.value==="Details"?(o(),v("div",ma,[a("section",_a,[a("h3",ha,l(r.$t("General")),1),a("div",xa,[a("label",ba,l(r.$t("Name")),1),u(y(R),{id:"name",modelValue:I.value,"onUpdate:modelValue":p[2]||(p[2]=h=>I.value=h),class:"w-full",variant:"filled"},null,8,["modelValue"])]),a("div",ya,[a("label",ga,l(r.$t("Overview")),1),u(F,{id:"overview",modelValue:$.value,"onUpdate:modelValue":p[3]||(p[3]=h=>$.value=h),rows:6,class:"w-full",variant:"filled"},null,8,["modelValue"])])]),a("section",wa,[a("h3",$a,l(r.$t("Artwork")),1),a("div",ka,[a("div",Ca,[V.value?(o(),D(y(W),{key:0,src:`${y(H)?.serverBaseUrl}/images/original${V.value}`,alt:"Backdrop",class:"w-28 flex-shrink-0 rounded-lg overflow-hidden aspect-backdrop",preview:""},null,8,["src"])):(o(),v("div",Sa,[a("span",Va,l(r.$t("No image")),1)])),a("div",Da,[a("label",Ea,l(r.$t("Backdrop")),1),u(y(R),{id:"backdrop",modelValue:V.value,"onUpdate:modelValue":p[4]||(p[4]=h=>V.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])]),a("div",Aa,[f.value?(o(),D(y(W),{key:0,src:`${y(H)?.serverBaseUrl}/images/original${f.value}`,alt:"Logo",class:"w-28 flex-shrink-0 rounded-lg overflow-hidden aspect-backdrop bg-surface-12/6",preview:""},null,8,["src"])):(o(),v("div",Ia,[a("span",Ba,l(r.$t("No image")),1)])),a("div",Pa,[a("label",Ua,l(r.$t("Logo")),1),u(y(R),{id:"logo",modelValue:f.value,"onUpdate:modelValue":p[5]||(p[5]=h=>f.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])]),a("div",za,[d.value?(o(),D(y(W),{key:0,src:`${y(H)?.serverBaseUrl}/images/original${d.value}`,alt:"Poster",class:"w-20 flex-shrink-0 rounded-lg overflow-hidden aspect-poster",preview:""},null,8,["src"])):(o(),v("div",Ta,[a("span",qa,l(r.$t("No image")),1)])),a("div",Oa,[a("label",Ra,l(r.$t("Poster")),1),u(y(R),{id:"poster",modelValue:d.value,"onUpdate:modelValue":p[6]||(p[6]=h=>d.value=h),class:"w-full",size:"small",variant:"filled"},null,8,["modelValue"])])])])])])):P("",!0),E.value==="Playlist"&&n.value?.id?(o(),D(fa,{key:1,ref_key:"playlistEditorRef",ref:O,"special-id":n.value.id,class:"w-full flex-1 min-full"},null,8,["special-id"])):P("",!0),n.value?.id?(o(),D(De,{key:2,id:n.value?.id,close:C,name:n.value?.title,open:_.value},null,8,["id","name","open"])):P("",!0)]),_:1},8,["error","params"])}}}),sl=ja;export{sl as default};
