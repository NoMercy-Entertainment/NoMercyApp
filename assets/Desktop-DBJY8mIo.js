import{C as _,J as d,O as m,Q as x,S as i,T as S,Tt as I,X as j,c as g,ct as n,g as A,gt as u,j as C,k as c,kt as f,n as B,x as E}from"./i18n-Cs-AFcrY.js";import"./ionic-XwZpO7IE.js";import"./vue-core-CKeWI2Kt.js";import"./query-28IwY2wK.js";import{Ji as T,Xi as M,_n as D,x as L,y as h}from"./index-BnnbGJJT.js";import"./useInfiniteServerClient-BaqYBifM.js";import{t as N}from"./useServerClient-BaNodTh9.js";import"./md5-CGFWI3rU.js";import"./ScrollContainer-DGY1ZpQv.js";import"./useMounted-18HlRU8K.js";import"./RipperOverlay-9iqczFKj.js";import"./ripperSocket-CkNjtSGm.js";import"./FloatingBackButton-Bd4mVBBR.js";import{t as O}from"./DashboardLayout-Cs7-GZW_.js";import{t as z}from"./DashboardCard-lUN_KSHW.js";import{t as F}from"./useApiClient-C_WekoXJ.js";import{t as J}from"./Avatar-CDQNyVLI.js";g();var K={class:"backdropCard relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},Q=["src"],X=C({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(l){const s=u(!1);function p(t){console.error(t),t.target.onerror=null,s.value=!0}return(t,a)=>(d(),_(z,{line1:l.data.name,route:`/dashboard/users/${l.data.user_id}`,line2:""},{image:n(()=>[i("div",K,[a[0]||(a[0]=i("div",{class:"backdropCard-overlay"},null,-1)),l.data.avatar&&!s.value?(d(),S("img",{key:0,onerror:p,src:l.data.avatar,alt:"",class:"w-full h-full object-cover rounded-lg backdropCard-image"},null,8,Q)):(d(),_(J,{key:1,email:l.data.email,class:"w-full backdropCard-image"},null,8,["email"]))])]),_:1},8,["line1","route"]))}}),Z=X;g();var W={class:"flex w-full flex-col justify-start text-left"},G={class:"py-4 text-sm text-surface-10"},H={class:"flex flex-col gap-2 w-full"},P={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},R=C({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(l){const s=l,{t:p}=B();u(null);const t=u(!1),a=u(""),v=u([]),{data:k}=N({path:"/dashboard/libraries"}),o=u();function y(){v.value=[],s.close()}function w(r){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(r).toLowerCase())}const V=E(()=>a.value?w(a.value):!1);async function $(){if(!a.value){v.value.push({type:"error",place:"email",message:p("Email is required")});return}if(!w(a.value)){v.value.push({type:"error",place:"email",message:p("Invalid email address")});return}if(!t.value){t.value=!0;try{await D().post("server/server-users",{id:M.value?.id,email:a.value,libraries:o.value?.map(r=>r.id)}),T.invalidateQueries({queryKey:["server_users"]}),a.value="",s.close()}catch(r){const{response:e}=r;e?.status!==200&&e?.data&&v.value.push({message:e.data.message??"An error occurred",place:"email",type:e.data.status??e.data.exception})}finally{t.value=!1}}}return(r,e)=>{const q=x("InputText"),U=x("MultiSelect");return d(),_(L,{close:y,open:l.open,title:"Invite user"},{actions:n(()=>[c(h,{id:"yes",disabled:!V.value||t.value,color:"theme","end-icon":"emailSend",type:"button",variant:"contained",onClick:$},{default:n(()=>[m(f(t.value?r.$t("Sending..."):r.$t("Send")),1)]),_:1},8,["disabled"]),c(h,{id:"no",disabled:t.value,type:"button",variant:"text",onClick:y},{default:n(()=>[m(f(r.$t("Cancel")),1)]),_:1},8,["disabled"])]),default:n(()=>[i("div",W,[i("p",G,[m(f(r.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=i("br",null,null,-1)),m(" "+f(r.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",H,[e[3]||(e[3]=i("label",{for:"email"},"Email",-1)),c(q,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=b=>a.value=b),class:"mb-4"},null,8,["modelValue"])]),i("div",P,[e[4]||(e[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),c(U,{id:"libraries",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=b=>o.value=b),options:I(k),display:"chip",label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),Y=R;g();var ee=C({__name:"Desktop",setup(l){const s=u(!1),{data:p}=F({path:"server/server-users",params:{id:M.value?.id},queryKey:["server_users"]});function t(){s.value=!0,setTimeout(()=>{document.querySelector("#email")?.focus()},300)}function a(){s.value=!1}return(v,k)=>(d(),_(O,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:n(()=>[c(h,{id:"invite",color:"theme","start-icon":"userAdd",onClick:t},{default:n(()=>[m(f(v.$t("Invite user")),1)]),_:1})]),default:n(()=>[(d(!0),S(A,null,j([...I(p)??[]].sort((o,y)=>o.name.localeCompare(y.name)),o=>(d(),_(Z,{key:o.user_id,data:o},null,8,["data"]))),128)),c(Y,{open:s.value,close:a},null,8,["open"])]),_:1}))}}),be=ee;export{be as default};
