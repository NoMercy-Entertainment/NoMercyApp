{"version":3,"file":"Mobile-_-n3UOgS.js","sources":["../../src/views/Music/List/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {onMounted, ref, watch} from 'vue';\nimport {useRoute} from 'vue-router';\nimport {IonContent, IonPage, isPlatform, onIonViewWillEnter} from '@ionic/vue';\n\nimport type { DisplayList } from '@/types/api/music/musicPlayer';\n\nimport { PlaylistItem, SortOrder, SortType } from '@/types/musicPlayer';\n\nimport useServerClient from '@/lib/clients/useServerClient';\nimport { breakTitle, setTitle, sortByType } from '@/lib/stringArray';\nimport { setColorPalette, setSortOrder, sortOrder, sortType } from '@/store/ui';\n\nimport ControlHeader from '@/views/Music/List/components/ControlHeader.vue';\nimport ArtistHeader from '@/views/Music/List/components/ArtistHeader.vue';\nimport SortHeader from '@/views/Music/List/components/SortHeader.vue';\nimport TrackRow from '@/views/Music/List/components/TrackRow.vue';\nimport MoooomIcon from '@/components/Images/icons/MoooomIcon.vue';\nimport NotFound from \"@/Layout/Desktop/components/NotFound.vue\";\n\nconst route = useRoute();\n\nconst { data, isError } = useServerClient<DisplayList>({\n  path: route.fullPath,\n  keepForever: true,\n});\n\nconst main = ref<HTMLDivElement | null>(null);\n\nconst displayList = ref<PlaylistItem[]>();\nconst filter = ref('');\n\nwatch(data, (value) => {\n  setTitle(value?.name ?? null);\n\n  sort(value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n\n  setColorPalette(value?.color_palette?.cover);\n});\n\nwatch(sortOrder, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, value, filter.value);\n});\nwatch(sortType, (value) => {\n  sort(data.value?.tracks ?? [], value, sortOrder.value, filter.value);\n});\nwatch(filter, (value) => {\n  sort(data.value?.tracks ?? [], sortType.value, sortOrder.value, value);\n});\n\nconst sort = (songs: PlaylistItem[], sortType: SortType, sortOrder: SortOrder, value: string) => {\n\n  const newList = sortByType<PlaylistItem>(songs ?? [], sortType, sortOrder, setSortOrder);\n\n  if (value == '') {\n    displayList.value = newList;\n  } else {\n    // @ts-ignore\n    displayList.value = newList?.filter(t =>\n      t.name?.toLowerCase().includes(value?.toLowerCase?.())\n      || t.artist_track?.some(a => a.name.toLowerCase().includes(value?.toLowerCase?.()))\n      || t.album_track?.[0]?.name.toLowerCase().includes(value?.toLowerCase?.())) ?? [];\n  }\n};\n\nonMounted(() => {\n  sort(data?.value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n  if (data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n});\n\nonIonViewWillEnter(() => {\n  sort(data?.value?.tracks ?? [], sortType.value, sortOrder.value, filter.value);\n  if (data.value?.color_palette?.cover) {\n    setColorPalette(data.value?.color_palette?.cover);\n  }\n});\n\nconst handleBack = () => {\n  window.history.back();\n};\n\nconst showScrollHeader = ref(false);\nconst showScrollHeaderText = ref(false);\nconst sortHeader = ref<VueDivElement>();\nconst container = ref<VueDivElement>();\n\nconst onScroll = () => {\n  // if(window.CSS.supports('container-type', 'scroll-state')) return;\n\n  const headerScrollTop = 170;\n  const headerScrollTextTop = 160;\n  const sortHeaderTop = isPlatform('capacitor') ? 88 : 64;\n\n  const top = sortHeader.value?.$el?.getBoundingClientRect().top;\n  if (!top) {\n    requestAnimationFrame(onScroll);\n    return;\n  }\n\n  showScrollHeader.value = top <= headerScrollTop;\n  showScrollHeaderText.value = top <= headerScrollTextTop;\n\n  if (top == sortHeaderTop) {\n    sortHeader.value?.$el?.classList.add('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.add('!bg-slate-light-10/11', 'dark:!bg-[rgb(var(--background-auto)/79%)]');\n  } else {\n    sortHeader.value?.$el?.classList.remove('!bg-focus');\n    sortHeader.value?.$el?.firstChild?.classList.remove('!bg-slate-light-10/11', 'dark:!bg-[rgb(var(--background-auto)/79%)]');\n  }\n\n  requestAnimationFrame(onScroll);\n};\n\nwatch(container, () => {\n  requestAnimationFrame(onScroll);\n});\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content ref=\"container\" @ionScroll=\"onScroll\" :scrollEvents=\"true\">\n      <NotFound v-if=\"isError && !data\" />\n      <div\n        v-else-if=\"!route.params.id || (route.params.id && data?.id == route.params.id)\"\n        ref=\"main\"\n        class=\"flex flex-col h-auto overflow-x-clip w-available sm:rounded-2xl -mt-safe-offset-12 bg-[rgb(var(--background-auto))]\">\n        <ArtistHeader :data=\"data\" />\n\n        <div class=\"relative z-0 flex h-auto flex-shrink-0 flex-grow flex-col items-start justify-start self-stretch\">\n\n          <div class=\"pointer-events-none absolute z-0 h-96 w-full bg-spotifyBottom bg-focus\"></div>\n\n          <div id=\"navbar\"\n            class=\"fixed z-1099 -mx-2 flex gap-4 p-2 px-4 w-available sm:hidden bg-slate-light-11 dark:bg-slate-dark-1 top-0 pt-safe-offset-4 transition-all duration-300\"\n            :class=\"{\n              'opacity-0 pointer-events-none': !showScrollHeader,\n              'opacity-100 pointer-events-auto': showScrollHeader\n            }\">\n            <div id=\"navBg\"\n              class=\"z-20 absolute flex items-center inset-0 w-available h-full bg-focus/12 dark:bg-focus transition-all duration-300 bg-spotifyTop opacity-50 pointer-events-none\">\n            </div>\n\n            <button @click=\"handleBack\" class=\"z-30 flex h-10 w-11 items-center justify-center rounded-md\">\n              <MoooomIcon icon=\"arrowLeft\" />\n            </button>\n\n            <div id=\"navText\"\n              class=\"pointer-events-none whitespace-pre text-left relative z-20 line-clamp-1 h-auto self-center font-bold leading-none transition-all duration-300 w-[70%] overflow-clip text-xl\"\n              :class=\"{\n                'opacity-0 pointer-events-none': !showScrollHeader,\n                'opacity-100 pointer-events-auto': showScrollHeader\n              }\" v-html=\"breakTitle(data?.name ?? 'Songs you like', 'text-xs line-clamp-1')\">\n            </div>\n          </div>\n\n          <ControlHeader :key=\"data?.id\" :data=\"data\" :filter=\"filter\" @filter-change=\"(e: string) => filter = e\" />\n\n          <div\n            class=\"flex flex-1 flex-shrink-0 flex-col items-start justify-start self-stretch bg-slate-dark-12 dark:bg-transparent flex-grow-1 gap-0.5 sm:p-4\">\n            <SortHeader ref=\"sortHeader\" :key=\"data?.id\" />\n\n            <TrackRow v-for=\"(item, index) in displayList\" :key=\"item.id\" :data=\"item\" :displayList=\"displayList\"\n              :index=\"index\" />\n          </div>\n        </div>\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n"],"names":["route","useRoute","data","isError","useServerClient","main","ref","displayList","filter","watch","value","setTitle","sort","sortType","sortOrder","setColorPalette","_a","songs","newList","sortByType","setSortOrder","_b","t","_c","a","_f","_d","_e","onMounted","onIonViewWillEnter","handleBack","showScrollHeader","showScrollHeaderText","sortHeader","container","onScroll","sortHeaderTop","isPlatform","top","_g","_i","_h","_l","_k","_j"],"mappings":"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"}