import{d}from"./api-BBofn2cc.js";import{$,a7 as A,d as l,f as B,w as g,c as x,o as r,l as y,y as M,a0 as s,au as j,h as p,i as e,v as o,b as k,b9 as q,ar as F}from"./vue-ionic-DNlOg-eX.js";import{bt as H,bu as b,J as I,x as i,bv as L,r as T,bw as Q}from"./index-B5eD0-7Z.js";import"./vendor-C28OoIfY.js";import"./media-C2AqgyMX.js";import"./icons-BW5E66pf.js";import"./swiper-D00Cnjmx.js";import"./music-player-JWnzXDV1.js";import"./rxjs-BCp2L9Rn.js";const R={key:0,class:"flex h-screen w-screen flex-nowrap items-center justify-between gap-4 overflow-hidden p-24 text-slate-light-12 dark:text-slate-dark-12 bg-slate-light-3 dark:bg-slate-dark-1"},z={class:"flex w-2/3 flex-col gap-4 font-semibold"},D={class:"text-3xl"},E={class:"flex items-start gap-4"},J={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},K={class:"flex flex-col gap-2 text-lg"},P={class:"text-2xl font-semibold whitespace-break-spaces"},Y={class:"flex items-start gap-4"},G={class:"whitespace-nowrap rounded-md px-3 leading-8 text-white bg-theme-600"},O={class:"flex flex-col gap-2 text-lg"},U={class:"grid w-1/3 place-items-center gap-4 p-4 font-semibold"},W=["src"],X={key:1,class:"grid h-screen w-screen place-items-center"},Z={role:"status"},de=$({__name:"Tv",setup(ee){const{t:c}=A(),C=l(`https://${i?`${i.replace("-","")}.`:""}nomercy.tv/tv`),u=l(""),N=l(!1),h=l(!1),V=l("L"),S=l("canvas"),a=l();B(async()=>{try{await H(),b();const{isAuthenticated:t}=I();t.value=!0}catch{d.post(`https://auth${i}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/auth/device`,{client_id:"nomercy-ui",scope:"openid profile email",cancelToken:new d.CancelToken(n=>n("Cancel repeated request"))},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(n=>{a.value=n.data,h.value=!0}).catch(n=>{console.log(n)})}}),g(a,t=>{t&&(console.log(t),setTimeout(()=>{m()},t.interval*1e3))});function m(){var t;d.post(`https://auth${i}.nomercy.tv/realms/NoMercyTV/protocol/openid-connect/token`,{grant_type:"urn:ietf:params:oauth:grant-type:device_code",client_id:"nomercy-ui",scope:"openid",device_code:(t=a.value)==null?void 0:t.device_code},{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(async n=>{L(n.data),b(),setTimeout(async()=>{await T.push({name:"Home"})},500)}).catch(()=>{setTimeout(()=>{m()},a.value.interval*1e3)})}return g(Q,t=>{t.length!==0&&setTimeout(async()=>{await T.push({name:"Home"})},1e3)}),(t,n)=>(r(),x(s(F),null,{default:y(()=>[M(s(j),{fullscreen:!0},{default:y(()=>{var v,_,f,w;return[h.value&&((v=a.value)!=null&&v.user_code)&&!N.value?(r(),p("div",R,[e("div",z,[e("h1",D,o(s(c)("Follow these steps on your computer or mobile device")),1),e("div",E,[e("span",J,o(s(c)("Step"))+" 1",1),e("div",K,[e("p",null,o(s(c)("Scan the QR with your phone or go to"))+":",1),e("p",P,o(C.value)+"?code="+o((_=a.value)==null?void 0:_.user_code),1)])]),e("div",Y,[e("span",G,o(s(c)("Step"))+" 2",1),e("div",O,[e("p",null,o(s(c)("Sign in to NoMercy"))+".",1),e("p",null,o(s(c)("Your tv will be ready to watch"))+".",1)])])]),e("div",U,[(f=a.value)!=null&&f.verification_uri_complete?(r(),x(q,{key:0,level:V.value,"render-as":S.value,size:250,value:(w=a.value)==null?void 0:w.verification_uri_complete,class:"bg-white p-1"},null,8,["level","render-as","value"])):k("",!0),u.value?(r(),p("img",{key:1,src:u.value,alt:"",class:"bg-white p-1"},null,8,W)):k("",!0)])])):(r(),p("div",X,[e("div",Z,[e("span",null,o(s(c)("Loading"))+"...",1)])]))]}),_:1})]),_:1}))}});export{de as default};
