import{Lt as f,Tt as b,kn as u}from"./index-BvWvvCYJ.js";import{y as n}from"./client-Cg1KDvig.js";import{t as g,u as m}from"./currentServer-WcAeFY_n.js";import{i as _}from"./user-UVXKBmDM.js";import{t as s}from"./serverClient-BAqmq0Lj.js";import{l as d,t as r,u as p}from"./router-B1ISlAzM.js";import{l as c,tt as w}from"./SocketClient-C4CiAzV3.js";import{t as v}from"./musicPlaylists-DBeSgbAD.js";import{t as C}from"./esm-C__ta2Q1.js";b();var T=(o,a)=>s().get(o);function q(o,a){return s().put(o,{data:a})}function x(o,a){return s().post(o,{data:a})}function R(o,a){return s().delete(o,{data:a})}function M(o,a){return s().patch(o,{data:a})}function Q(o){return o.map(a=>{let t;return a.method==="GET"?t=T:a.method==="PUT"?t=q:a.method==="POST"?t=x:a.method==="PATCH"?t=M:a.method==="DELETE"?t=R:t=a.command,{label:a.label,icon:a.icon,confirm:a.confirm,args:a.args,command:()=>t(a.args?.url,P.value).then(()=>{a.args?.replaceKey&&document.dispatchEvent(new CustomEvent("mutateId",{detail:{id:a.args?.replaceKey}}))})}})}const B=u({});var k=u();const H=f(()=>k.value);function O(o){k.value=o}var h=u(null);const P=f(()=>h.value);function j(o){h.value=o}const E=u([]),S=u(),e=u();function z(o,a){e.value=a;const t=[],i={label:n("Add to playlist"),icon:"mooooom-add",items:[{label:n("New Playlist"),icon:"mooooom-add",command:()=>{const l=new CustomEvent("showModal",{detail:{modalName:"createPlaylist",modalProps:e.value}});document.dispatchEvent(l)}}]};v.value.length===0&&i.items.push({label:n("No playlists")});for(const l of v.value)i.items.push({label:l.name,icon:"mooooom-disk",command:()=>{s().patch(`/music-player/playlist/${l.id}/add`,{id:e.value?.id}).then(()=>{w.invalidateQueries({queryKey:["music","tracks"]}).then(()=>{console.log("refetching tracks")})}).catch(y=>{console.error(y)})}});t.push(i),t.push({label:n("Save to your liked songs"),icon:"mooooom-heart",command:async()=>{await s().post(`${e.value?.link}/like`,{value:!e.value?.liked.value}).then(({data:l})=>{e.value&&(e.value.value=l.args?.[0]==="liked"||l.args?.[1]==="liked")})}},{label:n("Add to queue"),icon:"mooooom-playlist1Add",command:()=>{if(e.value){if(c.currentSong===null){console.log("playing track"),c.playTrack(e.value);return}console.log("adding track to queue"),c.addToQueue(e.value)}}},{separator:!0}),!d.value&&e.value?.album_track&&e.value?.album_track?.length<2?t.push({label:n("Go to album"),icon:"mooooom-disk",command:async()=>{e.value?.album_track?.[0]?.link&&await r.push(e.value?.album_track?.[0]?.link)}}):!d.value&&e.value?.album_track&&e.value?.album_track?.length>1&&t.push({label:n("Go to album"),icon:"mooooom-disk",items:e.value?.album_track?.map(l=>({label:l.name,icon:"mooooom-disk",command:async()=>await r.push(l.link)}))}),!p.value&&e.value?.artist_track&&e.value?.artist_track?.length<2?t.push({label:n("Go to artist"),icon:"mooooom-user",command:async()=>{e.value?.artist_track?.[0]?.link&&await r.push(e.value?.artist_track?.[0]?.link)}}):!p.value&&e.value?.artist_track&&e.value?.artist_track?.length>1&&t.push({label:n("Go to artist"),icon:"mooooom-user",items:e.value?.artist_track?.map(l=>({label:l.name,icon:"mooooom-user",command:async()=>await r.push(l.link)}))}),t.push({separator:!0},{label:n("Share"),icon:"mooooom-shareSquare",items:[{label:n("Copy page link"),icon:"mooooom-fileCopy",command:async()=>await m(window.location.href)},{label:n("Copy track link"),icon:"mooooom-fileCopy",command:()=>e.value?m(`${g.value?.serverBaseUrl}${e.value?.link}?token=${_.value}`):{}},{label:n("Share page"),icon:"mooooom-fileCopy",command:async()=>{const l={url:window.location.href};await C.share(l)}}]}),E.value=t,S.value.show(o)}export{z as a,E as c,Q as i,B as n,O as o,H as r,j as s,S as t};
