import{t as r}from"./index-04Sh3wNb.js";import"./dist-CVoPesok.js";import"./client-DMa-uSBE.js";import"./config-BOA2pGQM.js";import"./esm-BuRgllmc.js";import"./user-C1ciKa7-.js";import"./apiClient-Cw7f36ko.js";import{t as s}from"./notifications-Bi_dU6lP.js";function c(){return localStorage.getItem("language")||navigator.language.split("-")[0]||"en"}function l(){const e=c(),o=r[e]||r.en;return{id:`sw-update-${Date.now()}`,type:"update",title:o.newVersion,body:o.updateNow,from:"system",read:!1,created_at:Date.now(),updated_at:Date.now(),notify:!0,link:"reload"}}var t=null,n=!1;function h(){if(!("serviceWorker"in navigator)){console.log("Service worker not supported");return}console.log("Setting up service worker update detection..."),navigator.serviceWorker.addEventListener("controllerchange",()=>{n||(n=!0,window.location.reload())}),navigator.serviceWorker.getRegistration().then(e=>{if(!e){console.log("No service worker registration found");return}console.log("Service worker registration found"),a(e),e.waiting&&(t=e.waiting,i()),e.update().catch(o=>{console.log("Manual update check failed:",o)})}).catch(e=>{console.error("Failed to get service worker registration:",e)}),navigator.serviceWorker.ready.then(e=>{console.log("Service worker ready, setting up update detection..."),a(e)}).catch(e=>{console.error("Service worker ready failed:",e)}),document.addEventListener("sw-update-accepted",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(e=>{e&&(console.log("Checking for updates..."),e.update().then())}).catch(e=>{console.log("Periodic update check failed:",e)})},6e4)}function a(e){e.addEventListener("updatefound",()=>{console.log("New service worker found!");const o=e.installing;if(!o){console.log("No installing worker found");return}console.log("New worker state:",o.state),o.addEventListener("statechange",()=>{console.log("Service worker state changed to:",o.state),o.state==="installed"&&(navigator.serviceWorker.controller?(console.log("New version installed, showing notification"),t=o,i()):console.log("Service worker installed for the first time"))})})}function i(){const e=l();s(e)}export{h as setupServiceWorkerUpdates};
