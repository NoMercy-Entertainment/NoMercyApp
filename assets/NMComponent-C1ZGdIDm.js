import{C as S,Et as f,K as I,S as x,T as K,Y as h,Z as B,c as M,g as Q,j as F,q as N,st as p,tt as O,z as D}from"./i18n-DXLa9EKW.js";import{x as b,y as C}from"./vue-core-DBpBuPMK.js";import{a as R,r as T,t as U}from"./query-DJ5OsBey.js";import{$i as $,Ii as j,La as w,Qi as k,Zi as y,k as P}from"./index-CLM6Y7vI.js";import{t as Z}from"./nmComponentMap-CyeiG1p3.js";C();M();function m(t){const e=b(),r=[];return(t??e?.path)?.split("/").slice(1).forEach(u=>{u.includes("?")?(r.push(u.split("?")[0]),r.push(u.split("?")[1].split("=")[1])):r.push(u)}),r}function z({queryKey:t,path:e}={queryKey:void 0,path:void 0}){return U({mutationKey:t??m(e)})}p(w(),async t=>{t&&(await y.invalidateQueries(),y.getMutationCache().clear())});p($,async(t,e)=>{if(!t){j();return}e?.id&&t.id!==e.id&&(await y.invalidateQueries(),y.getMutationCache().clear())});function A({queryKey:t,path:e}={queryKey:void 0,path:void 0}){return R({queryKey:t??m(e),queryFn:async()=>k().get(e??P.currentRoute.value.path,{params:{}}).then(({data:r})=>r.data)})}function H({queryKey:t,path:e,homeData:r}){return T({mutationKey:t??m(e),mutationFn:async u=>{const n=new Set(u.map(i=>i.update?.body?.replace_id)),l=r.value?.map(i=>n.has(i.id)?{...i}:i)??[];for(const i of u)await k().post(e??i.update.link,{replace_id:i.update.body.replace_id}).then(c=>{for(let o=0;o<l.length;o++)l[o].id===i.update?.body?.replace_id&&(l[o]=c.data?.data[0])});return l}})}M();C();var Y={key:0,class:"grid w-available h-available place-items-center p-4"},G=F({__name:"NMComponent",props:{path:{type:String,required:!1,default:void 0},options:{type:Object,required:!1,default:()=>({keepForever:!0,queryKey:m()})}},setup(t){const e=t,r=new Set(["Home","Libraries","Music Start"]),u=e.options.queryKey??m();z({queryKey:u,path:e.path});const{data:n,isLoading:l}=A({queryKey:u,path:e.path}),{data:i,mutate:c}=H({queryKey:u,homeData:n}),o=w(),_=b();function g(){if(!n.value||!o.value)return;const a=n.value.filter(s=>s?.update?.when==="pageLoad")??[];a.length>0&&c(a)}function E(){if(!n.value||!o.value)return;const a=n.value.filter(s=>s?.update?.when==="online")??[];a.length>0&&c(a)}function q(a){const s=a;if(!n.value||!o.value)return;const d=n.value.filter(v=>v?.id===s.detail.id)??[];d.length>0&&c(d)}function L(){return r.has(_.name)}return I(()=>{document.addEventListener("mutateId",q),n.value&&o.value&&L()&&g()}),N(()=>{document.removeEventListener("mutateId",q)}),p(o,a=>{a&&E()}),p(n,a=>{a&&requestIdleCallback(()=>{document.dispatchEvent(new Event("indexer"))})}),p(()=>_.name,a=>{n.value&&o.value&&r.has(a)&&g()}),(a,s)=>f(l)?(h(),K("div",Y,[...s[0]||(s[0]=[x("div",{class:"w-8 h-8 border-2 border-focus border-t-transparent rounded-full animate-spin"},null,-1)])])):(h(!0),K(Q,{key:1},B(f(i)??f(n)??[],(d,v)=>(h(),S(O(f(Z)[d?.component]),D({key:d.id,index:v},{ref_for:!0},d.props),null,16,["index"]))),128))}}),te=G;export{te as t};
