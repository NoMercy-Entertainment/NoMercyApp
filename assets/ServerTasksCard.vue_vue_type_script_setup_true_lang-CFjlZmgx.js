import{u as Q}from"./useQuery-BV5bz1Dq.js";import{u as V}from"./useServerClient-B7mr_MDk.js";import{I as j,d as f,c as d,b as h,K as u,X as R,o as l,bB as J,s as _,a as e,t as s,r as S,n as T,l as y,R as z,E as O,ek as L,h as q,F as A,j as g,O as $,w as D,C as B,ah as X,A as U,f as G,q as N,eK as E}from"./index-4xkagrUD.js";import{_ as c}from"./OptimizedIcon.vue_vue_type_script_setup_true_lang-BEbBJsKC.js";import{_ as H}from"./KeepCounting.vue_vue_type_script_setup_true_lang-C8UXSQPl.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as C}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-CJGz-6CV.js";import{d as M,c as I}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DGO9C1aT.js";const W={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch w-full pt-1"},Y={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch text-slate-light-12 dark:text-slate-dark-12"},Z={class:"flex-grow text-xl font-medium"},ee={class:"ml-auto flex gap-2"},te={key:1,class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch"},se={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch text-slate-light-12 dark:text-slate-dark-12"},ae={class:"flex-grow text-xl font-medium"},le={class:"ml-auto flex gap-2"},P=j({__name:"ServerSystemCard",props:{title:{type:String,required:!0},background:{type:Boolean,required:!1,default:!0}},setup(t){return(r,n)=>u(R)&&u(M)?(l(),f(u(J),{key:0},{default:_(()=>[e("div",W,[e("div",Y,[e("p",Z,s(r.$t(t.title)),1),e("div",ee,[S(r.$slots,"cta")])]),e("div",{class:T(["flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip",{"bg-slate-lightA-3 dark:bg-slate-darkA-3 p-4":t.background}])},[S(r.$slots,"default")],2)])]),_:3})):u(M)?(l(),d("div",te,[e("div",se,[e("p",ae,s(r.$t(t.title)),1),e("div",le,[S(r.$slots,"cta")])]),e("div",{class:T(["flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip",{"bg-slate-lightA-3 dark:bg-slate-darkA-3 p-4":t.background}])},[S(r.$slots,"default")],2)])):h("",!0)}}),re={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-slate-light-10 dark:border-slate-dark-10 text-slate-light-12/80 dark:text-slate-dark-12/80 rounded-lg pl-1 pr-2 py-1"},ie={class:"flex-shrink-0 flex-grow-0 text-sm"},oe={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-slate-light-10 dark:border-slate-dark-10 text-slate-light-12/80 dark:text-slate-dark-12/80 rounded-lg pl-1 pr-2 py-1"},ne={class:"flex-shrink-0 flex-grow-0 text-sm"},de={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},ce={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},ue={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},fe={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},he={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},xe={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},ge={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},me={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},pe={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},ke={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},ve={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},we={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},be={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},_e={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},ye={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},$e={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},je={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},Se={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},Ce={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 w-available"},Ie={class:"w-40 flex-grow whitespace-nowrap text-sm text-slate-light-12 dark:text-slate-dark-12"},qe={class:"text-sm line-clamp-2 text-slate-light-10 dark:text-slate-dark-10 text-right w-full"},Ae=j({__name:"ServerSystemInfoCard",setup(t){const r=y(!1),n=y(!0),{data:k,refetch:m}=Q({queryKey:["runners",z.value?.serverBaseUrl],retryOnMount:!0,queryFn:()=>$().get("dashboard/tasks/runners").then(({data:a})=>(r.value=!(a.workers>0),a.workers??[]))}),{data:i}=V({path:"dashboard/server/info",queryKey:["serverInfo",z.value?.serverBaseUrl]});function v(){n.value=!0,m()}function w(){n.value=!1}return O(()=>{const a=L();a?.onreconnected(v),a?.onclose(w)}),(a,b)=>(l(),f(P,{title:"System"},{cta:_(()=>[e("button",re,[g(c,{icon:"pause",class:"w-4"}),e("p",ie,s(a.$t("Pause")),1)]),e("button",oe,[g(c,{icon:"shutdown",class:"w-4"}),e("p",ne,s(a.$t("Shutdown")),1)])]),default:_(()=>[e("div",de,[e("p",ce,s(a.$t("Server")),1),e("p",ue,s(u(i)?.server),1)]),e("div",fe,[e("p",he,s(a.$t("Server version")),1),e("p",xe,s(u(i)?.version),1)]),e("div",ge,[e("p",me,s(a.$t("Uptime")),1),e("p",pe,[(l(),f(H,{key:u(i)?.bootTime,"start-time":u(i)?.bootTime},null,8,["start-time"]))])]),e("div",ke,[e("p",ve,s(a.$t("OS")),1),e("p",we,s(u(i)?.os.toTitleCase()),1)]),e("div",be,[e("p",_e,s(a.$t("Architecture")),1),e("p",ye,s(u(i)?.arch),1)]),(l(!0),d(A,null,q(u(i)?.cpu,(o,x)=>(l(),d("div",$e,[e("p",je,s(a.$t("CPU"))+" #"+s(x+1),1),e("p",Se,s(o),1)]))),256)),(l(!0),d(A,null,q(u(i)?.gpu,(o,x)=>(l(),d("div",Ce,[e("p",Ie,s(a.$t("GPU"))+" #"+s(x+1),1),e("p",qe,s(o),1)]))),256))]),_:1}))}}),Nt=F(Ae,[["__scopeId","data-v-f012b4cd"]]),Ne={key:0,class:"relative flex w-full flex-col items-start justify-start overflow-clip rounded-lg pt-2 group/encoderCard gap-1.5 px-2.5 pb-3.5 bg-slate-lightA-3 dark:bg-slate-darkA-3"},ze={class:"relative flex w-full items-center justify-center gap-0.5"},Be=["title"],Pe={class:"flex-shrink-0 flex-grow-0 text-right text-xs font-light text-auto-alpha-10"},Te={class:"relative flex items-start justify-start gap-2"},Ue={key:0,class:"relative aspect-video h-auto w-1/3 flex-shrink-0 flex-grow-0 overflow-hidden rounded-sm min-w-36",style:{background:`linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 0) 25%,
            rgba(0, 0, 0, 0) 50%,
            #000 100%
          )`}},Ee={class:"absolute inset-0 z-0 h-full w-full bg-white/[0.01]"},Me=["src"],Ve={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px]"},Oe={class:"absolute z-10 flex items-end justify-start left-[3%] bottom-[3%] gap-[2%]"},De={class:"absolute z-10 flex items-end justify-end right-[3%] bottom-[3%] gap-[2%] text-[10px]"},Fe={class:"group-hover/progress:hidden text-right font-bold text-auto-12 monospace"},Ke={class:"flex h-full flex-grow flex-col items-start justify-evenly"},Qe={class:"relative flex h-4 items-center justify-center overflow-clip"},Re={class:"ml-2 w-full font-medium text-2xs text-auto-12"},Je={key:0,class:"relative flex h-4 w-full items-start justify-start gap-2"},Le={key:0,class:"relative flex h-4 items-center justify-center overflow-clip"},Xe={class:"ml-2 w-full font-medium text-2xs text-auto-12"},Ge={key:1,class:"relative flex h-4 w-full items-start justify-start gap-2"},He={key:0,class:"relative flex h-4 items-center justify-center overflow-clip"},We={class:"ml-1 font-medium text-2xs text-auto-12"},Ye={key:2,class:"relative flex h-4 items-center justify-center gap-2 overflow-clip"},Ze=["title"],et={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},tt=["title"],st={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},at=["title"],lt={class:"w-full text-xs text-auto-alpha-10 line-clamp-1"},rt={key:0,class:"absolute -bottom-0.5 left-0 h-1 w-full blur-[1px]"},it=j({__name:"ServerEncoderTaskCard",props:{data:{type:Object,required:!0}},setup(t){const r=t,n=y(r.data?.status);D(r,a=>{n.value=a.data.status});const k=B(()=>n.value==="running"?"running":"paused"),m=B(()=>r.data.thumbnails?`${`${z.value?.serverBaseUrl}\\${r.data.thumbnails}`.replace(/\\+/gu,"/").replace(/\/\/images/u,"/images")}?token=${X.value.accessToken}`:null);function i(){$().post(`/dashboard/tasks/pause/${r.data.process_id}`).then(({data:a})=>{n.value=a?"paused":n.value}).catch(()=>{})}function v(){$().post(`/dashboard/tasks/resume/${r.data.process_id}`).then(({data:a})=>{n.value=a?"running":n.value}).catch(()=>{})}function w(){n.value==="running"?i():v()}return(a,b)=>t.data?(l(),d("div",Ne,[e("div",ze,[e("p",{class:"w-full flex-grow text-sm font-semibold text-auto-12 line-clamp-1 h-6",title:t.data.title.replace(/NoMercy/giu,"")},s(t.data.title.replace(/NoMercy/giu,"")),9,Be),e("p",Pe,s(a.$t("Id"))+": "+s(t.data?.process_id),1)]),e("div",Te,[t.data?.message==="Encoding video"?(l(),d("div",Ue,[e("div",Ee,[b[0]||(b[0]=e("div",{class:"pointer-events-none absolute inset-0 z-10 mt-auto h-4/5 bg-gradient-to-t from-black via-black/60"},null,-1)),m.value?(l(),d("img",{key:0,src:m.value,class:"absolute z-0 h-full w-full",alt:""},null,8,Me)):h("",!0)]),e("div",{class:"absolute top-1/2 left-1/2 z-10 group-hover/encoderCard:flex hidden h-11 w-11 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/60 p-0.5 group/progress text-focus",onClick:w},[e("div",Ve,[k.value==="running"?(l(),f(c,{key:0,icon:"pause",class:"w-10 text-white"})):(l(),f(c,{key:1,icon:"play",class:"w-10 text-white"}))])]),e("div",Oe,[t.data?.has_gpu?(l(),f(c,{key:0,icon:"gpu","class-name":"w-[15%]"})):(l(),f(c,{key:1,icon:"cpu","class-name":"w-[15%]"})),t.data?.is_hdr?(l(),f(c,{key:2,icon:"hdr","class-name":"w-[15%]"})):(l(),f(c,{key:3,icon:"hdrOff","class-name":"w-[15%]"}))]),e("div",De,[e("span",Fe,s(Math.floor(t.data?.progress??0))+"% ",1)])])):h("",!0),e("div",Ke,[e("div",Qe,[g(c,{icon:"stickyNote","class-name":"relative w-4 text-auto-12"}),e("p",Re,s(t.data?.message),1)]),t.data?.message==="Encoding video"?(l(),d("div",Je,[t.data?.speed?(l(),d("div",Le,[g(c,{icon:"dashboard","class-name":"relative w-4 text-auto-12"}),e("p",Xe,s(t.data?.speed)+"X ",1)])):h("",!0)])):h("",!0),t.data?.message==="Encoding video"?(l(),d("div",Ge,[t.data?.remaining_split?(l(),d("div",He,[g(c,{icon:"hourglass","class-name":"relative w-4 text-auto-12"}),e("p",We,s(t.data?.remaining_split?.[0]&&t.data?.remaining_split[0]>0?` ${t.data?.remaining_split?.[0]+a.$t("d")} `:"")+" "+s(t.data?.remaining_split?.[1]&&(t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[1]+a.$t("h")} `:"")+" "+s(t.data?.remaining_split?.[2]&&(t.data?.remaining_split[2]>0||t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[2]+a.$t("m")} `:"")+" "+s(t.data?.remaining_split?.[3]?` ${t.data?.remaining_split?.[3]+a.$t("s")} `:""),1)])):h("",!0)])):h("",!0),t.data?.video_streams&&t.data?.message==="Encoding video"?(l(),d("div",Ye,[e("div",{class:"relative flex h-4 w-full cursor-pointer items-center justify-start gap-2",title:t.data?.video_streams?.join?.(", ")??""},[g(c,{icon:"film","class-name":"w-4"}),e("p",et,s(t.data?.video_streams.length),1)],8,Ze),t.data?.audio_streams?(l(),d("div",{key:0,class:"relative flex h-4 cursor-pointer items-center justify-center gap-2 overflow-clip",title:t.data?.audio_streams?.join?.(", ")??""},[g(c,{icon:"audioFile","class-name":"w-4"}),e("p",st,s(t.data?.audio_streams.length),1)],8,tt)):h("",!0),t.data?.subtitle_streams?(l(),d("div",{key:1,class:"relative flex h-4 cursor-pointer items-center justify-center gap-2 overflow-clip",title:t.data?.subtitle_streams?.join?.(", ")??""},[g(c,{icon:"chatBubble","class-name":"w-4"}),e("p",lt,s(t.data?.subtitle_streams.length),1)],8,at)):h("",!0)])):h("",!0)])]),t.data?.message==="Encoding video"?(l(),d("div",rt,[b[1]||(b[1]=e("div",{class:"absolute w-full h-1 left-[-1px] top-[-1px] bg-black/[0.22]"},null,-1)),e("div",{class:"w-0 h-1 absolute left-[-1px] top-[-1px] rounded-sm bg-gradient-to-r from-black/5 to-[rgb(var(--color-focus))] z-10",style:U(`width: ${t.data.progress}%;`)},null,4),e("div",{class:"w-1 h-0.5 absolute top-[-1px] rounded-sm bg-[#f1eefe] -translate-x-[2px] z-0",style:U(`left: ${t.data.progress}%;`)},null,4)])):h("",!0)])):h("",!0)}}),ot={class:"flex flex-shrink-0 flex-grow-0 items-start gap-4 self-stretch overflow-hidden rounded-lg py-4 px-4 bg-slate-lightA-3 dark:bg-slate-darkA-3 text-slate-light-12/80 dark:text-slate-dark-12/80"},nt={class:"relative flex flex-1 flex-grow flex-col items-start space-y-[-2px] w-full"},dt={class:"flex flex-nowrap w-full justify-between"},ct=["title"],ut={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available !mt-1 text-slate-light-12/80 dark:text-slate-dark-12/80"},ft={class:"text-slate-light-11 dark:text-slate-dark-11"},ht={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80 w-full flex justify-between"},xt={class:"flex-shrink-0 flex-grow-0 self-stretch text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},gt={class:"text-slate-light-11 dark:text-slate-dark-11"},mt={class:"flex-shrink-0 flex-grow-0 self-stretch break-all text-xs w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},pt={class:"text-slate-light-11 dark:text-slate-dark-11"},kt=j({__name:"ServerQueueTaskCard",props:{data:{type:Object,required:!0}},setup(t){const r=t,n=y(r.data.priority??0);function k(i){$().patch(`/dashboard/tasks/queue/${r.data.id}`,{id:r.data.id,priority:i}).then(()=>{console.log("Priority updated")})}function m(){$().delete(`/dashboard/tasks/queue/${r.data.id}`).then(()=>{console.log("Item deleted")})}return D(n,i=>{console.log(i),k(i)}),(i,v)=>{const w=G("InputNumber");return l(),d("div",ot,[e("div",nt,[e("span",dt,[e("p",{class:"text-sm font-semibold text-auto-12 line-clamp-1 h-6",title:t.data.title.replace(/NoMercy/giu,"")},s(t.data.title.replace(/NoMercy/giu,"")),9,ct),e("button",{class:"float-right flex items-center justify-center gap-2 overflow-hidden rounded-lg bg-transparent w-10 -mt-1.5 -mr-1.5 aspect-square",onClick:m},[g(c,{icon:"cross",class:"relative h-5 w-5 flex-shrink-0 flex-grow-0"})])]),e("p",ut,[N(s(i.$t("Id"))+": ",1),e("span",ft,s(t.data.id),1)]),e("p",ht,[e("span",null,s(i.$t("Priority"))+":",1),g(w,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=a=>n.value=a),size:"small",variant:"filled","show-buttons":"",class:"ml-auto h-8 first:children:!w-12 last:children:!w-4 children:last:children:!w-4 overflow-clip -mb-2",min:0,max:100,step:1},null,8,["modelValue"])]),e("p",xt,[N(s(i.$t("Profile"))+": ",1),e("span",gt,s(t.data.profile),1)]),e("p",mt,[N(s(i.$t("File"))+": ",1),e("span",pt,s(t.data.input_file),1)])])])}}}),vt=F(kt,[["__scopeId","data-v-060734d2"]]),wt={class:"flex-shrink-0 flex-grow-0 text-sm"},bt={class:"relative flex items-start justify-start gap-2 self-stretch rounded-lg p-4 bg-slate-lightA-3 dark:bg-slate-darkA-3 text-slate-light-12/80 dark:text-slate-dark-12/80"},_t={class:"flex-shrink-0 flex-grow-0 self-stretch text-sm font-semibold"},zt=j({__name:"ServerTasksCard",setup(t){const r=y([]),n=y(!1),{data:k,refetch:m}=V({path:"dashboard/tasks/queue",queryKey:["queue"],refetchInterval:3e4});O(()=>{r.value=[]});function i(o){o.status==="running"||o.status==="paused"?r.value=E([...r.value.filter(x=>x?.id!==o?.id),o],"id"):(r.value=E([...r.value.filter(x=>x?.id!==o?.id)],"id"),m())}const v=B(()=>{const o=k.value?.filter(x=>!r.value.find(p=>p.id===x.payload_id))??[];return n.value||o.length<=20?o:[...o.slice(0,10),...o.slice(-10)]});function w(o){k.value=o}function a(){r.value=[],m()}function b(){n.value=!n.value}return C(I,"encoder-progress",i),C(I,"encoder-queue",w),C(I,"encoder-clear",a),C(I,"disconnected",a),(o,x)=>r.value.length||u(k)?.length?(l(),f(P,{key:0,title:"Running tasks",background:!1},{cta:_(()=>[e("button",{class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-slate-light-10 dark:border-slate-dark-10 text-slate-light-12/80 dark:text-slate-dark-12/80 rounded-lg px-2 py-1",onClick:b},[e("p",wt,s(n.value?o.$t("Show less"):o.$t("Show all")),1)])]),default:_(()=>[(l(!0),d(A,null,q(r.value.toSorted((p,K)=>p.title.localeCompare(K.title))??[],p=>(l(),f(it,{key:p.id,data:p},null,8,["data"]))),128)),(l(!0),d(A,null,q(v.value,p=>(l(),f(vt,{key:p.id,data:p},null,8,["data"]))),128))]),_:1})):(l(),f(P,{key:1,title:"Running tasks",background:!1},{default:_(()=>[e("div",bt,[e("span",_t,s(o.$t("No tasks are currently running")),1)])]),_:1}))}});export{Nt as S,zt as _,P as a};
