import{Jo as v,ec as g,qs as w,ti as m}from"./index-ZKQbrg8Z.js";v();function l(e){return Array.isArray(e)}function _(e){return typeof e=="function"}function a(e){return e==null}function k(e){return typeof e=="string"}var n=w({keycloak:void 0,isAuthenticated:!1,hasFailed:!1,error:null,isPending:!1,token:"",decodedToken:{},username:"",userId:"",roles:[],resourceRoles:{}}),p=e=>{n.keycloak=e},h=(e,r)=>{n.token=e;const o=r;n.decodedToken=o,n.roles=o.realm_access?o.realm_access.roles:[],n.username=o.preferred_username,n.userId=o.sub,n.resourceRoles=o.resource_access?Object.fromEntries(Object.entries(o.resource_access).map(([s,c])=>[s,c.roles])):{}},i=(e,r)=>{n.hasFailed=e,r instanceof Error?n.error=r:k(r?.error)?n.error=new Error(r.error):k(r)?n.error=new Error(r):n.error=new Error("Unknown"),n.error.name="[vue-keycloak]",console.error(n.error)},d=e=>{n.isPending=e},f=e=>{n.isAuthenticated=e},t=void 0;async function E(e){try{return await t.updateToken(e),h(t.token,t.tokenParsed),t.token}catch(r){const o=a(r)?new Error("Failed to refresh the access token"):r;throw i(!0,o),o}}async function T(e=10){return E(e)}function R(e){try{t=new m(e),p(t)}catch(r){i(!0,a(r)?new Error("Failed to create the keycloak adapter"):r)}return t}async function A(e){try{d(!0);const r=await t.init(e);f(r),a(t.token)||h(t.token,t.tokenParsed)}catch(r){f(!1),i(!0,a(r)?new Error("Failed to initialize the keycloak adapter"):r)}finally{d(!1)}}var F=()=>({...g(n),hasRoles:e=>l(e)&&n.isAuthenticated&&e.every(r=>n.roles.includes(r)),hasResourceRoles:(e,r)=>l(e)&&!a(r)&&n.isAuthenticated&&!a(n.resourceRoles)&&l(n.resourceRoles[r])&&e.every(o=>n.resourceRoles[r].includes(o))}),y={flow:"standard",checkLoginIframe:!1,onLoad:"login-required"},K={install:async(e,r)=>{if(a(r)){i(!0,new Error("The VueKeycloakPluginConfig is required"));return}let o;if(_(r)?o=await r():o=r,a(o.config)){i(!0,new Error("The KeycloakConfig is required"));return}const s=o.config,c=a(o.initOptions)?y:{...y,...o.initOptions},u=R(s);a(u)||(e.config.globalProperties.$keycloak=u,await A(c))}};export{T as getToken,F as useKeycloak,K as vueKeycloak};
