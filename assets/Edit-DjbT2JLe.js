import{aG as O,b7 as X,bC as Y,K as c,j as m,a7 as d,a as t,a6 as b,t as l,x as A,o as i,bD as Z,ba as z,bE as j,bb as ee,ax as ae,L,aI as w,c as te,h as p,bF as q,bG as se}from"./index-CvS9J4DT.js";import{_ as le}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CYzBz9e5.js";import{_ as oe}from"./Modal.vue_vue_type_script_setup_true_lang-D2nc8Aof.js";import{_ as T}from"./Button.vue_vue_type_script_setup_true_lang-B1wyWsC8.js";import{u as re}from"./useApiClient-DoEFYQit.js";import{_ as ne}from"./Select.vue_vue_type_script_setup_true_lang-D1tb3s4s.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-CzbrroWL.js";import"./listbox-BLvt5oH-.js";const ie={class:"my-6 text-sm text-auto-10"},de=O({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const _=v,{t:f}=X(),n=Y(),B=c([]),o=()=>{var u;if(!_.id){B.value.push({type:"error",place:"email",message:f("Email is required")});return}Z().post("server/server-users",{_method:"delete",id:(u=z.value)==null?void 0:u.id,user_id:_.id}).then(()=>{n.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),_.close()};return(u,S)=>(i(),m(oe,{open:v.open,close:v.close,params:{name:v.name},title:"Delete server member {{name}}"},{actions:d(()=>[A(T,{type:"button",id:"yes",color:"red",variant:"contained",endIcon:"userRemove",onClick:o},{default:d(()=>[b(l(u.$t("Yes")),1)]),_:1}),A(T,{type:"button",id:"no",variant:"text",color:"white",onClick:v.close},{default:d(()=>[b(l(u.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:d(()=>[t("p",ie,[b(l(u.$t("Are you sure you want to delete this server member?")),1),S[0]||(S[0]=t("br",null,null,-1)),b(" "+l(u.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),ue={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},ce={class:"mt-4 mb-2"},me={class:"flex flex-col gap-2"},pe={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},fe={class:"whitespace-pre-wrap text-sm font-semibold"},be={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ve={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ge={class:"flex w-full flex-col gap-2"},ye={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},we={class:"whitespace-pre-wrap text-sm font-semibold"},_e={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ke={class:"whitespace-pre-wrap text-sm font-semibold"},Ve={class:"mt-4 mb-2"},$e={class:"flex w-1/2 flex-col gap-2"},Ce={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},xe={class:"whitespace-pre-wrap text-sm font-semibold"},Ee=O({__name:"Edit",setup(v){var K,M,N,R,I,Q,F,G,P;const _=Y(),f=ee(),{data:n}=j({path:"/dashboard/libraries"}),{data:B}=re({path:"server/server-users",params:{id:(K=z.value)==null?void 0:K.id},queryKey:["server_users"]}),{data:o,error:u}=j({path:`dashboard/users/${f.params.id}/permissions`,queryKey:["userPermissions",f.params.id]}),S=ae(()=>{var e,a;return(a=(e=B.value)==null?void 0:e.find(r=>r.id==f.params.id))==null?void 0:a.name}),k=c((M=o.value)==null?void 0:M.allowed),V=c((N=o.value)==null?void 0:N.manage),$=c((R=o.value)==null?void 0:R.audio_transcoding),C=c((I=o.value)==null?void 0:I.video_transcoding),U=c((Q=o.value)==null?void 0:Q.no_transcoding),h=c(((F=n.value)==null?void 0:F.filter(e=>{var a,r;return(r=(a=o.value)==null?void 0:a.libraries)==null?void 0:r.includes(e.id)}).length)==((G=n.value)==null?void 0:G.length)),g=c((P=n.value)==null?void 0:P.filter(e=>{var a,r;return(r=(a=o.value)==null?void 0:a.libraries)==null?void 0:r.includes(e.id)}));L(o,e=>{var a,r,x;k.value=e==null?void 0:e.allowed,V.value=e==null?void 0:e.manage,$.value=e==null?void 0:e.audio_transcoding,C.value=e==null?void 0:e.video_transcoding,U.value=e==null?void 0:e.no_transcoding,g.value=(a=n.value)==null?void 0:a.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}),h.value=((r=n.value)==null?void 0:r.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}).length)==((x=n.value)==null?void 0:x.length)});const D=c(!1),H=()=>{D.value=!0},J=()=>{D.value=!1},E=()=>{window.history.back()},W=()=>{var e;se().patch(`dashboard/users/${f.params.id}/permissions`,{allowed:k.value,manage:V.value,audio_transcoding:$.value,video_transcoding:C.value,no_transcoding:U.value,libraries:(e=g.value)==null?void 0:e.map(a=>a.id)}).then(({data:a})=>{_.invalidateQueries({queryKey:["userPermissions",f.params.id]}),E()})};return L(h,e=>{e&&(g.value=n.value)}),L(g,e=>{n.value}),(e,a)=>(i(),m(le,{error:w(u),title:"Server member: {{name}}",params:{name:S.value},back:!0},{cta:d(()=>a[6]||(a[6]=[])),actions:d(()=>[A(T,{type:"button",id:"yes",variant:"text",class:"mr-auto",color:"text-auto-alpha-11",startIcon:"userDelete",onClick:H},{default:d(()=>[b(l(e.$t("Remove user")),1)]),_:1}),A(T,{type:"button",id:"cancel",variant:"text",color:"white",onClick:E},{default:d(()=>[b(l(e.$t("Cancel")),1)]),_:1}),A(T,{type:"button",id:"save",color:"theme",onClick:W},{default:d(()=>[b(l(e.$t("Save")),1)]),_:1})]),default:d(()=>{var r,x,y;return[w(o)?(i(),te("div",ue,[t("h3",ce,l(e.$t("Base permissions"))+":",1),t("div",me,[t("label",pe,[k.value!=null?(i(),m(q,{key:0,id:"allowed",label:"Manage",modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=s=>k.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),t("span",fe,l(e.$t("Allow this user to access content")),1)]),t("label",be,[V.value!=null?(i(),m(q,{key:0,id:"manage",label:"Manage",modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=s=>V.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),t("span",ve,l(e.$t("Allow this user to manage the server")),1)])]),t("h3",he,l(e.$t("Media playback"))+":",1),t("div",ge,[t("label",ye,[$.value!=null?(i(),m(q,{key:0,id:"audioTranscoding",label:"AudioTranscoding",modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=s=>$.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),t("span",we,l(e.$t("Allow audio playback that requires transcoding")),1)]),t("label",_e,[C.value!=null?(i(),m(q,{key:0,id:"videoTranscoding",label:"VideoTranscoding",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=s=>C.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),t("span",ke,l(e.$t("Allow video playback that requires transcoding")),1)])]),t("h3",Ve,l(e.$t("Library Access"))+":",1),t("div",$e,[t("label",Ce,[h.value!=null?(i(),m(q,{key:0,id:"allowedAllLibraries",label:"AllowedAllLibraries",modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=s=>h.value=s),class:"mr-2"},null,8,["modelValue"])):p("",!0),t("span",xe,l(e.$t("Enable access to all libraries")),1)]),h.value?p("",!0):(i(),m(ne,{key:0,id:"libraries",label:"libraries",placeholder:"Select libraries",multiple:"",items:w(n),optionLabel:"title",modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=s=>g.value=s)},null,8,["items","modelValue"]))])])):p("",!0),(r=w(o))!=null&&r.id?(i(),m(de,{key:1,id:(x=w(o))==null?void 0:x.id,name:(y=w(o))==null?void 0:y.name,close:J,open:D.value},null,8,["id","name","open"])):p("",!0)]}),_:1},8,["error","params"]))}});export{Ee as default};
//# sourceMappingURL=Edit-DjbT2JLe.js.map
