import{C as _,Ct as b,Dt as c,J as j,K as p,O as f,S as i,T as S,X as I,c as C,g as A,j as k,k as u,mt as d,n as B,ot as l,x as D}from"./i18n-fABvX7Av.js";import"./ionic-DIYphHxf.js";import{C as E,_ as T}from"./vue-core-hXf_Oh5G.js";import"./dist-CJipjyJM.js";import"./query-BsKzQ1i8.js";import"./esm-D1nPlPuN.js";import{Gi as L,mn as K,qi as M,x as N,y as g}from"./index-D70HP9b0.js";import"./md5-DivBKk6L.js";import"./useInfiniteServerClient-CqYT9R1N.js";import{t as O}from"./useServerClient-FMNZVARp.js";import"./ScrollContainer-BQE8uB0u.js";import"./useMounted-C90o8FQQ.js";import"./RipperOverlay-DbFRSTLk.js";import"./ripperSocket-DQpXINAg.js";import"./FloatingBackButton-DUNFh7Ik.js";import{t as z}from"./DashboardLayout-CYA144Ld.js";import{t as F}from"./DashboardCard-CbgQjr5J.js";import{t as Z}from"./useApiClient-DDau_UVN.js";import{t as G}from"./Avatar-B5FAS0vc.js";C();var J={class:"backdropCard relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},P=["src"],Q=k({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(s){const o=d(!1);function m(t){console.error(t),t.target.onerror=null,o.value=!0}return(t,a)=>(p(),_(F,{line1:s.data.name,route:`/dashboard/users/${s.data.user_id}`,line2:""},{image:l(()=>[i("div",J,[a[0]||(a[0]=i("div",{class:"backdropCard-overlay"},null,-1)),s.data.avatar&&!o.value?(p(),S("img",{key:0,onerror:m,src:s.data.avatar,alt:"",class:"w-full h-full object-cover rounded-lg backdropCard-image"},null,8,P)):(p(),_(G,{key:1,email:s.data.email,class:"w-full backdropCard-image"},null,8,["email"]))])]),_:1},8,["line1","route"]))}}),W=Q;C();var X={class:"flex w-full flex-col justify-start text-left"},H={class:"py-4 text-sm text-surface-10"},R={class:"flex flex-col gap-2 w-full"},Y={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},ee=k({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(s){const o=s,{t:m}=B();d(null);const t=d(!1),a=d(""),v=d([]),{data:w}=O({path:"/dashboard/libraries"}),n=d();function y(){v.value=[],o.close()}function x(r){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(r).toLowerCase())}const q=D(()=>a.value?x(a.value):!1);async function V(){if(!a.value){v.value.push({type:"error",place:"email",message:m("Email is required")});return}if(!x(a.value)){v.value.push({type:"error",place:"email",message:m("Invalid email address")});return}if(!t.value){t.value=!0;try{await K().post("server/server-users",{id:M.value?.id,email:a.value,libraries:n.value?.map(r=>r.id)}),L.invalidateQueries({queryKey:["server_users"]}),a.value="",o.close()}catch(r){const{response:e}=r;e?.status!==200&&e?.data&&v.value.push({message:e.data.message??"An error occurred",place:"email",type:e.data.status??e.data.exception})}finally{t.value=!1}}}return(r,e)=>{const $=I("InputText"),U=I("MultiSelect");return p(),_(N,{close:y,open:s.open,title:"Invite user"},{actions:l(()=>[u(g,{id:"yes",disabled:!q.value||t.value,color:"theme","end-icon":"emailSend",type:"button",variant:"contained",onClick:V},{default:l(()=>[f(c(t.value?r.$t("Sending..."):r.$t("Send")),1)]),_:1},8,["disabled"]),u(g,{id:"no",disabled:t.value,type:"button",variant:"text",onClick:y},{default:l(()=>[f(c(r.$t("Cancel")),1)]),_:1},8,["disabled"])]),default:l(()=>[i("div",X,[i("p",H,[f(c(r.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=i("br",null,null,-1)),f(" "+c(r.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),i("div",R,[e[3]||(e[3]=i("label",{for:"email"},"Email",-1)),u($,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=h=>a.value=h),class:"mb-4"},null,8,["modelValue"])]),i("div",Y,[e[4]||(e[4]=i("label",{for:"libraries"},"Allowed libraries",-1)),u(U,{id:"libraries",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=h=>n.value=h),options:b(w),display:"chip",label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","options"])])])]),_:1},8,["open"])}}}),ae=ee;C();var te=k({__name:"Desktop",setup(s){const o=d(!1),{data:m}=Z({path:"server/server-users",params:{id:M.value?.id},queryKey:["server_users"]});function t(){o.value=!0,setTimeout(()=>{document.querySelector("#email")?.focus()},300)}function a(){o.value=!1}return(v,w)=>(p(),_(b(E),null,{default:l(()=>[u(b(T),{fullscreen:!0},{default:l(()=>[u(z,{"grid-style":1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[u(g,{id:"invite",color:"theme","start-icon":"userAdd",onClick:t},{default:l(()=>[f(c(v.$t("Invite user")),1)]),_:1})]),default:l(()=>[(p(!0),S(A,null,j([...b(m)??[]].sort((n,y)=>n.name.localeCompare(y.name)),n=>(p(),_(W,{key:n.user_id,data:n},null,8,["data"]))),128)),u(ae,{open:o.value,close:a},null,8,["open"])]),_:1})]),_:1})]),_:1}))}}),ke=te;export{ke as default};
