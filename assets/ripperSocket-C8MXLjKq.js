import{Lt as d,Tt as f,kn as s,yn as m}from"./index-CJ3av9Nr.js";import{t as c}from"./currentServer-DQ7i6d_b.js";import{s as u}from"./user-Creb9Pvq.js";import{n as S,t as l}from"./SocketClient-KaSDTymP.js";import{t as i}from"./HubConnection-Dx0QDLJI.js";f();var e=s();const w=d(()=>e.value?.connection),r=s(!1);function t(){r.value=!0,document.dispatchEvent(new Event("ripperHub-connected")),e.value?.connection&&S(e.value?.connection)}function o(n){r.value=!1,console.log("Disconnected from Ripper SignalR",n),document.dispatchEvent(new Event("ripperHub-disconnected"))}function p(n){r.value=!1,console.error("Ripper SignalR Error:",n),document.dispatchEvent(new Event("ripperHub-error"))}m(c,async n=>{const a=u.value?.accessToken;n&&r.value&&(e.value?.connection?.stop().then(),e.value?.dispose(),e.value=new l(c.value.serverBaseUrl,a,"ripperHub"),e.value?.connection?.on("connected",t),e.value?.connection?.on("disconnected",o),await v().catch(p))});async function v(){if(e.value?.connection?.state!==i.Connected)return e.value?.connection?.start().then(t)}async function E(){try{return e.value?.connection?.state===i.Disconnected?void 0:e.value?.connection?.stop().then(o).catch(o)}catch(n){console.error("Error stopping Ripper SignalR:",n),o()}}async function H(){const n=u.value?.accessToken;c.value&&(!e.value?.connection?.state||e.value?.connection?.state===i.Disconnected)&&(e.value=new l(c.value.serverBaseUrl,n,"ripperHub"),e.value?.connection?.on("connected",t),e.value?.connection?.on("disconnected",o),await v().catch(p),e.value?.connection?.onreconnecting(a=>{console.log("SignalR Disconnected.",a?.message),o()}),e.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),t()}))}export{E as i,r as n,H as r,w as t};
