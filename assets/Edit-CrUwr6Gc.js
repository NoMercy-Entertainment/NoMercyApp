import"./useBaseQuery-CBXNnECq.js";import"./useInfiniteServerClient-BW1g-ydX.js";import{t as L}from"./useQueryClient-C-MIg5UW.js";import"./useQuery-CIhLkkcF.js";import{Ci as M,Ec as S,Gc as b,Gs as t,Js as W,Ks as u,Nc as r,Ns as N,Oc as n,Qs as C,Rc as d,Si as z,Uo as F,Wo as J,Ws as Y,Zs as p,ci as B,ec as K,hc as i,i as R,qs as m,r as Z,zn as j}from"./index-C9t0dAlI.js";import"./basecomponent-CFE95MlL.js";import"./classnames-ai0DVBar.js";import{t as H}from"./Select-B_vljoi-.js";import"./use-text-value-DjW4F4Fe.js";import"./render-DmZATKh_.js";import"./MoooomIcon-BZTHnqZD.js";import{n as I}from"./dist-B4nyeBaT.js";import"./baseeditableholder-lDAplWRE.js";import{t as V}from"./Toggle-BCt8q9wF.js";import{t as E}from"./useServerClient-Bx8hZPwj.js";import"./ScrollContainer-Bw5QDJPQ.js";import"./useMounted-DoXoLbHh.js";import"./RipperOverlay-DMgjzROm.js";import"./HubConnection-BgYujhqd.js";import"./ripperSocket-DHZSi_E1.js";import{t as $}from"./Button-D92upDHr.js";import{t as X}from"./Modal-Br04bZeK.js";import"./FloatingBackButton-DLOyumJ3.js";import{t as ee}from"./DashboardLayout-CO63u1sW.js";import{t as ae}from"./useApiClient-DwimqkXc.js";F();N();var te={class:"my-6 text-sm text-surface-10"},le=K({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(v){const h=v,{t:c}=I(),q=L(),s=d([]);function T(){if(!h.id){s.value.push({type:"error",place:"email",message:c("Email is required")});return}j().post("server/server-users",{_method:"delete",id:M.value?.id,user_id:h.id}).then(()=>{q.invalidateQueries({queryKey:["server_users"]}).then(()=>{R.back()})}),h.close()}return(l,x)=>(i(),u(X,{close:v.close,open:v.open,params:{name:v.name},style:{"max-width":"36rem"},title:"Delete server member {{name}}"},{actions:n(()=>[C($,{id:"yes",color:"red","end-icon":"userRemove",type:"button",variant:"contained",onClick:T},{default:n(()=>[p(r(l.$t("Yes")),1)]),_:1}),C($,{id:"no",color:"white",type:"button",variant:"text",onClick:v.close},{default:n(()=>[p(r(l.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:n(()=>[t("p",te,[p(r(l.$t("Are you sure you want to delete this server member?")),1),x[0]||(x[0]=t("br",null,null,-1)),p(" "+r(l.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["close","open","params"]))}}),re=le;N();var se={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2 px-1"},oe={class:"mt-4 mb-2"},ie={class:"flex flex-col gap-2"},ne={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowed"},ue={class:"whitespace-pre-wrap text-sm font-semibold"},de={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"manage"},me={class:"whitespace-pre-wrap text-sm font-semibold"},ce={class:"mt-4 mb-2"},pe={class:"flex w-full flex-col gap-2"},ve={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"audioTranscoding"},fe={class:"whitespace-pre-wrap text-sm font-semibold"},_e={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"videoTranscoding"},be={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ge={class:"flex w-1/2 flex-col gap-2"},ye={class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true",for:"allowedAllLibraries"},we={class:"whitespace-pre-wrap text-sm font-semibold"},ke=K({__name:"Edit",setup(v){const h=L(),c=J(),q=Z(),{data:s}=E({path:"/dashboard/libraries"}),{data:T}=ae({path:"server/server-users",params:{id:M.value?.id},queryKey:["server_users"]}),{data:l,error:x}=E({path:`dashboard/users/${c.params.id}/permissions`,queryKey:["userPermissions",c.params.id]}),Q=Y(()=>T.value?.find(e=>e.user_id===c.params.id)?.name),g=d(l.value?.allowed),y=d(l.value?.manage),w=d(l.value?.audio_transcoding),k=d(l.value?.video_transcoding),U=d(l.value?.no_transcoding),f=d(s.value?.filter(e=>l.value?.libraries?.includes(e.id)).length===s.value?.length),_=d(s.value?.filter(e=>l.value?.libraries?.includes(e.id)));S(l,e=>{g.value=e?.allowed,y.value=e?.manage,w.value=e?.audio_transcoding,k.value=e?.video_transcoding,U.value=e?.no_transcoding,_.value=s.value?.filter(a=>e?.libraries?.includes(a.id)),f.value=s.value?.filter(a=>e?.libraries?.includes(a.id)).length===s.value?.length});const A=d(!1);function G(){A.value=!0}function O(){A.value=!1}function D(){R.back()}function P(){z().patch(`dashboard/users/${c.params.id}/permissions`,{allowed:g.value,manage:y.value,audio_transcoding:w.value,video_transcoding:k.value,no_transcoding:U.value,libraries:_.value?.map(e=>e.id)}).then(({data:e})=>{h.invalidateQueries({queryKey:["userPermissions",c.params.id]}),q.add({severity:e.status==="ok"?"success":"error",summary:B(e.status==="ok"?"Success":"Error"),detail:B(e.message,...e.args),life:5e3}),D()})}return S(f,e=>{e&&(_.value=s.value)}),S(_,e=>{s.value}),(e,a)=>(i(),u(ee,{back:!0,error:b(x),params:{name:Q.value},title:"Server member: {{name}}"},{cta:n(()=>[...a[6]||(a[6]=[])]),actions:n(()=>[C($,{id:"yes",class:"mr-auto",color:"auto","start-icon":"userDelete",type:"button",variant:"text",onClick:G},{default:n(()=>[p(r(e.$t("Remove user")),1)]),_:1}),C($,{id:"cancel",color:"white",type:"button",variant:"text",onClick:D},{default:n(()=>[p(r(e.$t("Cancel")),1)]),_:1}),C($,{id:"save",color:"theme",type:"button",onClick:P},{default:n(()=>[p(r(e.$t("Save")),1)]),_:1})]),default:n(()=>[b(l)?(i(),W("div",se,[t("h3",oe,r(e.$t("Base permissions"))+": ",1),t("div",ie,[t("label",ne,[g.value!==void 0?(i(),u(V,{key:0,id:"allowed",modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=o=>g.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),t("span",ue,r(e.$t("Allow this user to access content")),1)]),t("label",de,[y.value!==void 0?(i(),u(V,{key:0,id:"manage",modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=o=>y.value=o),class:"mr-2",label:"Manage"},null,8,["modelValue"])):m("",!0),t("span",me,r(e.$t("Allow this user to manage the server")),1)])]),t("h3",ce,r(e.$t("Media playback"))+": ",1),t("div",pe,[t("label",ve,[w.value!==void 0?(i(),u(V,{key:0,id:"audioTranscoding",modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=o=>w.value=o),class:"mr-2",label:"AudioTranscoding"},null,8,["modelValue"])):m("",!0),t("span",fe,r(e.$t("Allow audio playback that requires transcoding")),1)]),t("label",_e,[k.value!==void 0?(i(),u(V,{key:0,id:"videoTranscoding",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=o=>k.value=o),class:"mr-2",label:"VideoTranscoding"},null,8,["modelValue"])):m("",!0),t("span",be,r(e.$t("Allow video playback that requires transcoding")),1)])]),t("h3",he,r(e.$t("Library Access"))+": ",1),t("div",ge,[t("label",ye,[f.value!==void 0?(i(),u(V,{key:0,id:"allowedAllLibraries",modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=o=>f.value=o),class:"mr-2",label:"AllowedAllLibraries"},null,8,["modelValue"])):m("",!0),t("span",we,r(e.$t("Enable access to all libraries")),1)]),f.value?m("",!0):(i(),u(H,{key:0,id:"libraries",modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=o=>_.value=o),items:b(s),label:"libraries",multiple:"","option-label":"title",placeholder:"Select libraries"},null,8,["modelValue","items"]))])])):m("",!0),b(l)?.id?(i(),u(re,{key:1,id:b(l)?.id,close:O,name:b(l)?.name,open:A.value},null,8,["id","name","open"])):m("",!0)]),_:1},8,["error","params"]))}}),Ye=ke;export{Ye as default};
