var p=Object.defineProperty;var l=(r,i,t)=>i in r?p(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var s=(r,i,t)=>l(r,typeof i!="symbol"?i+"":i,t);import{P as h}from"./video-player-DmVd3h04.js";import{by as u}from"./index-Dq_Cm6ym.js";import{b as y}from"./buttons-DnucOQvv.js";import{R as c}from"./vue-ionic-DerxjBh9.js";class C extends h{constructor(){super(...arguments);s(this,"player",{});s(this,"introPatterns",[/^OP$/iu,/^NCOP$/iu,/^Opening$/iu,/^Opening/iu,/^Opening Credits$/iu,/^Opening Theme$/iu,/^Opening Song$/iu,/^Epilogue$/iu]);s(this,"outroPatterns",[/^ED$/iu,/^PV$/iu,/^NCED$/iu,/^CM$/iu,/^Preview$/iu,/^Next Episode Preview$/iu,/^Next Time Preview$/iu,/^Outro$/iu,/^Ending/iu,/^Prologue$/iu,/^ED\+Cast$/iu,/^Credits$/iu,/^End Credits$/iu,/^Closing$/iu]);s(this,"buttons",{});s(this,"autoSkip",!1);s(this,"lastChapter","");s(this,"skipButtonElement",null)}initialize(t){this.player=t,!this.player.options.disableAutoPlayback&&(this.player.options.introPatterns&&(this.introPatterns=this.player.options.introPatterns),this.player.options.outroPatterns&&(this.outroPatterns=this.player.options.outroPatterns),this.player.options.autoSkip!==void 0?this.autoSkip=this.player.options.autoSkip:this.autoSkip=localStorage.getItem("nmplayer-auto-skip")==="true",this.buttons=y())}use(){this.player.options.disableAutoPlayback||this.player.on("time",this.checkChapters.bind(this))}dispose(){this.player.options.disableAutoPlayback||this.player.off("time",this.checkChapters.bind(this))}getChapterType(t){return this.introPatterns.some(e=>e.test(t))?"intro":this.outroPatterns.some(e=>e.test(t))?"next":null}checkChapters(){if(!this.player.chapters||!this.player.chapters.cues||this.player.chapters.cues.length===0){this.hideSkipButton();return}if(this.player.chapters.errors.length>0){console.error("Error parsing chapters:",this.player.chapters.errors),this.hideSkipButton();return}const t=this.player.getVideoElement().currentTime;let e=this.getCurrentChapter(t);if(!e){this.hideSkipButton();return}if(this.shouldSkipChapter(e.text)){if(this.lastChapter!==e.text){this.lastChapter=e.text;const a=this.getNextChapter(e.endTime);if(!a){this.player.next(),this.lastChapter="";return}this.autoSkip?(this.hideSkipButton(),this.player.seek(a.startTime)):this.showSkipButton()}}else this.hideSkipButton()}isFirstOrLastEpisodeOfSeason(){const t=this.player.playlistItem();if(t.episode===1)return!0;const e=this.player.getPlaylist().map(o=>c(o)),n=u(e,"season")[t.season];return n?n.at(-1)===t:!1}shouldSkipChapter(t){return this.player.getCurrentTime()<this.player.getDuration()/2&&this.player.getPlaylistIndex()===0||this.player.getCurrentTime()>this.player.getDuration()/2&&this.player.isLastPlaylistItem()||this.isFirstOrLastEpisodeOfSeason()?!1:this.introPatterns.some(e=>e.test(t))||this.outroPatterns.some(e=>e.test(t))}getCurrentChapter(t){return this.player.chapters.cues.find(e=>t>=e.startTime&&t<=e.endTime)}getNextChapter(t){return this.player.chapters.cues.find(e=>e.startTime>=t)}showSkipButton(){if(this.skipButtonElement){this.skipButtonElement.classList.add("visible");return}const t=this.player.createElement("button","skip-chapter-button").addClasses(["skip-chapter-button","flex","items-center","justify-center","gap-2","text-sm","text-white","bg-neutral-800","rounded","hover:bg-neutral-700","px-2","py-1","absolute","bottom-20","right-6","z-10","transition-opacity","duration-300","opacity-0","invisible"]).appendTo(this.player.overlay).get();let a=this.getChapterType(this.lastChapter)==="intro"?this.player.localize("Skip intro"):this.player.localize("Skip outro");t.title=a;const n=this.player.createElement("span","skip-chapter-text").addClasses(["hidden","md:inline"]).appendTo(t).get();n.textContent=a,this.player.createSVGElement(t,"chevronR",this.buttons.chevronR,!1,!1).classList.add("w-4","h-4"),t.addEventListener("click",this.player.nextChapter.bind(this.player)),this.skipButtonElement=t,requestAnimationFrame(()=>{t.classList.remove("opacity-0","invisible"),t.classList.add("opacity-100","visible")}),t.focus()}hideSkipButton(){this.skipButtonElement&&(this.skipButtonElement.classList.remove("opacity-100","visible"),this.skipButtonElement.classList.add("opacity-0","invisible"),setTimeout(()=>{this.skipButtonElement&&(this.skipButtonElement.remove(),this.skipButtonElement=null)},300))}}export{C as A};
