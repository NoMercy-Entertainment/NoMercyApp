import{H as S}from"./useMounted-CXw_NJYL.js";import{I as w,aC as T,J as B,dz as E,dA as H,b1 as d,dB as I,dC as R,dD as U}from"./index-s4WF9Q_3.js";const n=w(),A=T(()=>{var e;return(e=n.value)==null?void 0:e.connection}),g=w(!1),C=()=>{var e,o,c;g.value=!0,console.log("Connected to Cast SignalR"),document.dispatchEvent(new Event("castHub-connected")),(e=n.value)!=null&&e.connection&&(R((o=n.value)==null?void 0:o.connection),U((c=n.value)==null?void 0:c.connection))},l=e=>{g.value=!1,console.log("Disconnected from Cast SignalR",e),document.dispatchEvent(new Event("castHub-disconnected"))},D=e=>{g.value=!1,console.error("Cast SignalR Error:",e),document.dispatchEvent(new Event("castHub-error"))};B(d,async e=>{var c,t,a,i,u,r,v;const o=(c=E.value)==null?void 0:c.accessToken;e&&g.value&&((a=(t=n.value)==null?void 0:t.connection)==null||a.stop().then(),n.value=new H(d.value.serverBaseUrl,o,"castHub"),(u=(i=n.value)==null?void 0:i.connection)==null||u.on("connected",C),(v=(r=n.value)==null?void 0:r.connection)==null||v.on("disconnected",l),await y().catch(D))});const y=async()=>{var e,o,c,t;if(((o=(e=n.value)==null?void 0:e.connection)==null?void 0:o.state)!==S.Connected)return(t=(c=n.value)==null?void 0:c.connection)==null?void 0:t.start().then(C)},J=async()=>{var e,o,c,t;try{return((o=(e=n.value)==null?void 0:e.connection)==null?void 0:o.state)===S.Disconnected||(t=(c=n.value)==null?void 0:c.connection)==null?void 0:t.stop().then(l).catch(l)}catch(a){console.error("Error stopping Cast SignalR:",a),l()}},j=async()=>{var o,c,t,a,i,u,r,v,f,p,h,m,b;const e=(o=E.value)==null?void 0:o.accessToken;d.value&&(!((t=(c=n.value)==null?void 0:c.connection)!=null&&t.state)||((i=(a=n.value)==null?void 0:a.connection)==null?void 0:i.state)===S.Disconnected)&&(n.value=new H(d.value.serverBaseUrl,e,"castHub"),(r=(u=n.value)==null?void 0:u.connection)==null||r.on("connected",C),(f=(v=n.value)==null?void 0:v.connection)==null||f.on("disconnected",l),await y().catch(D),(h=(p=n.value)==null?void 0:p.connection)==null||h.onreconnecting(s=>{var k;console.log("SignalR Disconnected.",s==null?void 0:s.message),I((k=n.value)==null?void 0:k.connection),l()}),(b=(m=n.value)==null?void 0:m.connection)==null||b.onreconnected(()=>{var s;console.log("SignalR Reconnected."),R((s=n.value)==null?void 0:s.connection),C()}))};export{g as a,j as b,A as c,J as s};
//# sourceMappingURL=castSocket-Ck_YqOqR.js.map
