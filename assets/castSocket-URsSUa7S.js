import{Ht as f,In as m,Wn as i,en as p}from"./index-04Sh3wNb.js";import{t}from"./currentServer-B7-kbkE-.js";import{c as u}from"./user-C1ciKa7-.js";import{n as g,t as l}from"./SocketClient-DPmgFkP-.js";import{t as r}from"./HubConnection-BtQMN1V5.js";f();var n=i();const w=p(()=>n.value?.connection),a=i(!1);function o(){a.value=!0,console.log("Connected to Cast SignalR"),document.dispatchEvent(new Event("castHub-connected")),n.value?.connection&&g(n.value?.connection)}function c(e){a.value=!1,console.log("Disconnected from Cast SignalR",e),document.dispatchEvent(new Event("castHub-disconnected"))}function v(e){a.value=!1,console.error("Cast SignalR Error:",e),document.dispatchEvent(new Event("castHub-error"))}m(t,async e=>{const s=u.value?.accessToken;e&&a.value&&(n.value?.connection?.stop().then(),n.value?.dispose(),n.value=new l(t.value.serverBaseUrl,s,"castHub"),n.value?.connection?.on("connected",o),n.value?.connection?.on("disconnected",c),await d().catch(v))});async function d(){if(n.value?.connection?.state!==r.Connected)return n.value?.connection?.start().then(o)}async function E(){try{return n.value?.connection?.state===r.Disconnected?void 0:n.value?.connection?.stop().then(c).catch(c)}catch(e){console.error("Error stopping Cast SignalR:",e),c()}}async function H(){const e=u.value?.accessToken;t.value&&(!n.value?.connection?.state||n.value?.connection?.state===r.Disconnected)&&(n.value=new l(t.value.serverBaseUrl,e,"castHub"),n.value?.connection?.on("connected",o),n.value?.connection?.on("disconnected",c),await d().catch(v),n.value?.connection?.onreconnecting(s=>{console.log("SignalR Disconnected.",s?.message),c()}),n.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),o()}))}export{E as i,w as n,H as r,a as t};
