import{$o as R,Qo as k,Xo as N,Zo as O,_s as F,cs as A,es as H,hs as $,ls as b,ps as C,vs as P}from"./index-CTNfsqO1.js";var D=new WeakMap,T=(e,r,t,s=0,o=!1)=>{D.has(e)!==t&&(t?Y(e,r,s,o):q(e,r))},U=e=>e===e.getRootNode().activeElement,Y=(e,r,t,s=!1)=>{const o=r.parentNode,a=r.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,s&&(a.disabled=!0),o.appendChild(a),D.set(e,a);const n=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${n}px,${t}px,0) scale(0)`},q=(e,r)=>{const t=D.get(e);t&&(D.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""};var G=(e,r,t)=>{if(!t||!r)return()=>{};const s=c=>{U(r)&&T(e,r,c)},o=()=>T(e,r,!1),a=()=>s(!0),n=()=>s(!1);return C(t,"ionScrollStart",a),C(t,"ionScrollEnd",n),r.addEventListener("blur",o),()=>{P(t,"ionScrollStart",a),P(t,"ionScrollEnd",n),r.removeEventListener("blur",o)}};var W=()=>{let e=!0,r=!1;const t=document,s=()=>{r=!0},o=()=>{e=!0},a=n=>{if(r){r=!1;return}const c=t.activeElement;if(!c||c.matches("input, textarea, [no-blur], [contenteditable]"))return;const f=n.target;f!==c&&(f.matches("input, textarea, [no-blur], [contenteditable]")||f.closest("input, textarea, [no-blur], [contenteditable]")||(e=!1,setTimeout(()=>{e||c.blur()},50)))};return C(t,"ionScrollStart",s),t.addEventListener("focusin",o,!0),t.addEventListener("touchend",a,!1),()=>{P(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",o,!0),t.removeEventListener("touchend",a,!1)}},z=.3,j=(e,r,t,s)=>{var o;const a=(o=e.closest("ion-item,[ion-item]"))!==null&&o!==void 0?o:e;return Q(a.getBoundingClientRect(),r.getBoundingClientRect(),t,s)},Q=(e,r,t,s)=>{const o=e.top,a=e.bottom,n=r.top,c=Math.min(r.bottom,s-t),f=n+15,d=c-50-a,u=f-o,l=Math.round(d<0?-d:u>0?-u:0),v=Math.min(l,o-n),S=Math.abs(v)/z;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(o-f)+4}},K="$ionPaddingTimer",M=(e,r,t)=>{const s=e[K];s&&clearTimeout(s),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[K]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},x=(e,r,t)=>{const s=()=>{r&&M(r,0,t)};e.addEventListener("focusout",s,{once:!0})},g=0,p="data-ionic-skip-scroll-assist",X=(e,r,t,s,o,a,n,c=!1)=>{const f=a&&(n===void 0||n.mode===O.None);let d=!1;const u=b!==void 0?b.innerHeight:0,l=y=>{if(d===!1){d=!0;return}_(e,r,t,s,y.detail.keyboardHeight,f,c,u,!1)},v=()=>{d=!1,b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute("data-ionic-skip-scroll-assist")){r.removeAttribute(p);return}_(e,r,t,s,o,f,c,u),b===null||b===void 0||b.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),b===null||b===void 0||b.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},I=e=>{var r;if(document.activeElement===e)return;const t=e.getAttribute("id"),s=e.closest(`label[for="${t}"]`),o=(r=document.activeElement)===null||r===void 0?void 0:r.closest(`label[for="${t}"]`);s!==null&&s===o||(e.setAttribute(p,"true"),e.focus())},_=async(e,r,t,s,o,a,n=!1,c=0,f=!0)=>{if(!t&&!s)return;const d=j(e,t||s,o,c);if(t&&Math.abs(d.scrollAmount)<4){I(r),a&&t!==null&&(M(t,g),x(r,t,()=>g=0));return}if(T(e,r,!0,d.inputSafeY,n),I(r),F(()=>e.click()),a&&t&&(g=d.scrollPadding,M(t,g)),typeof window<"u"){let u;const l=async()=>{u!==void 0&&clearTimeout(u),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await H(t,0,d.scrollAmount,d.scrollDuration),T(e,r,!1,d.inputSafeY),I(r),a&&x(r,t,()=>g=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await R(t),y=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>y-S.scrollTop){r.type==="password"?(d.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),u=setTimeout(l,1e3);return}}l()}};var J=async(e,r)=>{if(A===void 0)return;const t=r==="ios",s=r==="android",o=e.getNumber("keyboardHeight",290),a=e.getBoolean("scrollAssist",!0),n=e.getBoolean("hideCaretOnScroll",t),c=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(A.querySelectorAll("ion-input, ion-textarea")),u=new WeakMap,l=new WeakMap,v=await N.getResizeMode(),S=async i=>{await new Promise(m=>$(i,m));const h=i.shadowRoot||i,L=h.querySelector("input")||h.querySelector("textarea"),w=k(i),B=w?null:i.closest("ion-footer");if(L){if(w&&n&&!u.has(i)){const m=G(i,L,w);u.set(i,m)}if(!(L.type==="date"||L.type==="datetime-local")&&(w||B)&&a&&!l.has(i)){const m=X(i,L,w,B,o,f,v,s);l.set(i,m)}}},y=i=>{if(n){const h=u.get(i);h&&h(),u.delete(i)}if(a){const h=l.get(i);h&&h(),l.delete(i)}};c&&W();for(const i of d)S(i);A.addEventListener("ionInputDidLoad",i=>{S(i.detail)}),A.addEventListener("ionInputDidUnload",i=>{y(i.detail)})};export{J as startInputShims};
