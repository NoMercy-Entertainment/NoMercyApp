import{$ as A,Fn as N,Ht as _,In as w,On as x,Qn as D,Rn as $,Sn as G,Tn as o,Wn as E,Xt as I,Y as L,Zn as g,cn as U,en as l,er as F,gn as K,in as d,nn as f,rn as C,sn as P,tn as s,tr as n,un as j}from"./index-04Sh3wNb.js";import{a as Q,o as W}from"./ui-BT6EUdI0.js";import{t as c}from"./currentServer-B7-kbkE-.js";import{a as X}from"./config-BOA2pGQM.js";import{a as Y,i as Z,o as J}from"./global-gyhCjh_P.js";import{c as q}from"./user-C1ciKa7-.js";import{i as ee,n as te,r as z,t as R}from"./SocketClient-DPmgFkP-.js";import{t as ae}from"./useServerClient-CroZbKWw.js";import{t as se}from"./ScrollContainer-3_hZWeKa.js";import{t as re}from"./useMounted-CBZpV1fi.js";import{i as oe,t as ne}from"./RipperOverlay-BWEr7uxe.js";import{t as k}from"./HubConnection-BtQMN1V5.js";import{t as le}from"./Button-BOqv4y1r.js";import{t as ie}from"./FloatingBackButton-D3UgtlFi.js";_();var t=E();const Ue=l(()=>t.value?.connection),u=E(!1);function y(){u.value=!0,document.dispatchEvent(new Event("dashboardHub-connected")),t.value?.connection&&(z(t.value?.connection,"Dashboard Hub"),te(t.value?.connection))}function i(a){u.value=!1,console.log("Disconnected from Dashboard SignalR",a),document.dispatchEvent(new Event("dashboardHub-disconnected"))}function M(a){u.value=!1,console.error("Dashboard SignalR Error:",a),document.dispatchEvent(new Event("dashboardHub-error"))}w(c,async a=>{const r=q.value?.accessToken;a&&u.value&&(t.value?.connection?.stop().then(),t.value?.dispose(),t.value=new R(c.value.serverBaseUrl,r,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",i),await O().catch(M))});async function O(){if(t.value?.connection?.state!==k.Connected)return t.value?.connection?.start().then(y)}async function ce(){try{return t.value?.connection?.state===k.Disconnected?void 0:t.value?.connection?.stop().then(i).catch(i)}catch(a){console.error("Error stopping Dashboard SignalR:",a),i()}}async function H(){const a=q.value?.accessToken;c.value&&(!t.value?.connection?.state||t.value?.connection?.state===k.Disconnected)&&(t.value=new R(c.value.serverBaseUrl,a,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",i),await O().catch(M),t.value?.connection?.onreconnecting(r=>{console.log("SignalR Disconnected.",r?.message),ee(t.value.connection,"Dashboard Hub"),i()}),t.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),z(t.value.connection,"Dashboard Hub"),y()}))}_();L();var ue=j({__name:"HelpButton",setup(a){const r=A(),v=l(()=>`https://docs${X}.nomercy.tv${r.path.replace(/\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/gu,"")}`);return(b,S)=>(o(),f(le,{id:"help",href:v.value,variant:"text",component:"link",target:"_blank",color:"auto","start-icon":"messageBubbleQuestion",class:"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5"},{default:$(()=>[P(n(b.$t("Help")),1)]),_:1},8,["href"]))}}),de=ue;_();var fe={key:0,class:"grid h-full w-full place-items-center text-surface-12"},ve={class:"relative flex items-center justify-start gap-8 overflow-hidden"},pe={class:"relative flex w-full flex-col gap-4"},he={class:"text-7xl font-bold text-center"},me={class:"left-0 text-2xl text-center whitespace-pre-line"},xe=["inert"],ye={class:"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-surface-8/11 xl:px-6"},be={class:"relative flex h-full flex-col items-start justify-center gap-1"},ge={class:"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold"},we={key:1,class:"hidden w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex text-surface-12/12"},_e={class:"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row"},ke={key:0,class:"grid h-full w-full place-items-center"},Se={class:"relative flex flex-col items-center justify-start gap-8 overflow-hidden"},Be={class:"relative flex w-full flex-col gap-4"},De={class:"text-7xl font-bold text-center"},Ce={class:"left-0 text-2xl text-center whitespace-pre-line"},He={key:2,class:"sticky bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-surface-8/11 empty:hidden sm:h-16 xl:px-6"},$e=j({__name:"DashboardLayout",props:K({title:{type:String,required:!0},params:{type:Object,required:!1},description:{type:String,required:!1},gridStyle:{type:Number,required:!1,default:0},back:{type:Boolean,required:!1,default:!1},error:{type:Object,required:!1},allowAnyone:{type:Boolean,required:!1,default:!1},styles:{type:String,required:!1}},{modelValue:{required:!1,type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const r=a,v=N(a,"modelValue"),{dataUpdatedAt:b,error:S,isPending:T}=ae({path:"dashboard/server",enabled:!r.allowAnyone,refetchInterval:1e4,queryKey:["dashboard","server",u.value]}),V=l(()=>r.gridStyle===1?Y.value:r.gridStyle===2?J.value:r.gridStyle===3?Z.value:r.gridStyle===4?"flex flex-wrap h-available":"flex flex-wrap h-available overflow-clip"),p=l(()=>{if(r.allowAnyone)return null;const e=S.value;if(e?.response?.status!==200)return{code:e?.response?.data?.status??null,message:e?.response?.data?.detail??""}}),h=l(()=>{const e=r.error;if(console.log(e),!(!e?.response||e?.response?.status===200))return{code:e?.response?.status,message:e?.response?.data?.detail??""}});G(()=>{W(null),Q(null)}),re(H,ce,20);const B=l(()=>(p.value?.code||T.value)&&!r.allowAnyone);return w(B,e=>{e&&v.value!==void 0&&(v.value=!1)}),w(b,e=>{e&&!u.value&&H()}),(e,m)=>(o(),f(I,null,[B.value?(o(),d("div",fe,[s("div",ve,[s("div",pe,[s("p",he,n(p.value?.code?p.value?.code:"Offline"),1),s("p",me,n(p.value?.message),1)])])])):(o(),d("div",{key:1,class:D([{" min-h-[92vh] sm:min-h-[92.75vh]":!e.$slots.cta," min-h-[92vh] sm:min-h-[90.1vh]":!!e.$slots.cta},"flex flex-col relative z-0 flex-1 h-available overflow-clip items-start justify-start self-stretch w-available text-surface-12"])},[s("div",{inert:g(oe),class:"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch"},[m[0]||(m[0]=s("div",{class:"absolute inset-0 z-0 h-full w-full"},null,-1)),s("div",ye,[s("div",be,[s("p",ge,n(e.$t(a.title,a.params)),1),a.back?(o(),f(ie,{key:0,class:"left-4 -mt-1.5",position:"relative"})):(o(),d("p",we,n(e.$t(a.description??"")),1))]),x(e.$slots,"title"),s("div",_e,[U(de),x(e.$slots,"cta")])])],8,xe),h.value?(o(),d("div",ke,[s("div",Se,[s("div",Be,[s("p",De,n(h.value.code),1),s("p",Ce,n(h.value.message),1)])])])):(o(),f(se,{key:1,static:!0,class:"z-0 w-full flex-1 overflow-y-auto overflow-x-hidden pt-2 sm:p-4",frame:""},{default:$(()=>[s("div",{class:D([V.value,"h-auto w-full flex-wrap content-start gap-4 flex-1"]),style:F(a.styles)},[x(e.$slots,"default")],6)]),_:3})),!h.value&&e.$slots.actions?(o(),d("div",He,[m[1]||(m[1]=s("div",{class:"absolute inset-0 -z-10 h-full w-full"},null,-1)),x(e.$slots,"actions")])):C("",!0),g(c)?.is_owner||g(c)?.is_manager?(o(),f(ne,{key:3})):C("",!0)],2))],1024))}}),Fe=$e;export{Ue as n,u as r,Fe as t};
