import{aw as C,o as f,e as h,a7 as l,a,a_ as V,I as m,bt as M,aC as B,q as I,v as o,a6 as p,t as v,aB as y,bs as E,b1 as $,bg as j,c as A,u as T,F as U,bE as F,bF as L}from"./index-Bfb4eeQA.js";import{u as N}from"./useApiClient-CS3WZty2.js";import{_ as z}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DN9Fe7xn.js";import{_ as x}from"./Button.vue_vue_type_script_setup_true_lang-DYUvFrPQ.js";import{_ as D}from"./DashboardCard.vue_vue_type_script_setup_true_lang-yr_TZNhr.js";import{_ as K}from"./Modal.vue_vue_type_script_setup_true_lang-nEpf7gpX.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-NpF_oR0E.js";const O={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},Z=["src"],P=C({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(n){return(u,d)=>(f(),h(D,{route:`/dashboard/users/${n.data.id}`,line1:n.data.name,line2:""},{image:l(()=>[a("div",O,[d[0]||(d[0]=a("div",{class:"backdropCard-overlay"},null,-1)),a("img",{src:n.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,Z)])]),_:1},8,["route","line1"]))}}),Q={class:"flex w-full flex-col justify-start text-left"},W={class:"py-4 text-sm text-auto-10"},G={class:"flex flex-col gap-2 w-full"},H={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},J=C({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(n){const{t:u}=V(),d=n;m(null);const r=m(""),c=m([]),{data:_}=M({path:"/dashboard/libraries"}),i=m(),g=()=>{c.value=[],d.close()},b=s=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(s).toLowerCase()),S=B(()=>b(r.value)),k=()=>{var s,e;if(!r.value){c.value.push({type:"error",place:"email",message:u("Email is required")});return}if(!b(r.value)){c.value.push({type:"error",place:"email",message:u("Invalid email address")});return}E().post("server/users",{server_id:(s=$.value)==null?void 0:s.id,email:r.value,libraries:(e=i.value)==null?void 0:e.map(t=>t.id)}).then(()=>{j.invalidateQueries({queryKey:["server_users"]}),r.value="",d.close()}).catch(({response:t})=>{(t==null?void 0:t.status)!=200&&(t!=null&&t.data)&&c.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})};return(s,e)=>{const t=I("InputText"),q=I("MultiSelect");return f(),h(K,{open:n.open,close:g,title:"Invite user"},{actions:l(()=>[o(x,{type:"button",id:"yes",color:"theme",variant:"contained",endIcon:"emailSend",disabled:!S.value,onClick:k},{default:l(()=>[p(v(s.$t("Send")),1)]),_:1},8,["disabled"]),o(x,{type:"button",id:"no",variant:"text",onClick:g},{default:l(()=>[p(v(s.$t("Cancel")),1)]),_:1})]),default:l(()=>[a("div",Q,[a("p",W,[p(v(s.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=a("br",null,null,-1)),p(" "+v(s.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),a("div",G,[e[3]||(e[3]=a("label",{for:"email"},"Email",-1)),o(t,{id:"email",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=w=>r.value=w),class:"mb-4"},null,8,["modelValue"])]),a("div",H,[e[4]||(e[4]=a("label",{for:"libraries"},"Allowed libraries",-1)),o(q,{id:"libraries",display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:y(_),optionLabel:"title",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=w=>i.value=w)},null,8,["options","modelValue"])])])]),_:1},8,["open"])}}}),re=C({__name:"Desktop",setup(n){var _;const u=m(!1),{data:d}=N({path:"server_users",params:{server_id:(_=$.value)==null?void 0:_.id},queryKey:["server_users"]}),r=()=>{u.value=!0,setTimeout(()=>{var i;(i=document.querySelector("#email"))==null||i.focus()},300)},c=()=>{u.value=!1};return(i,g)=>(f(),h(y(L),null,{default:l(()=>[o(y(F),{fullscreen:!0},{default:l(()=>[o(z,{gridStyle:1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[o(x,{id:"invite",color:"theme",startIcon:"userAdd",onClick:r},{default:l(()=>[p(v(i.$t("Invite user")),1)]),_:1})]),default:l(()=>[(f(!0),A(U,null,T(y(d),b=>(f(),h(P,{data:b},null,8,["data"]))),256)),o(J,{open:u.value,close:c},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{re as default};
//# sourceMappingURL=Desktop-BLC3i4MD.js.map
