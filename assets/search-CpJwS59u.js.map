{"version":3,"file":"search-CpJwS59u.js","sources":["../../src/store/search.ts"],"sourcesContent":["import { computed, onMounted, ref, watch } from 'vue';\nimport { refDebounced, useIntersectionObserver } from '@vueuse/core';\n\nimport type { HomeDataItem } from '@/types/api/music';\nimport type { Component } from '@/lib/routerHelper';\nimport type { Movie, Person, Tv } from '@/types/api/base/info';\n\nimport { currentServer } from '@/store/currentServer';\nimport { user } from '@/store/user';\nimport { tmdbApiKey } from '@/config/config';\n\nexport const musicSearchValue = ref('');\nexport const musicSearchResult = computed(() => musicResult.value);\n\nconst debouncedSearchValue = refDebounced(musicSearchValue, 500);\nconst musicResult = ref<Component<HomeDataItem>[]>([]);\n\nwatch(debouncedSearchValue, (value) => {\n\tconst url = `${currentServer.value?.serverBaseUrl}/api/v1/music/search?query=${value}`;\n\n\tfetch(url, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Authorization': `Bearer ${user.value?.accessToken}`\n\t\t}\n\t})\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tmusicResult.value = data.data;\n\t\t});\n});\n\n\nexport const videoSearchValue = ref('');\nexport const videoSearchResult = ref<Array<Movie | Tv | Person & any>>([]);\nexport const hasMoreResults = ref(false);\n\nconst debouncedVideoSearchValue = refDebounced(videoSearchValue, 500);\nconst page = ref(1);\n\nwatch(debouncedVideoSearchValue, (value) => {\n\tpage.value = 1; // Reset page number on new search\n\tconst url = `https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=en-US&query=${value}&page=${page.value}&include_adult=false`;\n\n\tfetch(url)\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tvideoSearchResult.value = data.results;\n\t\t\thasMoreResults.value = data.total_pages > 1;\n\t\t});\n});\n\nexport const fetchNextPage = () => {\n\tpage.value += 1;\n\tconst url = `https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=en-US&query=${debouncedVideoSearchValue.value}&page=${page.value}&include_adult=false`;\n\n\tfetch(url)\n\t\t.then(response => response.json())\n\t\t.then(data => {\n\t\t\tvideoSearchResult.value = [...videoSearchResult.value, ...data.results];\n\t\t\tif (data.results.length === 0) {\n\t\t\t\thasMoreResults.value = false;\n\t\t\t} else {\n\t\t\t\thasMoreResults.value = data.total_pages > page.value;\n\t\t\t}\n\t\t});\n}\n\nconst loadMore = ref(null);\nconst { stop } = useIntersectionObserver(\n\tloadMore,\n\t([{ isIntersecting }], observerElement) => {\n\t\tif (isIntersecting) {\n\t\t\tfetchNextPage()\n\t\t}\n\t},\n);\n\nonMounted(() => {\n\tstop();\n});\n"],"names":["musicSearchValue","ref","musicSearchResult","computed","musicResult","debouncedSearchValue","refDebounced","watch","value","url","_a","currentServer","_b","user","response","data","videoSearchValue","videoSearchResult","hasMoreResults","debouncedVideoSearchValue","page","tmdbApiKey","fetchNextPage","loadMore","stop","useIntersectionObserver","isIntersecting","observerElement","onMounted"],"mappings":"uGAWa,MAAAA,EAAmBC,EAAI,EAAE,EACzBC,EAAoBC,EAAS,IAAMC,EAAY,KAAK,EAE3DC,EAAuBC,EAAaN,EAAkB,GAAG,EACzDI,EAAcH,EAA+B,EAAE,EAErDM,EAAMF,EAAuBG,GAAU,SACtC,MAAMC,EAAM,IAAGC,EAAAC,EAAc,QAAd,YAAAD,EAAqB,aAAa,8BAA8BF,CAAK,GAEpF,MAAMC,EAAK,CACV,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAiB,WAAUG,EAAAC,EAAK,QAAL,YAAAD,EAAY,WAAW,EAAA,CACnD,CACA,EACC,KAAKE,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbX,EAAY,MAAQW,EAAK,IAAA,CACzB,CACH,CAAC,EAGY,MAAAC,EAAmBf,EAAI,EAAE,EACzBgB,EAAoBhB,EAAsC,CAAE,CAAA,EAC5DiB,EAAiBjB,EAAI,EAAK,EAEjCkB,EAA4Bb,EAAaU,EAAkB,GAAG,EAC9DI,EAAOnB,EAAI,CAAC,EAElBM,EAAMY,EAA4BX,GAAU,CAC3CY,EAAK,MAAQ,EACb,MAAMX,EAAM,qDAAqDY,CAAU,yBAAyBb,CAAK,SAASY,EAAK,KAAK,uBAEtH,MAAAX,CAAG,EACP,KAAKK,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbE,EAAkB,MAAQF,EAAK,QAChBG,EAAA,MAAQH,EAAK,YAAc,CAAA,CAC1C,CACH,CAAC,EAEM,MAAMO,EAAgB,IAAM,CAClCF,EAAK,OAAS,EACR,MAAAX,EAAM,qDAAqDY,CAAU,yBAAyBF,EAA0B,KAAK,SAASC,EAAK,KAAK,uBAEhJ,MAAAX,CAAG,EACP,KAAKK,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACbE,EAAkB,MAAQ,CAAC,GAAGA,EAAkB,MAAO,GAAGF,EAAK,OAAO,EAClEA,EAAK,QAAQ,SAAW,EAC3BG,EAAe,MAAQ,GAERA,EAAA,MAAQH,EAAK,YAAcK,EAAK,KAChD,CACA,CACH,EAEMG,EAAWtB,EAAI,IAAI,EACnB,CAAE,KAAAuB,CAAS,EAAAC,EAChBF,EACA,CAAC,CAAC,CAAE,eAAAG,EAAgB,EAAGC,IAAoB,CACtCD,GACWJ,EAAA,CACf,CAEF,EAEAM,EAAU,IAAM,CACVJ,EAAA,CACN,CAAC"}