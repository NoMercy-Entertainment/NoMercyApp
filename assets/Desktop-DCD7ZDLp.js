import{C as f,Ct as u,Dt as c,J as E,K as i,O as b,S as _,T as k,X as $,c as w,g as R,j as x,k as d,mt as h,ot as t,wt as g}from"./i18n-Rm1NkeNf.js";import"./ionic-vX7GXDhi.js";import{C as q,_ as A}from"./vue-core-D-3YrIBp.js";import{C as K}from"./primevue-DkuV93HA.js";import"./query-BPfDyGC_.js";import{Gi as N,Ki as y,_i as r,n as T,qi as C}from"./index-Cz-5kHOr.js";import"./useInfiniteServerClient-DD3VR0t0.js";import{t as j}from"./useServerClient-3BFHXUNx.js";import"./ScrollContainer-2WwLyTKz.js";import"./useMounted-A4MEnwHg.js";import"./RipperOverlay-EVO5zeg2.js";import"./ripperSocket-V7LwG1_y.js";import"./FloatingBackButton-BFk90iHf.js";import{t as I}from"./DashboardLayout-Cm_9Eles.js";import{t as V}from"./DashboardCard-DbVXoo4k.js";w();var z={class:"relative flex aspect-video flex-shrink-0 flex-grow-0 flex-col items-center justify-center self-stretch overflow-clip rounded-lg bg-theme-8"},M={key:1,class:"text-xl font-bold text-center"},O=x({__name:"LibraryCard",props:{data:{type:Object,required:!0}},setup(a){return(s,n)=>(i(),f(V,{line1:a.data.title,line2:a.data.folder_library&&a.data.folder_library?.length!==1?`${a.data.folder_library?.length} folders`:`${a.data.folder_library?.length}  folder`,route:`/dashboard/libraries/${a.data.id}`},{image:t(()=>[_("div",z,[n[0]||(n[0]=_("div",{class:"backdropCard-overlay"},null,-1)),a.data.image?(i(),f(T,{key:0,path:a.data.image,aspect:"backdrop",class:"z-0"},null,8,["path"])):(i(),k("span",M,c(a.data.title),1))])]),_:1},8,["line1","line2","route"]))}}),U=O;w();var F=x({__name:"Desktop",setup(a){const s=K(),{data:n,error:B}=j({path:"dashboard/libraries",queryKey:["dashboard","libraries",C.value?.serverBaseUrl]}),o=h(!1);async function S(){if(!o.value){o.value=!0;try{const{data:e}=await y().post("dashboard/libraries");s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3}),N.invalidateQueries({queryKey:["dashboard","libraries",C.value?.serverBaseUrl]})}catch{s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while creating the library"),life:5e3})}finally{o.value=!1}}}const l=h(!1);function D(){l.value=!0,y().post("dashboard/libraries/refresh").then(({data:e})=>{l.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{l.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}const m=h(!1);function L(){m.value=!0,y().post("dashboard/libraries/rescan").then(({data:e})=>{m.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{m.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}return(e,G)=>{const v=$("Button");return i(),f(u(q),null,{default:t(()=>[d(u(A),{fullscreen:!0},{default:t(()=>[d(I,{error:u(B),"grid-style":1,title:"Libraries",description:"Manage your media libraries and their content here."},{cta:t(()=>[d(v,{id:"newLibrary",disabled:o.value,color:"theme","start-icon":"folderAdd",onClick:S},{default:t(()=>[b(c(o.value?e.$t("Creating..."):e.$t("New library")),1)]),_:1},8,["disabled"])]),actions:t(()=>[d(v,{id:"refresh",type:"button",variant:"text","start-icon":"folderSwap",disabled:l.value,class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),onClick:D},{default:t(()=>[b(c(e.$t("Refresh all libraries")),1)]),_:1},8,["disabled","class"]),d(v,{id:"rescan",type:"button",variant:"text","start-icon":"folderSwap",disabled:l.value,class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),onClick:L},{default:t(()=>[b(c(e.$t("Rescan all libraries")),1)]),_:1},8,["disabled","class"])]),default:t(()=>[(i(!0),k(R,null,E(u(n)??[],p=>(i(),f(U,{key:p.id,data:p},null,8,["data"]))),128))]),_:1},8,["error"])]),_:1})]),_:1})}}}),oe=F;export{oe as default};
