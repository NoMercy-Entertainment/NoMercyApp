import{$n as h,Bn as W,Hn as j,In as Q,Ln as V,Qn as Z,Rn as J,Vn as X,Zn as T,ir as _,lr as E,or as ee,sr as te,ur as B,xu as re,zn as se}from"./index-Rmty3EhQ.js";var A,D,O,H,p,K,F,I,$,U,Y,q,x,C,R,L,M,z,P,k,G,oe,ie=re(()=>{Z(),X(),te(),J(),A=new WeakMap,D=(e,r,t,s=0,o=!1)=>{A.has(e)!==t&&(t?H(e,r,s,o):p(e,r))},O=e=>e===e.getRootNode().activeElement,H=(e,r,t,s=!1)=>{const o=r.parentNode,i=r.cloneNode(!1);i.classList.add("cloned-input"),i.tabIndex=-1,s&&(i.disabled=!0),o.appendChild(i),A.set(e,i);const a=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",r.style.transform=`translate3d(${a}px,${t}px,0) scale(0)`},p=(e,r)=>{const t=A.get(e);t&&(A.delete(e),t.remove()),e.style.pointerEvents="",r.style.transform=""},K=50,F=(e,r,t)=>{if(!t||!r)return()=>{};const s=u=>{O(r)&&D(e,r,u)},o=()=>D(e,r,!1),i=()=>s(!0),a=()=>s(!1);return _(t,"ionScrollStart",i),_(t,"ionScrollEnd",a),r.addEventListener("blur",o),()=>{B(t,"ionScrollStart",i),B(t,"ionScrollEnd",a),r.removeEventListener("blur",o)}},I="input, textarea, [no-blur], [contenteditable]",$=()=>{let e=!0,r=!1;const t=document,s=()=>{r=!0},o=()=>{e=!0},i=a=>{if(r){r=!1;return}const u=t.activeElement;if(!u||u.matches(I))return;const f=a.target;f!==u&&(f.matches(I)||f.closest(I)||(e=!1,setTimeout(()=>{e||u.blur()},50)))};return _(t,"ionScrollStart",s),t.addEventListener("focusin",o,!0),t.addEventListener("touchend",i,!1),()=>{B(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",o,!0),t.removeEventListener("touchend",i,!1)}},U=.3,Y=(e,r,t,s)=>{var o;return q(((o=e.closest("ion-item,[ion-item]"))!==null&&o!==void 0?o:e).getBoundingClientRect(),r.getBoundingClientRect(),t,s)},q=(e,r,t,s)=>{const o=e.top,i=e.bottom,a=r.top,u=Math.min(r.bottom,s-t),f=a+15,d=u-K-i,c=f-o,l=Math.round(d<0?-d:c>0?-c:0),v=Math.min(l,o-a),S=Math.abs(v)/U;return{scrollAmount:v,scrollDuration:Math.min(400,Math.max(150,S)),scrollPadding:t,inputSafeY:-(o-f)+4}},x="$ionPaddingTimer",C=(e,r,t)=>{const s=e[x];s&&clearTimeout(s),r>0?e.style.setProperty("--keyboard-offset",`${r}px`):e[x]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},R=(e,r,t)=>{const s=()=>{r&&C(r,0,t)};e.addEventListener("focusout",s,{once:!0})},L=0,M="data-ionic-skip-scroll-assist",z=(e,r,t,s,o,i,a,u=!1)=>{const f=i&&(a===void 0||a.mode===V.None);let d=!1;const c=h!==void 0?h.innerHeight:0,l=w=>{if(d===!1){d=!0;return}k(e,r,t,s,w.detail.keyboardHeight,f,u,c,!1)},v=()=>{d=!1,h===null||h===void 0||h.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)},S=async()=>{if(r.hasAttribute(M)){r.removeAttribute(M);return}k(e,r,t,s,o,f,u,c),h===null||h===void 0||h.addEventListener("ionKeyboardDidShow",l),e.addEventListener("focusout",v)};return e.addEventListener("focusin",S),()=>{e.removeEventListener("focusin",S),h===null||h===void 0||h.removeEventListener("ionKeyboardDidShow",l),e.removeEventListener("focusout",v)}},P=e=>{document.activeElement!==e&&(e.setAttribute(M,"true"),e.focus())},k=async(e,r,t,s,o,i,a=!1,u=0,f=!0)=>{if(!t&&!s)return;const d=Y(e,t||s,o,u);if(t&&Math.abs(d.scrollAmount)<4){P(r),i&&t!==null&&(C(t,L),R(r,t,()=>L=0));return}if(D(e,r,!0,d.inputSafeY,a),P(r),E(()=>e.click()),i&&t&&(L=d.scrollPadding,C(t,L)),typeof window<"u"){let c;const l=async()=>{c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",v),window.removeEventListener("ionKeyboardDidShow",l),t&&await j(t,0,d.scrollAmount,d.scrollDuration),D(e,r,!1,d.inputSafeY),P(r),i&&R(r,t,()=>L=0)},v=()=>{window.removeEventListener("ionKeyboardDidShow",v),window.addEventListener("ionKeyboardDidShow",l)};if(t){const S=await W(t),w=S.scrollHeight-S.clientHeight;if(f&&d.scrollAmount>w-S.scrollTop){r.type==="password"?(d.scrollAmount+=K,window.addEventListener("ionKeyboardDidShow",v)):window.addEventListener("ionKeyboardDidShow",l),c=setTimeout(l,1e3);return}}l()}},G=!0,oe=async(e,r)=>{if(T===void 0)return;const t=r==="ios",s=r==="android",o=e.getNumber("keyboardHeight",290),i=e.getBoolean("scrollAssist",!0),a=e.getBoolean("hideCaretOnScroll",t),u=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),d=Array.from(T.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,l=new WeakMap,v=await Q.getResizeMode(),S=async n=>{await new Promise(g=>ee(n,g));const y=n.shadowRoot||n,b=y.querySelector("input")||y.querySelector("textarea"),m=se(n),N=m?null:n.closest("ion-footer");if(b){if(m&&a&&!c.has(n)){const g=F(n,b,m);c.set(n,g)}if(!(b.type==="date"||b.type==="datetime-local")&&(m||N)&&i&&!l.has(n)){const g=z(n,b,m,N,o,f,v,s);l.set(n,g)}}},w=n=>{if(a){const y=c.get(n);y&&y(),c.delete(n)}if(i){const y=l.get(n);y&&y(),l.delete(n)}};u&&G&&$();for(const n of d)S(n);T.addEventListener("ionInputDidLoad",n=>{S(n.detail)}),T.addEventListener("ionInputDidUnload",n=>{w(n.detail)})}});ie();export{oe as startInputShims};
