import{$ as j,a7 as W,aZ as z,d as m,c,o as n,l as d,i as a,B as v,v as o,y as q,aa as X,C as ee,w as D,h as te,b as p,a0 as w}from"./vue-ionic-BZKAFNsD.js";import{u as Z}from"./useServerClient-DggO6pli.js";import{bd as ae,h as G,t as se}from"./index-En-DH4bZ.js";import{_ as oe}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DOe_jPua.js";import{_ as le}from"./Modal.vue_vue_type_script_setup_true_lang-DYkO2vPA.js";import{_ as A}from"./Button.vue_vue_type_script_setup_true_lang-DNNBfaYY.js";import{T}from"./Toggle-B56Ymfw9.js";import{u as re}from"./useApiClient-dJX1JwVI.js";import{_ as ie}from"./Select.vue_vue_type_script_setup_true_lang-B_jODRWA.js";import"./vendor-B4CMB5r9.js";import"./icons-BW5E66pf.js";import"./rxjs-BCp2L9Rn.js";import"./media-C2AqgyMX.js";import"./api-BBofn2cc.js";import"./swiper-D00Cnjmx.js";import"./useInfiniteServerClient-DZr6viGI.js";import"./music-player-4pEGVRj1.js";import"./useMounted-Ddis8rGT.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-CTa4FlxL.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-CBcusWU1.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-BaVJO8ob.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-16zO7UkF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"my-6 text-sm text-auto-10"},de=j({__name:"DeleteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},noRedirect:{type:Boolean,default:!1}},setup(b){const _=b,{t:f}=W(),i=z(),S=m([]);function l(){var u;if(!_.id){S.value.push({type:"error",place:"email",message:f("Email is required")});return}ae().post("server/server-users",{_method:"delete",id:(u=G.value)==null?void 0:u.id,user_id:_.id}).then(()=>{i.invalidateQueries({queryKey:["users"]}).then(()=>{history.back()})}),_.close()}return(u,B)=>(n(),c(le,{open:b.open,close:b.close,params:{name:b.name},title:"Delete server member {{name}}"},{actions:d(()=>[q(A,{id:"yes",type:"button",color:"red",variant:"contained","end-icon":"userRemove",onClick:l},{default:d(()=>[v(o(u.$t("Yes")),1)]),_:1}),q(A,{id:"no",type:"button",variant:"text",color:"white",onClick:b.close},{default:d(()=>[v(o(u.$t("Cancel")),1)]),_:1},8,["onClick"])]),default:d(()=>[a("p",ne,[v(o(u.$t("Are you sure you want to delete this server member?")),1),B[0]||(B[0]=a("br",null,null,-1)),v(" "+o(u.$t("They won't be able to access your content anymore until you re-invite them"))+". ",1)])]),_:1},8,["open","close","params"]))}}),ue={key:0,class:"mt-4 flex w-full flex-col sm:w-1/2"},me={class:"mt-4 mb-2"},ce={class:"flex flex-col gap-2"},pe={for:"allowed",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},fe={class:"whitespace-pre-wrap text-sm font-semibold"},ve={for:"manage",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},be={class:"whitespace-pre-wrap text-sm font-semibold"},he={class:"mt-4 mb-2"},ge={class:"flex w-full flex-col gap-2"},ye={for:"audioTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},we={class:"whitespace-pre-wrap text-sm font-semibold"},_e={for:"videoTranscoding",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},ke={class:"whitespace-pre-wrap text-sm font-semibold"},$e={class:"mt-4 mb-2"},Ve={class:"flex w-1/2 flex-col gap-2"},Ce={for:"allowedAllLibraries",class:"pointer-events-auto inline-flex h-10 w-full touch-none items-center group","data-selected":"true"},xe={class:"whitespace-pre-wrap text-sm font-semibold"},Ie=j({__name:"Edit",setup(b){var K,M,N,R,Q,P,F,O,Y;const _=z(),f=X(),{data:i}=Z({path:"/dashboard/libraries"}),{data:S}=re({path:"server/server-users",params:{id:(K=G.value)==null?void 0:K.id},queryKey:["server_users"]}),{data:l,error:u}=Z({path:`dashboard/users/${f.params.id}/permissions`,queryKey:["userPermissions",f.params.id]}),B=ee(()=>{var e,t;return(t=(e=S.value)==null?void 0:e.find(r=>r.id===f.params.id))==null?void 0:t.name}),k=m((M=l.value)==null?void 0:M.allowed),$=m((N=l.value)==null?void 0:N.manage),V=m((R=l.value)==null?void 0:R.audio_transcoding),C=m((Q=l.value)==null?void 0:Q.video_transcoding),L=m((P=l.value)==null?void 0:P.no_transcoding),h=m(((F=i.value)==null?void 0:F.filter(e=>{var t,r;return(r=(t=l.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}).length)===((O=i.value)==null?void 0:O.length)),g=m((Y=i.value)==null?void 0:Y.filter(e=>{var t,r;return(r=(t=l.value)==null?void 0:t.libraries)==null?void 0:r.includes(e.id)}));D(l,e=>{var t,r,x;k.value=e==null?void 0:e.allowed,$.value=e==null?void 0:e.manage,V.value=e==null?void 0:e.audio_transcoding,C.value=e==null?void 0:e.video_transcoding,L.value=e==null?void 0:e.no_transcoding,g.value=(t=i.value)==null?void 0:t.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}),h.value=((r=i.value)==null?void 0:r.filter(y=>{var s;return(s=e==null?void 0:e.libraries)==null?void 0:s.includes(y.id)}).length)==((x=i.value)==null?void 0:x.length)});const U=m(!1);function H(){U.value=!0}function I(){U.value=!1}function E(){window.history.back()}function J(){var e;se().patch(`dashboard/users/${f.params.id}/permissions`,{allowed:k.value,manage:$.value,audio_transcoding:V.value,video_transcoding:C.value,no_transcoding:L.value,libraries:(e=g.value)==null?void 0:e.map(t=>t.id)}).then(({data:t})=>{_.invalidateQueries({queryKey:["userPermissions",f.params.id]}),E()})}return D(h,e=>{e&&(g.value=i.value)}),D(g,e=>{i.value}),(e,t)=>(n(),c(oe,{error:w(u),title:"Server member: {{name}}",params:{name:B.value},back:!0},{cta:d(()=>t[6]||(t[6]=[])),actions:d(()=>[q(A,{id:"yes",type:"button",variant:"text",class:"mr-auto",color:"text-auto-alpha-11","start-icon":"userDelete",onClick:H},{default:d(()=>[v(o(e.$t("Remove user")),1)]),_:1}),q(A,{id:"cancel",type:"button",variant:"text",color:"white",onClick:E},{default:d(()=>[v(o(e.$t("Cancel")),1)]),_:1}),q(A,{id:"save",type:"button",color:"theme",onClick:J},{default:d(()=>[v(o(e.$t("Save")),1)]),_:1})]),default:d(()=>{var r,x,y;return[w(l)?(n(),te("div",ue,[a("h3",me,o(e.$t("Base permissions"))+": ",1),a("div",ce,[a("label",pe,[k.value!==void 0?(n(),c(T,{key:0,id:"allowed",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),label:"Manage",class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",fe,o(e.$t("Allow this user to access content")),1)]),a("label",ve,[$.value!==void 0?(n(),c(T,{key:0,id:"manage",modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),label:"Manage",class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",be,o(e.$t("Allow this user to manage the server")),1)])]),a("h3",he,o(e.$t("Media playback"))+": ",1),a("div",ge,[a("label",ye,[V.value!==void 0?(n(),c(T,{key:0,id:"audioTranscoding",modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=s=>V.value=s),label:"AudioTranscoding",class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",we,o(e.$t("Allow audio playback that requires transcoding")),1)]),a("label",_e,[C.value!==void 0?(n(),c(T,{key:0,id:"videoTranscoding",modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),label:"VideoTranscoding",class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",ke,o(e.$t("Allow video playback that requires transcoding")),1)])]),a("h3",$e,o(e.$t("Library Access"))+": ",1),a("div",Ve,[a("label",Ce,[h.value!==void 0?(n(),c(T,{key:0,id:"allowedAllLibraries",modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=s=>h.value=s),label:"AllowedAllLibraries",class:"mr-2"},null,8,["modelValue"])):p("",!0),a("span",xe,o(e.$t("Enable access to all libraries")),1)]),h.value?p("",!0):(n(),c(ie,{key:0,id:"libraries",modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=s=>g.value=s),label:"libraries",placeholder:"Select libraries",multiple:"",items:w(i),"option-label":"title"},null,8,["modelValue","items"]))])])):p("",!0),(r=w(l))!=null&&r.id?(n(),c(de,{key:1,id:(x=w(l))==null?void 0:x.id,name:(y=w(l))==null?void 0:y.name,close:I,open:U.value},null,8,["id","name","open"])):p("",!0)]}),_:1},8,["error","params"]))}});export{Ie as default};
