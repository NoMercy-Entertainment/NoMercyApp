import{Bn as N,Bt as j,Dn as V,Gt as $,Lt as P,Nn as q,Rn as M,Sn as L,Tt as S,Vt as U,bn as z,cn as b,qt as D,zn as g,zt as x}from"./index-CymNhKD_.js";import{s as H}from"./user-DlzWNC9W.js";import{V as K,Z as E,g as k,h as C,k as G,l as w,m as Z}from"./SocketClient-DIjrmZvk.js";import{a as O}from"./deviceInfo-AeSN8xPw.js";import{t as J}from"./MoooomIcon-D8Onw6Et.js";import{t as Q}from"./MusicButton-Bje5gNcL.js";import{t as I}from"./PlayerIcon-BDrm_9hN.js";function _(i,t,e){let s=e.initialDeps??[],n;function o(){var r,l,h,a;let c;e.key&&((r=e.debug)!=null&&r.call(e))&&(c=Date.now());const u=i();if(!(u.length!==s.length||u.some((f,m)=>s[m]!==f)))return n;s=u;let d;if(e.key&&((l=e.debug)!=null&&l.call(e))&&(d=Date.now()),n=t(...u),e.key&&((h=e.debug)!=null&&h.call(e))){const f=Math.round((Date.now()-c)*100)/100,m=Math.round((Date.now()-d)*100)/100,y=m/16,v=(p,W)=>{for(p=String(p);p.length<W;)p=" "+p;return p};console.info(`%câ± ${v(m,5)} /${v(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,e?.key)}return(a=e?.onChange)==null||a.call(e,n),n}return o.updateDeps=r=>{s=r},o}function F(i,t){if(i===void 0)throw new Error(`Unexpected undefined${t?`: ${t}`:""}`);return i}var X=(i,t)=>Math.abs(i-t)<1.01,Y=(i,t,e)=>{let s;return function(...n){i.clearTimeout(s),s=i.setTimeout(()=>t.apply(this,n),e)}},R=i=>{const{offsetWidth:t,offsetHeight:e}=i;return{width:t,height:e}},ee=i=>i,te=i=>{const t=Math.max(i.startIndex-i.overscan,0),e=Math.min(i.endIndex+i.overscan,i.count-1),s=[];for(let n=t;n<=e;n++)s.push(n);return s},se=(i,t)=>{const e=i.scrollElement;if(!e)return;const s=i.targetWindow;if(!s)return;const n=r=>{const{width:l,height:h}=r;t({width:Math.round(l),height:Math.round(h)})};if(n(R(e)),!s.ResizeObserver)return()=>{};const o=new s.ResizeObserver(r=>{const l=()=>{const h=r[0];if(h?.borderBoxSize){const a=h.borderBoxSize[0];if(a){n({width:a.inlineSize,height:a.blockSize});return}}n(R(e))};i.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return o.observe(e,{box:"border-box"}),()=>{o.unobserve(e)}},T={passive:!0},A=typeof window>"u"?!0:"onscrollend"in window,ne=(i,t)=>{const e=i.scrollElement;if(!e)return;const s=i.targetWindow;if(!s)return;let n=0;const o=i.options.useScrollendEvent&&A?()=>{}:Y(s,()=>{t(n,!1)},i.options.isScrollingResetDelay),r=c=>()=>{const{horizontal:u,isRtl:d}=i.options;n=u?e.scrollLeft*(d&&-1||1):e.scrollTop,o(),t(n,c)},l=r(!0),h=r(!1);h(),e.addEventListener("scroll",l,T);const a=i.options.useScrollendEvent&&A;return a&&e.addEventListener("scrollend",h,T),()=>{e.removeEventListener("scroll",l),a&&e.removeEventListener("scrollend",h)}},ie=(i,t,e)=>{if(t?.borderBoxSize){const s=t.borderBoxSize[0];if(s)return Math.round(s[e.options.horizontal?"inlineSize":"blockSize"])}return i[e.options.horizontal?"offsetWidth":"offsetHeight"]},re=(i,{adjustments:t=0,behavior:e},s)=>{var n,o;const r=i+t;(o=(n=s.scrollElement)==null?void 0:n.scrollTo)==null||o.call(n,{[s.options.horizontal?"left":"top"]:r,behavior:e})},oe=class{constructor(i){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const e=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(s=>{s.forEach(n=>{const o=()=>{this._measureElement(n.target,n)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var s;(s=e())==null||s.disconnect(),t=null},observe:s=>{var n;return(n=e())==null?void 0:n.observe(s,{box:"border-box"})},unobserve:s=>{var n;return(n=e())==null?void 0:n.unobserve(s)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([e,s])=>{typeof s>"u"&&delete t[e]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ee,rangeExtractor:te,onChange:()=>{},measureElement:ie,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var e,s;(s=(e=this.options).onChange)==null||s.call(e,this,t)},this.maybeNotify=_(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const e=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==e){if(this.cleanup(),!e){this.maybeNotify();return}this.scrollElement=e,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(s=>{this.observer.observe(s)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,s=>{this.scrollRect=s,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(s,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<s?"forward":"backward":null,this.scrollOffset=s,this.isScrolling=n,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,e)=>{const s=new Map,n=new Map;for(let o=e-1;o>=0;o--){const r=t[o];if(s.has(r.lane))continue;const l=n.get(r.lane);if(l==null||r.end>l.end?n.set(r.lane,r):r.end<l.end&&s.set(r.lane,!0),s.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((o,r)=>o.end===r.end?o.index-r.index:o.end-r.end)[0]:void 0},this.getMeasurementOptions=_(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,e,s,n,o)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:e,scrollMargin:s,getItemKey:n,enabled:o}),{key:!1}),this.getMeasurements=_(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:e,scrollMargin:s,getItemKey:n,enabled:o},r)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(a=>{this.itemSizeCache.set(a.key,a.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,l);for(let a=l;a<t;a++){const c=n(a),u=this.options.lanes===1?h[a-1]:this.getFurthestMeasurement(h,a),d=u?u.end+this.options.gap:e+s,f=r.get(c),m=typeof f=="number"?f:this.options.estimateSize(a),y=d+m,v=u?u.lane:a%this.options.lanes;h[a]={index:a,start:d,size:m,end:y,key:c,lane:v}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=_(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,e,s,n)=>this.range=t.length>0&&e>0?le({measurements:t,outerSize:e,scrollOffset:s,lanes:n}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=_(()=>{let t=null,e=null;const s=this.calculateRange();return s&&(t=s.startIndex,e=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,e]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,e]},(t,e,s,n,o)=>n===null||o===null?[]:t({startIndex:n,endIndex:o,overscan:e,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const e=this.options.indexAttribute,s=t.getAttribute(e);return s?parseInt(s,10):(console.warn(`Missing attribute name '${e}={index}' on measured element.`),-1)},this._measureElement=(t,e)=>{const s=this.indexFromElement(t),n=this.measurementsCache[s];if(!n)return;const o=n.key,r=this.elementsCache.get(o);r!==t&&(r&&this.observer.unobserve(r),this.observer.observe(t),this.elementsCache.set(o,t)),t.isConnected&&this.resizeItem(s,this.options.measureElement(t,e,this))},this.resizeItem=(t,e)=>{const s=this.measurementsCache[t];if(!s)return;const n=e-(this.itemSizeCache.get(s.key)??s.size);n!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(s,n,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=n,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,e)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((e,s)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(s))});return}this._measureElement(t,void 0)},this.getVirtualItems=_(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,e)=>{const s=[];for(let n=0,o=t.length;n<o;n++){const r=e[t[n]];s.push(r)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const e=this.getMeasurements();if(e.length!==0)return F(e[B(0,e.length-1,s=>F(e[s]).start,t)])},this.getOffsetForAlignment=(t,e,s=0)=>{const n=this.getSize(),o=this.getScrollOffset();e==="auto"&&(e=t>=o+n?"end":"start"),e==="center"?t+=(s-n)/2:e==="end"&&(t-=n);const r=this.getTotalSize()+this.options.scrollMargin-n;return Math.max(Math.min(r,t),0)},this.getOffsetForIndex=(t,e="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const s=this.measurementsCache[t];if(!s)return;const n=this.getSize(),o=this.getScrollOffset();if(e==="auto")if(s.end>=o+n-this.options.scrollPaddingEnd)e="end";else if(s.start<=o+this.options.scrollPaddingStart)e="start";else return[o,e];const r=e==="end"?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(r,e,s.size),e]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:e="start",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,e),{adjustments:void 0,behavior:s})},this.scrollToIndex=(t,{align:e="auto",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let n=0;const o=10,r=h=>{if(!this.targetWindow)return;const a=this.getOffsetForIndex(t,h);if(!a){console.warn("Failed to get offset for index:",t);return}const[c,u]=a;this._scrollToOffset(c,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{const d=this.getScrollOffset(),f=this.getOffsetForIndex(t,u);if(!f){console.warn("Failed to get offset for index:",t);return}X(f[0],d)||l(u)})},l=h=>{this.targetWindow&&(n++,n<o?this.targetWindow.requestAnimationFrame(()=>r(h)):console.warn(`Failed to scroll to index ${t} after ${o} attempts.`))};r(e)},this.scrollBy=(t,{behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:e})},this.getTotalSize=()=>{var t;const e=this.getMeasurements();let s;if(e.length===0)s=this.options.paddingStart;else if(this.options.lanes===1)s=((t=e[e.length-1])==null?void 0:t.end)??0;else{const n=Array(this.options.lanes).fill(null);let o=e.length-1;for(;o>=0&&n.some(r=>r===null);){const r=e[o];n[r.lane]===null&&(n[r.lane]=r.end),o--}s=Math.max(...n.filter(r=>r!==null))}return Math.max(s-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:e,behavior:s})=>{this.options.scrollToFn(t,{behavior:s,adjustments:e},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(i)}},B=(i,t,e,s)=>{for(;i<=t;){const n=(i+t)/2|0,o=e(n);if(o<s)i=n+1;else if(o>s)t=n-1;else return n}return i>0?i-1:0};function le({measurements:i,outerSize:t,scrollOffset:e,lanes:s}){const n=i.length-1,o=h=>i[h].start;if(i.length<=s)return{startIndex:0,endIndex:n};let r=B(0,n,o,e),l=r;if(s===1)for(;l<n&&i[l].end<e+t;)l++;else if(s>1){const h=Array(s).fill(0);for(;l<n&&h.some(c=>c<e+t);){const c=i[l];h[c.lane]=c.end,l++}const a=Array(s).fill(e+t);for(;r>=0&&a.some(c=>c>=e);){const c=i[r];a[c.lane]=c.start,r--}r=Math.max(0,r-r%s),l=Math.min(n,l+(s-1-l%s))}return{startIndex:r,endIndex:l}}S();function ae(i){const t=new oe(g(i)),e=q(t),s=t._didMount();return z(()=>g(i).getScrollElement(),n=>{n&&t._willUpdate()},{immediate:!0}),z(()=>g(i),n=>{t.setOptions({...n,onChange:(o,r)=>{var l;M(e),(l=n.onChange)==null||l.call(n,o,r)}}),t._willUpdate(),M(e)},{immediate:!0}),V(s),e}function be(i){return ae(P(()=>({observeElementRect:se,observeElementOffset:ne,scrollToFn:re,...g(i)})))}S();var he={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-xl bg-gradient-to-br shadow-lg from-theme-6 to-theme-9",style:{padding:"10%"}},ce=D({__name:"FavoriteImage",props:{size:{type:Number,required:!1,default:256}},setup(i){return(t,e)=>(b(),U("div",he,[$(J,{"class-name":"size-64",icon:"heart",style:{"--fill-color":"white"}})]))}}),ye=ce;S();var ue=D({__name:"BigPlayButton",props:{data:{type:Object,required:!0},onkeyup:{type:Function,required:!1},className:{type:String,required:!1,default:""}},setup(i){const t=i,e=P(()=>`/music/${t.data?.type?.replace(/s$/u,"")}/${t.data?.id}`);function s(){if(!t.data?.tracks)return;if(!H.value.features?.nomercyConnect){if(C.value===e.value){w.togglePlayback();return}w.playTrack(t.data.tracks.at(0),t.data.tracks),K(e.value);return}Z.value||E.value?.invoke("ChangeDeviceCommand",O.value).then(()=>{console.log("Switched to device:",O.value)}).catch(o=>{console.error("Error switching device:",o)});const n=t.data.tracks.some(o=>o.id===k.value?.id)?k.value?.id:t.data.tracks.at(0)?.id;E.value?.invoke("StartPlaybackCommand",t.data.type.replace(/s$/u,""),t.data.id,n)}return(n,o)=>g(w)?(b(),x(Q,{key:0,id:"playList",class:N([i.className,"h-12 w-12 min-w-12 min-h-12 max-w-12 max-h-12 relative !rounded-full overflow-clip !bg-focus transition-all duration-200 shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--color-slate-9)_g_g_b/60%)_inset,0_22px_30px_-4px_rgba(from_var(--color-slate-9)_g_g_b/70%)] dark:shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--color-slate-1)_g_g_b/30%)_inset,0_22px_30px_-4px_rgba(from_var(--color-slate-1)_g_g_b/70%)] hover:shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--color-slate-11)_g_g_b/60%)_inset,0_22px_30px_-4px_rgba(from_var(--color-slate-11)_g_g_b/70%)] dark:hover:shadow-[0_1px_0_0_rgba(255,255,255,0.20)_inset,0_-1px_0_0_rgba(from_var(--color-slate-1)_g_g_b/30%)_inset,0_22px_30px_-4px_rgba(from_var(--color-slate-1)_g_g_b/70%)] active:!bg-focus focus-visible:!bg-focus hover:!bg-focus dark:active:!bg-focus dark:focus-visible:!bg-focus dark:sm:hover:!bg-focus active:!shadow-none active:!dark:shadow-none text-white"]),onclick:s,onkeyup:i.onkeyup,label:"Play","no-tooltip":""},{default:L(()=>[g(G)&&g(C)===e.value?(b(),x(I,{key:0,class:"h-8 w-8",icon:"nmPause"})):(b(),x(I,{key:1,class:"h-8 w-8",icon:"nmPlay"}))]),_:1},8,["class","onkeyup"])):j("",!0)}}),xe=ue;export{ye as n,be as r,xe as t};
