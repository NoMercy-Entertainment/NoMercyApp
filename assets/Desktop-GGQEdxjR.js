import{am as ye,c as b,o as c,a as u,m as J,I as j,B as v,eJ as re,cD as ae,t as S,z as M,eK as se,eL as P,eM as xe,eN as oe,eO as ne,R as le,l as k,D as G,ej as be,b0 as we,d as y,s as h,j as g,b as I,h as ie,F as $,K as w,eP as W,w as ke,bu as Ce,bh as _e}from"./index-DkQngsHe.js";import{c as _,d as V,_ as Pe}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DnCqx71_.js";import{B as Se,s as $e}from"./index-CE67H0ZO.js";import{u as Oe}from"./useMounted-BfGYJuv5.js";import{u as je}from"./RipperOverlay.vue_vue_type_script_setup_true_lang-oED-RT0Y.js";import{u as N}from"./useServerClient-CmW8VHrx.js";import{a as D,S as X,_ as Y}from"./ServerTasksCard.vue_vue_type_script_setup_true_lang-BD6m5-wS.js";import{d as Ae}from"./colorScheme-BjQjspPx.js";import{_ as Ie}from"./ActivityCard.vue_vue_type_script_setup_true_lang-BXe5LmPQ.js";import"./HubConnection-CMQnVIkW.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-Da0SgVOE.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-BBYVQkaB.js";import"./Button.vue_vue_type_script_setup_true_lang-B5T8NTkB.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-BJWiF2I-.js";import"./ripperSocket-BmFnZdbx.js";import"./useQuery-jTNaBwZN.js";import"./useBaseQuery-BnGe7Aaf.js";import"./useQueryClient-Cy1MABnp.js";import"./useInfiniteServerClient-BHsBwDbE.js";import"./KeepCounting.vue_vue_type_script_setup_true_lang-CQVpfsAQ.js";import"./index-Czi9s18M.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BdM1tIz5.js";var Me={root:{position:"relative"}},Ne={root:"p-chart"},De=Se.extend({name:"chart",classes:Ne,inlineStyles:Me}),Be={name:"BaseChart",extends:$e,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:De,provide:function(){return{$pcChart:this,$parentInstance:this}}},ue={name:"Chart",extends:Be,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var e=this;ye(()=>import("./auto-BsvuWMA9.js"),[]).then(function(a){e.chart&&(e.chart.destroy(),e.chart=null),a&&a.default&&(e.chart=new a.default(e.$refs.canvas,{type:e.type,data:e.data,options:e.options,plugins:e.plugins})),e.$emit("loaded",e.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(e){if(this.chart){var a=this.chart.getElementsAtEventForMode(e,"nearest",{intersect:!0},!1),o=this.chart.getElementsAtEventForMode(e,"dataset",{intersect:!0},!1);a&&a[0]&&o&&this.$emit("select",{originalEvent:e,element:a[0],dataset:o})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function O(t){"@babel/helpers - typeof";return O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(t)}function Z(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(f){return Object.getOwnPropertyDescriptor(t,f).enumerable})),a.push.apply(a,o)}return a}function Q(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Z(Object(a),!0).forEach(function(o){Re(t,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Z(Object(a)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(a,o))})}return t}function Re(t,e,a){return(e=ze(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ze(t){var e=Ue(t,"string");return O(e)=="symbol"?e:e+""}function Ue(t,e){if(O(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var o=a.call(t,e);if(O(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ee=["width","height"];function Ge(t,e,a,o,f,m){return c(),b("div",J({class:t.cx("root"),style:t.sx("root")},t.ptmi("root")),[u("canvas",J({ref:"canvas",width:t.width,height:t.height,onClick:e[0]||(e[0]=function(l){return m.onCanvasClick(l)})},Q(Q({},t.canvasProps),t.ptm("canvas"))),null,16,Ee)],16)}ue.render=Ge;const Ve={class:"flex flex-shrink-0 flex-grow-0 items-start justify-start gap-4 self-stretch text-slate-light-11/80 dark:text-slate-dark-11/80"},qe={class:"flex flex-grow flex-col items-start justify-start gap-1 text-left"},He={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start self-stretch"},Ke={class:"w-8 flex-shrink-0 flex-grow-0 text-sm"},Le={class:"relative h-2 flex-grow rounded-lg"},Te={class:"w-10 flex-shrink-0 flex-grow-0 text-right text-sm"},Fe=j({__name:"ResourceBar",props:{cpu:{type:Number,required:!0,default:0},value:{type:Number,required:!0,default:0}},setup(t){const e=t,a=v(()=>re.value?ae(e.value,se):"rgb(var(--color-focus))");return(o,f)=>(c(),b("div",Ve,[u("div",qe,[u("div",He,[u("p",Ke,S(t.cpu),1),u("div",Le,[f[0]||(f[0]=u("div",{class:"absolute h-2 w-full rounded left-[-1px] top-[-1px] bg-auto-2 dark:bg-auto-1"},null,-1)),u("div",{class:"absolute h-2 rounded transition-all duration-500 left-[-1px] top-[-1px]",style:M({width:`${t.value}%`,backgroundImage:`linear-gradient(90deg, ${a.value} 0%, ${a.value} 100%)`})},null,4)]),u("p",Te,S(Math.floor(t.value))+"% ",1)])])]))}}),Je={class:"relative flex aspect-video h-auto w-full flex-1 flex-shrink-0 flex-col items-start justify-center gap-1 flex-grow-1"},We={class:"relative h-full flex-1 flex-shrink-0 w-available"},Xe={class:"absolute top-2/3 left-1/2 -translate-x-1/2 text-center font-semibold text-[2.5vw] monospace sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.6vw]"},Ye={class:"flex-shrink-0 flex-grow-0 scale-75 self-stretch text-center text-sm font-semibold w-available text-[2.5vw] sm:text-[1.5vw] md:text-[2vw] lg:text-[1.2vw] 2xl:text-[1vw] 5xl:text-[0.7vw]"},E=j({__name:"ResourceCircle",props:{name:{type:String,required:!0},value:{type:Number,required:!0},size:{type:Number,required:!0}},setup(t){const e=t,a=v(()=>{if(re.value)return ae(e.value,se);switch(e.name){case"CPU":return P(ne,50);case"Memory":return P(oe,50);case"GPU":return P(xe,50)}}),o=v(()=>Math.PI*72),f=v(()=>(1-(e.value===-1?0:e.value)/100)*o.value);return(m,l)=>(c(),b("div",Je,[u("div",We,[(c(),b("svg",{viewBox:"0 0 152 148",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"absolute inset-2 mx-auto rounded",style:M({width:t.size*2,height:t.size*2}),preserveAspectRatio:"xMidYMid meet"},[l[0]||(l[0]=u("path",{d:"M148 76C148 66.5448 146.138 57.1822 142.519 48.4468C138.901 39.7114 133.598 31.7741 126.912 25.0883C120.226 18.4025 112.289 13.099 103.553 9.48068C94.8178 5.86234 85.4552 4 76 4C66.5448 3.99999 57.1823 5.86232 48.4468 9.48066C39.7114 13.099 31.7742 18.4025 25.0883 25.0883C18.4025 31.7741 13.099 39.7113 9.48069 48.4468C5.86234 57.1822 4 66.5448 4 76",class:"stroke-auto-2 dark:stroke-auto-1","stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),u("path",{class:"absolute -top-1 -left-1 h-2 rounded transition-all duration-500",d:"M4 76C4 56.9044 11.5857 38.5909 25.0883 25.0883C38.5909 11.5857 56.9044 4 76 4C95.0956 4 113.409 11.5857 126.912 25.0883C140.414 38.5909 148 56.9044 148 76",style:M({stroke:a.value,strokeDasharray:o.value,strokeDashoffset:f.value}),"stroke-width":"8","stroke-linecap":"round","stroke-linejoin":"round"},null,4)],4)),u("p",Xe,S(t.value===-1?m.$t(""):Math.floor(t.value))+S(t.value===-1?"":"%"),1)]),u("p",Ye,S(t.name),1)]))}}),Ze={class:"flex items-start justify-between gap-2 overflow-clip w-available text-slate-light-12/80 dark:text-slate-dark-12/80"},Qe={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start self-stretch"},A=40,ee=j({__name:"ServerResourceCard",setup(t){var L;const{data:e}=N({path:"dashboard/server/info",queryKey:["serverInfo",(L=le.value)==null?void 0:L.serverBaseUrl]}),a=k(),o=k("graph"),f=k(Array.from({length:A}).fill("")),m=k(Array.from({length:A}).fill(null)),l=k(Array.from({length:A}).fill(null)),B=k(Array.from({length:A}).fill([null]));Oe(()=>{var r;return(r=_.value)==null?void 0:r.invoke("StartResources")},()=>{var r;return(r=_.value)==null?void 0:r.invoke("StopResources").catch()},10);function ce(){var r;(r=_.value)==null||r.invoke("StartResources")}G(()=>{const r=be();r==null||r.onreconnected(ce)});const q=v(()=>{var r,s,n;return((n=(s=(r=a.value)==null?void 0:r.cpu)==null?void 0:s.core)==null?void 0:n.toSorted((i,p)=>i.index-p.index))??[]}),R=v(()=>{var r,s;return((s=(r=a.value)==null?void 0:r.gpu)==null?void 0:s.toSorted((n,i)=>n.index-i.index).map(n=>(n.power+n.core)/2))??[]}),H=v(()=>{var r,s,n,i;return(n=(s=(r=a.value)==null?void 0:r.cpu)==null?void 0:s.core)!=null&&n.length?Math.floor(((i=q.value)==null?void 0:i.reduce((p,d)=>p+d.utilization,0))/q.value.length):-1}),K=v(()=>{var r,s,n,i;return((s=(r=a.value)==null?void 0:r.memory)==null?void 0:s.percentage)==="NaN"?-1:((i=(n=a.value)==null?void 0:n.memory)==null?void 0:i.percentage)??-1}),pe=v(()=>{var s,n,i;if(((n=(s=a.value)==null?void 0:s.gpu)==null?void 0:n.length)===0)return-1;const r=Math.floor(((i=R.value)==null?void 0:i.reduce((p,d)=>p+d,0))/R.value.length);return Number.isNaN(r)?-1:r}),z=v(()=>(window.innerWidth-5e3)/3);function de(r){if(r.length===1)return[{color:W(r[0]),opacity:50}];const p=50/2,d=[];for(let x=0;x<r.length;x++){const C=25+x%3*p;d.push({color:W(r[x]),opacity:C})}return d}function fe(r){r&&(a.value=r,m.value=[...m.value.slice(-40),H.value],l.value=[...l.value.slice(-40),K.value],B.value=[...B.value.slice(-40),R.value])}je(_,"ResourceUpdate",fe);const ve=v(()=>{var r,s,n,i;return{labels:f.value,datasets:[...((s=(r=e.value)==null?void 0:r.cpu)==null?void 0:s.map((p,d)=>{var C;const x=ne;return{label:`CPU ${((C=e.value)==null?void 0:C.cpu.length)>1?d:""}`,data:m.value,yAxisID:"y",borderColor:P(x,50)}}))??[],{label:"Memory",data:l.value,yAxisID:"y",borderColor:P(oe,50)},...((i=(n=e.value)==null?void 0:n.gpu)==null?void 0:i.map((p,d)=>{var T,F;const x=de((T=e.value)==null?void 0:T.gpu)[d],C=P(x.color,x.opacity);return{label:`GPU ${((F=e.value)==null?void 0:F.gpu.length)>1?d:""}`,data:B.value.map(ge=>ge[d]),yAxisID:"y",borderColor:C}}))??[]]}}),U=we("legendPosition","bottom"),me=v(()=>{const r=getComputedStyle(document.documentElement),s=Ae.value?`rgb(${r.getPropertyValue("--color-slate-12")})`:`rgb(${r.getPropertyValue("--color-slate-1")})`,n=r.getPropertyValue("--p-content-border-color"),i=["left","top","right","bottom"];return{indexAxis:"x",maintainAspectRatio:!1,animation:!1,plugins:{legend:{labels:{color:s},value:U.value,onClick(){U.value=i[(i.indexOf(U.value)+1)%i.length]}}},elements:{line:{tension:.2},point:{pointStyle:!1}},scales:{x:{ticks:{color:"transparent"},grid:{color:"transparent"}},y:{min:0,max:100,beginAtZero:!0,clip:!0,ticks:{color:s},grid:{color:n}}}}}),he=v(()=>{var p,d;return`${(((d=(p=e.value)==null?void 0:p.gpu)==null?void 0:d.length)??0)*40+120}px`});return(r,s)=>(c(),y(D,{title:"Resources monitor"},{cta:h(()=>s[0]||(s[0]=[])),default:h(()=>{var n,i;return[u("div",Ze,[g(E,{name:"CPU",value:H.value,size:z.value},null,8,["value","size"]),s[1]||(s[1]=u("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),g(E,{name:"Memory",value:K.value,size:z.value},null,8,["value","size"]),s[2]||(s[2]=u("div",{class:"w-px flex-shrink-0 flex-grow-0 self-stretch bg-white/10"},null,-1)),g(E,{name:"GPU",value:pe.value,size:z.value},null,8,["value","size"])]),u("div",Qe,[o.value==="bar"?(c(!0),b($,{key:0},ie(((i=(n=a.value)==null?void 0:n.cpu)==null?void 0:i.core)??[],(p,d)=>(c(),b($,{key:p.index},[Number.isNaN(p.utilization)?I("",!0):(c(),y(Fe,{key:0,cpu:d,value:p.utilization},null,8,["cpu","value"]))],64))),128)):I("",!0),o.value==="graph"?(c(),y(w(ue),{key:1,type:"line",data:ve.value,options:me.value,style:M(`height: ${he.value}`),class:"w-available"},null,8,["data","options","style"])):I("",!0)])]}),_:1}))}}),te=j({__name:"ServerActivityCard",setup(t){const{data:e}=N({path:"dashboard/activity",refetchInterval:1e4,data:{take:999},queryKey:["server","activity"]}),{data:a}=N({path:"dashboard/devices",refetchInterval:1e4,queryKey:["devices"]});return(o,f)=>w(V)?(c(),y(D,{key:0,title:"Activity",background:!1},{cta:h(()=>f[0]||(f[0]=[])),default:h(()=>{var m;return[(c(!0),b($,null,ie(((m=w(e))==null?void 0:m.slice(0,5))??[],l=>(c(),y(Ie,{key:l==null?void 0:l.id,devices:w(a)??[],activity:l},null,8,["devices","activity"]))),128))]}),_:1})):I("",!0)}}),et={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-1 xl:row-start-1"},tt={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 xl:col-span-2 xl:col-start-3 xl:row-start-1"},rt={class:"col-span-3 col-start-1 flex flex-col gap-4 lg:col-span-2 lg:col-start-1 lg:row-start-2 2xl:col-span-2 2xl:col-start-5 2xl:row-start-1 2xl:flex"},St=j({__name:"Desktop",setup(t){var f;const e=k(!0);ke(_,m=>{e.value=!!m}),G(()=>{setTimeout(()=>{e.value=!!_.value},1e3)});const{data:a}=N({path:"dashboard/server/storage",queryKey:["dashboard","storage",(f=le.value)==null?void 0:f.serverBaseUrl]});G(()=>{console.raw(a.value)});const o=v(()=>window.CSS.supports("grid-template-rows: masonry"));return(m,l)=>(c(),y(w(_e),null,{default:h(()=>[g(w(Ce),{fullscreen:!0},{default:h(()=>[g(Pe,{title:"Dashboard overview","grid-style":o.value?3:2,styles:"grid-template-rows: masonry; masonry-auto-flow: next;"},{cta:h(()=>l[0]||(l[0]=[])),default:h(()=>[o.value?(c(),b($,{key:0},[g(X),g(Y),g(te),w(V)?(c(),y(ee,{key:0})):(c(),y(D,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:h(()=>l[1]||(l[1]=[])),default:h(()=>[l[2]||(l[2]=u("div",{class:"min-h-80"},null,-1))]),_:1}))],64)):(c(),b($,{key:1},[u("div",et,[g(X),w(V)?(c(),y(ee,{key:0})):(c(),y(D,{key:1,title:"Resources monitor",class:"animate-pulse"},{cta:h(()=>l[3]||(l[3]=[])),default:h(()=>[l[4]||(l[4]=u("div",{class:"min-h-80"},null,-1))]),_:1}))]),u("div",tt,[g(Y)]),u("div",rt,[g(te)])],64))]),_:1},8,["grid-style"])]),_:1})]),_:1}))}});export{St as default};
