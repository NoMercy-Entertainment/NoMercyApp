import{C as I,G as N,J as _,K as x,R as B,T as M,Tt as d,X as F,c as C,et as O,g as Q,j as R,k as T,ot as p,w as U}from"./i18n-Bgv5p1Yb.js";import{A as j,G as k,U as w}from"./vue-core-Dey0Eikg.js";import{a as A,r as D,t as G}from"./query-xyWPY_A0.js";import{Ai as P,Gi as f,Ki as b,ja as E,k as $,qi as H}from"./index-Bjp96vCp.js";import{t as J}from"./nmComponentMap-DBSO27Hr.js";w();C();function m(a){const e=k(),r=[];return(a??e?.path)?.split("/").slice(1).forEach(u=>{u.includes("?")?(r.push(u.split("?")[0]),r.push(u.split("?")[1].split("=")[1])):r.push(u)}),r}function V({queryKey:a,path:e}={queryKey:void 0,path:void 0}){return G({mutationKey:a??m(e)})}p(E(),async a=>{a&&(await f.invalidateQueries(),f.getMutationCache().clear())});p(H,async(a,e)=>{if(!a){P();return}e?.id&&a.id!==e.id&&(await f.invalidateQueries(),f.getMutationCache().clear())});function X({queryKey:a,path:e}={queryKey:void 0,path:void 0}){return A({queryKey:a??m(e),queryFn:async()=>b().get(e??$.currentRoute.value.path,{params:{}}).then(({data:r})=>r.data)})}function z({queryKey:a,path:e,homeData:r}){return D({mutationKey:a??m(e),mutationFn:async u=>{const y=new Set(u.map(i=>i.update?.body?.replace_id)),t=r.value?.map(i=>y.has(i.id)?{...i}:i)??[];for(const i of u)await b().post(e??i.update.link,{replace_id:i.update.body.replace_id}).then(v=>{for(let o=0;o<t.length;o++)t[o].id===i.update?.body?.replace_id&&(t[o]=v.data?.data[0])});return t}})}C();w();var W={key:0,class:"grid w-available h-available place-items-center"},Y=R({__name:"NMComponent",props:{path:{type:String,required:!1,default:void 0},options:{type:Object,required:!1,default:()=>({keepForever:!0,queryKey:m()})}},setup(a){const e=a,r=new Set(["Home","Libraries","Music Start"]),u=e.options.queryKey??m(),y=V({queryKey:u,path:e.path}),{data:t,isLoading:i}=X({queryKey:u,path:e.path}),{data:v,mutate:o}=z({queryKey:u,homeData:t}),s=E(),g=k();function q(){if(!t.value||!s.value)return;const n=t.value.filter(c=>c?.update?.when==="pageLoad")??[];n.length>0&&o(n)}function L(){if(!t.value||!s.value)return;const n=t.value.filter(c=>c?.update?.when==="online")??[];n.length>0&&o(n)}function K(n){const c=n;if(!t.value||!s.value)return;const l=t.value.filter(h=>h?.id===c.detail.id)??[];l.length>0&&o(l)}function S(){return r.has(g.name)}return N(()=>{document.addEventListener("mutateId",K),t.value&&s.value&&S()&&q()}),x(()=>{document.removeEventListener("mutateId",K)}),p(s,n=>{n&&L()}),p(t,n=>{n&&requestIdleCallback(()=>{document.dispatchEvent(new Event("indexer"))})}),p(()=>g.name,n=>{t.value&&s.value&&r.has(n)&&q()}),(n,c)=>d(i)?(_(),M("div",W,[T(d(j),{class:"ion-padding",name:"crescent"})])):d(y)?U("",!0):(_(!0),M(Q,{key:1},F(d(v)??d(t)??[],(l,h)=>(_(),I(O(d(J)[l?.component]),B({key:l.id,index:h},{ref_for:!0},l.props),null,16,["index"]))),128))}}),re=Y;export{re as t};
