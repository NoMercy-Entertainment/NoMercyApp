import"./dist-BWFEUpD5.js";import"./client-D4e5iciK.js";import"./config-BZ-AEJ_J.js";import"./esm-CLtwhlBL.js";import"./user-Cpc-QsaC.js";import"./apiClient-9DYr7MVK.js";import{t as s}from"./notifications-qUxNFD5p.js";const t={en:{newVersion:"New version available.",updateNow:"Update now?",offline:"You are offline",offlineMessage:"Please check your internet connection and try again.",reload:"Reload page"},nl:{newVersion:"Nieuwe versie beschikbaar.",updateNow:"Nu updaten?",offline:"Je bent offline",offlineMessage:"Controleer je internetverbinding en probeer het opnieuw.",reload:"Pagina herladen"},fr:{newVersion:"Nouvelle version disponible.",updateNow:"Mettre à jour maintenant?",offline:"Vous êtes hors ligne",offlineMessage:"Veuillez vérifier votre connexion Internet et réessayer.",reload:"Recharger la page"},de:{newVersion:"Neue Version verfügbar.",updateNow:"Jetzt aktualisieren?",offline:"Du bist offline",offlineMessage:"Bitte überprüfe deine Internetverbindung und versuche es erneut.",reload:"Seite neu laden"},es:{newVersion:"¡Una nueva versión está disponible!",updateNow:"Actualizar ahora",offline:"Estás sin conexión",offlineMessage:"Por favor, comprueba tu conexión a Internet y vuelve a intentarlo.",reload:"Recargar página"}};function l(){return localStorage.getItem("language")||navigator.language.split("-")[0]||"en"}function c(){const e=t[l()]||t.en;return{id:`sw-update-${Date.now()}`,type:"update",title:e.newVersion,body:e.updateNow,from:"system",read:!1,created_at:Date.now(),updated_at:Date.now(),notify:!0,link:"reload"}}var n=null,r=!1;function k(){if(!("serviceWorker"in navigator)){console.log("Service worker not supported");return}console.log("Setting up service worker update detection..."),navigator.serviceWorker.addEventListener("controllerchange",()=>{r||(r=!0,window.location.reload())}),navigator.serviceWorker.getRegistration().then(e=>{if(!e){console.log("No service worker registration found");return}console.log("Service worker registration found"),i(e),e.waiting&&(n=e.waiting,a()),e.update().catch(o=>{console.log("Manual update check failed:",o)})}).catch(e=>{console.error("Failed to get service worker registration:",e)}),navigator.serviceWorker.ready.then(e=>{console.log("Service worker ready, setting up update detection..."),i(e)}).catch(e=>{console.error("Service worker ready failed:",e)}),document.addEventListener("sw-update-accepted",()=>{n?n.postMessage({type:"SKIP_WAITING"}):window.location.reload()}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(e=>{e&&(console.log("Checking for updates..."),e.update().then())}).catch(e=>{console.log("Periodic update check failed:",e)})},6e4)}function i(e){e.addEventListener("updatefound",()=>{console.log("New service worker found!");const o=e.installing;if(!o){console.log("No installing worker found");return}console.log("New worker state:",o.state),o.addEventListener("statechange",()=>{console.log("Service worker state changed to:",o.state),o.state==="installed"&&(navigator.serviceWorker.controller?(console.log("New version installed, showing notification"),n=o,a()):console.log("Service worker installed for the first time"))})})}function a(){s(c())}export{k as setupServiceWorkerUpdates};
