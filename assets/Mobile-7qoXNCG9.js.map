{"version":3,"file":"Mobile-7qoXNCG9.js","sources":["../../src/views/Base/Library/Mobile.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\nimport {useRoute} from 'vue-router';\nimport {IonContent, IonPage, onIonViewDidEnter} from '@ionic/vue';\n\nimport type { LibraryResponse } from '@/types/api/base/library';\nimport type { PeopleResponse, PersonResponseItem } from '@/types/api/base/person';\nimport type { GenreResponse } from '@/types/api/base/genre';\n\nimport { isNative } from '@/config/global';\nimport { currentSong } from '@/store/audioPlayer';\nimport useInfiniteServerClient from '@/lib/clients/useInfiniteServerClient';\nimport { showBackdrops } from '@/store/preferences';\nimport { setBackground, setColorPalette } from '@/store/ui';\nimport router from '@/router';\nimport { setTitle } from '@/lib/stringArray';\n\nimport Indexer from '@/Layout/Indexer.vue';\n\nimport MediaCard from '@/components/Cards/MediaCard.vue';\nimport PersonCard from '@/components/Cards/PersonCard.vue';\nimport GenreCard from '@/components/Cards/GenreCard.vue';\nimport EmptyCard from '@/components/Cards/EmptyCard.vue';\n\nconst route = useRoute();\n\nconst { data, fetchNextPage, hasNextPage, isError } = useInfiniteServerClient<{\n  data: Array<LibraryResponse | GenreResponse | PeopleResponse>\n}>({\n  queryKey: ['libraries', ((route.params.id ?? route.name) as string)?.split('&').at(0)],\n  limit: 20,\n  keepForever: true,\n});\n\nonMounted(() => {\n  setTitle();\n  setBackground(null);\n  setColorPalette(null);\n  document.dispatchEvent(new Event('sidebar'));\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n  setTimeout(() => {\n    document.dispatchEvent(new Event('indexer'));\n  }, 1000);\n});\n\nconst backdropStyle = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-4 3xl:grid-cols-5 4xl:grid-cols-5 5xl:grid-cols-9 tv:grid-cols-6';\n\nconst posterStyle = 'grid-cols-2 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-7 3xl:grid-cols-9 4xl:grid-cols-10 5xl:grid-cols-[repeat(14,minmax(0,1fr))] tv:grid-cols-6';\n\nconst useBackdropStyle = computed(() => {\n  const firstItem = data.value?.pages?.[0]?.data?.[0];\n  return (\n      firstItem &&\n      showBackdrops.value &&\n      firstItem.media_type !== 'person' &&\n      firstItem.media_type !== 'genres'\n  );\n});\n\nonUnmounted(() => {\n  stop();\n  setBackground(null);\n});\n\nconst lib = ref<HTMLDivElement>();\nconst id = ref();\n\nonMounted(() => {\n  id.value = route.params.id ?? route.name as string;\n\n  if (hasNextPage.value && (data?.value?.pages?.length ?? 0) < 50) {\n    fetchNextPage();\n  }\n\n  document.addEventListener('scrollToDiv', (e: Event) => {\n    lib.value?.scrollTo({\n      // @ts-ignore\n      top: e.detail.top - 100,\n      behavior: 'smooth',\n    });\n  });\n});\n\nonIonViewDidEnter(() => {\n  document.dispatchEvent(new Event('indexer'));\n});\n\nwatch(data, (value) => {\n  if (!value) return;\n\n  if (hasNextPage.value && value?.pages?.length < 50) {\n    fetchNextPage();\n  }\n});\n\nconst selectedCard = ref<LibraryResponse | GenreResponse | PeopleResponse>();\nconst cardMenu = ref();\n\nconst onRightClick = (event: Event, data: LibraryResponse | GenreResponse | PeopleResponse) => {\n  selectedCard.value = data;\n  cardMenu.value.show(event);\n};\n\n</script>\n\n<template>\n  <ion-page>\n    <ion-content :fullscreen=\"true\" class=\"ion-padding \" style=\"--padding-bottom: 0;\">\n      <div class=\"fixed top-0 pt-safe w-full bg-slate-light-1 dark:bg-slate-dark-3 z-1199\"></div>\n      <div ref=\"lib\" class=\"pt-safe-offset-10 flex h-auto w-full pr-8 overflow-auto scroll-container\">\n        <div class=\"z-0 flex flex-col gap-4 rounded-3xl border-0 w-available scrollbar-none border-auto-3\" :class=\"{\n          'pb-2': isNative && currentSong,\n          'children:pb-4 sm:children:pb-3': !isNative && currentSong\n        }\" :key=\"router.currentRoute.value.params?.id as string\">\n\n          <div\n            :class=\"`grid w-full gap-4 scroll-smooth music-showing:pb-0 pl-1 py-4 ${useBackdropStyle ? backdropStyle : posterStyle}`\">\n            <!--        <ContextMenu ref=\"cardMenu\" :model=\"items\"/>-->\n            <template v-if=\"data\">\n              <template v-for=\"(group, index) in data.pages ?? []\" :key=\"index\">\n                <template v-if=\"group.data.length > 0\">\n                  <template v-for=\"(data, index2) in group.data ?? []\">\n                    <MediaCard\n                      v-if=\"data?.media_type === 'tv' || data?.media_type == 'movie' || data?.media_type == 'collection' || data?.media_type == 'specials'\"\n                      :key=\"data.id\" :data=\"data as LibraryResponse\" @context-menu=\"onRightClick($event, data)\"\n                      :index=\"index2\" />\n                    <PersonCard v-else-if=\"data?.media_type === 'person'\" :key=\"data.id + '_person'\"\n                      :data=\"data as PersonResponseItem\" @context-menu=\"onRightClick($event, data)\" :index=\"index2\" />\n                    <GenreCard v-else-if=\"data?.media_type === 'genres'\" :key=\"data.id + '_genres'\"\n                      :data=\"data as GenreResponse\" @context-menu=\"onRightClick($event, data)\" :index=\"index2\" />\n                  </template>\n                </template>\n                <template v-else-if=\"data.pages?.[0]?.data?.length == 0\">\n                  <EmptyCard />\n                </template>\n              </template>\n            </template>\n          </div>\n        </div>\n        <Indexer :id=\"id\"\n            class=\"w-8 !-mt-4 pt-4 pb-4 mb-0 fixed right-0 bg-slate-light-1 dark:bg-slate-dark-3\"\n           :class=\"{\n            'h-available': !isNative,\n            'h-inherit top-24': isNative,\n          }\"\n        />\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n\n<!--<style scoped>-->\n\n<!--@media screen and (max-width: 800px) {-->\n<!--  ion-content::part(scroll) {-->\n<!--    &#45;&#45;offset-top: -4.5rem;-->\n<!--  }-->\n\n<!--  *:has(ion-toolbar:first-child:nth-last-child(2) ~ *) ion-content::part(scroll) {-->\n<!--    &#45;&#45;offset-top: -8.5rem;-->\n<!--  }-->\n<!--}-->\n<!--</style>-->\n"],"names":["backdropStyle","posterStyle","route","useRoute","data","fetchNextPage","hasNextPage","isError","useInfiniteServerClient","_a","onMounted","setTitle","setBackground","setColorPalette","watch","value","useBackdropStyle","computed","firstItem","_d","_c","_b","showBackdrops","onUnmounted","lib","ref","id","e","onIonViewDidEnter","selectedCard","cardMenu","onRightClick","event"],"mappings":"gpBAmDA,MAAMA,GAAgB,0IAEhBC,GAAc,0MA7BpB,MAAMC,EAAQC,EAAS,EAEjB,CAAE,KAAAC,EAAM,cAAAC,EAAe,YAAAC,EAAa,QAAAC,EAAA,EAAYC,EAEnD,CACD,SAAU,CAAC,aAAeC,EAAAP,EAAM,OAAO,IAAMA,EAAM,OAAzB,YAAAO,EAA2C,MAAM,KAAK,GAAG,EAAE,EACrF,MAAO,GACP,YAAa,EAAA,CACd,EAEDC,EAAU,IAAM,CACLC,EAAA,EACTC,EAAc,IAAI,EAClBC,EAAgB,IAAI,EACpB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,EAC3C,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAEKC,EAAAV,EAAOW,GAAU,CAChBA,GACL,WAAW,IAAM,CACf,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,GAC1C,GAAI,CAAA,CACR,EAMK,MAAAC,EAAmBC,EAAS,IAAM,aACtC,MAAMC,GAAYC,GAAAC,GAAAC,GAAAZ,EAAAL,EAAK,QAAL,YAAAK,EAAY,QAAZ,YAAAY,EAAoB,KAApB,YAAAD,EAAwB,OAAxB,YAAAD,EAA+B,GACjD,OACID,GACAI,EAAc,OACdJ,EAAU,aAAe,UACzBA,EAAU,aAAe,QAAA,CAE9B,EAEDK,EAAY,IAAM,CACX,KAAA,EACLX,EAAc,IAAI,CAAA,CACnB,EAED,MAAMY,EAAMC,EAAoB,EAC1BC,EAAKD,EAAI,EAEff,EAAU,IAAM,SACdgB,EAAG,MAAQxB,EAAM,OAAO,IAAMA,EAAM,KAEhCI,EAAY,UAAUe,GAAAZ,EAAAL,GAAA,YAAAA,EAAM,QAAN,YAAAK,EAAa,QAAb,YAAAY,EAAoB,SAAU,GAAK,IAC7ChB,EAAA,EAGP,SAAA,iBAAiB,cAAgBsB,GAAa,QACrDlB,EAAAe,EAAI,QAAJ,MAAAf,EAAW,SAAS,CAElB,IAAKkB,EAAE,OAAO,IAAM,IACpB,SAAU,QAAA,EACX,CACF,CAAA,CACF,EAEDC,EAAkB,IAAM,CACtB,SAAS,cAAc,IAAI,MAAM,SAAS,CAAC,CAAA,CAC5C,EAEKd,EAAAV,EAAOW,GAAU,OAChBA,GAEDT,EAAY,SAASG,EAAAM,GAAA,YAAAA,EAAO,QAAP,YAAAN,EAAc,QAAS,IAChCJ,EAAA,CAChB,CACD,EAED,MAAMwB,EAAeJ,EAAsD,EACrEK,EAAWL,EAAI,EAEfM,EAAe,CAACC,EAAc5B,IAA2D,CAC7FyB,EAAa,MAAQzB,EACZ0B,EAAA,MAAM,KAAKE,CAAK,CAC3B"}