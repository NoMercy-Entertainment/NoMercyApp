import{At as l,C as v,Dt as x,Et as b,K as G,O as K,Q as u,R as I,S as n,T as f,Y as o,_ as P,_t as R,c as k,j as z,k as Q,kt as F,lt as A,ot as Y,q as J,st as w,w as q,x as i}from"./i18n-DXLa9EKW.js";import{x as W,y as X}from"./vue-core-DBpBuPMK.js";import{t as S}from"./signalr-Rqfnyj2P.js";import{$i as c,B as Z,Bi as ee,Da as V,Gn as te,Hi as ae,Kn as se,L,Oi as ne,R as oe,Vi as re,gt as le,y as ie,z as O}from"./index-CLM6Y7vI.js";import{t as ce}from"./useServerClient-QYfn39K-.js";import{t as de}from"./ScrollContainer-aZQSs5X2.js";import{t as ue}from"./useMounted-DrbBl1d-.js";import{i as fe,t as ve}from"./RipperOverlay-DCWWVsFD.js";import{t as he}from"./FloatingBackButton-BrTpeYvl.js";k();var t=R();const Pe=i(()=>t.value?.connection),h=R(!1);function y(){h.value=!0,document.dispatchEvent(new Event("dashboardHub-connected")),t.value?.connection&&(O(t.value?.connection,"Dashboard Hub"),oe(t.value?.connection))}function d(a){h.value=!1,console.log("Disconnected from Dashboard SignalR",a),document.dispatchEvent(new Event("dashboardHub-disconnected"))}function M(a){h.value=!1,console.error("Dashboard SignalR Error:",a),document.dispatchEvent(new Event("dashboardHub-error"))}var _;w(c,async a=>{const s=V.value?.accessToken,r=a?.serverBaseUrl;a&&h.value&&r&&r!==_&&(_=r,t.value?.connection?.stop().then(),t.value?.dispose(),t.value=new L(r,s,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",d),await N().catch(M))});async function N(){if(t.value?.connection?.state!==S.Connected)return t.value?.connection?.start().then(y)}async function pe(){try{return t.value?.connection?.state===S.Disconnected?void 0:t.value?.connection?.stop().then(d).catch(d)}catch(a){console.error("Error stopping Dashboard SignalR:",a),d()}}async function j(){const a=V.value?.accessToken;c.value&&(!t.value?.connection?.state||t.value?.connection?.state===S.Disconnected)&&(_=c.value.serverBaseUrl,t.value=new L(c.value.serverBaseUrl,a,"dashboardHub"),t.value?.connection?.on("connected",y),t.value?.connection?.on("disconnected",d),await N().catch(M),t.value?.connection?.onreconnecting(s=>{console.log("SignalR Disconnected.",s?.message),Z(t.value.connection,"Dashboard Hub"),d()}),t.value?.connection?.onreconnected(()=>{console.log("SignalR Reconnected."),O(t.value.connection,"Dashboard Hub"),y()}))}k();X();var me=z({__name:"HelpButton",setup(a){const s=W(),r=i(()=>`https://docs${ne}.nomercy.tv${s.path.replace(/\/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/gu,"")}`);return(g,B)=>(o(),v(ie,{id:"help",href:r.value,variant:"text",component:"link",target:"_blank",color:"auto","start-icon":"messageBubbleQuestion",class:"relative flex h-10 flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden rounded-lg px-4 py-2.5"},{default:A(()=>[K(l(g.$t("Help")),1)]),_:1},8,["href"]))}}),be=me;k();var ye={key:0,class:"grid h-full w-full place-items-center text-surface-12"},ge={class:"relative flex items-center justify-start gap-8 overflow-hidden"},xe={class:"relative flex w-full flex-col gap-4"},we={class:"text-7xl font-bold text-center"},_e={class:"left-0 text-2xl text-center whitespace-pre-line"},ke=["data-music"],Se=["inert"],Be={class:"z-10 flex h-20 items-center justify-between gap-4 self-stretch border-b px-4 py-4 border-surface-8/11 xl:px-6"},De={class:"relative flex h-full flex-col items-start justify-center gap-1"},He={class:"w-auto flex-shrink-0 flex-grow-0 self-stretch whitespace-nowrap text-xl font-semibold"},Ce={key:1,class:"hidden w-auto flex-shrink-0 flex-grow-0 items-center self-stretch text-sm empty:hidden lg:flex text-surface-12/12"},Ee={class:"flex flex-col flex-nowrap items-end justify-center gap-x-3 gap-y-1 sm:flex-row"},$e={key:0,class:"grid h-full w-full place-items-center"},qe={class:"relative flex flex-col items-center justify-start gap-8 overflow-hidden"},je={class:"relative flex w-full flex-col gap-4"},Re={class:"text-7xl font-bold text-center"},ze={class:"left-0 text-2xl text-center whitespace-pre-line"},Ae={key:2,class:"mt-auto bottom-0 z-0 flex w-full flex-wrap items-center gap-4 border-t px-4 py-4 border-surface-8/11 empty:hidden sm:h-16 xl:px-6"},Ve=z({__name:"DashboardLayout",props:I({title:{type:String,required:!0},params:{type:Object,required:!1},description:{type:String,required:!1},gridStyle:{type:Number,required:!1,default:0},back:{type:Boolean,required:!1,default:!1},error:{type:Object,required:!1},allowAnyone:{type:Boolean,required:!1,default:!1},styles:{type:String,required:!1},className:{type:String,required:!1}},{modelValue:{required:!1,type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const s=a,r=Y(a,"modelValue"),{dataUpdatedAt:g,error:B,isPending:T,refetch:D}=ce({path:"dashboard/server",enabled:!s.allowAnyone,refetchInterval:1e4,queryKey:["dashboard","server"]}),U=i(()=>s.gridStyle===1?re.value:s.gridStyle===2?ae.value:s.gridStyle===3?ee.value:s.gridStyle===4?"flex flex-wrap h-available":"flex flex-wrap h-available overflow-clip"),p=i(()=>{if(s.allowAnyone)return null;const e=B.value;if(e?.response?.status!==200)return{code:e?.response?.data?.status??null,message:e?.response?.data?.detail??""}}),m=i(()=>{const e=s.error;if(console.log(e),!(!e?.response||e?.response?.status===200))return{code:e?.response?.status,message:e?.response?.data?.detail??""}}),H=i(()=>(p.value?.code||T.value)&&!s.allowAnyone);function C(){s.allowAnyone||D()}function E(){s.allowAnyone||D()}return G(()=>{se(null),te(null),document.addEventListener("dashboardHub-connected",C),document.addEventListener("dashboardHub-disconnected",E)}),J(()=>{document.removeEventListener("dashboardHub-connected",C),document.removeEventListener("dashboardHub-disconnected",E)}),ue(j,pe,20),w(H,e=>{e&&r.value!==void 0&&(r.value=!1)}),w(g,e=>{e&&!h.value&&j()}),(e,$)=>(o(),v(P,null,[H.value?(o(),f("div",ye,[n("div",ge,[n("div",xe,[n("p",we,l(p.value?.code?p.value?.code:"Offline"),1),n("p",_e,l(p.value?.message),1)])])])):(o(),f("div",{key:1,class:x([{"min-h-[92vh] music-showing:min-h-[85vh] sm:min-h-[85.75vh] music-showing:sm:min-h-[92.75vh] children-not-first:mt-20":!e.$slots.cta,"min-h-[92vh] music-showing:min-h-[92vh] sm:min-h-[82.1vh] music-showing:sm:min-h-[82.1vh] children-not-first:mt-20":!!e.$slots.cta},"flex flex-col relative z-0 flex-1 h-available overflow-clip items-start justify-start self-stretch w-available text-surface-12"]),"data-music":b(le)},[n("div",{inert:b(fe),class:"sticky top-0 z-10 flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-5 self-stretch"},[$[0]||($[0]=n("div",{class:"absolute inset-0 z-0 h-full w-full"},null,-1)),n("div",Be,[n("div",De,[n("p",He,l(e.$t(a.title,a.params)),1),a.back?(o(),v(he,{key:0,class:"left-4 -mt-1.5",position:"relative"})):(o(),f("p",Ce,l(e.$t(a.description??"")),1))]),u(e.$slots,"title"),n("div",Ee,[u(e.$slots,"pre-cta"),Q(be),u(e.$slots,"cta")])])],8,Se),m.value?(o(),f("div",$e,[n("div",qe,[n("div",je,[n("p",Re,l(m.value.code),1),n("p",ze,l(m.value.message),1)])])])):(o(),v(de,{key:1,class:x([a.className,"z-0 w-full flex-1 overflow-y-auto overflow-x-hidden pt-2 sm:p-4"]),static:!0,frame:""},{default:A(()=>[n("div",{class:x([U.value,"h-auto w-full flex-wrap content-start gap-4 flex-1"]),style:F(a.styles)},[u(e.$slots,"default")],6)]),_:3},8,["class"])),!m.value&&e.$slots.actions?(o(),f("div",Ae,[u(e.$slots,"actions")])):q("",!0),b(c)?.is_owner||b(c)?.is_manager?(o(),v(ve,{key:3})):q("",!0)],10,ke))],1024))}}),Qe=Ve;export{Pe as n,h as r,Qe as t};
