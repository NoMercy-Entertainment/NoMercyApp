import{$ as A,At as d,C as h,Dt as p,Et as _,O as f,S as k,T as w,Y as i,Z as R,_t as m,c as S,g as q,j as x,k as v,lt as s}from"./i18n-DBb78QAI.js";import"./ionic-DNKsarlx.js";import"./vue-core-CD3ScEG4.js";import{w as M}from"./primevue-CDzFprnl.js";import"./query-Dwz_k4KB.js";import{$i as C,Qi as b,Si as r,Zi as N,n as T}from"./index-Dbw70ZKS.js";import"./useInfiniteServerClient-BG6feyia.js";import{t as j}from"./useServerClient-CIpZVCqE.js";import"./ScrollContainer-HN7xdQ-l.js";import"./useMounted-BpvfXUCe.js";import"./RipperOverlay-C-xCTF1l.js";import"./ripperSocket-DFNdW8XQ.js";import"./FloatingBackButton-PJwyKHhE.js";import{t as V}from"./DashboardLayout-BNzi-2rz.js";import{t as z}from"./DashboardCard-DClKvs1N.js";S();var F={class:"relative flex aspect-video flex-shrink-0 flex-grow-0 flex-col items-center justify-center self-stretch overflow-clip rounded-lg bg-theme-8"},K={key:1,class:"text-xl font-bold text-center"},O=x({__name:"LibraryCard",props:{data:{type:Object,required:!0}},setup(a){return(t,u)=>(i(),h(z,{line1:a.data.title,line2:a.data.folder_library&&a.data.folder_library?.length!==1?`${a.data.folder_library?.length} folders`:`${a.data.folder_library?.length}  folder`,route:`/dashboard/libraries/${a.data.id}`},{image:s(()=>[k("div",F,[u[0]||(u[0]=k("div",{class:"backdropCard-overlay"},null,-1)),a.data.image?(i(),h(T,{key:0,path:a.data.image,aspect:"backdrop",class:"z-0"},null,8,["path"])):(i(),w("span",K,d(a.data.title),1))])]),_:1},8,["line1","line2","route"]))}}),Q=O;S();var U=x({__name:"Desktop",setup(a){const t=M(),{data:u,error:E}=j({path:"dashboard/libraries",queryKey:["dashboard","libraries",C.value?.serverBaseUrl]}),o=m(!1);async function $(){if(!o.value){o.value=!0;try{const{data:e}=await b().post("dashboard/libraries");t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3}),N.invalidateQueries({queryKey:["dashboard","libraries",C.value?.serverBaseUrl]})}catch{t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while creating the library"),life:5e3})}finally{o.value=!1}}}const l=m(!1);function B(){l.value=!0,b().post("dashboard/libraries/refresh").then(({data:e})=>{l.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{l.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}const n=m(!1);function D(){n.value=!0,b().post("dashboard/libraries/scan-new").then(({data:e})=>{n.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{n.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the library folders"),life:5e3})})}const y=m(!1);function L(){y.value=!0,b().post("dashboard/libraries/rescan").then(({data:e})=>{y.value=!1,t.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{y.value=!1,t.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}return(e,Z)=>{const c=A("Button");return i(),h(V,{error:_(E),"grid-style":1,description:"Manage your media libraries and their content here.",title:"Libraries"},{cta:s(()=>[v(c,{id:"newLibrary",disabled:o.value,color:"theme","start-icon":"folderAdd",onClick:$},{default:s(()=>[f(d(o.value?e.$t("Creating..."):e.$t("New library")),1)]),_:1},8,["disabled"])]),actions:s(()=>[v(c,{id:"refresh",class:p(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:B},{default:s(()=>[f(d(e.$t("Refresh all libraries")),1)]),_:1},8,["class","disabled"]),v(c,{id:"missing",class:p(n.value?"first:children:animate-spin !cursor-not-allowed":""),disabled:n.value,color:"auto","start-icon":"folderSwap",type:"button",variant:"text",onClick:D},{default:s(()=>[f(d(e.$t("Find missing")),1)]),_:1},8,["class","disabled"]),v(c,{id:"rescan",class:p(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:L},{default:s(()=>[f(d(e.$t("Rescan all libraries")),1)]),_:1},8,["class","disabled"])]),default:s(()=>[(i(!0),w(q,null,R(_(u)??[],g=>(i(),h(Q,{key:g.id,data:g},null,8,["data"]))),128))]),_:1},8,["error"])}}}),oe=U;export{oe as default};
