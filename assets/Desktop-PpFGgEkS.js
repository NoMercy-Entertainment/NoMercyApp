import{Y as $,c as y,o as c,l,i as o,h as I,a8 as M,d as v,C as j,j as k,B as f,v as _,y as n,Z as h,ar as B,F as A,p as E,an as T}from"./vue-ionic-Cv2or74p.js";import{u as U}from"./useApiClient-ukoCqN96.js";import{_ as L}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-T80GXZJS.js";import{_ as x}from"./Button.vue_vue_type_script_setup_true_lang-R7-60zhu.js";import{_ as z}from"./DashboardCard.vue_vue_type_script_setup_true_lang-BUnLVVM7.js";import{_ as F}from"./Avatar.vue_vue_type_script_setup_true_lang-DNoKJqSW.js";import{bg as N,c as S,z as Z}from"./index-C2Ct7WB4.js";import{u as D}from"./useServerClient-dUrNusTt.js";import{_ as K}from"./Modal.vue_vue_type_script_setup_true_lang-BFuGhVNW.js";import"./vendor-F08gofix.js";import"./icons-BW5E66pf.js";import"./rxjs-BCp2L9Rn.js";import"./media-C2AqgyMX.js";import"./api-BBofn2cc.js";import"./swiper-DhG1br88.js";import"./useInfiniteServerClient-CbFvL_Uv.js";import"./useMounted-CS-UU_bv.js";import"./FloatingBackButton.vue_vue_type_script_setup_true_lang-DFavHiT8.js";import"./OptimizedIcon.vue_vue_type_script_setup_true_lang-Bi-0Ik3i.js";import"./ScrollContainer.vue_vue_type_script_setup_true_lang-DeecvqeB.js";import"./RipperOverlay.vue_vue_type_script_setup_true_lang-D8gB4io9.js";import"./Button.vue_vue_type_script_setup_true_lang-BDrzJc8T.js";import"./music-player-Dgg5bFLw.js";const O={class:"relative flex aspect-square h-auto w-full flex-col items-center justify-center overflow-clip rounded-lg bg-black"},P=["src"],Q=$({__name:"UserCard",props:{data:{type:Object,required:!0}},setup(r){return(u,d)=>(c(),y(z,{route:`/dashboard/users/${r.data.user_id}`,line1:r.data.name,line2:""},{image:l(()=>[o("div",O,[d[0]||(d[0]=o("div",{class:"backdropCard-overlay"},null,-1)),r.data.avatar?(c(),I("img",{key:0,src:r.data.avatar,class:"w-full h-full object-cover rounded-lg",alt:""},null,8,P)):(c(),y(F,{key:1,email:r.data.email,class:"w-full"},null,8,["email"]))])]),_:1},8,["route","line1"]))}}),W={class:"flex w-full flex-col justify-start text-left"},Y={class:"py-4 text-sm text-auto-10"},G={class:"flex flex-col gap-2 w-full"},H={class:"pointer-events-auto mt-2 w-full flex-col gap-1 card flex justify-center"},J=$({__name:"InviteUserModal",props:{open:{type:Boolean,required:!0},close:{type:Function,required:!0}},setup(r){const{t:u}=M(),d=r;v(null);const a=v(""),p=v([]),{data:b}=D({path:"/dashboard/libraries"}),s=v(),g=()=>{p.value=[],d.close()},m=i=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/u.test(String(i).toLowerCase()),C=j(()=>a.value?m(a.value):!1),V=()=>{var i,e;if(!a.value){p.value.push({type:"error",place:"email",message:u("Email is required")});return}if(!m(a.value)){p.value.push({type:"error",place:"email",message:u("Invalid email address")});return}N().post("server/server-users",{id:(i=S.value)==null?void 0:i.id,email:a.value,libraries:(e=s.value)==null?void 0:e.map(t=>t.id)}).then(()=>{Z.invalidateQueries({queryKey:["server_users"]}),a.value="",d.close()}).catch(({response:t})=>{(t==null?void 0:t.status)!=200&&(t!=null&&t.data)&&p.value.push({message:t.data.message??"An error occurred",place:"email",type:t.data.status??t.data.exception})})};return(i,e)=>{const t=k("InputText"),q=k("MultiSelect");return c(),y(K,{open:r.open,close:g,title:"Invite user"},{actions:l(()=>[n(x,{type:"button",id:"yes",color:"theme",variant:"contained",endIcon:"emailSend",disabled:!C.value,onClick:V},{default:l(()=>[f(_(i.$t("Send")),1)]),_:1},8,["disabled"]),n(x,{type:"button",id:"no",variant:"text",onClick:g},{default:l(()=>[f(_(i.$t("Cancel")),1)]),_:1})]),default:l(()=>[o("div",W,[o("p",Y,[f(_(i.$t("Enter the email of the friend you want to invite to your server.")),1),e[2]||(e[2]=o("br",null,null,-1)),f(" "+_(i.$t("We will send this person an email with a link to join the server, if they accept the invitation they will be automatically shown here.")),1)]),o("div",G,[e[3]||(e[3]=o("label",{for:"email"},"Email",-1)),n(t,{id:"email",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=w=>a.value=w),class:"mb-4"},null,8,["modelValue"])]),o("div",H,[e[4]||(e[4]=o("label",{for:"libraries"},"Allowed libraries",-1)),n(q,{id:"libraries",display:"chip",label:"libraries",placeholder:"Select libraries",multiple:"",options:h(b),optionLabel:"title",modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=w=>s.value=w)},null,8,["options","modelValue"])])])]),_:1},8,["open"])}}}),Ce=$({__name:"Desktop",setup(r){var b;const u=v(!1),{data:d}=U({path:"server/server-users",params:{id:(b=S.value)==null?void 0:b.id},queryKey:["server_users"]}),a=()=>{u.value=!0,setTimeout(()=>{var s;(s=document.querySelector("#email"))==null||s.focus()},300)},p=()=>{u.value=!1};return(s,g)=>(c(),y(h(T),null,{default:l(()=>[n(h(B),{fullscreen:!0},{default:l(()=>[n(L,{gridStyle:1,title:"Server members",description:"Manage your server members and their account permissions here."},{cta:l(()=>[n(x,{id:"invite",color:"theme",startIcon:"userAdd",onClick:a},{default:l(()=>[f(_(s.$t("Invite user")),1)]),_:1})]),default:l(()=>[(c(!0),I(A,null,E([...h(d)??[]].sort((m,C)=>m.name.localeCompare(C.name)),m=>(c(),y(Q,{key:m.user_id,data:m},null,8,["data"]))),128)),n(J,{open:u.value,close:p},null,8,["open"])]),_:1})]),_:1})]),_:1}))}});export{Ce as default};
