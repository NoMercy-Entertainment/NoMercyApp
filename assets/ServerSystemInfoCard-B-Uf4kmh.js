import{$ as R,At as a,C as f,Dt as V,E as J,Et as d,K as O,O as z,Q as $,S as e,T as u,Y as r,Z as T,_t as y,c as C,g as E,j,k as h,kt as M,lt as m,st as U,w,x as N}from"./i18n-DXLa9EKW.js";import{m as K}from"./primevue-wrrgrfJj.js";import{a as G}from"./query-DJ5OsBey.js";import{$i as B,Da as H,Ki as X,Lr as Q,Qi as S,V as Y,b as c,v as A}from"./index-CLM6Y7vI.js";import{t as F}from"./useServerClient-QYfn39K-.js";import{t as Z}from"./KeepCounting-Bb5r22xI.js";import{s as I}from"./RipperOverlay-DCWWVsFD.js";import{n as q,r as D}from"./DashboardLayout-BtrwC5sp.js";C();var W={key:0},ee={class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch w-full pt-1 text-surface-12"},te={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},ae={class:"flex flex-grow flex-nowrap gap-2 text-xl font-medium"},se={class:"ml-auto flex gap-2 text-surface-12 bg-surface-12/2"},le={key:1,class:"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-3 self-stretch text-surface-12"},re={class:"relative flex flex-shrink-0 flex-grow-0 items-center justify-start gap-4 self-stretch"},ie={class:"flex flex-grow flex-nowrap gap-2 text-xl font-medium"},ne={class:"ml-auto flex gap-2 bg-surface-12/2"},oe=j({__name:"ServerSystemCard",props:{title:{type:String,required:!0},background:{type:Boolean,required:!1,default:!0}},setup(t){return(s,o)=>d(X)&&d(D)?(r(),u("div",W,[e("div",ee,[e("div",te,[e("p",ae,[e("span",null,a(s.$t(t.title)),1),$(s.$slots,"count")]),e("div",se,[$(s.$slots,"cta")])]),e("div",{class:V([{" bg-surface-5/6 text-surface-11 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[$(s.$slots,"default")],2)])])):d(D)?(r(),u("div",le,[e("div",re,[e("p",ie,[e("span",null,a(s.$t(t.title)),1),$(s.$slots,"count")]),e("div",ne,[$(s.$slots,"cta")])]),e("div",{class:V([{"bg-surface-12/3 text-surface-12/12 p-4":t.background},"flex flex-shrink-0 flex-grow-0 flex-col items-start justify-start gap-4 self-stretch rounded-xl overflow-clip"])},[$(s.$slots,"default")],2)])):w("",!0)}}),P=oe;C();var de={class:"relative flex w-full items-center justify-center gap-0.5 text-surface-12"},ue=["title"],ce={class:"flex-shrink-0 flex-grow-0 text-right text-xs font-light text-surface-10"},fe={class:"relative flex items-start justify-start gap-2 group/encoderCard"},ve={key:0,class:"relative aspect-video h-auto w-1/3 flex-shrink-0 flex-grow-0 overflow-hidden rounded-sm min-w-36",style:{background:`linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 0) 25%,
            rgba(0, 0, 0, 0) 50%,
            #000 100%
          )`}},xe={class:"absolute inset-0 z-0 h-full w-full bg-white/[0.01] flex flex-col justify-center"},he=["src"],me={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px]"},pe={class:"absolute z-10 flex items-end justify-start left-[3%] bottom-[3%] gap-[2%]"},ge={class:"absolute z-10 flex items-end justify-end right-[3%] bottom-[3%] gap-[2%] text-[10px]"},we={class:"group-hover/progress:hidden text-right font-bold monospace"},_e={class:"grid grid-cols-4 gap-2 flex-1"},be={class:"flex flex-col text-surface-12 col-span-4"},ke={class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},$e={class:"text-surface-12/11"},ye={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Se={class:"text-surface-12/11 text-2xs"},Ce={key:1,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},je={class:"font-medium text-2xs text-surface-12/11"},Ie={class:"flex flex-nowrap gap-4 flex-shrink-0 flex-grow-0 self-stretch text-sm"},qe={key:0,class:"flex flex-nowrap gap-2 flex-shrink-0 flex-grow-0 self-stretch text-sm"},Te={class:"w-full text-xs text-surface-10 line-clamp-1"},Ee=["title"],ze={class:"w-full text-xs text-surface-10 line-clamp-1"},Ne=["title"],Be={class:"w-full text-xs text-surface-10 line-clamp-1"},Pe={key:0,class:"absolute -bottom-0.5 left-0 h-1 w-full blur-[1px]"},Ve=j({__name:"ServerEncoderTaskCard",props:{data:{type:Object,required:!0}},setup(t){const s=t,o=y(s.data?.status);U(s,l=>{o.value=l.data.status});const v=N(()=>o.value==="running"?"running":"paused"),p=N(()=>s.data.thumbnails?`${`${B.value?.serverBaseUrl}\\${s.data.thumbnails}`.replace(/\\+/gu,"/").replace(/\/\/images/u,"/images")}?token=${H.value.accessToken}`:null);function i(){S().post(`/dashboard/tasks/pause/${s.data.process_id}`).then(({data:l})=>{o.value=l?"paused":o.value}).catch(()=>{})}function _(){S().post(`/dashboard/tasks/resume/${s.data.process_id}`).then(({data:l})=>{o.value=l?"running":o.value}).catch(()=>{})}function b(){o.value==="running"?i():_()}return(l,k)=>(r(),f(d(K),{class:"relative overflow-clip"},{title:m(()=>[e("div",de,[e("p",{title:t.data.title.replace(/NoMercy/giu,""),class:"w-full flex-grow text-sm font-semibold line-clamp-1 h-6"},a(t.data.title.replace(/NoMercy/giu,"")),9,ue),e("p",ce,a(l.$t("Id"))+": "+a(t.data?.process_id),1)])]),content:m(()=>[e("div",fe,[t.data?.message==="Encoding video"?(r(),u("div",ve,[e("div",xe,[k[0]||(k[0]=e("div",{class:"pointer-events-none absolute inset-0 z-10 mt-auto h-4/5 bg-gradient-to-t from-black via-black/60"},null,-1)),p.value?(r(),u("img",{key:0,src:p.value,alt:"",class:"absolute z-0 h-full w-full"},null,8,he)):w("",!0)]),e("button",{class:"absolute top-1/2 left-1/2 z-10 group-hover/encoderCard:flex hidden h-11 w-11 -translate-x-1/2 -translate-y-1/2 rounded-full bg-black/60 p-0.5 group/progress text-white flex flex-col",onClick:b},[e("div",me,[v.value==="running"?(r(),f(c,{key:0,class:"w-10",icon:"pause"})):(r(),f(c,{key:1,class:"w-10",icon:"play"}))])]),e("div",pe,[t.data?.has_gpu?(r(),f(c,{key:0,"class-name":"w-[15%]",icon:"gpu"})):(r(),f(c,{key:1,"class-name":"w-[15%]",icon:"cpu"})),t.data?.is_hdr?(r(),f(c,{key:2,"class-name":"w-[15%]",icon:"hdr"})):(r(),f(c,{key:3,"class-name":"w-[15%]",icon:"hdrOff"}))]),e("div",ge,[e("span",we,a(Math.floor(t.data?.progress??0))+"% ",1)])])):w("",!0),e("div",_e,[e("div",be,[e("span",ke,[h(c,{"class-name":"relative w-4",icon:"stickyNote"}),e("span",$e,a(t.data?.message),1)]),t.data?.message==="Encoding video"?(r(),u("span",ye,[h(c,{"class-name":"relative w-4",icon:"dashboard"}),e("span",Se,a(t.data?.speed)+"X ",1)])):w("",!0),t.data?.message==="Encoding video"?(r(),u("span",Ce,[h(c,{"class-name":"relative w-4",icon:"hourglass"}),e("span",je,a(t.data?.remaining_split?.[0]&&t.data?.remaining_split[0]>0?` ${t.data?.remaining_split?.[0]+l.$t("d")} `:"")+" "+a(t.data?.remaining_split?.[1]&&(t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[1]+l.$t("h")} `:"")+" "+a(t.data?.remaining_split?.[2]&&(t.data?.remaining_split[2]>0||t.data?.remaining_split[1]>0||t.data?.remaining_split[0]>0)?` ${t.data?.remaining_split?.[2]+l.$t("m")} `:"")+" "+a(t.data?.remaining_split?.[3]?` ${t.data?.remaining_split?.[3]+l.$t("s")} `:""),1)])):w("",!0),e("div",Ie,[t.data?.video_streams&&t.data?.message==="Encoding video"?(r(),u("span",qe,[h(c,{"class-name":"w-4",icon:"film"}),e("span",Te,a(t.data?.video_streams.length),1)])):w("",!0),t.data?.audio_streams&&t.data?.message==="Encoding video"?(r(),u("div",{key:1,title:t.data?.audio_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[h(c,{"class-name":"w-4",icon:"audioFile"}),e("span",ze,a(t.data?.audio_streams.length),1)],8,Ee)):w("",!0),t.data?.subtitle_streams&&t.data?.message==="Encoding video"?(r(),u("div",{key:2,title:t.data?.subtitle_streams?.join?.(", ")??"",class:"flex flex-nowrap gap-1 flex-shrink-0 flex-grow-0 self-stretch text-sm"},[h(c,{"class-name":"w-4",icon:"chatBubble"}),e("span",Be,a(t.data?.subtitle_streams.length),1)],8,Ne)):w("",!0)])])])]),t.data?.message==="Encoding video"?(r(),u("div",Pe,[k[1]||(k[1]=e("div",{class:"absolute w-full h-1 left-[-1px] top-[-1px] bg-black/[0.22]"},null,-1)),e("div",{style:M(`width: ${t.data.progress}%;`),class:"w-0 h-1 absolute left-[-1px] top-[-1px] rounded-sm bg-gradient-to-r from-black/5 to-[var(--color-theme-8)] z-10"},null,4),e("div",{style:M(`left: ${t.data.progress}%;`),class:"w-1 h-0.5 absolute top-[-1px] rounded-sm bg-[#f1eefe] -translate-x-[2px] z-0"},null,4)])):w("",!0)]),_:1}))}}),Me=Ve;C();var Qe={class:"flex flex-nowrap w-full justify-between"},De={class:"text-surface-12"},Oe={class:"flex flex-col text-surface-12"},Ue={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Ke={class:"text-surface-12/11"},Ae={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm flex justify-between"},Fe={class:"mr-auto"},Le={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Re={class:"text-surface-12/11"},Je={class:"flex-shrink-0 flex-grow-1 self-stretch text-sm"},Ge={class:"text-surface-12/11"},He=j({__name:"ServerQueueTaskCard",props:{data:{type:Object,required:!0}},setup(t){const s=t,o=y(s.data.priority??0);function v(i){S().patch(`/dashboard/tasks/queue/${s.data.id}`,{id:s.data.id,priority:i}).then(()=>{console.log("Priority updated")})}function p(){S().delete(`/dashboard/tasks/queue/${s.data.id}`).then(()=>{console.log("Item deleted")})}return U(o,i=>{console.log(i),v(i)}),(i,_)=>{const b=R("InputNumber");return r(),f(d(K),null,{title:m(()=>[e("span",Qe,[e("span",De,a(t.data.title.replace(/NoMercy/giu,"")),1),e("button",{class:"float-right flex items-center justify-center gap-2 overflow-hidden rounded-lg bg-transparent w-10 -mt-1.5 -mr-1.5 aspect-square",onClick:p},[h(c,{class:"relative h-5 w-5 flex-shrink-0 flex-grow-1",icon:"cross"})])])]),content:m(()=>[e("div",Oe,[e("p",Ue,[z(a(i.$t("Id"))+": ",1),e("span",Ke,a(t.data.id),1)]),e("span",Ae,[e("span",Fe,a(i.$t("Priority"))+": ",1),h(b,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=l=>o.value=l),max:100,min:0,step:1,class:"ml-auto h-8 first:children:!w-12 last:children:!w-4 children:last:children:!w-4 overflow-clip -mb-2","show-buttons":"",size:"small",variant:"filled"},null,8,["modelValue"])]),e("span",Le,[z(a(i.$t("Profile"))+": ",1),e("span",Re,a(t.data.profile),1)]),e("span",Je,[z(a(i.$t("File"))+": ",1),e("span",Ge,a(t.data.input_file),1)])])]),_:1})}}}),Xe=A(He,[["__scopeId","data-v-8e217994"]]);C();var Ye={class:"h-7 w-min flex rounded-lg px-2 border border-solid border-surface-12/11 text-surface-11 text-sm font-semibold"},Ze={class:"flex-shrink-0 flex-grow-0 text-sm"},We={class:"relative flex items-start justify-start gap-2 self-stretch rounded-lg p-4 text-surface-11 bg-surface-12/2"},et={class:"flex-shrink-0 flex-grow-0 self-stretch text-sm font-semibold"},tt=j({__name:"ServerTasksCard",setup(t){const s=y([]),o=y(!1),{data:v,refetch:p}=F({path:"dashboard/tasks/queue",queryKey:["queue"],refetchInterval:3e4});O(()=>{s.value=[]});function i(n){n.status==="running"||n.status==="paused"?s.value=Q([...s.value.filter(x=>x.id!==n.id),n],"id"):(s.value=Q([...s.value.filter(x=>x.id!==n.id)],"id"),p())}const _=N(()=>{const n=v.value?.filter(x=>!s.value.find(g=>g.title===x.title))??[];return o.value||n.length<=20?n:[...n.slice(0,5),...n.slice(-5)]});function b(n){v.value=n}function l(){s.value=[],p()}function k(){o.value=!o.value}return I(q,"encoder-progress",i),I(q,"encoder-queue",b),I(q,"encoder-clear",l),I(q,"disconnected",l),(n,x)=>s.value.length||d(v)?.length?(r(),f(P,{key:0,background:!1,title:"Running tasks"},J({cta:m(()=>[e("button",{class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11",onClick:k},[e("p",Ze,a(o.value?n.$t("Show less"):n.$t("Show all")),1)])]),default:m(()=>[(r(!0),u(E,null,T(s.value.toSorted((g,L)=>g.title.localeCompare(L.title))??[],g=>(r(),f(Me,{key:g.id,data:g},null,8,["data"]))),128)),(r(!0),u(E,null,T(_.value,g=>(r(),f(Xe,{key:g.id,data:g},null,8,["data"]))),128))]),_:2},[d(v)?.length?{name:"count",fn:m(()=>[e("span",Ye,a(d(v)?.length),1)]),key:"0"}:void 0]),1024)):(r(),f(P,{key:1,background:!1,title:"Running tasks"},{default:m(()=>[e("div",We,[e("span",et,a(n.$t("No tasks are currently running")),1)])]),_:1}))}}),Vt=tt;C();var at={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},st={class:"flex-shrink-0 flex-grow-0 text-sm"},lt={class:"relative h-7 flex flex-shrink-0 flex-grow-0 items-center justify-center gap-2 overflow-hidden border border-solid border-surface-12/11 rounded-lg pl-1 pr-2 py-1 text-surface-12/11"},rt={class:"flex-shrink-0 flex-grow-0 text-sm"},it={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},nt={class:"w-40 flex-grow whitespace-nowrap text-sm"},ot={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},dt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},ut={class:"w-40 flex-grow whitespace-nowrap text-sm"},ct={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},ft={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},vt={class:"w-40 flex-grow whitespace-nowrap text-sm"},xt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},ht={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},mt={class:"w-40 flex-grow whitespace-nowrap text-sm"},pt={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},gt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},wt={class:"w-40 flex-grow whitespace-nowrap text-sm"},_t={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},bt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},kt={class:"w-40 flex-grow whitespace-nowrap text-sm"},$t={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},yt={class:"flex flex-1 flex-nowrap text-sm line-clamp-2 w-available"},St={class:"w-40 flex-grow whitespace-nowrap text-sm"},Ct={class:"text-sm line-clamp-2 text-surface-12/11 text-right w-full"},jt=j({__name:"ServerSystemInfoCard",setup(t){const s=y(!1),o=y(!0),{data:v,refetch:p}=G({queryKey:["runners",B.value?.serverBaseUrl],retryOnMount:!0,queryFn:()=>S().get("dashboard/tasks/runners").then(({data:l})=>(s.value=!(l.workers>0),l.workers??[]))}),{data:i}=F({path:"dashboard/server/info",queryKey:["serverInfo",B.value?.serverBaseUrl]});function _(){o.value=!0,p()}function b(){o.value=!1}return O(()=>{const l=Y();l?.onreconnected(_),l?.onclose(b)}),(l,k)=>(r(),f(P,{title:"System"},{cta:m(()=>[e("button",at,[h(c,{class:"w-4",icon:"pause"}),e("p",st,a(l.$t("Pause")),1)]),e("button",lt,[h(c,{class:"w-4",icon:"shutdown"}),e("p",rt,a(l.$t("Shutdown")),1)])]),default:m(()=>[e("div",it,[e("p",nt,a(l.$t("Server")),1),e("p",ot,a(d(i)?.server),1)]),e("div",dt,[e("p",ut,a(l.$t("Server version")),1),e("p",ct,a(d(i)?.version),1)]),e("div",ft,[e("p",vt,a(l.$t("Uptime")),1),e("p",xt,[(r(),f(Z,{key:d(i)?.bootTime,"start-time":d(i)?.bootTime},null,8,["start-time"]))])]),e("div",ht,[e("p",mt,a(l.$t("OS")),1),e("p",pt,a(d(i)?.os.toTitleCase()),1)]),e("div",gt,[e("p",wt,a(l.$t("Architecture")),1),e("p",_t,a(d(i)?.arch),1)]),(r(!0),u(E,null,T(d(i)?.cpu,(n,x)=>(r(),u("div",bt,[e("p",kt,a(l.$t("CPU"))+" #"+a(x+1),1),e("p",$t,a(n),1)]))),256)),(r(!0),u(E,null,T(d(i)?.gpu,(n,x)=>(r(),u("div",yt,[e("p",St,a(l.$t("GPU"))+" #"+a(x+1),1),e("p",Ct,a(n),1)]))),256))]),_:1}))}}),Mt=A(jt,[["__scopeId","data-v-c6231921"]]);export{Vt as n,P as r,Mt as t};
