import{C as y,Et as g,J as o,O as m,Q as R,S as k,T as w,Tt as v,X as q,c as S,ct as t,g as A,gt as b,j as x,k as i,kt as u}from"./i18n-Bgv5p1Yb.js";import"./ionic-B1wlflFe.js";import{C as T,_ as M}from"./vue-core-Dey0Eikg.js";import{C as N}from"./primevue-CuC2W_MW.js";import"./query-xyWPY_A0.js";import{Gi as j,Ki as h,_i as r,n as I,qi as C}from"./index-B_NkyEly.js";import"./useInfiniteServerClient-BCGUWDge.js";import{t as K}from"./useServerClient-B06v0qGB.js";import"./ScrollContainer-C9fy_G9S.js";import"./useMounted-Cjvkyxzm.js";import"./RipperOverlay-DcCGekik.js";import"./ripperSocket-4ePkZ4cT.js";import"./FloatingBackButton-CZyYttZP.js";import{t as V}from"./DashboardLayout-DMRwa1MN.js";import{t as z}from"./DashboardCard-B3u9zURD.js";S();var F={class:"relative flex aspect-video flex-shrink-0 flex-grow-0 flex-col items-center justify-center self-stretch overflow-clip rounded-lg bg-theme-8"},O={key:1,class:"text-xl font-bold text-center"},Q=x({__name:"LibraryCard",props:{data:{type:Object,required:!0}},setup(a){return(s,c)=>(o(),y(z,{line1:a.data.title,line2:a.data.folder_library&&a.data.folder_library?.length!==1?`${a.data.folder_library?.length} folders`:`${a.data.folder_library?.length}  folder`,route:`/dashboard/libraries/${a.data.id}`},{image:t(()=>[k("div",F,[c[0]||(c[0]=k("div",{class:"backdropCard-overlay"},null,-1)),a.data.image?(o(),y(I,{key:0,path:a.data.image,aspect:"backdrop",class:"z-0"},null,8,["path"])):(o(),w("span",O,u(a.data.title),1))])]),_:1},8,["line1","line2","route"]))}}),U=Q;S();var G=x({__name:"Desktop",setup(a){const s=N(),{data:c,error:E}=K({path:"dashboard/libraries",queryKey:["dashboard","libraries",C.value?.serverBaseUrl]}),n=b(!1);async function B(){if(!n.value){n.value=!0;try{const{data:e}=await h().post("dashboard/libraries");s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3}),j.invalidateQueries({queryKey:["dashboard","libraries",C.value?.serverBaseUrl]})}catch{s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while creating the library"),life:5e3})}finally{n.value=!1}}}const l=b(!1);function L(){l.value=!0,h().post("dashboard/libraries/refresh").then(({data:e})=>{l.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{l.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}const d=b(!1);function $(){d.value=!0,h().post("dashboard/libraries/scan-new").then(({data:e})=>{d.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{d.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the library folders"),life:5e3})})}const p=b(!1);function D(){p.value=!0,h().post("dashboard/libraries/rescan").then(({data:e})=>{p.value=!1,s.add({severity:e.status==="ok"?"success":"error",summary:r(e.status==="ok"?"Success":"Error"),detail:r(e.message,...e.args),life:5e3})}).catch(()=>{p.value=!1,s.add({severity:"error",summary:r("Error"),detail:r("An error occurred while rescanning the libraries"),life:5e3})})}return(e,J)=>{const f=R("Button");return o(),y(v(T),null,{default:t(()=>[i(v(M),{fullscreen:!0},{default:t(()=>[i(V,{error:v(E),"grid-style":1,description:"Manage your media libraries and their content here.",title:"Libraries"},{cta:t(()=>[i(f,{id:"newLibrary",disabled:n.value,color:"theme","start-icon":"folderAdd",onClick:B},{default:t(()=>[m(u(n.value?e.$t("Creating..."):e.$t("New library")),1)]),_:1},8,["disabled"])]),actions:t(()=>[i(f,{id:"refresh",class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:L},{default:t(()=>[m(u(e.$t("Refresh all libraries")),1)]),_:1},8,["class","disabled"]),i(f,{id:"missing",class:g(d.value?"first:children:animate-spin !cursor-not-allowed":""),disabled:d.value,color:"auto","start-icon":"folderSwap",type:"button",variant:"text",onClick:$},{default:t(()=>[m(u(e.$t("Find missing")),1)]),_:1},8,["class","disabled"]),i(f,{id:"rescan",class:g(l.value?"first:children:animate-spin cursor-not-allowed":""),disabled:l.value,"start-icon":"folderSwap",type:"button",variant:"text",onClick:D},{default:t(()=>[m(u(e.$t("Rescan all libraries")),1)]),_:1},8,["class","disabled"])]),default:t(()=>[(o(!0),w(A,null,q(v(c)??[],_=>(o(),y(U,{key:_.id,data:_},null,8,["data"]))),128))]),_:1},8,["error"])]),_:1})]),_:1})}}}),de=G;export{de as default};
