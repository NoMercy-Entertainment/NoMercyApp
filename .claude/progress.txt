# NoMercy.App Performance Optimization Progress

## Completed Tasks

### Phase 1.1: Configure Manual Chunks (vite.config.ts)
- Status: DONE (prior to this session)
- Changed manualChunks from object syntax to function syntax for rolldown-vite compatibility

### Phase 1.2: Fix Layout Imports (src/router/routes.ts)
- Status: DONE
- Date: 2026-02-05
- Changed layout imports from immediate execution to lazy-loaded functions:
  - `const MobileBaseLayout = import(...)` → `const MobileBaseLayout = () => import(...)`
  - `const DesktopBaseLayout = import(...)` → `const DesktopBaseLayout = () => import(...)`
- This prevents both layouts from loading at module initialization; only the needed layout loads when used

### Phase 1.3: Remove Swiper Duplication
- Status: DONE
- Date: 2026-02-05
- Changes made:
  1. Removed web component bundle import and registration from src/setupApp.ts:
     - Removed `import { register as registerSwiperElements } from 'swiper/element/bundle';`
     - Removed `registerSwiperElements();` call
  2. Removed duplicate web component registration from src/components/Carousel/Carousel.vue:
     - Removed `import { register } from 'swiper/element/bundle';`
     - Removed `register();` call
- The app now only uses Vue Swiper components (Swiper, SwiperSlide from 'swiper/vue')
- This eliminates ~100KB of duplicate Swiper code (web component bundle)

### Phase 1.4: Add Preconnect Hints (index.html)
- Status: DONE
- Date: 2026-02-05
- Changes made:
  1. Removed placeholder dns-prefetch for `//api.example.com`
  2. Removed `x-dns-prefetch-control: off` meta tag
  3. Added preconnect hints for external domains:
     - `https://media.themoviedb.org` (TMDB images)
     - `https://app.nomercy.tv` (app server)
     - `https://auth-dev.nomercy.tv` (Keycloak auth)
     - `https://fonts.bunny.net` (Google Fonts alternative)
  4. Added dns-prefetch for `https://cdn.nomercy.tv`
- Font preloads already existed in the file, kept as is

### Phase 2.1: Convert NM Components to Local Component Map with Lazy Loading
- Status: DONE
- Date: 2026-02-05
- Changes made:
  1. Created src/components/nmComponentMap.ts:
     - Single shared export with all 15 NM components as defineAsyncComponent lazy imports
     - Used by all components that render dynamic NM components
  2. Updated src/setupApp.ts:
     - Removed all NM component imports and global registrations
     - Removed unused supportsCarousel variable and isMobile import
  3. Updated components to use shared nmComponentMap:
     - src/components/NMComponent.vue
     - src/components/NMCarousel.vue
     - src/components/NMCarousel2.vue
     - src/components/NMContainer.vue
     - src/components/NMList.vue
     - src/components/NMGrid.vue
- Benefits:
  - Single source of truth for NM component map (DRY principle)
  - NM components now load only when API requests them
  - Reduces initial bundle size (components split into separate chunks)
  - Easy to add new NM components - just update nmComponentMap.ts

### Phase 2.1b: Add Loading Skeletons for Lazy-Loaded Components
- Status: DONE
- Date: 2026-02-05
- Changes made:
  1. Created src/components/Loading/NMCardSkeleton.vue:
     - Animated pulse placeholder with correct aspect ratio (poster/backdrop)
     - Matches card dimensions to prevent layout shift
  2. Updated src/components/nmComponentMap.ts:
     - Card components now use loadingComponent option with NMCardSkeleton
     - Applied to: NMCard, NMGenreCard, NMHomeCard, NMSeasonCard, NMMusicCard,
       NMMusicHomeCard, NMTopResultCard
- Benefits:
  - Prevents CLS (Cumulative Layout Shift) while async components load
  - Smooth loading experience with animated placeholders

## Next Tasks (from PRD)
- Phase 2.2: Use defineAsyncComponent for Heavy Components (VideoPlayer, MusicPlayer, Dashboard)
